"use strict";(self.webpackChunkmegaten_fusion_tool=self.webpackChunkmegaten_fusion_tool||[]).push([[452],{609:(q,w,u)=>{u.d(w,{d:()=>n});var l=u(4412);class n{constructor(D,E,$,A,x){this.settingsKey=A,this.settingsVersion=x,this._compendium=D,this._compendium$=new l.t(this._compendium),this.compendium=this._compendium$.asObservable(),this._fusionChart=E,this._fusionChart$=new l.t(this._fusionChart),this.fusionChart=this._fusionChart$.asObservable(),this._fusionSettings=$,this._fusionSettings$=new l.t(this._fusionSettings),this.fusionSettings=this._fusionSettings$.asObservable();const V=JSON.parse(localStorage.getItem(this.settingsKey));V&&V.version&&V.version>=this.settingsVersion&&this.updateFusionSettings(V.settings),window.addEventListener("storage",this.onStorageUpdated.bind(this))}updateToggledSettings(D){this._fusionSettings.updateSaveFile(D),this._compendium.updateFusionSettings(this._fusionSettings.demonToggles),this._compendium$.next(this._compendium),this._fusionSettings$.next(this._fusionSettings)}onStorageUpdated(D){D.key===this.settingsKey&&this.updateToggledSettings(JSON.parse(D.newValue).settings)}updateFusionSettings(D){this.updateToggledSettings(D),localStorage.setItem(this.settingsKey,JSON.stringify({version:this.settingsVersion,settings:this._fusionSettings.saveFile}))}}},9436:(q,w,u)=>{u.d(w,{d:()=>S});var l=u(1090),n=u(2598),o=u(177),D=u(4207);function E(m,y){if(1&m&&(n.j41(0,"th",4),n.EFF(1,"Inheritable Skills"),n.k0s()),2&m){const f=n.XpG();n.BMQ("colspan",f.inheritHeaders.length)}}function $(m,y){if(1&m&&(n.j41(0,"th",4),n.EFF(1),n.nI1(2,"translateComp"),n.k0s()),2&m){const f=n.XpG();n.BMQ("colspan",f.inheritHeaders.length),n.R7$(1),n.SpI(" ",n.i5U(2,2,f.msgs.SkillAffinities,f.lang)," ")}}function A(m,y){if(1&m&&(n.qex(0),n.EFF(1),n.bVm()),2&m){const f=n.XpG().$implicit;n.R7$(1),n.JRh(f)}}function x(m,y){if(1&m&&(n.j41(0,"div"),n.EFF(1),n.k0s()),2&m){const f=n.XpG().$implicit;n.ZvI("element-icon ",f,""),n.R7$(1),n.JRh(f)}}function V(m,y){if(1&m&&(n.j41(0,"th"),n.DNE(1,A,2,1,"ng-container",3),n.DNE(2,x,2,4,"div",5),n.k0s()),2&m){const f=n.XpG();n.xc7("width",100/f.inheritHeaders.length,"%"),n.R7$(1),n.Y8G("ngIf",!f.hasIcons),n.R7$(1),n.Y8G("ngIf",f.hasIcons)}}function Q(m,y){if(1&m&&(n.j41(0,"td"),n.EFF(1),n.k0s()),2&m){const f=y.$implicit;n.xc7("color",f?null:"transparent"),n.R7$(1),n.SpI(" ",f?"yes":"no"," ")}}function t(m,y){if(1&m&&(n.j41(0,"tr"),n.DNE(1,Q,2,3,"td",6),n.k0s()),2&m){const f=n.XpG();n.R7$(1),n.Y8G("ngForOf",f.inherits)}}function T(m,y){if(1&m&&(n.j41(0,"td"),n.nI1(1,"roundInheritPercent"),n.EFF(2),n.k0s()),2&m){const f=y.$implicit;n.ZvI("affinity",n.bMT(1,4,f),""),n.R7$(2),n.SpI(" ",f,"% ")}}function k(m,y){if(1&m&&(n.j41(0,"tr"),n.DNE(1,T,3,6,"td",7),n.k0s()),2&m){const f=n.XpG();n.R7$(1),n.Y8G("ngForOf",f.inherits)}}function F(m,y){if(1&m&&(n.j41(0,"td"),n.EFF(1),n.nI1(2,"affinityToString"),n.k0s()),2&m){const f=y.$implicit;n.ZvI("affinity",f,""),n.R7$(1),n.SpI(" ",n.bMT(2,4,f)," ")}}function p(m,y){if(1&m&&(n.j41(0,"tr"),n.DNE(1,F,3,6,"td",7),n.k0s()),2&m){const f=n.XpG();n.R7$(1),n.Y8G("ngForOf",f.inherits)}}let S=(()=>{class m{constructor(){this.inheritHeaders=[],this.inherits=[],this.hasChance=!1,this.hasIcons=!0,this.hasLvls=!1,this.lang="en",this.msgs=l.dx}static{this.\u0275fac=function(B){return new(B||m)}}static{this.\u0275cmp=n.VBU({type:m,selectors:[["app-demon-inherits"]],inputs:{inheritHeaders:"inheritHeaders",inherits:"inherits",hasChance:"hasChance",hasIcons:"hasIcons",hasLvls:"hasLvls",lang:"lang"},decls:11,vars:6,consts:[[1,"entry-table"],["class","title",4,"ngIf"],[3,"width",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"title"],[3,"class",4,"ngIf"],[3,"color",4,"ngFor","ngForOf"],[3,"class",4,"ngFor","ngForOf"]],template:function(B,K){1&B&&(n.j41(0,"table",0)(1,"thead")(2,"tr"),n.DNE(3,E,2,1,"th",1),n.DNE(4,$,3,5,"th",1),n.k0s(),n.j41(5,"tr"),n.DNE(6,V,3,4,"th",2),n.k0s()(),n.j41(7,"tbody"),n.DNE(8,t,2,1,"tr",3),n.DNE(9,k,2,1,"tr",3),n.DNE(10,p,2,1,"tr",3),n.k0s()()),2&B&&(n.R7$(3),n.Y8G("ngIf",!K.hasLvls),n.R7$(1),n.Y8G("ngIf",K.hasLvls&&K.inheritHeaders.length),n.R7$(2),n.Y8G("ngForOf",K.inheritHeaders),n.R7$(2),n.Y8G("ngIf",!K.hasLvls&&!K.hasChance),n.R7$(1),n.Y8G("ngIf",K.hasChance),n.R7$(1),n.Y8G("ngIf",K.hasLvls))},dependencies:[o.Sq,o.bT,D.uz,D.XM,D.D8],encapsulation:2,changeDetection:0})}}return m})()},9023:(q,w,u)=>{u.d(w,{q:()=>T});var l=u(2755),n=u(1090),o=u(2598),D=u(345),E=u(8935),$=u(177);function A(k,F){if(1&k&&(o.j41(0,"th"),o.EFF(1),o.k0s()),2&k){const p=F.$implicit,S=o.XpG();o.R7$(1),o.JRh(p.slice(0,S.nameCut))}}function x(k,F){if(1&k&&(o.j41(0,"td",4),o.EFF(1),o.k0s()),2&k){const p=F.$implicit,S=o.XpG(2);o.Y8G("ngClass",p.slice(0,4)),o.R7$(1),o.JRh(p.slice(4,S.nameCut+4))}}function V(k,F){if(1&k&&(o.j41(0,"tr")(1,"th"),o.EFF(2),o.k0s(),o.DNE(3,x,2,2,"td",3),o.j41(4,"th"),o.EFF(5),o.k0s()()),2&k){const p=F.$implicit;o.R7$(2),o.JRh(p[0]),o.R7$(1),o.Y8G("ngForOf",p.slice(1,p.length-1)),o.R7$(2),o.JRh(p[p.length-1])}}function Q(k,F){if(1&k&&(o.j41(0,"th"),o.EFF(1),o.k0s()),2&k){const p=F.$implicit,S=o.XpG();o.R7$(1),o.JRh(p.slice(0,S.nameCut))}}function t(k,F){if(1&k&&(o.j41(0,"tr")(1,"th",0),o.EFF(2),o.k0s()()),2&k){const p=o.XpG();o.R7$(1),o.BMQ("colspan",p.table[0].length),o.R7$(1),o.Lme("",p.appName," ",p.tripTitle,"")}}class T{static{this.RESULT_COLORS=Object.entries({oran:["-2","Erthys","Gnome","Saki","Saki Mitama","Random","\u30a2\u30fc\u30b7\u30fc\u30ba","\u30ce\u30fc\u30e0","\u30b5\u30ad\u30df\u30bf\u30de"],redd:["-1","Flaemis","Salamander","Ara ","Ara Mitama","Fiend","\u30d5\u30ec\u30a4\u30df\u30fc\u30ba","\u30b5\u30e9\u30de\u30f3\u30c0\u30fc","\u30a2\u30e9\u30df\u30bf\u30de"],gree:["1","Aeros","Sylph","Kusi","Kusi Mitama","UMA","\u30a8\u30a2\u30ed\u30b9","\u30b7\u30eb\u30ad\u30fc","\u30af\u30b7\u30df\u30bf\u30de"],blue:["2","Aquans","Undine","Nigi","Nigi Mitama","Enigma","\u30a2\u30af\u30a2\u30f3\u30ba","\u30a6\u30f3\u30c7\u30a3\u30fc\u30cd","\u30cb\u30ae\u30df\u30bf\u30de"]})}constructor(F,p){this.title2=F,this.route=p,this.normTitle="Normal Fusions",this.tripTitle="",this.isPersona=!1,this.filterDarks=!0,this.lang="en",this.msgs=n.qh,this.subscriptions=[],this.table=[],this.nameCut=4}ngOnInit(){this.subscriptions.push(this.route.parent.data.subscribe(F=>{this.appName=F.appName||"Shin Megami Tensei",this.nameCut=parseInt((0,l.oO)(this.msgs.NameCut,F.lang)),this.title2.setTitle((0,l.oO)(this.msgs.AppTitle,F.lang).replace("$APP",this.appName))}))}ngOnChanges(){this.normChart&&this.fillFusionChart()}ngOnDestroy(){for(const F of this.subscriptions)F.unsubscribe()}fillFusionChart(){const F="noneNone",S=T.RESULT_COLORS.reduce((G,[N,U])=>U.reduce((Y,tt)=>(Y[tt]=N,Y),G),{}),m=this.normChart.elementDemons;let y=[],f=this.normChart.races,B=[];this.filterDarks&&(y=this.normChart.races.filter(G=>this.normChart.getLightDark(G)>0),f=this.normChart.races.filter(G=>0===this.normChart.getLightDark(G)),B=this.normChart.races.filter(G=>-1===this.normChart.getLightDark(G)),0===B.length&&y.length>0&&(y=this.normChart.races.filter(G=>this.normChart.getLightDark(G)>-1),f=[],B=this.normChart.races.filter(G=>this.normChart.getLightDark(G)<-1)));const K=y.length-B.length,z=y.concat(f,m),it=B.length?B.concat(Array(z.length-B.length).fill("")):z,pt=this.mitaTable?z:y.concat(f,Array(m.length).fill("")),ot=this.mitaTable||B.length?Array(K).fill("").concat(B,f,m):z;this.table=[[""].concat(z,[""])];for(let G=0;G<ot.length;G++){const N=Array(z.length+2).fill("empt-"),U=ot[G],Y=pt[G],tt=-1!==m.indexOf(U),ft=-1!==m.indexOf(Y);this.table.push(N),N[0]=U,N[N.length-1]=Y;for(let M=G;M<z.length;M++){const L=z[M],X=-1!==m.indexOf(L);if(X&&ft){const W=m.indexOf(Y),r=m.indexOf(L),c=this.mitaTable[r][W].replace("-","");N[M+1]=c?(S[c]||"norm")+c:F}else if(X&&Y){const W=this.normChart.getElemFusions(L)[Y];N[M+1]=W?(S[W]||"rank")+(W>0?"+":"")+W.toString():F}else if(L&&Y){const W=this.isPersona&&L===Y?L:this.normChart.getRaceFusion(L,Y);N[M+1]=W?(S[W]||(L===Y?"elem":"norm"))+W:F}}if(this.tripChart)for(let M=0;M<=G-K;M++){const L=it[M];if(L&&tt){const X=this.tripChart.getElemFusions(U)[L];N[M+1]=X?(S[X]||"rank")+(X>0?"+":"")+X.toString():F}else if(L&&U){const X=this.tripChart.getRaceFusion(L,U);N[M+1]=X?(S[X]||(L===U?"elem":"trip"))+X:F}}if(-1!==U.indexOf(" x ")){const[M,L]=U.split(" x "),X=M.slice(0,3)+"x"+L.slice(0,3);N[0]=X,N[N.length-1]=X}else if(-1!==U.indexOf(" ")){const M=U.split(" ")[0];N[0]=M,N[N.length-1]=M}}for(let G=0;G<this.table[0].length;G++){const N=this.table[0][G];if(-1!==N.indexOf(" x ")){const[U,Y]=N.split(" x ");this.table[0][G]=U.slice(0,2)+Y.slice(0,2)}}this.table.push([""].concat(it,[""]))}static{this.\u0275fac=function(p){return new(p||T)(o.rXU(D.hE),o.rXU(E.nX))}}static{this.\u0275cmp=o.VBU({type:T,selectors:[["app-fusion-chart"]],inputs:{normChart:"normChart",tripChart:"tripChart",mitaTable:"mitaTable",normTitle:"normTitle",tripTitle:"tripTitle",isPersona:"isPersona",filterDarks:"filterDarks",lang:"lang",counter:"counter"},features:[o.OA$],decls:12,vars:7,consts:[[1,"title"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(p,S){1&p&&(o.j41(0,"table")(1,"tbody")(2,"tr")(3,"th",0),o.EFF(4),o.k0s()(),o.j41(5,"tr"),o.DNE(6,A,2,1,"th",1),o.k0s(),o.DNE(7,V,6,3,"tr",1),o.j41(8,"tr"),o.DNE(9,Q,2,1,"th",1),o.k0s(),o.DNE(10,t,3,3,"tr",2),o.k0s(),o.nrm(11,"tbody"),o.k0s()),2&p&&(o.R7$(3),o.BMQ("colspan",S.table[0].length),o.R7$(1),o.Lme("",S.appName," ",S.normTitle,""),o.R7$(2),o.Y8G("ngForOf",S.table[0]),o.R7$(1),o.Y8G("ngForOf",S.table.slice(1,S.table.length-1)),o.R7$(2),o.Y8G("ngForOf",S.table[S.table.length-1]),o.R7$(1),o.Y8G("ngIf",S.tripTitle))},dependencies:[$.YU,$.Sq,$.bT],styles:["table[_ngcontent-%COMP%]{width:auto;margin:0 auto;white-space:nowrap}td.elem[_ngcontent-%COMP%]{color:#0f0}td.trip[_ngcontent-%COMP%]{color:#d3d3d3}td.oran[_ngcontent-%COMP%]{color:orange}td.redd[_ngcontent-%COMP%]{color:red}td.gree[_ngcontent-%COMP%]{color:#0f0}td.blue[_ngcontent-%COMP%]{color:#0ff}td.none[_ngcontent-%COMP%]{color:transparent}td.empt[_ngcontent-%COMP%]{background-color:transparent;color:transparent}"],changeDetection:0})}}},860:(q,w,u)=>{u.d(w,{B:()=>Q});var l=u(2598),n=u(2755),o=u(1090),D=u(345),E=u(177),$=u(4207);function A(t,T){if(1&t){const k=l.RV6();l.qex(0),l.j41(1,"tr")(2,"th"),l.EFF(3,"All Demons"),l.k0s()(),l.j41(4,"tr")(5,"td")(6,"button",4),l.bIt("click",function(){l.eBV(k);const p=l.XpG();return l.Njj(p.toggledAll.emit(!0))}),l.EFF(7,"Enable All"),l.k0s(),l.j41(8,"button",4),l.bIt("click",function(){l.eBV(k);const p=l.XpG();return l.Njj(p.toggledAll.emit(!1))}),l.EFF(9,"Disable All"),l.k0s()()(),l.bVm()}}function x(t,T){if(1&t){const k=l.RV6();l.j41(0,"tr")(1,"td")(2,"label"),l.EFF(3),l.j41(4,"input",5),l.bIt("change",function(){const S=l.eBV(k).$implicit,m=l.XpG(2);return l.Njj(m.toggledName.emit(S.name))}),l.k0s()()()()}if(2&t){const k=T.$implicit;l.R7$(3),l.SpI("",k.caption," "),l.R7$(1),l.Y8G("checked",k.enabled)}}function V(t,T){if(1&t&&(l.qex(0),l.j41(1,"tr")(2,"th"),l.EFF(3),l.k0s()(),l.DNE(4,x,5,2,"tr",3),l.bVm()),2&t){const k=T.$implicit;l.R7$(3),l.JRh(k.category),l.R7$(1),l.Y8G("ngForOf",k.settings)}}let Q=(()=>{class t{constructor(k){this.title=k,this.lang="en",this.showEnableAll=!1,this.toggledAll=new l.bkB,this.toggledName=new l.bkB,this.msgs=o.BR}set appTitle(k){this.title.setTitle((0,n.oO)(this.msgs.AppTitle,this.lang)+k)}static{this.\u0275fac=function(F){return new(F||t)(l.rXU(D.hE))}}static{this.\u0275cmp=l.VBU({type:t,selectors:[["app-fusion-settings"]],inputs:{dlcDemons:"dlcDemons",lang:"lang",fusionSettings:"fusionSettings",showEnableAll:"showEnableAll",appTitle:"appTitle"},outputs:{toggledAll:"toggledAll",toggledName:"toggledName"},decls:12,vars:6,consts:[[1,"entry-table"],[1,"title"],[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"width","50%",3,"click"],["type","checkbox",3,"checked","change"]],template:function(F,p){1&F&&(l.qex(0),l.j41(1,"h2"),l.EFF(2),l.nI1(3,"translateComp"),l.k0s(),l.j41(4,"table",0)(5,"thead")(6,"tr")(7,"th",1),l.EFF(8,"Unlock Conditions"),l.k0s()()(),l.j41(9,"tbody"),l.DNE(10,A,10,0,"ng-container",2),l.DNE(11,V,5,2,"ng-container",3),l.k0s()(),l.bVm()),2&F&&(l.R7$(2),l.JRh(l.i5U(3,3,p.msgs.DlcTitle,p.lang)),l.R7$(8),l.Y8G("ngIf",p.showEnableAll),l.R7$(1),l.Y8G("ngForOf",p.fusionSettings.displayHeaders))},dependencies:[E.Sq,E.bT,$.uz],encapsulation:2,changeDetection:0})}}return t})()},1289:(q,w,u)=>{u.d(w,{h:()=>W});var l=u(4207),n=u(4660);function D(r,c){return parseInt(c.map(e=>r.includes(e)?"1":"0").join(""),2)||0}function E(r,c){return r.map((e,s,i)=>D(i.slice(0,s+1),c))}function A(r,c,e,s,i,a){let h=e,g=[h];const b=s.getSpecialNameEntries(h),j=c[c.length-1];if(0!==b.length&&(h=b.find(I=>0===s.getSpecialNameEntries(I).length),g.unshift(b.filter(I=>I!==h).join(" x ")),g.unshift(h)),r.length>0){const I=function V(r,c,e,s,i){const{fusionCalculator:a}=i,h=r.slice(0,1);if(r.length<2)return h;let g=h[0],b=c[0];for(let j=1;j<r.length;j++){const I=r[j],C=c[j],d=a.getFusions(g,e,s).map(O=>(0,n.lA)(O,e)).sort((O,H)=>O.price-H.price);let v=!1;for(const O of d)if(O.name1===I&&(C&e.getDemon(O.name2).inherits)===C){h.push(I),h.push(O.name2),g=h[h.length-1],b=C,v=!0;break}if(v)continue;const J=a.getFusions(I,e,s).reduce((O,H)=>(O[H.name1]=H.name2,O),{});for(const O of d)if(J[O.name2]&&(b&e.getDemon(O.name2).inherits)===b&&(C&e.getDemon(J[O.name2]).inherits)===C){h.push(O.name1),h.push(O.name2),h.push(I),h.push(J[O.name2]),g=h[h.length-1],b=C,v=!0;break}if(!v)return[]}return h}(r,c,s,i,a);if(0===I.length)return[];const C=I[I.length-1];let d=x(C,h,j,s,i,a);if(0===d.length){const v=s.getDemon(h),rt=s.getResultDemonLvls(v.race).map(J=>s.reverseLookupDemon(v.race,J)).filter(J=>J!==h);for(const J of i.elementDemons.concat(rt)){if((j&s.getDemon(J).inherits)!==j)continue;const O=x(C,J,j,s,i,a),H=x(J,h,j,s,i,a);if(0!==O.length&&0!==H.length){d=O.concat(H.slice(1));break}}}if(0===d.length)return[];g=I.concat(d.slice(1),g.slice(1))}return g}function x(r,c,e,s,i,a){const{fissionCalculator:h,fusionCalculator:g}=a,b=[r];if(r===c)return b;const j=g.getFusions(r,s,i).map(d=>(0,n.lA)(d,s)).sort((d,v)=>d.price-v.price);for(const d of j)if(d.name2===c)return b.push(d.name1),b.push(c),b;const I=h.getFusions(c,s,i).map(d=>(0,n.on)(d,s)).sort((d,v)=>d.price-v.price);j.sort((d,v)=>v.price-d.price);const C=j.reduce((d,v)=>(d[v.name2]=v.name1,d),{});for(const d of I){if(C[d.name1]&&(e&s.getDemon(d.name1).inherits)===e)return b.push(C[d.name1]),b.push(d.name1),b.push(d.name2),b.push(c),b;if(C[d.name2]&&(e&s.getDemon(d.name2).inherits)===e)return b.push(C[d.name2]),b.push(d.name2),b.push(d.name1),b.push(c),b}return[]}var Q=u(1090),t=u(2598),T=u(4341),k=u(177);function F(r,c){if(1&r&&(t.j41(0,"option",16),t.EFF(1),t.k0s()),2&r){const e=c.$implicit;t.Y8G("value",e),t.R7$(1),t.JRh(e)}}function p(r,c){if(1&r&&(t.j41(0,"option",17),t.EFF(1),t.k0s()),2&r){const e=c.$implicit;t.Y8G("ngValue",e),t.R7$(1),t.JRh(e.name)}}function S(r,c){if(1&r&&(t.j41(0,"option",16),t.EFF(1),t.k0s()),2&r){const e=c.$implicit,s=t.XpG(3);t.Y8G("value",e),t.R7$(1),t.JRh(s.recipeConfig.displayElems[e]||e)}}function m(r,c){if(1&r&&(t.j41(0,"option",17),t.EFF(1),t.k0s()),2&r){const e=c.$implicit;t.Y8G("ngValue",e),t.R7$(1),t.JRh(e.name)}}function y(r,c){if(1&r&&(t.j41(0,"option",16),t.EFF(1),t.k0s()),2&r){const e=c.$implicit;t.Y8G("value",e),t.R7$(1),t.JRh(e)}}function f(r,c){if(1&r&&(t.j41(0,"option",17),t.EFF(1),t.k0s()),2&r){const e=c.$implicit;t.Y8G("ngValue",e),t.R7$(1),t.JRh(e.name)}}function B(r,c){if(1&r&&(t.j41(0,"select",25),t.DNE(1,f,2,2,"option",8),t.k0s()),2&r){const e=t.XpG(2).$implicit,s=t.XpG();t.R7$(1),t.Y8G("ngForOf",s.learnedBy[e.controls.skill.value.name])}}function K(r,c){if(1&r&&(t.j41(0,"option",17),t.EFF(1),t.k0s()),2&r){const e=c.$implicit;t.Y8G("ngValue",e),t.R7$(1),t.JRh(e.name)}}function z(r,c){if(1&r&&(t.j41(0,"select",25),t.DNE(1,K,2,2,"option",8),t.k0s()),2&r){const e=t.XpG(2).$implicit,s=t.XpG();t.R7$(1),t.Y8G("ngForOf",s.demons[e.controls.race.value])}}function it(r,c){if(1&r){const e=t.RV6();t.j41(0,"tr")(1,"td")(2,"label"),t.EFF(3),t.nI1(4,"translateComp"),t.j41(5,"input",20),t.bIt("change",function(){t.eBV(e);const i=t.XpG().$implicit,a=t.XpG();return t.Njj(a.setIngredDemon(i))}),t.k0s()()(),t.j41(6,"td")(7,"select",21),t.bIt("change",function(){t.eBV(e);const i=t.XpG().$implicit,a=t.XpG();return t.Njj(a.setIngredElem(i))}),t.j41(8,"option",22),t.EFF(9,"-"),t.k0s(),t.DNE(10,S,2,2,"option",6),t.k0s()(),t.j41(11,"td")(12,"select",23),t.bIt("change",function(){t.eBV(e);const i=t.XpG().$implicit,a=t.XpG();return t.Njj(a.setIngredDemon(i))}),t.DNE(13,m,2,2,"option",8),t.k0s()(),t.j41(14,"td")(15,"select",5),t.bIt("change",function(){t.eBV(e);const i=t.XpG().$implicit,a=t.XpG();return t.Njj(a.setIngredDemon(i))}),t.j41(16,"option",22),t.EFF(17,"-"),t.k0s(),t.DNE(18,y,2,2,"option",6),t.k0s()(),t.j41(19,"td"),t.DNE(20,B,2,1,"select",24),t.DNE(21,z,2,1,"select",24),t.k0s()()}if(2&r){const e=t.XpG(),s=e.index,i=e.$implicit,a=t.XpG();t.R7$(3),t.Lme("",t.i5U(4,10,a.msgs.LearnsSkill,a.lang),"",s+1," "),t.R7$(4),t.BMQ("disabled",!i.controls.searchSkill.value||null),t.R7$(3),t.Y8G("ngForOf",a.elems),t.R7$(2),t.BMQ("disabled",!i.controls.searchSkill.value||null),t.R7$(1),t.Y8G("ngForOf",a.skills[i.controls.elem.value]),t.R7$(2),t.BMQ("disabled",i.controls.searchSkill.value||null),t.R7$(3),t.Y8G("ngForOf",a.races),t.R7$(2),t.Y8G("ngIf",i.controls.searchSkill.value),t.R7$(1),t.Y8G("ngIf",!i.controls.searchSkill.value)}}function pt(r,c){if(1&r&&(t.qex(0,18),t.DNE(1,it,22,13,"tr",19),t.bVm()),2&r){const e=c.index,s=t.XpG();t.Y8G("formGroupName",e),t.R7$(1),t.Y8G("ngIf",e<s.maxSkills)}}function ot(r,c){if(1&r&&(t.j41(0,"li"),t.EFF(1),t.k0s()),2&r){const e=c.$implicit;t.R7$(1),t.JRh(e)}}function G(r,c){if(1&r&&(t.j41(0,"td",29)(1,"ul"),t.DNE(2,ot,2,1,"li",30),t.k0s()()),2&r){const e=t.XpG(2);t.R7$(2),t.Y8G("ngForOf",e.recipeLeft)}}function N(r,c){if(1&r&&(t.j41(0,"td",31),t.EFF(1),t.nI1(2,"translateComp"),t.k0s()),2&r){const e=t.XpG(2);t.R7$(1),t.JRh(t.i5U(2,1,e.msgs.NoRecipesFound,e.lang))}}function U(r,c){if(1&r&&(t.j41(0,"li"),t.EFF(1),t.k0s()),2&r){const e=c.$implicit;t.R7$(1),t.JRh(e)}}function Y(r,c){if(1&r&&(t.j41(0,"td",29)(1,"ul"),t.DNE(2,U,2,1,"li",30),t.k0s()()),2&r){const e=t.XpG(2);t.R7$(2),t.Y8G("ngForOf",e.recipeRight)}}function tt(r,c){if(1&r&&(t.j41(0,"td",31),t.EFF(1),t.nI1(2,"translateComp"),t.k0s()),2&r){const e=t.XpG(2);t.R7$(1),t.JRh(t.i5U(2,1,e.msgs.NoRecipesFound,e.lang))}}function ft(r,c){if(1&r&&(t.j41(0,"tr")(1,"td",28),t.EFF(2),t.nI1(3,"translateComp"),t.k0s()()),2&r){const e=t.XpG(2);t.R7$(2),t.Lme(" ",t.i5U(3,2,e.msgs.SpecialFusionCondition,e.lang),": ",e.fusionPrereq," ")}}function M(r,c){if(1&r&&(t.qex(0),t.EFF(1),t.nrm(2,"br"),t.EFF(3),t.bVm()),2&r){const e=t.XpG(2);t.R7$(1),t.Lme(" ",e.recipeResult.join(" x ")," = ",e.recipe.result,""),t.R7$(2),t.SpI(" [",e.resultSkills.join(", "),"] ")}}function L(r,c){if(1&r&&(t.qex(0),t.EFF(1),t.nI1(2,"translateComp"),t.bVm()),2&r){const e=t.XpG(2);t.R7$(1),t.JRh(t.i5U(2,1,e.msgs.NoRecipesFound,e.lang))}}function X(r,c){if(1&r&&(t.j41(0,"table",1)(1,"tr")(2,"th",2),t.EFF(3),t.nI1(4,"translateComp"),t.k0s()(),t.j41(5,"tr")(6,"th"),t.EFF(7),t.nI1(8,"translateComp"),t.k0s(),t.j41(9,"th"),t.EFF(10),t.nI1(11,"translateComp"),t.k0s()(),t.j41(12,"tr"),t.DNE(13,G,3,1,"td",26),t.DNE(14,N,3,4,"td",27),t.DNE(15,Y,3,1,"td",26),t.DNE(16,tt,3,4,"td",27),t.k0s(),t.DNE(17,ft,4,5,"tr",19),t.j41(18,"tr")(19,"td",28),t.DNE(20,M,4,3,"ng-container",19),t.DNE(21,L,3,4,"ng-container",19),t.k0s()()()),2&r){const e=t.XpG();t.R7$(3),t.JRh(t.i5U(4,10,e.msgs.FusionRecipe,e.lang)),t.R7$(4),t.JRh(t.i5U(8,13,e.msgs.LeftChain,e.lang)),t.R7$(3),t.JRh(t.i5U(11,16,e.msgs.RightChain,e.lang)),t.R7$(3),t.Y8G("ngIf",e.recipeLeft.length),t.R7$(1),t.Y8G("ngIf",!e.recipeLeft.length),t.R7$(1),t.Y8G("ngIf",e.recipeRight.length),t.R7$(1),t.Y8G("ngIf",!e.recipeRight.length),t.R7$(1),t.Y8G("ngIf",e.fusionPrereq),t.R7$(3),t.Y8G("ngIf",e.recipe.stepR.length),t.R7$(1),t.Y8G("ngIf",!e.recipe.stepR.length)}}let W=(()=>{class r{constructor(e){this.fb=e,this.maxSkills=8,this.lang="en",this.internalMaxSkills=9,this.range99=Array(99),this.demons={},this.skills={},this.learnedBy={},this.fusionPrereq="",this.msgs=Q.hV,this.skillLevelPipe=new l.wv,this.blankDemon={name:"-",race:"-",lvl:0,currLvl:0,price:0,inherits:0,skills:{},stats:[],resists:[],affinities:[],fusion:"normal",prereq:""},this.blankSkill={name:"-",element:"-",rank:99,cost:0,effect:"",target:"",level:0,learnedBy:[{demon:"-",level:0}]},this.createForm()}ngOnChanges(){this.initDropdowns()}createForm(){const e=[];for(let s=0;s<this.internalMaxSkills;s++)e.push(this.fb.group({searchSkill:!0,elem:"-",skill:this.blankSkill,race:{value:"-",disabled:!0},demon:this.blankDemon}));this.form=this.fb.group({race:"-",demon:this.blankDemon,ingreds:this.fb.array(e)}),this.form.valueChanges.subscribe(s=>{if(this.form.valid){const i=s.ingreds.filter(h=>"-"!==h.demon.name&&h.demon.name!==s.demon.name).map(h=>h.demon.name),a={};for(const h of s.ingreds)h.searchSkill&&"-"!==h.skill.name&&(a[h.skill.name]=h.demon.name);this.updateRecipe(function o(r,c,e,s,i,a){const{fissionCalculator:h,inheritElems:g,restrictInherits:b,triExclusiveRaces:j,triFissionCalculator:I}=a,{normalChart:C}=i,d=s.getDemon(r),v={};for(const[_,R]of Object.entries(e))"-"!==R&&R!==d.name&&(v[_]=R);const J=D(Object.keys(e).map(_=>s.getSkill(_)).map(_=>_.element),g);let O=s.getSpecialNameEntries(r);if(O.length<2&&j.includes(d.race)){const _=I.getFusions(r,s,i).map(R=>(0,n.f7)(R,s)).sort((R,P)=>R.price-P.price).find(R=>(J&(R.d1.inherits|R.d2.inherits))===J&&!j.includes(R.d1.race)&&!j.includes(R.d2.race)&&!j.includes(R.d3.race));_&&(O=[_.d1.name,_.d2.name,_.d3.name])}if(O.length<2){const _=h.getFusions(r,s,C).map(R=>(0,n.on)(R,s)).sort((R,P)=>R.price-P.price).find(R=>(J&(s.getDemon(R.name1).inherits|s.getDemon(R.name2).inherits))===J&&"normal"===s.getDemon(R.name1).fusion&&"normal"===s.getDemon(R.name2).fusion&&!j.includes(s.getDemon(R.name1).race)&&!j.includes(s.getDemon(R.name2).race));_&&(O=[_.name1,_.name2])}const H=O.map(_=>s.getDemon(_)).sort((_,R)=>R.price-_.price),_t=Object.keys(v).map(_=>s.getSkill(_)),lt=D(_t.map(_=>_.element),g),kt=_t.map(_=>D([_.element],g));let at,ut,dt=0;for(let _=0;_<H.length;_++){const R=H[_];for(const P of H.slice(_+1))if((lt&(R.inherits|P.inherits))===lt){const Rt=(lt&R.inherits).toString(2).split("1").length*(lt&P.inherits).toString(2).split("1").length;dt<Rt&&(at=R,ut=P,dt=Rt)}}const ct={chain1:[],chain2:[],stepR:O,skills:v,result:r};if(!at)return ct;const et=Object.values(v).filter((_,R,P)=>P.indexOf(_)===R),ht=c.filter(_=>!et.includes(_));let Z=Math.ceil(et.length/2);et.sort((_,R)=>C.getLightDark(s.getDemon(_).race)-C.getLightDark(s.getDemon(R).race));let nt=et.slice(0,Z),mt=Array(nt.length).fill(0),st=et.slice(Z),gt=Array(st.length).fill(0);if(b){const{left:_,right:R}=function $(r,c,e,s){let i=[],a=[];const h=[],g=[],b={},j=[];for(let I=0;I<e.length;I++){const C=e[I];0!==C?(b.hasOwnProperty(C)||(b[C]=[]),b[C].push(s[I])):j.push(s[I])}for(const I of Object.keys(b).sort()){const C=parseInt(I);h.length<=g.length?(C&r)===C?h.push(C):g.push(C):(C&c)===C?g.push(C):h.push(C)}for(const I of h)i=i.concat(b[I]);for(const I of g)a=a.concat(b[I]);for(const I of j)i.length<a.length?i.push(I):a.push(I);return{left:i.reverse(),right:a.reverse()}}(at.inherits,ut.inherits,kt,_t.map(P=>P.name));nt=_.map(P=>v[P]),mt=E(_.map(P=>s.getSkill(P).element),g),st=R.map(P=>v[P]),gt=E(R.map(P=>s.getSkill(P).element),g)}return Z=Math.ceil(ht.length/2),nt=ht.slice(0,Z).concat(nt),mt=Array(Z).fill(0).concat(mt),st=ht.slice(Z).concat(st),gt=Array(ht.length-Z).fill(0).concat(gt),ct.chain1=A(nt,mt,at.name,s,C,a),ct.chain2=A(st,gt,ut.name,s,C,a),ct}(s.demon.name,i,a,this.compendium,this.squareChart,this.recipeConfig))}})}setIngredElem(e){e.controls.skill.setValue(this.skills[e.controls.elem.value][0]),this.setIngredDemon(e)}setIngredDemon(e){e.controls.demon.setValue((e.controls.searchSkill.value?this.learnedBy[e.controls.skill.value.name]:this.demons[e.controls.race.value])[0])}updateRecipe(e){const s={};for(const[i,a]of Object.entries(e.skills)){s[a]||(s[a]=[]);const h=this.compendium.getDemon(a).skills[i];s[a].push(`${i} ${this.skillLevelPipe.transform(h)}`.trim())}this.recipe=e,this.recipeLeft=this.decodeRecipechain(e.chain1,s),this.recipeRight=this.decodeRecipechain(e.chain2,s),this.resultSkills=[],this.recipeResult=[],this.fusionPrereq=this.compendium.getDemon(e.result).prereq||"";for(const i of e.stepR)this.recipeResult.push(s[i]?`${i} [${s[i].join(", ")}]`:i);for(const[i,a]of Object.entries(this.compendium.getDemon(e.result).skills).filter(h=>h[1]<2e3).sort((h,g)=>h[1]-g[1]))this.resultSkills.push(`${i} ${this.skillLevelPipe.transform(a)}`.trim())}decodeRecipechain(e,s){const i=[];for(let a=0;a<e.length-2;a+=2){const h=s[e[a]]?"["+s[e[a]].join(", ")+"] ":"",g=s[e[a+1]]?"["+s[e[a+1]].join(", ")+"] ":"";i.push(`${e[a]} ${h}x ${e[a+1]} ${g}= ${e[a+2]}`)}return i}initDropdowns(){if(this.recipeConfig&&this.compendium&&this.squareChart){this.demons={"-":[this.blankDemon]},this.skills={"-":[this.blankSkill]},this.learnedBy={"-":[this.blankDemon]};for(const e of this.compendium.allDemons)if(!e.isEnemy&&"party"!==e.fusion&&"enemy"!==e.fusion){this.demons[e.race]||(this.demons[e.race]=[]),this.demons[e.race].push(e);for(const s of Object.keys(e.skills))this.learnedBy[s]||(this.learnedBy[s]=[]),this.learnedBy[s].push(e)}for(const e of this.compendium.allSkills.filter(s=>s.rank<50&&s.learnedBy.length>0))this.skills[e.element]||(this.skills[e.element]=[]),this.skills[e.element].push(e);for(const e of Object.values(this.demons))e.sort((s,i)=>s.lvl-i.lvl);for(const e of Object.values(this.learnedBy))e.sort((s,i)=>s.lvl-i.lvl);for(const e of Object.values(this.skills))e.sort((s,i)=>s.rank-i.rank);this.races=this.recipeConfig.races.filter(e=>this.demons[e]),this.elems=this.recipeConfig.skillElems.filter(e=>this.skills[e]),this.setDemon(this.compendium.getDemon(this.recipeConfig.defaultDemon))}}setDemon(e){const s=[],{inheritElems:i}=this.recipeConfig,a=Object.entries(e.skills).slice(0,this.internalMaxSkills).filter(g=>g[1]<2).map(g=>this.compendium.getSkill(g[0])),h=Object.entries(e.skills).slice(0,this.internalMaxSkills).filter(g=>g[1]<100).map(g=>this.compendium.getSkill(g[0]));for(let g=0;g<i.length;g++)e.inherits&1<<g||s.push(i[i.length-g-1]);this.skills[this.blankSkill.element]=[this.blankSkill].concat(h),this.elems=this.recipeConfig.skillElems.filter(g=>this.skills[g]&&!s.includes(g)),this.form.patchValue({race:e.race,demon:e,ingreds:a.concat(Array(this.internalMaxSkills-a.length).fill(this.blankSkill)).map(g=>({searchSkill:!0,elem:"-",skill:g,race:"-",demon:"-"!==g.name?e:this.blankDemon}))})}static{this.\u0275fac=function(s){return new(s||r)(t.rXU(T.ok))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["app-recipe-generator"]],inputs:{maxSkills:"maxSkills",compendium:"compendium",squareChart:"squareChart",recipeConfig:"recipeConfig",lang:"lang"},features:[t.OA$],decls:46,vars:45,consts:[[3,"formGroup"],[1,"entry-table"],["colspan","2",1,"title"],[2,"width","40%"],[2,"width","60%"],["formControlName","race",3,"change"],[3,"value",4,"ngFor","ngForOf"],["formControlName","demon",3,"change"],[3,"ngValue",4,"ngFor","ngForOf"],["formArrayName","ingreds",1,"entry-table"],["colspan","5",1,"title"],[2,"width","20%"],[2,"width","10%"],[2,"width","25%"],[3,"formGroupName",4,"ngFor","ngForOf"],["class","entry-table",4,"ngIf"],[3,"value"],[3,"ngValue"],[3,"formGroupName"],[4,"ngIf"],["formControlName","searchSkill","type","checkbox",3,"change"],["formControlName","elem",3,"change"],["value","-"],["formControlName","skill",3,"change"],["formControlName","demon",4,"ngIf"],["formControlName","demon"],["style","width: 50%",4,"ngIf"],["style","width: 50%","style","padding: 1em; text-align: center;",4,"ngIf"],["colspan","2",2,"padding","1em","text-align","center"],[2,"width","50%"],[4,"ngFor","ngForOf"],[2,"padding","1em","text-align","center"]],template:function(s,i){1&s&&(t.j41(0,"form",0)(1,"h2"),t.EFF(2),t.nI1(3,"translateComp"),t.k0s(),t.j41(4,"table",1)(5,"tr")(6,"th",2),t.EFF(7),t.nI1(8,"translateComp"),t.k0s()(),t.j41(9,"tr")(10,"th",3),t.EFF(11),t.nI1(12,"translateComp"),t.k0s(),t.j41(13,"th",4),t.EFF(14),t.nI1(15,"translateComp"),t.k0s()(),t.j41(16,"tr")(17,"td")(18,"select",5),t.bIt("change",function(){return i.setDemon(i.demons[i.form.controls.race.value][0])}),t.DNE(19,F,2,2,"option",6),t.k0s()(),t.j41(20,"td")(21,"select",7),t.bIt("change",function(){return i.setDemon(i.form.controls.demon.value)}),t.DNE(22,p,2,2,"option",8),t.k0s()()()(),t.j41(23,"table",9)(24,"tr")(25,"th",10),t.EFF(26),t.nI1(27,"translateComp"),t.k0s()(),t.j41(28,"tr")(29,"th",11),t.EFF(30),t.nI1(31,"translateComp"),t.k0s(),t.j41(32,"th",12),t.EFF(33),t.nI1(34,"translateComp"),t.k0s(),t.j41(35,"th",13),t.EFF(36),t.nI1(37,"translateComp"),t.k0s(),t.j41(38,"th",11),t.EFF(39),t.nI1(40,"translateComp"),t.k0s(),t.j41(41,"th",13),t.EFF(42),t.nI1(43,"translateComp"),t.k0s()(),t.DNE(44,pt,2,2,"ng-container",14),t.k0s(),t.DNE(45,X,22,19,"table",15),t.k0s()),2&s&&(t.Y8G("formGroup",i.form),t.R7$(2),t.JRh(t.i5U(3,15,i.msgs.RecipeGenerator,i.lang)),t.R7$(5),t.JRh(t.i5U(8,18,i.msgs.Target,i.lang)),t.R7$(4),t.JRh(t.i5U(12,21,i.msgs.Race,i.lang)),t.R7$(3),t.JRh(t.i5U(15,24,i.msgs.Name,i.lang)),t.R7$(5),t.Y8G("ngForOf",i.races),t.R7$(3),t.Y8G("ngForOf",i.demons[i.form.controls.race.value]),t.R7$(4),t.JRh(t.i5U(27,27,i.msgs.IncludeIngredients,i.lang)),t.R7$(4),t.JRh(t.i5U(31,30,i.msgs.FilterBy,i.lang)),t.R7$(3),t.JRh(t.i5U(34,33,i.msgs.Elem,i.lang)),t.R7$(3),t.JRh(t.i5U(37,36,i.msgs.Skill,i.lang)),t.R7$(3),t.JRh(t.i5U(40,39,i.msgs.Race,i.lang)),t.R7$(3),t.JRh(t.i5U(43,42,i.msgs.Ingredient,i.lang)),t.R7$(2),t.Y8G("ngForOf",i.form.controls.ingreds.controls),t.R7$(1),t.Y8G("ngIf",i.recipe))},dependencies:[k.Sq,k.bT,T.qT,T.xH,T.y7,T.Zm,T.wz,T.BC,T.cb,T.j4,T.JD,T.$R,T.v8,l.uz],styles:["ul[_ngcontent-%COMP%]{padding:0 1em;list-style:none}td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-height:25px;width:100%}"],changeDetection:0})}}return r})()},6567:(q,w,u)=>{u.d(w,{I:()=>n});var l=u(2598);let n=(()=>{class o{constructor(E,$){this.changeDetector2=E,this.fusionDataService2=$,this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.fusionDataService2.compendium.subscribe(E=>{this.changeDetector2.markForCheck(),this.compendium=E})),this.subscriptions.push(this.fusionDataService2.fusionSettings.subscribe(E=>{this.fusionSettings=E}))}ngOnDestroy(){for(const E of this.subscriptions)E.unsubscribe()}toggleAll(E){const $={};for(const A of this.fusionSettings.displayHeaders)for(const x of A.settings)$[x.name]=E;this.fusionDataService2.updateFusionSettings($)}toggleName(E){const $={};$[E]=!this.fusionSettings.isEnabled(E),this.fusionDataService2.updateFusionSettings($)}static{this.\u0275fac=function($){l.QTQ()}}static{this.\u0275dir=l.FsC({type:o})}}return o})()},1939:(q,w,u)=>{u.d(w,{U:()=>l});class l{constructor(o,D,E=","){this.separator=E,this._displayHeaders=[],this._demonToggles={},this._subappToggles={};for(const{category:A,unlocked:x,conditions:V}of o){const Q=[];this._displayHeaders.push({category:A,settings:Q});for(const t of Object.keys(V))this._demonToggles[t]=x,Q.push({name:t,caption:t.split(E).join(", "),enabled:x})}const $=[];D.length>0&&this._displayHeaders.push({category:"Subapps",settings:$});for(const A of D)this._subappToggles[A]=!1,$.push({name:A,caption:A,enabled:!1})}get displayHeaders(){for(const o of this._displayHeaders)for(const D of o.settings)D.enabled=this.saveFile[D.name];return this._displayHeaders}get subappToggles(){return this._subappToggles}get demonToggles(){const o={};for(const[D,E]of Object.entries(this._demonToggles))for(const $ of D.split(this.separator))o[$]=E;return o}get saveFile(){return Object.assign({},this._demonToggles,this._subappToggles)}isEnabled(o){return this._demonToggles[o]||this._subappToggles[o]||!1}updateSaveFile(o){for(const D of[this._demonToggles,this._subappToggles])for(const[E,$]of Object.entries(o))D[E]===!$&&(D[E]=$)}}}}]);