(self.webpackChunkmegaten_fusion_tool=self.webpackChunkmegaten_fusion_tool||[]).push([[426],{628:(e,t,n)=>{"use strict";n.d(t,{N:()=>Z});var i=n(5614),s=n(1116),o=n(6101);function r(e,t){if(1&e&&(i.TgZ(0,"th",4),i._uU(1,"Inheritable Skills"),i.qZA()),2&e){const e=i.oxw();i.uIk("colspan",e.inheritHeaders.length)}}function l(e,t){if(1&e&&(i.TgZ(0,"th",4),i._uU(1),i.qZA()),2&e){const e=i.oxw();i.uIk("colspan",e.inheritHeaders.length),i.xp6(1),i.hij(" ",e.langEn?"Skill Affinities":"\u30b9\u30ad\u30eb\u9069\u6b63"," ")}}function c(e,t){if(1&e&&(i.ynx(0),i._uU(1),i.BQk()),2&e){const e=i.oxw().$implicit;i.xp6(1),i.Oqu(e)}}function a(e,t){if(1&e&&(i.TgZ(0,"div"),i._uU(1),i.qZA()),2&e){const e=i.oxw().$implicit;i.Gre("element-icon ",e,""),i.xp6(1),i.Oqu(e)}}function h(e,t){if(1&e&&(i.TgZ(0,"th"),i.YNc(1,c,2,1,"ng-container",3),i.YNc(2,a,2,4,"div",5),i.qZA()),2&e){const e=i.oxw();i.Udp("width",100/e.inheritHeaders.length,"%"),i.xp6(1),i.Q6J("ngIf",!e.hasIcons),i.xp6(1),i.Q6J("ngIf",e.hasIcons)}}function g(e,t){if(1&e&&(i.TgZ(0,"td"),i._uU(1),i.qZA()),2&e){const e=t.$implicit;i.Udp("color",e?null:"transparent"),i.xp6(1),i.hij(" ",e?"yes":"no"," ")}}function f(e,t){if(1&e&&(i.TgZ(0,"tr"),i.YNc(1,g,2,3,"td",6),i.qZA()),2&e){const e=i.oxw();i.xp6(1),i.Q6J("ngForOf",e.inherits)}}function u(e,t){if(1&e&&(i.TgZ(0,"td"),i.ALo(1,"roundInheritPercent"),i._uU(2),i.qZA()),2&e){const e=t.$implicit;i.Gre("affinity",i.lcZ(1,4,100*e),""),i.xp6(2),i.hij(" ",100*e,"% ")}}function m(e,t){if(1&e&&(i.TgZ(0,"tr"),i.YNc(1,u,3,6,"td",7),i.qZA()),2&e){const e=i.oxw();i.xp6(1),i.Q6J("ngForOf",e.inherits)}}function p(e,t){if(1&e&&(i.TgZ(0,"td"),i._uU(1),i.ALo(2,"affinityToString"),i.qZA()),2&e){const e=t.$implicit;i.Gre("affinity",e,""),i.xp6(1),i.hij(" ",i.lcZ(2,4,e)," ")}}function d(e,t){if(1&e&&(i.TgZ(0,"tr"),i.YNc(1,p,3,6,"td",7),i.qZA()),2&e){const e=i.oxw();i.xp6(1),i.Q6J("ngForOf",e.inherits)}}let Z=(()=>{class e{constructor(){this.inheritHeaders=[],this.inherits=[],this.hasChance=!1,this.hasIcons=!0,this.hasLvls=!1,this.langEn=!0}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Xpm({type:e,selectors:[["app-demon-inherits"]],inputs:{inheritHeaders:"inheritHeaders",inherits:"inherits",hasChance:"hasChance",hasIcons:"hasIcons",hasLvls:"hasLvls",langEn:"langEn"},decls:11,vars:6,consts:[[1,"entry-table"],["class","title",4,"ngIf"],[3,"width",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"title"],[3,"class",4,"ngIf"],[3,"color",4,"ngFor","ngForOf"],[3,"class",4,"ngFor","ngForOf"]],template:function(e,t){1&e&&(i.TgZ(0,"table",0),i.TgZ(1,"thead"),i.TgZ(2,"tr"),i.YNc(3,r,2,1,"th",1),i.YNc(4,l,2,2,"th",1),i.qZA(),i.TgZ(5,"tr"),i.YNc(6,h,3,4,"th",2),i.qZA(),i.qZA(),i.TgZ(7,"tbody"),i.YNc(8,f,2,1,"tr",3),i.YNc(9,m,2,1,"tr",3),i.YNc(10,d,2,1,"tr",3),i.qZA(),i.qZA()),2&e&&(i.xp6(3),i.Q6J("ngIf",!t.hasLvls),i.xp6(1),i.Q6J("ngIf",t.hasLvls&&t.inheritHeaders.length),i.xp6(2),i.Q6J("ngForOf",t.inheritHeaders),i.xp6(2),i.Q6J("ngIf",!t.hasLvls&&!t.hasChance),i.xp6(1),i.Q6J("ngIf",t.hasChance),i.xp6(1),i.Q6J("ngIf",t.hasLvls))},directives:[s.O5,s.sg],pipes:[o.DY,o.JZ],encapsulation:2,changeDetection:0}),e})()},7967:(e,t,n)=>{"use strict";n.d(t,{R:()=>f});var i=n(5614),s=n(9624),o=n(3522),r=n(1116);function l(e,t){if(1&e&&(i.TgZ(0,"th"),i._uU(1),i.qZA()),2&e){const e=t.$implicit,n=i.oxw();i.xp6(1),i.Oqu(e.slice(0,n.nameCut))}}function c(e,t){if(1&e&&(i.TgZ(0,"td",4),i._uU(1),i.qZA()),2&e){const e=t.$implicit,n=i.oxw(2);i.Q6J("ngClass",e.slice(0,4)),i.xp6(1),i.Oqu(e.slice(4,n.nameCut+4))}}function a(e,t){if(1&e&&(i.TgZ(0,"tr"),i.TgZ(1,"th"),i._uU(2),i.qZA(),i.YNc(3,c,2,2,"td",3),i.TgZ(4,"th"),i._uU(5),i.qZA(),i.qZA()),2&e){const e=t.$implicit;i.xp6(2),i.Oqu(e[0]),i.xp6(1),i.Q6J("ngForOf",e.slice(1,e.length-1)),i.xp6(2),i.Oqu(e[e.length-1])}}function h(e,t){if(1&e&&(i.TgZ(0,"th"),i._uU(1),i.qZA()),2&e){const e=t.$implicit,n=i.oxw();i.xp6(1),i.Oqu(e.slice(0,n.nameCut))}}function g(e,t){if(1&e&&(i.TgZ(0,"tr"),i.TgZ(1,"th",0),i._uU(2),i.qZA(),i.qZA()),2&e){const e=i.oxw();i.xp6(1),i.uIk("colspan",e.table[0].length),i.xp6(1),i.AsE("",e.appName," ",e.tripTitle,"")}}let f=(()=>{class e{constructor(e,t){this.title2=e,this.route=t,this.normTitle="Normal Fusions",this.tripTitle="",this.isPersona=!1,this.filterDarks=!0,this.langEn=!0,this.subscriptions=[],this.table=[],this.nameCut=4}ngOnInit(){this.subscriptions.push(this.route.parent.data.subscribe(e=>{this.appName=e.appName||"Shin Megami Tensei",this.nameCut=this.langEn?4:2,this.title2.setTitle(this.langEn?`Fusion Chart - ${this.appName} Fusion Calculator`:`\u5408\u4f53\u8868 ${this.appName} \u5408\u4f53\u30a2\u30d7\u30ea`)}))}ngOnChanges(){this.normChart&&this.fillFusionChart()}ngOnDestroy(){for(const e of this.subscriptions)e.unsubscribe()}fillFusionChart(){const t="noneNone",n=e.RESULT_COLORS.reduce((e,[t,n])=>n.reduce((e,n)=>(e[n]=t,e),e),{}),i=this.normChart.elementDemons;let s=[],o=this.normChart.races,r=[];this.filterDarks&&(s=this.normChart.races.filter(e=>this.normChart.getLightDark(e)>0),o=this.normChart.races.filter(e=>0===this.normChart.getLightDark(e)),r=this.normChart.races.filter(e=>-1===this.normChart.getLightDark(e)),0===r.length&&s.length>0&&(s=this.normChart.races.filter(e=>this.normChart.getLightDark(e)>-1),o=[],r=this.normChart.races.filter(e=>this.normChart.getLightDark(e)<-1)));const l=s.length-r.length,c=s.concat(o,i),a=r.length?r.concat(Array(c.length-r.length).fill("")):c,h=this.mitaTable?c:s.concat(o,Array(i.length).fill("")),g=this.mitaTable||r.length?Array(l).fill("").concat(r,o,i):c;this.table=[[""].concat(c,[""])];for(let e=0;e<g.length;e++){const s=Array(c.length+2).fill("empt-"),o=g[e],r=h[e],f=-1!==i.indexOf(o),u=-1!==i.indexOf(r);this.table.push(s),s[0]=o,s[s.length-1]=r;for(let l=e;l<c.length;l++){const e=c[l],o=-1!==i.indexOf(e);if(o&&u){const o=i.indexOf(r),c=i.indexOf(e),a=this.mitaTable[o][c-o-1];s[l+1]=a?(n[a]||"norm")+a:t}else if(o&&r){const i=this.normChart.getElemFusions(e)[r];s[l+1]=i?(n[i]||"rank")+(i>0?"+":"")+i.toString():t}else if(e&&r){const i=this.isPersona&&e===r?e:this.normChart.getRaceFusion(e,r);s[l+1]=i?(n[i]||(e===r?"elem":"norm"))+i:t}}if(this.tripChart)for(let i=0;i<=e-l;i++){const e=a[i];if(e&&f){const r=this.tripChart.getElemFusions(o)[e];s[i+1]=r?(n[r]||"rank")+(r>0?"+":"")+r.toString():t}else if(e&&o){const r=this.tripChart.getRaceFusion(e,o);s[i+1]=r?(n[r]||(e===o?"elem":"trip"))+r:t}}if(-1!==o.indexOf(" x ")){const[e,t]=o.split(" x "),n=e.slice(0,3)+"x"+t.slice(0,3);s[0]=n,s[s.length-1]=n}else if(-1!==o.indexOf(" ")){const e=o.split(" ")[0];s[0]=e,s[s.length-1]=e}}for(let e=0;e<this.table[0].length;e++){const t=this.table[0][e];if(-1!==t.indexOf(" x ")){const[n,i]=t.split(" x ");this.table[0][e]=n.slice(0,2)+i.slice(0,2)}}this.table.push([""].concat(a,[""]))}}return e.RESULT_COLORS=Object.entries({oran:["-2","Erthys","Gnome","Saki","Saki Mitama","Random","\u30a2\u30fc\u30b7\u30fc\u30ba","\u30ce\u30fc\u30e0","\u30b5\u30ad\u30df\u30bf\u30de"],redd:["-1","Flaemis","Salamander","Ara ","Ara Mitama","Fiend","\u30d5\u30ec\u30a4\u30df\u30fc\u30ba","\u30b5\u30e9\u30de\u30f3\u30c0\u30fc","\u30a2\u30e9\u30df\u30bf\u30de"],gree:["1","Aeros","Sylph","Kusi","Kusi Mitama","UMA","\u30a8\u30a2\u30ed\u30b9","\u30b7\u30eb\u30ad\u30fc","\u30af\u30b7\u30df\u30bf\u30de"],blue:["2","Aquans","Undine","Nigi","Nigi Mitama","Enigma","\u30a2\u30af\u30a2\u30f3\u30ba","\u30a6\u30f3\u30c7\u30a3\u30fc\u30cd","\u30cb\u30ae\u30df\u30bf\u30de"]}),e.\u0275fac=function(t){return new(t||e)(i.Y36(s.Dx),i.Y36(o.gz))},e.\u0275cmp=i.Xpm({type:e,selectors:[["app-fusion-chart"]],inputs:{normChart:"normChart",tripChart:"tripChart",mitaTable:"mitaTable",normTitle:"normTitle",tripTitle:"tripTitle",isPersona:"isPersona",filterDarks:"filterDarks",langEn:"langEn",counter:"counter"},features:[i.TTD],decls:12,vars:7,consts:[[1,"title"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(e,t){1&e&&(i.TgZ(0,"table"),i.TgZ(1,"tbody"),i.TgZ(2,"tr"),i.TgZ(3,"th",0),i._uU(4),i.qZA(),i.qZA(),i.TgZ(5,"tr"),i.YNc(6,l,2,1,"th",1),i.qZA(),i.YNc(7,a,6,3,"tr",1),i.TgZ(8,"tr"),i.YNc(9,h,2,1,"th",1),i.qZA(),i.YNc(10,g,3,3,"tr",2),i.qZA(),i._UZ(11,"tbody"),i.qZA()),2&e&&(i.xp6(3),i.uIk("colspan",t.table[0].length),i.xp6(1),i.AsE("",t.appName," ",t.normTitle,""),i.xp6(2),i.Q6J("ngForOf",t.table[0]),i.xp6(1),i.Q6J("ngForOf",t.table.slice(1,t.table.length-1)),i.xp6(2),i.Q6J("ngForOf",t.table[t.table.length-1]),i.xp6(1),i.Q6J("ngIf",t.tripTitle))},directives:[r.sg,r.O5,r.mk],styles:["table[_ngcontent-%COMP%]{width:auto;margin:0 auto;white-space:nowrap}td.elem[_ngcontent-%COMP%]{color:#0f0}td.trip[_ngcontent-%COMP%]{color:#d3d3d3}td.oran[_ngcontent-%COMP%]{color:orange}td.redd[_ngcontent-%COMP%]{color:red}td.gree[_ngcontent-%COMP%]{color:#0f0}td.blue[_ngcontent-%COMP%]{color:#0ff}td.empt[_ngcontent-%COMP%], td.none[_ngcontent-%COMP%]{color:transparent}td.empt[_ngcontent-%COMP%]{background-color:initial}"],changeDetection:0}),e})()},3810:(e,t,n)=>{"use strict";n.d(t,{X:()=>F});var i=n(9859);function s(e,t){return parseInt(t.map(t=>e.includes(t)?"1":"0").join(""),2)||0}function o(e,t){return e.map((e,n,i)=>s(i.slice(0,n+1),t))}function r(e,t,n,s,o,r){let c=n,a=[c];const h=s.getSpecialNameEntries(c),g=t[t.length-1];if(0!==h.length&&(c=h.find(e=>0===s.getSpecialNameEntries(e).length),a.unshift(h.filter(e=>e!==c).join(" x ")),a.unshift(c)),e.length>0){const n=function(e,t,n,s,o){const{fusionCalculator:r}=o,l=e.slice(0,1);if(e.length<2)return l;let c=l[0],a=t[0];for(let h=1;h<e.length;h++){const o=e[h],g=t[h],f=r.getFusions(c,n,s).map(e=>(0,i.D0)(e,n)).sort((e,t)=>e.price-t.price);let u=!1;for(const e of f)if(e.name1===o&&(g&n.getDemon(e.name2).inherits)===g){l.push(o),l.push(e.name2),c=l[l.length-1],a=g,u=!0;break}if(u)continue;const m=r.getFusions(o,n,s).reduce((e,t)=>(e[t.name1]=t.name2,e),{});for(const e of f)if(m[e.name2]&&(a&n.getDemon(e.name2).inherits)===a&&(g&n.getDemon(m[e.name2]).inherits)===g){l.push(e.name1),l.push(e.name2),l.push(o),l.push(m[e.name2]),c=l[l.length-1],a=g,u=!0;break}if(!u)return[]}return l}(e,t,s,o,r);if(0===n.length)return[];const h=n[n.length-1];let f=l(h,c,g,s,o,r);if(0===f.length){const e=s.getDemon(c),t=s.getResultDemonLvls(e.race).map(t=>s.reverseLookupDemon(e.race,t)).filter(e=>e!==c);for(const n of o.elementDemons.concat(t)){if((g&s.getDemon(n).inherits)!==g)continue;const e=l(h,n,g,s,o,r),t=l(n,c,g,s,o,r);if(0!==e.length&&0!==t.length){f=e.concat(t.slice(1));break}}}if(0===f.length)return[];a=n.concat(f.slice(1),a.slice(1))}return a}function l(e,t,n,s,o,r){const{fissionCalculator:l,fusionCalculator:c}=r,a=[e];if(e===t)return a;const h=c.getFusions(e,s,o).map(e=>(0,i.D0)(e,s)).sort((e,t)=>e.price-t.price);for(const i of h)if(i.name2===t)return a.push(i.name1),a.push(t),a;const g=l.getFusions(t,s,o).map(e=>(0,i.S6)(e,s)).sort((e,t)=>e.price-t.price);h.sort((e,t)=>t.price-e.price);const f=h.reduce((e,t)=>(e[t.name2]=t.name1,e),{});for(const i of g){if(f[i.name1]&&(n&s.getDemon(i.name1).inherits)===n)return a.push(f[i.name1]),a.push(i.name1),a.push(i.name2),a.push(t),a;if(f[i.name2]&&(n&s.getDemon(i.name2).inherits)===n)return a.push(f[i.name2]),a.push(i.name2),a.push(i.name1),a.push(t),a}return[]}var c=n(5614),a=n(1462),h=n(1116);function g(e,t){if(1&e&&(c.TgZ(0,"option",16),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.Q6J("value",e),c.xp6(1),c.Oqu(e)}}function f(e,t){if(1&e&&(c.TgZ(0,"option",17),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.Q6J("ngValue",e),c.xp6(1),c.Oqu(e.name)}}function u(e,t){if(1&e&&(c.TgZ(0,"option",16),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.Q6J("value",e),c.xp6(1),c.Oqu(e)}}function m(e,t){if(1&e&&(c.TgZ(0,"option",17),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.Q6J("ngValue",e),c.xp6(1),c.Oqu(e.name)}}function p(e,t){if(1&e&&(c.TgZ(0,"option",16),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.Q6J("value",e),c.xp6(1),c.Oqu(e)}}function d(e,t){if(1&e&&(c.TgZ(0,"option",17),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.Q6J("ngValue",e),c.xp6(1),c.AsE("",e.name," ",e.lvl?"("+e.lvl+")":"","")}}function Z(e,t){if(1&e&&(c.TgZ(0,"select",25),c.YNc(1,d,2,3,"option",8),c.qZA()),2&e){const e=c.oxw(2).$implicit,t=c.oxw();c.xp6(1),c.Q6J("ngForOf",t.learnedBy[e.controls.skill.value.name])}}function x(e,t){if(1&e&&(c.TgZ(0,"option",17),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.Q6J("ngValue",e),c.xp6(1),c.AsE("",e.name," ",e.lvl?"("+e.lvl+")":"","")}}function k(e,t){if(1&e&&(c.TgZ(0,"select",25),c.YNc(1,x,2,3,"option",8),c.qZA()),2&e){const e=c.oxw(2).$implicit,t=c.oxw();c.xp6(1),c.Q6J("ngForOf",t.demons[e.controls.race.value])}}function A(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"tr"),c.TgZ(1,"td"),c.TgZ(2,"label"),c._uU(3,"Search Skill "),c.TgZ(4,"input",20),c.NdJ("change",function(){c.CHM(e);const t=c.oxw().$implicit;return c.oxw().setIngredDemon(t)}),c.qZA(),c.qZA(),c.qZA(),c.TgZ(5,"td"),c.TgZ(6,"select",21),c.NdJ("change",function(){c.CHM(e);const t=c.oxw().$implicit;return c.oxw().setIngredElem(t)}),c.TgZ(7,"option",22),c._uU(8,"-"),c.qZA(),c.YNc(9,u,2,2,"option",6),c.qZA(),c.qZA(),c.TgZ(10,"td"),c.TgZ(11,"select",23),c.NdJ("change",function(){c.CHM(e);const t=c.oxw().$implicit;return c.oxw().setIngredDemon(t)}),c.YNc(12,m,2,2,"option",8),c.qZA(),c.qZA(),c.TgZ(13,"td"),c.TgZ(14,"select",5),c.NdJ("change",function(){c.CHM(e);const t=c.oxw().$implicit;return c.oxw().setIngredDemon(t)}),c.TgZ(15,"option",22),c._uU(16,"-"),c.qZA(),c.YNc(17,p,2,2,"option",6),c.qZA(),c.qZA(),c.TgZ(18,"td"),c.YNc(19,Z,2,1,"select",24),c.YNc(20,k,2,1,"select",24),c.qZA(),c.qZA()}if(2&e){const e=c.oxw().$implicit,t=c.oxw();c.xp6(6),c.uIk("disabled",!e.controls.searchSkill.value||null),c.xp6(3),c.Q6J("ngForOf",t.elems),c.xp6(2),c.uIk("disabled",!e.controls.searchSkill.value||null),c.xp6(1),c.Q6J("ngForOf",t.skills[e.controls.elem.value]),c.xp6(2),c.uIk("disabled",e.controls.searchSkill.value||null),c.xp6(3),c.Q6J("ngForOf",t.races),c.xp6(2),c.Q6J("ngIf",e.controls.searchSkill.value),c.xp6(1),c.Q6J("ngIf",!e.controls.searchSkill.value)}}function T(e,t){if(1&e&&(c.ynx(0,18),c.YNc(1,A,21,8,"tr",19),c.BQk()),2&e){const e=t.index,n=c.oxw();c.Q6J("formGroupName",e),c.xp6(1),c.Q6J("ngIf",e<n.maxSkills)}}function q(e,t){if(1&e&&(c.TgZ(0,"li"),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.xp6(1),c.Oqu(e)}}function C(e,t){if(1&e&&(c.TgZ(0,"td",29),c.TgZ(1,"ul"),c.YNc(2,q,2,1,"li",30),c.qZA(),c.qZA()),2&e){const e=c.oxw(2);c.xp6(2),c.Q6J("ngForOf",e.recipeLeft)}}function O(e,t){1&e&&(c.TgZ(0,"td",31),c._uU(1,"No chains found"),c.qZA())}function b(e,t){if(1&e&&(c.TgZ(0,"li"),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.xp6(1),c.Oqu(e)}}function N(e,t){if(1&e&&(c.TgZ(0,"td",29),c.TgZ(1,"ul"),c.YNc(2,b,2,1,"li",30),c.qZA(),c.qZA()),2&e){const e=c.oxw(2);c.xp6(2),c.Q6J("ngForOf",e.recipeRight)}}function D(e,t){1&e&&(c.TgZ(0,"td",31),c._uU(1,"No chains found"),c.qZA())}function _(e,t){if(1&e&&(c.ynx(0),c._uU(1),c._UZ(2,"br"),c._uU(3),c.BQk()),2&e){const e=c.oxw(2);c.xp6(1),c.AsE(" ",e.recipeResult.join(" x ")," = ",e.recipe.result,""),c.xp6(2),c.hij(" [",e.resultSkills.join(", "),"] ")}}function v(e,t){1&e&&(c.ynx(0),c._uU(1,"No recipes found"),c.BQk())}function y(e,t){if(1&e&&(c.TgZ(0,"table",1),c.TgZ(1,"tr"),c.TgZ(2,"th",2),c._uU(3,"Fusion Recipe"),c.qZA(),c.qZA(),c.TgZ(4,"tr"),c.TgZ(5,"th"),c._uU(6,"Left Chain"),c.qZA(),c.TgZ(7,"th"),c._uU(8,"Right Chain"),c.qZA(),c.qZA(),c.TgZ(9,"tr"),c.YNc(10,C,3,1,"td",26),c.YNc(11,O,2,0,"td",27),c.YNc(12,N,3,1,"td",26),c.YNc(13,D,2,0,"td",27),c.qZA(),c.TgZ(14,"tr"),c.TgZ(15,"td",28),c.YNc(16,_,4,3,"ng-container",19),c.YNc(17,v,2,0,"ng-container",19),c.qZA(),c.qZA(),c.qZA()),2&e){const e=c.oxw();c.xp6(10),c.Q6J("ngIf",e.recipeLeft.length),c.xp6(1),c.Q6J("ngIf",!e.recipeLeft.length),c.xp6(1),c.Q6J("ngIf",e.recipeRight.length),c.xp6(1),c.Q6J("ngIf",!e.recipeRight.length),c.xp6(3),c.Q6J("ngIf",e.recipe.stepR.length),c.xp6(1),c.Q6J("ngIf",!e.recipe.stepR.length)}}let F=(()=>{class e{constructor(e){this.fb=e,this.defaultDemon="Pixie",this.maxSkills=8,this.internalMaxSkills=9,this.range99=Array(99),this.demons={},this.skills={},this.learnedBy={},this.blankDemon={name:"-",race:"-",lvl:0,currLvl:0,price:0,inherits:0,skills:{},stats:[],resists:[],affinities:[],fusion:"normal",prereq:""},this.blankSkill={name:"-",element:"-",rank:99,cost:0,effect:"",target:"",level:0,learnedBy:[{demon:"-",level:0}]},this.createForm()}ngOnChanges(){this.initDropdowns()}createForm(){const e=[];for(let t=0;t<this.internalMaxSkills;t++)e.push(this.fb.group({searchSkill:!0,elem:"-",skill:this.blankSkill,race:"-",demon:this.blankDemon}));this.form=this.fb.group({race:"-",demon:this.blankDemon,ingreds:this.fb.array(e)}),this.form.valueChanges.subscribe(e=>{if(this.form.valid){const t=e.ingreds.filter(t=>"-"!==t.demon.name&&t.demon.name!==e.demon.name).map(e=>e.demon.name),n=e.ingreds.filter(e=>e.searchSkill&&"-"!==e.skill.name).map(e=>e.skill.name);this.updateRecipe(function(e,t,n,l,c,a){const{fissionCalculator:h,inheritElems:g,restrictInherits:f,triExclusiveRaces:u,triFissionCalculator:m}=a,{normalChart:p}=c,d=l.getDemon(e),Z=n.map(e=>l.getSkill(e)).filter((e,t,n)=>e.rank<50&&e.learnedBy.length>0&&!d.skills.hasOwnProperty(e.name)&&n.indexOf(e)===t),x=s(Z.map(e=>e.element),g);let k=l.getSpecialNameEntries(e);if(k.length<2&&u.includes(d.race)){const t=m.getFusions(e,l,c).map(e=>(0,i.Aw)(e,l)).sort((e,t)=>e.price-t.price).find(e=>!((x&(e.d1.inherits|e.d2.inherits|e.d3.inherits))!==x||"special"!==e.d1.fusion&&u.includes(e.d1.race)||"special"!==e.d2.fusion&&u.includes(e.d2.race)||"special"!==e.d3.fusion&&u.includes(e.d3.race)));t&&(k=[t.d1.name,t.d2.name,t.d3.name])}if(k.length<2){const t=h.getFusions(e,l,p).map(e=>(0,i.S6)(e,l)).sort((e,t)=>e.price-t.price).find(e=>!((x&(l.getDemon(e.name1).inherits|l.getDemon(e.name2).inherits))!==x||"normal"!==l.getDemon(e.name1).fusion&&"special"!==l.getDemon(e.name1).fusion||"normal"!==l.getDemon(e.name2).fusion&&"special"!==l.getDemon(e.name2).fusion));t&&(k=[t.name1,t.name2])}const A=k.map(e=>l.getDemon(e)).sort((e,t)=>t.price-e.price),T=t.map(e=>l.getDemon(e)).sort((e,t)=>t.price-e.price),q={},C={};for(const i of Z){for(const e of A)e.skills.hasOwnProperty(i.name)&&(q[i.name]=e.name);if(!q[i.name])for(const e of T)e.skills.hasOwnProperty(i.name)&&(C[i.name]=e.name)}const O=Object.keys(C).map(e=>l.getSkill(e)),b=s(O.map(e=>e.element),g),N=O.map(e=>s([e.element],g));let D,_,v=0;for(let i=0;i<A.length;i++){const e=A[i];for(const t of A.slice(i+1))if((b&(e.inherits|t.inherits))===b){const n=(b&e.inherits).toString(2).split("1").length*(b&t.inherits).toString(2).split("1").length;v<n&&(D=e,_=t,v=n)}}const y={chain1:[],chain2:[],stepR:k,skills:Object.assign(C,q),result:e};if(!D)return y;const F=Object.values(C).filter((e,t,n)=>n.indexOf(e)===t),w=t.filter(e=>!F.includes(e));let J=Math.ceil(F.length/2);F.sort((e,t)=>p.getLightDark(l.getDemon(e).race)-p.getLightDark(l.getDemon(t).race));let S=F.slice(0,J),I=Array(S.length).fill(0),U=F.slice(J),Q=Array(U.length).fill(0);if(f){const{left:e,right:t}=function(e,t,n,i){let s=[],o=[];const r=[],l=[],c={},a=[];for(let h=0;h<n.length;h++){const e=n[h];0!==e?(c.hasOwnProperty(e)||(c[e]=[]),c[e].push(i[h])):a.push(i[h])}for(const h of Object.keys(c).sort()){const n=parseInt(h);r.length<=l.length?(n&e)===n?r.push(n):l.push(n):(n&t)===n?l.push(n):r.push(n)}for(const h of r)s=s.concat(c[h]);for(const h of l)o=o.concat(c[h]);for(const h of a)s.length<o.length?s.push(h):o.push(h);return{left:s.reverse(),right:o.reverse()}}(D.inherits,_.inherits,N,O.map(e=>e.name));S=e.map(e=>C[e]),I=o(e.map(e=>l.getSkill(e).element),g),U=t.map(e=>C[e]),Q=o(t.map(e=>l.getSkill(e).element),g)}return J=Math.ceil(w.length/2),S=w.slice(0,J).concat(S),I=Array(J).fill(0).concat(I),U=w.slice(J).concat(U),Q=Array(w.length-J).fill(0).concat(Q),y.chain1=r(S,I,D.name,l,p,a),y.chain2=r(U,Q,_.name,l,p,a),y}(e.demon.name,t,n,this.compendium,this.squareChart,this.recipeConfig))}})}setIngredElem(e){e.controls.skill.setValue(this.skills[e.controls.elem.value][0]),this.setIngredDemon(e)}setIngredDemon(e){e.controls.demon.setValue((e.controls.searchSkill.value?this.learnedBy[e.controls.skill.value.name]:this.demons[e.controls.race.value])[0])}updateRecipe(e){const t={};for(const[n,i]of Object.entries(e.skills)){t[i]||(t[i]=[]);const e=this.compendium.getDemon(i).skills[n];t[i].push(n+(e?` (${e})`:""))}this.recipe=e,this.recipeLeft=this.decodeRecipechain(e.chain1,t),this.recipeRight=this.decodeRecipechain(e.chain2,t),this.resultSkills=[],this.recipeResult=[];for(const n of e.stepR)this.recipeResult.push(t[n]?`${n} [${t[n].join(", ")}]`:n);for(const[n,i]of Object.entries(this.compendium.getDemon(e.result).skills).filter(e=>e[1]<2e3).sort((e,t)=>e[1]-t[1]))this.resultSkills.push(n+(i?` (${i})`:""))}decodeRecipechain(e,t){const n=[];for(let i=0;i<e.length-2;i+=2){const s=t[e[i]]?"["+t[e[i]].join(", ")+"] ":"",o=t[e[i+1]]?"["+t[e[i+1]].join(", ")+"] ":"";n.push(`${e[i]} ${s}x ${e[i+1]} ${o}= ${e[i+2]}`)}return n}initDropdowns(){if(this.recipeConfig&&this.compendium&&this.squareChart){this.demons={"-":[this.blankDemon]},this.skills={"-":[this.blankSkill]},this.learnedBy={"-":[this.blankDemon]};for(const e of this.compendium.allDemons)if(!e.isEnemy){this.demons[e.race]||(this.demons[e.race]=[]),this.demons[e.race].push(e);for(const t of Object.keys(e.skills))this.learnedBy[t]||(this.learnedBy[t]=[]),this.learnedBy[t].push(e)}for(const e of this.compendium.allSkills.filter(e=>e.rank<50&&e.learnedBy.length>0))this.skills[e.element]||(this.skills[e.element]=[]),this.skills[e.element].push(e);for(const e of Object.values(this.demons))e.sort((e,t)=>e.lvl-t.lvl);for(const e of Object.values(this.learnedBy))e.sort((e,t)=>e.lvl-t.lvl);for(const e of Object.values(this.skills))e.sort((e,t)=>e.rank-t.rank);this.races=this.recipeConfig.races.filter(e=>this.demons[e]),this.elems=this.recipeConfig.skillElems.filter(e=>this.skills[e]),this.setDemon(this.compendium.getDemon(this.defaultDemon))}}setDemon(e){const t=[],{inheritElems:n}=this.recipeConfig,i=Object.entries(e.skills).filter(e=>0===e[1]).map(e=>this.compendium.getSkill(e[0]));for(let s=0;s<n.length;s++)e.inherits&1<<s||t.push(n[n.length-s-1]);this.skills[this.blankSkill.element]=[this.blankSkill].concat(i),this.elems=this.recipeConfig.skillElems.filter(e=>this.skills[e]&&!t.includes(e)),this.form.patchValue({race:e.race,demon:e,ingreds:i.concat(Array(this.internalMaxSkills-i.length).fill(this.blankSkill)).map(t=>({searchSkill:!0,elem:"-",skill:t,race:"-",demon:"-"!==t.name?e:this.blankDemon}))})}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(a.qu))},e.\u0275cmp=c.Xpm({type:e,selectors:[["app-recipe-generator"]],inputs:{defaultDemon:"defaultDemon",maxSkills:"maxSkills",compendium:"compendium",squareChart:"squareChart",recipeConfig:"recipeConfig"},features:[c.TTD],decls:36,vars:5,consts:[[3,"formGroup"],[1,"entry-table"],["colspan","2",1,"title"],[2,"width","40%"],[2,"width","60%"],["formControlName","race",3,"change"],[3,"value",4,"ngFor","ngForOf"],["formControlName","demon",3,"change"],[3,"ngValue",4,"ngFor","ngForOf"],["formArrayName","ingreds",1,"entry-table"],["colspan","5",1,"title"],[2,"width","20%"],[2,"width","10%"],[2,"width","25%"],[3,"formGroupName",4,"ngFor","ngForOf"],["class","entry-table",4,"ngIf"],[3,"value"],[3,"ngValue"],[3,"formGroupName"],[4,"ngIf"],["formControlName","searchSkill","type","checkbox",3,"change"],["formControlName","elem",3,"change"],["value","-"],["formControlName","skill",3,"change"],["formControlName","demon",4,"ngIf"],["formControlName","demon"],["style","width: 50%",4,"ngIf"],["style","width: 50%","style","padding: 1em; text-align: center;",4,"ngIf"],["colspan","2",2,"padding","1em","text-align","center"],[2,"width","50%"],[4,"ngFor","ngForOf"],[2,"padding","1em","text-align","center"]],template:function(e,t){1&e&&(c.TgZ(0,"form",0),c.TgZ(1,"h2"),c._uU(2,"Recipe Generator"),c.qZA(),c.TgZ(3,"table",1),c.TgZ(4,"tr"),c.TgZ(5,"th",2),c._uU(6,"Target"),c.qZA(),c.qZA(),c.TgZ(7,"tr"),c.TgZ(8,"th",3),c._uU(9,"Race"),c.qZA(),c.TgZ(10,"th",4),c._uU(11,"Name"),c.qZA(),c.qZA(),c.TgZ(12,"tr"),c.TgZ(13,"td"),c.TgZ(14,"select",5),c.NdJ("change",function(){return t.setDemon(t.demons[t.form.controls.race.value][0])}),c.YNc(15,g,2,2,"option",6),c.qZA(),c.qZA(),c.TgZ(16,"td"),c.TgZ(17,"select",7),c.NdJ("change",function(){return t.setDemon(t.form.controls.demon.value)}),c.YNc(18,f,2,2,"option",8),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(19,"table",9),c.TgZ(20,"tr"),c.TgZ(21,"th",10),c._uU(22,"Include Ingredients"),c.qZA(),c.qZA(),c.TgZ(23,"tr"),c.TgZ(24,"th",11),c._uU(25,"Search"),c.qZA(),c.TgZ(26,"th",12),c._uU(27,"Elem"),c.qZA(),c.TgZ(28,"th",13),c._uU(29,"Skill"),c.qZA(),c.TgZ(30,"th",11),c._uU(31,"Race"),c.qZA(),c.TgZ(32,"th",13),c._uU(33,"Ingredient"),c.qZA(),c.qZA(),c.YNc(34,T,2,2,"ng-container",14),c.qZA(),c.YNc(35,y,18,6,"table",15),c.qZA()),2&e&&(c.Q6J("formGroup",t.form),c.xp6(15),c.Q6J("ngForOf",t.races),c.xp6(3),c.Q6J("ngForOf",t.demons[t.form.controls.race.value]),c.xp6(16),c.Q6J("ngForOf",t.form.controls.ingreds.controls),c.xp6(1),c.Q6J("ngIf",t.recipe))},directives:[a._Y,a.JL,a.sg,a.EJ,a.JJ,a.u,h.sg,a.CE,h.O5,a.YN,a.Kr,a.x0,a.Wl],styles:["ul[_ngcontent-%COMP%]{padding:0 1em;list-style:none}td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%}"],changeDetection:0}),e})()}}]);