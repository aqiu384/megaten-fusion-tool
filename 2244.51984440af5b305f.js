"use strict";(self.webpackChunkmegaten_fusion_tool=self.webpackChunkmegaten_fusion_tool||[]).push([[2244],{9436:(ue,H,O)=>{O.d(H,{d:()=>D});var U=O(1090),n=O(2598),r=O(177),V=O(4207);function Q(h,$){if(1&h&&(n.j41(0,"th",4),n.EFF(1,"Inheritable Skills"),n.k0s()),2&h){const f=n.XpG();n.BMQ("colspan",f.inheritHeaders.length)}}function w(h,$){if(1&h&&(n.j41(0,"th",4),n.EFF(1),n.nI1(2,"translateComp"),n.k0s()),2&h){const f=n.XpG();n.BMQ("colspan",f.inheritHeaders.length),n.R7$(1),n.SpI(" ",n.i5U(2,2,f.msgs.SkillAffinities,f.lang)," ")}}function K(h,$){if(1&h&&(n.qex(0),n.EFF(1),n.bVm()),2&h){const f=n.XpG().$implicit;n.R7$(1),n.JRh(f)}}function q(h,$){if(1&h&&(n.j41(0,"div"),n.EFF(1),n.k0s()),2&h){const f=n.XpG().$implicit;n.ZvI("element-icon ",f,""),n.R7$(1),n.JRh(f)}}function Z(h,$){if(1&h&&(n.j41(0,"th"),n.DNE(1,K,2,1,"ng-container",3),n.DNE(2,q,2,4,"div",5),n.k0s()),2&h){const f=n.XpG();n.xc7("width",100/f.inheritHeaders.length,"%"),n.R7$(1),n.Y8G("ngIf",!f.hasIcons),n.R7$(1),n.Y8G("ngIf",f.hasIcons)}}function e(h,$){if(1&h&&(n.j41(0,"td"),n.EFF(1),n.k0s()),2&h){const f=$.$implicit;n.xc7("color",f?null:"transparent"),n.R7$(1),n.SpI(" ",f?"yes":"no"," ")}}function N(h,$){if(1&h&&(n.j41(0,"tr"),n.DNE(1,e,2,3,"td",6),n.k0s()),2&h){const f=n.XpG();n.R7$(1),n.Y8G("ngForOf",f.inherits)}}function B(h,$){if(1&h&&(n.j41(0,"td"),n.nI1(1,"roundInheritPercent"),n.EFF(2),n.k0s()),2&h){const f=$.$implicit;n.ZvI("affinity",n.bMT(1,4,f),""),n.R7$(2),n.SpI(" ",f,"% ")}}function v(h,$){if(1&h&&(n.j41(0,"tr"),n.DNE(1,B,3,6,"td",7),n.k0s()),2&h){const f=n.XpG();n.R7$(1),n.Y8G("ngForOf",f.inherits)}}function C(h,$){if(1&h&&(n.j41(0,"td"),n.EFF(1),n.nI1(2,"affinityToString"),n.k0s()),2&h){const f=$.$implicit;n.ZvI("affinity",f,""),n.R7$(1),n.SpI(" ",n.bMT(2,4,f)," ")}}function k(h,$){if(1&h&&(n.j41(0,"tr"),n.DNE(1,C,3,6,"td",7),n.k0s()),2&h){const f=n.XpG();n.R7$(1),n.Y8G("ngForOf",f.inherits)}}let D=(()=>{class h{constructor(){this.inheritHeaders=[],this.inherits=[],this.hasChance=!1,this.hasIcons=!0,this.hasLvls=!1,this.lang="en",this.msgs=U.dx}static{this.\u0275fac=function(y){return new(y||h)}}static{this.\u0275cmp=n.VBU({type:h,selectors:[["app-demon-inherits"]],inputs:{inheritHeaders:"inheritHeaders",inherits:"inherits",hasChance:"hasChance",hasIcons:"hasIcons",hasLvls:"hasLvls",lang:"lang"},decls:11,vars:6,consts:[[1,"entry-table"],["class","title",4,"ngIf"],[3,"width",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"title"],[3,"class",4,"ngIf"],[3,"color",4,"ngFor","ngForOf"],[3,"class",4,"ngFor","ngForOf"]],template:function(y,P){1&y&&(n.j41(0,"table",0)(1,"thead")(2,"tr"),n.DNE(3,Q,2,1,"th",1),n.DNE(4,w,3,5,"th",1),n.k0s(),n.j41(5,"tr"),n.DNE(6,Z,3,4,"th",2),n.k0s()(),n.j41(7,"tbody"),n.DNE(8,N,2,1,"tr",3),n.DNE(9,v,2,1,"tr",3),n.DNE(10,k,2,1,"tr",3),n.k0s()()),2&y&&(n.R7$(3),n.Y8G("ngIf",!P.hasLvls),n.R7$(1),n.Y8G("ngIf",P.hasLvls&&P.inheritHeaders.length),n.R7$(2),n.Y8G("ngForOf",P.inheritHeaders),n.R7$(2),n.Y8G("ngIf",!P.hasLvls&&!P.hasChance),n.R7$(1),n.Y8G("ngIf",P.hasChance),n.R7$(1),n.Y8G("ngIf",P.hasLvls))},dependencies:[r.Sq,r.bT,V.uz,V.XM,V.D8],encapsulation:2,changeDetection:0})}}return h})()},9023:(ue,H,O)=>{O.d(H,{q:()=>B});var U=O(2755),n=O(1090),r=O(2598),V=O(345),Q=O(8935),w=O(177);function K(v,C){if(1&v&&(r.j41(0,"th"),r.EFF(1),r.k0s()),2&v){const k=C.$implicit,D=r.XpG();r.R7$(1),r.JRh(k.slice(0,D.nameCut))}}function q(v,C){if(1&v&&(r.j41(0,"td",4),r.EFF(1),r.k0s()),2&v){const k=C.$implicit,D=r.XpG(2);r.Y8G("ngClass",k.slice(0,4)),r.R7$(1),r.JRh(k.slice(4,D.nameCut+4))}}function Z(v,C){if(1&v&&(r.j41(0,"tr")(1,"th"),r.EFF(2),r.k0s(),r.DNE(3,q,2,2,"td",3),r.j41(4,"th"),r.EFF(5),r.k0s()()),2&v){const k=C.$implicit;r.R7$(2),r.JRh(k[0]),r.R7$(1),r.Y8G("ngForOf",k.slice(1,k.length-1)),r.R7$(2),r.JRh(k[k.length-1])}}function e(v,C){if(1&v&&(r.j41(0,"th"),r.EFF(1),r.k0s()),2&v){const k=C.$implicit,D=r.XpG();r.R7$(1),r.JRh(k.slice(0,D.nameCut))}}function N(v,C){if(1&v&&(r.j41(0,"tr")(1,"th",0),r.EFF(2),r.k0s()()),2&v){const k=r.XpG();r.R7$(1),r.BMQ("colspan",k.table[0].length),r.R7$(1),r.Lme("",k.appName," ",k.tripTitle,"")}}class B{static{this.RESULT_COLORS=Object.entries({oran:["-2","Erthys","Gnome","Saki","Saki Mitama","Random","\u30a2\u30fc\u30b7\u30fc\u30ba","\u30ce\u30fc\u30e0","\u30b5\u30ad\u30df\u30bf\u30de"],redd:["-1","Flaemis","Salamander","Ara ","Ara Mitama","Fiend","\u30d5\u30ec\u30a4\u30df\u30fc\u30ba","\u30b5\u30e9\u30de\u30f3\u30c0\u30fc","\u30a2\u30e9\u30df\u30bf\u30de"],gree:["1","Aeros","Sylph","Kusi","Kusi Mitama","UMA","\u30a8\u30a2\u30ed\u30b9","\u30b7\u30eb\u30ad\u30fc","\u30af\u30b7\u30df\u30bf\u30de"],blue:["2","Aquans","Undine","Nigi","Nigi Mitama","Enigma","\u30a2\u30af\u30a2\u30f3\u30ba","\u30a6\u30f3\u30c7\u30a3\u30fc\u30cd","\u30cb\u30ae\u30df\u30bf\u30de"]})}constructor(C,k){this.title2=C,this.route=k,this.normTitle="Normal Fusions",this.tripTitle="",this.isPersona=!1,this.filterDarks=!0,this.lang="en",this.msgs=n.qh,this.subscriptions=[],this.table=[],this.nameCut=4}ngOnInit(){this.subscriptions.push(this.route.parent.data.subscribe(C=>{this.appName=C.appName||"Shin Megami Tensei",this.nameCut=parseInt((0,U.oO)(this.msgs.NameCut,C.lang)),this.title2.setTitle((0,U.oO)(this.msgs.AppTitle,C.lang).replace("$APP",this.appName))}))}ngOnChanges(){this.normChart&&this.fillFusionChart()}ngOnDestroy(){for(const C of this.subscriptions)C.unsubscribe()}fillFusionChart(){const C="noneNone",D=B.RESULT_COLORS.reduce((E,[G,M])=>M.reduce((x,z)=>(x[z]=G,x),E),{}),h=this.normChart.elementDemons;let $=[],f=this.normChart.races,y=[];this.filterDarks&&($=this.normChart.races.filter(E=>this.normChart.getLightDark(E)>0),f=this.normChart.races.filter(E=>0===this.normChart.getLightDark(E)),y=this.normChart.races.filter(E=>-1===this.normChart.getLightDark(E)),0===y.length&&$.length>0&&($=this.normChart.races.filter(E=>this.normChart.getLightDark(E)>-1),f=[],y=this.normChart.races.filter(E=>this.normChart.getLightDark(E)<-1)));const P=$.length-y.length,J=$.concat(f,h),ie=y.length?y.concat(Array(J.length-y.length).fill("")):J,pe=this.mitaTable?J:$.concat(f,Array(h.length).fill("")),se=this.mitaTable||y.length?Array(P).fill("").concat(y,f,h):J;this.table=[[""].concat(J,[""])];for(let E=0;E<se.length;E++){const G=Array(J.length+2).fill("empt-"),M=se[E],x=pe[E],z=-1!==h.indexOf(M),fe=-1!==h.indexOf(x);this.table.push(G),G[0]=M,G[G.length-1]=x;for(let j=E;j<J.length;j++){const S=J[j],L=-1!==h.indexOf(S);if(L&&fe){const X=h.indexOf(x),o=h.indexOf(S),a=this.mitaTable[X][o-X-1];G[j+1]=a?(D[a]||"norm")+a:C}else if(L&&x){const X=this.normChart.getElemFusions(S)[x];G[j+1]=X?(D[X]||"rank")+(X>0?"+":"")+X.toString():C}else if(S&&x){const X=this.isPersona&&S===x?S:this.normChart.getRaceFusion(S,x);G[j+1]=X?(D[X]||(S===x?"elem":"norm"))+X:C}}if(this.tripChart)for(let j=0;j<=E-P;j++){const S=ie[j];if(S&&z){const L=this.tripChart.getElemFusions(M)[S];G[j+1]=L?(D[L]||"rank")+(L>0?"+":"")+L.toString():C}else if(S&&M){const L=this.tripChart.getRaceFusion(S,M);G[j+1]=L?(D[L]||(S===M?"elem":"trip"))+L:C}}if(-1!==M.indexOf(" x ")){const[j,S]=M.split(" x "),L=j.slice(0,3)+"x"+S.slice(0,3);G[0]=L,G[G.length-1]=L}else if(-1!==M.indexOf(" ")){const j=M.split(" ")[0];G[0]=j,G[G.length-1]=j}}for(let E=0;E<this.table[0].length;E++){const G=this.table[0][E];if(-1!==G.indexOf(" x ")){const[M,x]=G.split(" x ");this.table[0][E]=M.slice(0,2)+x.slice(0,2)}}this.table.push([""].concat(ie,[""]))}static{this.\u0275fac=function(k){return new(k||B)(r.rXU(V.hE),r.rXU(Q.nX))}}static{this.\u0275cmp=r.VBU({type:B,selectors:[["app-fusion-chart"]],inputs:{normChart:"normChart",tripChart:"tripChart",mitaTable:"mitaTable",normTitle:"normTitle",tripTitle:"tripTitle",isPersona:"isPersona",filterDarks:"filterDarks",lang:"lang",counter:"counter"},features:[r.OA$],decls:12,vars:7,consts:[[1,"title"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(k,D){1&k&&(r.j41(0,"table")(1,"tbody")(2,"tr")(3,"th",0),r.EFF(4),r.k0s()(),r.j41(5,"tr"),r.DNE(6,K,2,1,"th",1),r.k0s(),r.DNE(7,Z,6,3,"tr",1),r.j41(8,"tr"),r.DNE(9,e,2,1,"th",1),r.k0s(),r.DNE(10,N,3,3,"tr",2),r.k0s(),r.nrm(11,"tbody"),r.k0s()),2&k&&(r.R7$(3),r.BMQ("colspan",D.table[0].length),r.R7$(1),r.Lme("",D.appName," ",D.normTitle,""),r.R7$(2),r.Y8G("ngForOf",D.table[0]),r.R7$(1),r.Y8G("ngForOf",D.table.slice(1,D.table.length-1)),r.R7$(2),r.Y8G("ngForOf",D.table[D.table.length-1]),r.R7$(1),r.Y8G("ngIf",D.tripTitle))},dependencies:[w.YU,w.Sq,w.bT],styles:["table[_ngcontent-%COMP%]{width:auto;margin:0 auto;white-space:nowrap}td.elem[_ngcontent-%COMP%]{color:#0f0}td.trip[_ngcontent-%COMP%]{color:#d3d3d3}td.oran[_ngcontent-%COMP%]{color:orange}td.redd[_ngcontent-%COMP%]{color:red}td.gree[_ngcontent-%COMP%]{color:#0f0}td.blue[_ngcontent-%COMP%]{color:#0ff}td.none[_ngcontent-%COMP%]{color:transparent}td.empt[_ngcontent-%COMP%]{background-color:transparent;color:transparent}"],changeDetection:0})}}},1289:(ue,H,O)=>{O.d(H,{h:()=>X});var U=O(4660);function r(o,a){return parseInt(a.map(t=>o.includes(t)?"1":"0").join(""),2)||0}function V(o,a){return o.map((t,i,s)=>r(s.slice(0,i+1),a))}function w(o,a,t,i,s,l){let c=t,m=[c];const d=i.getSpecialNameEntries(c),b=a[a.length-1];if(0!==d.length&&(c=d.find(R=>0===i.getSpecialNameEntries(R).length),m.unshift(d.filter(R=>R!==c).join(" x ")),m.unshift(c)),o.length>0){const R=function q(o,a,t,i,s){const{fusionCalculator:l}=s,c=o.slice(0,1);if(o.length<2)return c;let m=c[0],d=a[0];for(let b=1;b<o.length;b++){const R=o[b],u=a[b],_=l.getFusions(m,t,i).map(F=>(0,U.lA)(F,t)).sort((F,A)=>F.price-A.price);let I=!1;for(const F of _)if(F.name1===R&&(u&t.getDemon(F.name2).inherits)===u){c.push(R),c.push(F.name2),m=c[c.length-1],d=u,I=!0;break}if(I)continue;const Y=l.getFusions(R,t,i).reduce((F,A)=>(F[A.name1]=A.name2,F),{});for(const F of _)if(Y[F.name2]&&(d&t.getDemon(F.name2).inherits)===d&&(u&t.getDemon(Y[F.name2]).inherits)===u){c.push(F.name1),c.push(F.name2),c.push(R),c.push(Y[F.name2]),m=c[c.length-1],d=u,I=!0;break}if(!I)return[]}return c}(o,a,i,s,l);if(0===R.length)return[];const u=R[R.length-1];let _=K(u,c,b,i,s,l);if(0===_.length){const I=i.getDemon(c),oe=i.getResultDemonLvls(I.race).map(Y=>i.reverseLookupDemon(I.race,Y)).filter(Y=>Y!==c);for(const Y of s.elementDemons.concat(oe)){if((b&i.getDemon(Y).inherits)!==b)continue;const F=K(u,Y,b,i,s,l),A=K(Y,c,b,i,s,l);if(0!==F.length&&0!==A.length){_=F.concat(A.slice(1));break}}}if(0===_.length)return[];m=R.concat(_.slice(1),m.slice(1))}return m}function K(o,a,t,i,s,l){const{fissionCalculator:c,fusionCalculator:m}=l,d=[o];if(o===a)return d;const b=m.getFusions(o,i,s).map(_=>(0,U.lA)(_,i)).sort((_,I)=>_.price-I.price);for(const _ of b)if(_.name2===a)return d.push(_.name1),d.push(a),d;const R=c.getFusions(a,i,s).map(_=>(0,U.on)(_,i)).sort((_,I)=>_.price-I.price);b.sort((_,I)=>I.price-_.price);const u=b.reduce((_,I)=>(_[I.name2]=I.name1,_),{});for(const _ of R){if(u[_.name1]&&(t&i.getDemon(_.name1).inherits)===t)return d.push(u[_.name1]),d.push(_.name1),d.push(_.name2),d.push(a),d;if(u[_.name2]&&(t&i.getDemon(_.name2).inherits)===t)return d.push(u[_.name2]),d.push(_.name2),d.push(_.name1),d.push(a),d}return[]}var Z=O(1090),e=O(2598),N=O(4341),B=O(177),v=O(4207);function C(o,a){if(1&o&&(e.j41(0,"option",16),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t),e.R7$(1),e.JRh(t)}}function k(o,a){if(1&o&&(e.j41(0,"option",17),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("ngValue",t),e.R7$(1),e.JRh(t.name)}}function D(o,a){if(1&o&&(e.j41(0,"option",16),e.EFF(1),e.k0s()),2&o){const t=a.$implicit,i=e.XpG(3);e.Y8G("value",t),e.R7$(1),e.JRh(i.recipeConfig.displayElems[t]||t)}}function h(o,a){if(1&o&&(e.j41(0,"option",17),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("ngValue",t),e.R7$(1),e.JRh(t.name)}}function $(o,a){if(1&o&&(e.j41(0,"option",16),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t),e.R7$(1),e.JRh(t)}}function f(o,a){if(1&o&&(e.j41(0,"option",17),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("ngValue",t),e.R7$(1),e.JRh(t.name)}}function y(o,a){if(1&o&&(e.j41(0,"select",25),e.DNE(1,f,2,2,"option",8),e.k0s()),2&o){const t=e.XpG(2).$implicit,i=e.XpG();e.R7$(1),e.Y8G("ngForOf",i.learnedBy[t.controls.skill.value.name])}}function P(o,a){if(1&o&&(e.j41(0,"option",17),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("ngValue",t),e.R7$(1),e.JRh(t.name)}}function J(o,a){if(1&o&&(e.j41(0,"select",25),e.DNE(1,P,2,2,"option",8),e.k0s()),2&o){const t=e.XpG(2).$implicit,i=e.XpG();e.R7$(1),e.Y8G("ngForOf",i.demons[t.controls.race.value])}}function ie(o,a){if(1&o){const t=e.RV6();e.j41(0,"tr")(1,"td")(2,"label"),e.EFF(3),e.nI1(4,"translateComp"),e.j41(5,"input",20),e.bIt("change",function(){e.eBV(t);const s=e.XpG().$implicit,l=e.XpG();return e.Njj(l.setIngredDemon(s))}),e.k0s()()(),e.j41(6,"td")(7,"select",21),e.bIt("change",function(){e.eBV(t);const s=e.XpG().$implicit,l=e.XpG();return e.Njj(l.setIngredElem(s))}),e.j41(8,"option",22),e.EFF(9,"-"),e.k0s(),e.DNE(10,D,2,2,"option",6),e.k0s()(),e.j41(11,"td")(12,"select",23),e.bIt("change",function(){e.eBV(t);const s=e.XpG().$implicit,l=e.XpG();return e.Njj(l.setIngredDemon(s))}),e.DNE(13,h,2,2,"option",8),e.k0s()(),e.j41(14,"td")(15,"select",5),e.bIt("change",function(){e.eBV(t);const s=e.XpG().$implicit,l=e.XpG();return e.Njj(l.setIngredDemon(s))}),e.j41(16,"option",22),e.EFF(17,"-"),e.k0s(),e.DNE(18,$,2,2,"option",6),e.k0s()(),e.j41(19,"td"),e.DNE(20,y,2,1,"select",24),e.DNE(21,J,2,1,"select",24),e.k0s()()}if(2&o){const t=e.XpG(),i=t.index,s=t.$implicit,l=e.XpG();e.R7$(3),e.Lme("",e.i5U(4,10,l.msgs.LearnsSkill,l.lang),"",i+1," "),e.R7$(4),e.BMQ("disabled",!s.controls.searchSkill.value||null),e.R7$(3),e.Y8G("ngForOf",l.elems),e.R7$(2),e.BMQ("disabled",!s.controls.searchSkill.value||null),e.R7$(1),e.Y8G("ngForOf",l.skills[s.controls.elem.value]),e.R7$(2),e.BMQ("disabled",s.controls.searchSkill.value||null),e.R7$(3),e.Y8G("ngForOf",l.races),e.R7$(2),e.Y8G("ngIf",s.controls.searchSkill.value),e.R7$(1),e.Y8G("ngIf",!s.controls.searchSkill.value)}}function pe(o,a){if(1&o&&(e.qex(0,18),e.DNE(1,ie,22,13,"tr",19),e.bVm()),2&o){const t=a.index,i=e.XpG();e.Y8G("formGroupName",t),e.R7$(1),e.Y8G("ngIf",t<i.maxSkills)}}function se(o,a){if(1&o&&(e.j41(0,"li"),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.R7$(1),e.JRh(t)}}function E(o,a){if(1&o&&(e.j41(0,"td",29)(1,"ul"),e.DNE(2,se,2,1,"li",30),e.k0s()()),2&o){const t=e.XpG(2);e.R7$(2),e.Y8G("ngForOf",t.recipeLeft)}}function G(o,a){if(1&o&&(e.j41(0,"td",31),e.EFF(1),e.nI1(2,"translateComp"),e.k0s()),2&o){const t=e.XpG(2);e.R7$(1),e.JRh(e.i5U(2,1,t.msgs.NoRecipesFound,t.lang))}}function M(o,a){if(1&o&&(e.j41(0,"li"),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.R7$(1),e.JRh(t)}}function x(o,a){if(1&o&&(e.j41(0,"td",29)(1,"ul"),e.DNE(2,M,2,1,"li",30),e.k0s()()),2&o){const t=e.XpG(2);e.R7$(2),e.Y8G("ngForOf",t.recipeRight)}}function z(o,a){if(1&o&&(e.j41(0,"td",31),e.EFF(1),e.nI1(2,"translateComp"),e.k0s()),2&o){const t=e.XpG(2);e.R7$(1),e.JRh(e.i5U(2,1,t.msgs.NoRecipesFound,t.lang))}}function fe(o,a){if(1&o&&(e.j41(0,"tr")(1,"td",28),e.EFF(2),e.nI1(3,"translateComp"),e.k0s()()),2&o){const t=e.XpG(2);e.R7$(2),e.Lme(" ",e.i5U(3,2,t.msgs.SpecialFusionCondition,t.lang),": ",t.fusionPrereq," ")}}function j(o,a){if(1&o&&(e.qex(0),e.EFF(1),e.nrm(2,"br"),e.EFF(3),e.bVm()),2&o){const t=e.XpG(2);e.R7$(1),e.Lme(" ",t.recipeResult.join(" x ")," = ",t.recipe.result,""),e.R7$(2),e.SpI(" [",t.resultSkills.join(", "),"] ")}}function S(o,a){if(1&o&&(e.qex(0),e.EFF(1),e.nI1(2,"translateComp"),e.bVm()),2&o){const t=e.XpG(2);e.R7$(1),e.JRh(e.i5U(2,1,t.msgs.NoRecipesFound,t.lang))}}function L(o,a){if(1&o&&(e.j41(0,"table",1)(1,"tr")(2,"th",2),e.EFF(3),e.nI1(4,"translateComp"),e.k0s()(),e.j41(5,"tr")(6,"th"),e.EFF(7),e.nI1(8,"translateComp"),e.k0s(),e.j41(9,"th"),e.EFF(10),e.nI1(11,"translateComp"),e.k0s()(),e.j41(12,"tr"),e.DNE(13,E,3,1,"td",26),e.DNE(14,G,3,4,"td",27),e.DNE(15,x,3,1,"td",26),e.DNE(16,z,3,4,"td",27),e.k0s(),e.DNE(17,fe,4,5,"tr",19),e.j41(18,"tr")(19,"td",28),e.DNE(20,j,4,3,"ng-container",19),e.DNE(21,S,3,4,"ng-container",19),e.k0s()()()),2&o){const t=e.XpG();e.R7$(3),e.JRh(e.i5U(4,10,t.msgs.FusionRecipe,t.lang)),e.R7$(4),e.JRh(e.i5U(8,13,t.msgs.LeftChain,t.lang)),e.R7$(3),e.JRh(e.i5U(11,16,t.msgs.RightChain,t.lang)),e.R7$(3),e.Y8G("ngIf",t.recipeLeft.length),e.R7$(1),e.Y8G("ngIf",!t.recipeLeft.length),e.R7$(1),e.Y8G("ngIf",t.recipeRight.length),e.R7$(1),e.Y8G("ngIf",!t.recipeRight.length),e.R7$(1),e.Y8G("ngIf",t.fusionPrereq),e.R7$(3),e.Y8G("ngIf",t.recipe.stepR.length),e.R7$(1),e.Y8G("ngIf",!t.recipe.stepR.length)}}let X=(()=>{class o{constructor(t){this.fb=t,this.maxSkills=8,this.lang="en",this.internalMaxSkills=9,this.range99=Array(99),this.demons={},this.skills={},this.learnedBy={},this.fusionPrereq="",this.msgs=Z.hV,this.blankDemon={name:"-",race:"-",lvl:0,currLvl:0,price:0,inherits:0,skills:{},stats:[],resists:[],affinities:[],fusion:"normal",prereq:""},this.blankSkill={name:"-",element:"-",rank:99,cost:0,effect:"",target:"",level:0,learnedBy:[{demon:"-",level:0}]},this.createForm()}ngOnChanges(){this.initDropdowns()}createForm(){const t=[];for(let i=0;i<this.internalMaxSkills;i++)t.push(this.fb.group({searchSkill:!0,elem:"-",skill:this.blankSkill,race:{value:"-",disabled:!0},demon:this.blankDemon}));this.form=this.fb.group({race:"-",demon:this.blankDemon,ingreds:this.fb.array(t)}),this.form.valueChanges.subscribe(i=>{if(this.form.valid){const s=i.ingreds.filter(c=>"-"!==c.demon.name&&c.demon.name!==i.demon.name).map(c=>c.demon.name),l={};for(const c of i.ingreds)c.searchSkill&&"-"!==c.skill.name&&(l[c.skill.name]=c.demon.name);this.updateRecipe(function n(o,a,t,i,s,l){const{fissionCalculator:c,inheritElems:m,restrictInherits:d,triExclusiveRaces:b,triFissionCalculator:R}=l,{normalChart:u}=s,_=i.getDemon(o),I={};for(const[g,p]of Object.entries(t))"-"!==p&&p!==_.name&&(I[g]=p);const Y=r(Object.keys(t).map(g=>i.getSkill(g)).map(g=>g.element),m);let F=i.getSpecialNameEntries(o);if(F.length<2&&b.includes(_.race)){const g=R.getFusions(o,i,s).map(p=>(0,U.f7)(p,i)).sort((p,T)=>p.price-T.price).find(p=>!((Y&(p.d1.inherits|p.d2.inherits))!==Y||"special"!==p.d1.fusion&&b.includes(p.d1.race)||"special"!==p.d2.fusion&&b.includes(p.d2.race)||"special"!==p.d3.fusion&&b.includes(p.d3.race)));g&&(F=[g.d1.name,g.d2.name,g.d3.name])}if(F.length<2){const g=c.getFusions(o,i,u).map(p=>(0,U.on)(p,i)).sort((p,T)=>p.price-T.price).find(p=>!((Y&(i.getDemon(p.name1).inherits|i.getDemon(p.name2).inherits))!==Y||"normal"!==i.getDemon(p.name1).fusion&&"special"!==i.getDemon(p.name1).fusion||"normal"!==i.getDemon(p.name2).fusion&&"special"!==i.getDemon(p.name2).fusion));g&&(F=[g.name1,g.name2])}const A=F.map(g=>i.getDemon(g)).sort((g,p)=>p.price-g.price),ge=Object.keys(I).map(g=>i.getSkill(g)),re=r(ge.map(g=>g.element),m),ke=ge.map(g=>r([g.element],m));let le,_e,de=0;for(let g=0;g<A.length;g++){const p=A[g];for(const T of A.slice(g+1))if((re&(p.inherits|T.inherits))===re){const Re=(re&p.inherits).toString(2).split("1").length*(re&T.inherits).toString(2).split("1").length;de<Re&&(le=p,_e=T,de=Re)}}const ae={chain1:[],chain2:[],stepR:F,skills:I,result:o};if(!le)return ae;const ee=Object.values(I).filter((g,p,T)=>T.indexOf(g)===p),ce=a.filter(g=>!ee.includes(g));let W=Math.ceil(ee.length/2);ee.sort((g,p)=>u.getLightDark(i.getDemon(g).race)-u.getLightDark(i.getDemon(p).race));let te=ee.slice(0,W),he=Array(te.length).fill(0),ne=ee.slice(W),me=Array(ne.length).fill(0);if(d){const{left:g,right:p}=function Q(o,a,t,i){let s=[],l=[];const c=[],m=[],d={},b=[];for(let R=0;R<t.length;R++){const u=t[R];0!==u?(d.hasOwnProperty(u)||(d[u]=[]),d[u].push(i[R])):b.push(i[R])}for(const R of Object.keys(d).sort()){const u=parseInt(R);c.length<=m.length?(u&o)===u?c.push(u):m.push(u):(u&a)===u?m.push(u):c.push(u)}for(const R of c)s=s.concat(d[R]);for(const R of m)l=l.concat(d[R]);for(const R of b)s.length<l.length?s.push(R):l.push(R);return{left:s.reverse(),right:l.reverse()}}(le.inherits,_e.inherits,ke,ge.map(T=>T.name));te=g.map(T=>I[T]),he=V(g.map(T=>i.getSkill(T).element),m),ne=p.map(T=>I[T]),me=V(p.map(T=>i.getSkill(T).element),m)}return W=Math.ceil(ce.length/2),te=ce.slice(0,W).concat(te),he=Array(W).fill(0).concat(he),ne=ce.slice(W).concat(ne),me=Array(ce.length-W).fill(0).concat(me),ae.chain1=w(te,he,le.name,i,u,l),ae.chain2=w(ne,me,_e.name,i,u,l),ae}(i.demon.name,s,l,this.compendium,this.squareChart,this.recipeConfig))}})}setIngredElem(t){t.controls.skill.setValue(this.skills[t.controls.elem.value][0]),this.setIngredDemon(t)}setIngredDemon(t){t.controls.demon.setValue((t.controls.searchSkill.value?this.learnedBy[t.controls.skill.value.name]:this.demons[t.controls.race.value])[0])}updateRecipe(t){const i={};for(const[s,l]of Object.entries(t.skills)){i[l]||(i[l]=[]);const c=this.compendium.getDemon(l).skills[s];i[l].push(s+(c>=2?` (${c})`:""))}this.recipe=t,this.recipeLeft=this.decodeRecipechain(t.chain1,i),this.recipeRight=this.decodeRecipechain(t.chain2,i),this.resultSkills=[],this.recipeResult=[],this.fusionPrereq=this.compendium.getDemon(t.result).prereq||"";for(const s of t.stepR)this.recipeResult.push(i[s]?`${s} [${i[s].join(", ")}]`:s);for(const[s,l]of Object.entries(this.compendium.getDemon(t.result).skills).filter(c=>c[1]<2e3).sort((c,m)=>c[1]-m[1]))this.resultSkills.push(s+(l>=2?` (${l})`:""))}decodeRecipechain(t,i){const s=[];for(let l=0;l<t.length-2;l+=2){const c=i[t[l]]?"["+i[t[l]].join(", ")+"] ":"",m=i[t[l+1]]?"["+i[t[l+1]].join(", ")+"] ":"";s.push(`${t[l]} ${c}x ${t[l+1]} ${m}= ${t[l+2]}`)}return s}initDropdowns(){if(this.recipeConfig&&this.compendium&&this.squareChart){this.demons={"-":[this.blankDemon]},this.skills={"-":[this.blankSkill]},this.learnedBy={"-":[this.blankDemon]};for(const t of this.compendium.allDemons)if(!t.isEnemy&&"party"!==t.fusion&&"enemy"!==t.fusion){this.demons[t.race]||(this.demons[t.race]=[]),this.demons[t.race].push(t);for(const i of Object.keys(t.skills))this.learnedBy[i]||(this.learnedBy[i]=[]),this.learnedBy[i].push(t)}for(const t of this.compendium.allSkills.filter(i=>i.rank<50&&i.learnedBy.length>0))this.skills[t.element]||(this.skills[t.element]=[]),this.skills[t.element].push(t);for(const t of Object.values(this.demons))t.sort((i,s)=>i.lvl-s.lvl);for(const t of Object.values(this.learnedBy))t.sort((i,s)=>i.lvl-s.lvl);for(const t of Object.values(this.skills))t.sort((i,s)=>i.rank-s.rank);this.races=this.recipeConfig.races.filter(t=>this.demons[t]),this.elems=this.recipeConfig.skillElems.filter(t=>this.skills[t]),this.setDemon(this.compendium.getDemon(this.recipeConfig.defaultDemon))}}setDemon(t){const i=[],{inheritElems:s}=this.recipeConfig,l=Object.entries(t.skills).slice(0,this.internalMaxSkills).filter(m=>m[1]<2).map(m=>this.compendium.getSkill(m[0])),c=Object.entries(t.skills).slice(0,this.internalMaxSkills).filter(m=>m[1]<100).map(m=>this.compendium.getSkill(m[0]));for(let m=0;m<s.length;m++)t.inherits&1<<m||i.push(s[s.length-m-1]);this.skills[this.blankSkill.element]=[this.blankSkill].concat(c),this.elems=this.recipeConfig.skillElems.filter(m=>this.skills[m]&&!i.includes(m)),this.form.patchValue({race:t.race,demon:t,ingreds:l.concat(Array(this.internalMaxSkills-l.length).fill(this.blankSkill)).map(m=>({searchSkill:!0,elem:"-",skill:m,race:"-",demon:"-"!==m.name?t:this.blankDemon}))})}static{this.\u0275fac=function(i){return new(i||o)(e.rXU(N.ok))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-recipe-generator"]],inputs:{maxSkills:"maxSkills",compendium:"compendium",squareChart:"squareChart",recipeConfig:"recipeConfig",lang:"lang"},features:[e.OA$],decls:46,vars:45,consts:[[3,"formGroup"],[1,"entry-table"],["colspan","2",1,"title"],[2,"width","40%"],[2,"width","60%"],["formControlName","race",3,"change"],[3,"value",4,"ngFor","ngForOf"],["formControlName","demon",3,"change"],[3,"ngValue",4,"ngFor","ngForOf"],["formArrayName","ingreds",1,"entry-table"],["colspan","5",1,"title"],[2,"width","20%"],[2,"width","10%"],[2,"width","25%"],[3,"formGroupName",4,"ngFor","ngForOf"],["class","entry-table",4,"ngIf"],[3,"value"],[3,"ngValue"],[3,"formGroupName"],[4,"ngIf"],["formControlName","searchSkill","type","checkbox",3,"change"],["formControlName","elem",3,"change"],["value","-"],["formControlName","skill",3,"change"],["formControlName","demon",4,"ngIf"],["formControlName","demon"],["style","width: 50%",4,"ngIf"],["style","width: 50%","style","padding: 1em; text-align: center;",4,"ngIf"],["colspan","2",2,"padding","1em","text-align","center"],[2,"width","50%"],[4,"ngFor","ngForOf"],[2,"padding","1em","text-align","center"]],template:function(i,s){1&i&&(e.j41(0,"form",0)(1,"h2"),e.EFF(2),e.nI1(3,"translateComp"),e.k0s(),e.j41(4,"table",1)(5,"tr")(6,"th",2),e.EFF(7),e.nI1(8,"translateComp"),e.k0s()(),e.j41(9,"tr")(10,"th",3),e.EFF(11),e.nI1(12,"translateComp"),e.k0s(),e.j41(13,"th",4),e.EFF(14),e.nI1(15,"translateComp"),e.k0s()(),e.j41(16,"tr")(17,"td")(18,"select",5),e.bIt("change",function(){return s.setDemon(s.demons[s.form.controls.race.value][0])}),e.DNE(19,C,2,2,"option",6),e.k0s()(),e.j41(20,"td")(21,"select",7),e.bIt("change",function(){return s.setDemon(s.form.controls.demon.value)}),e.DNE(22,k,2,2,"option",8),e.k0s()()()(),e.j41(23,"table",9)(24,"tr")(25,"th",10),e.EFF(26),e.nI1(27,"translateComp"),e.k0s()(),e.j41(28,"tr")(29,"th",11),e.EFF(30),e.nI1(31,"translateComp"),e.k0s(),e.j41(32,"th",12),e.EFF(33),e.nI1(34,"translateComp"),e.k0s(),e.j41(35,"th",13),e.EFF(36),e.nI1(37,"translateComp"),e.k0s(),e.j41(38,"th",11),e.EFF(39),e.nI1(40,"translateComp"),e.k0s(),e.j41(41,"th",13),e.EFF(42),e.nI1(43,"translateComp"),e.k0s()(),e.DNE(44,pe,2,2,"ng-container",14),e.k0s(),e.DNE(45,L,22,19,"table",15),e.k0s()),2&i&&(e.Y8G("formGroup",s.form),e.R7$(2),e.JRh(e.i5U(3,15,s.msgs.RecipeGenerator,s.lang)),e.R7$(5),e.JRh(e.i5U(8,18,s.msgs.Target,s.lang)),e.R7$(4),e.JRh(e.i5U(12,21,s.msgs.Race,s.lang)),e.R7$(3),e.JRh(e.i5U(15,24,s.msgs.Name,s.lang)),e.R7$(5),e.Y8G("ngForOf",s.races),e.R7$(3),e.Y8G("ngForOf",s.demons[s.form.controls.race.value]),e.R7$(4),e.JRh(e.i5U(27,27,s.msgs.IncludeIngredients,s.lang)),e.R7$(4),e.JRh(e.i5U(31,30,s.msgs.FilterBy,s.lang)),e.R7$(3),e.JRh(e.i5U(34,33,s.msgs.Elem,s.lang)),e.R7$(3),e.JRh(e.i5U(37,36,s.msgs.Skill,s.lang)),e.R7$(3),e.JRh(e.i5U(40,39,s.msgs.Race,s.lang)),e.R7$(3),e.JRh(e.i5U(43,42,s.msgs.Ingredient,s.lang)),e.R7$(2),e.Y8G("ngForOf",s.form.controls.ingreds.controls),e.R7$(1),e.Y8G("ngIf",s.recipe))},dependencies:[B.Sq,B.bT,N.qT,N.xH,N.y7,N.Zm,N.wz,N.BC,N.cb,N.j4,N.JD,N.$R,N.v8,v.uz],styles:["ul[_ngcontent-%COMP%]{padding:0 1em;list-style:none}td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-height:25px;width:100%}"],changeDetection:0})}}return o})()}}]);