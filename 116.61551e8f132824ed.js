"use strict";(self.webpackChunkmegaten_fusion_tool=self.webpackChunkmegaten_fusion_tool||[]).push([[116],{9012:(pe,j,S)=>{S.d(j,{N:()=>w});var t=S(4769),$=S(6814),L=S(2173);function B(c,I){if(1&c&&(t.TgZ(0,"th",4),t._uU(1,"Inheritable Skills"),t.qZA()),2&c){const u=t.oxw();t.uIk("colspan",u.inheritHeaders.length)}}function K(c,I){if(1&c&&(t.TgZ(0,"th",4),t._uU(1),t.qZA()),2&c){const u=t.oxw();t.uIk("colspan",u.inheritHeaders.length),t.xp6(1),t.hij(" ",u.langEn?"Skill Affinities":"\u30b9\u30ad\u30eb\u9069\u6b63"," ")}}function P(c,I){if(1&c&&(t.ynx(0),t._uU(1),t.BQk()),2&c){const u=t.oxw().$implicit;t.xp6(1),t.Oqu(u)}}function G(c,I){if(1&c&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&c){const u=t.oxw().$implicit;t.Gre("element-icon ",u,""),t.xp6(1),t.Oqu(u)}}function H(c,I){if(1&c&&(t.TgZ(0,"th"),t.YNc(1,P,2,1,"ng-container",3),t.YNc(2,G,2,4,"div",5),t.qZA()),2&c){const u=t.oxw();t.Udp("width",100/u.inheritHeaders.length,"%"),t.xp6(1),t.Q6J("ngIf",!u.hasIcons),t.xp6(1),t.Q6J("ngIf",u.hasIcons)}}function e(c,I){if(1&c&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&c){const u=I.$implicit;t.Udp("color",u?null:"transparent"),t.xp6(1),t.hij(" ",u?"yes":"no"," ")}}function b(c,I){if(1&c&&(t.TgZ(0,"tr"),t.YNc(1,e,2,3,"td",6),t.qZA()),2&c){const u=t.oxw();t.xp6(1),t.Q6J("ngForOf",u.inherits)}}function q(c,I){if(1&c&&(t.TgZ(0,"td"),t.ALo(1,"roundInheritPercent"),t._uU(2),t.qZA()),2&c){const u=I.$implicit;t.Gre("affinity",t.lcZ(1,4,u),""),t.xp6(2),t.hij(" ",u,"% ")}}function T(c,I){if(1&c&&(t.TgZ(0,"tr"),t.YNc(1,q,3,6,"td",7),t.qZA()),2&c){const u=t.oxw();t.xp6(1),t.Q6J("ngForOf",u.inherits)}}function x(c,I){if(1&c&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"affinityToString"),t.qZA()),2&c){const u=I.$implicit;t.Gre("affinity",u,""),t.xp6(1),t.hij(" ",t.lcZ(2,4,u)," ")}}function k(c,I){if(1&c&&(t.TgZ(0,"tr"),t.YNc(1,x,3,6,"td",7),t.qZA()),2&c){const u=t.oxw();t.xp6(1),t.Q6J("ngForOf",u.inherits)}}let w=(()=>{class c{constructor(){this.inheritHeaders=[],this.inherits=[],this.hasChance=!1,this.hasIcons=!0,this.hasLvls=!1,this.langEn=!0}static#e=this.\u0275fac=function(M){return new(M||c)};static#t=this.\u0275cmp=t.Xpm({type:c,selectors:[["app-demon-inherits"]],inputs:{inheritHeaders:"inheritHeaders",inherits:"inherits",hasChance:"hasChance",hasIcons:"hasIcons",hasLvls:"hasLvls",langEn:"langEn"},decls:11,vars:6,consts:[[1,"entry-table"],["class","title",4,"ngIf"],[3,"width",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"title"],[3,"class",4,"ngIf"],[3,"color",4,"ngFor","ngForOf"],[3,"class",4,"ngFor","ngForOf"]],template:function(M,E){1&M&&(t.TgZ(0,"table",0)(1,"thead")(2,"tr"),t.YNc(3,B,2,1,"th",1),t.YNc(4,K,2,2,"th",1),t.qZA(),t.TgZ(5,"tr"),t.YNc(6,H,3,4,"th",2),t.qZA()(),t.TgZ(7,"tbody"),t.YNc(8,b,2,1,"tr",3),t.YNc(9,T,2,1,"tr",3),t.YNc(10,k,2,1,"tr",3),t.qZA()()),2&M&&(t.xp6(3),t.Q6J("ngIf",!E.hasLvls),t.xp6(1),t.Q6J("ngIf",E.hasLvls&&E.inheritHeaders.length),t.xp6(2),t.Q6J("ngForOf",E.inheritHeaders),t.xp6(2),t.Q6J("ngIf",!E.hasLvls&&!E.hasChance),t.xp6(1),t.Q6J("ngIf",E.hasChance),t.xp6(1),t.Q6J("ngIf",E.hasLvls))},dependencies:[$.sg,$.O5,L.JZ,L.DY],encapsulation:2,changeDetection:0})}return c})()},8615:(pe,j,S)=>{S.d(j,{R:()=>b});var t=S(4769),$=S(6593),L=S(4487),B=S(6814);function K(q,T){if(1&q&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&q){const x=T.$implicit,k=t.oxw();t.xp6(1),t.Oqu(x.slice(0,k.nameCut))}}function P(q,T){if(1&q&&(t.TgZ(0,"td",4),t._uU(1),t.qZA()),2&q){const x=T.$implicit,k=t.oxw(2);t.Q6J("ngClass",x.slice(0,4)),t.xp6(1),t.Oqu(x.slice(4,k.nameCut+4))}}function G(q,T){if(1&q&&(t.TgZ(0,"tr")(1,"th"),t._uU(2),t.qZA(),t.YNc(3,P,2,2,"td",3),t.TgZ(4,"th"),t._uU(5),t.qZA()()),2&q){const x=T.$implicit;t.xp6(2),t.Oqu(x[0]),t.xp6(1),t.Q6J("ngForOf",x.slice(1,x.length-1)),t.xp6(2),t.Oqu(x[x.length-1])}}function H(q,T){if(1&q&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&q){const x=T.$implicit,k=t.oxw();t.xp6(1),t.Oqu(x.slice(0,k.nameCut))}}function e(q,T){if(1&q&&(t.TgZ(0,"tr")(1,"th",0),t._uU(2),t.qZA()()),2&q){const x=t.oxw();t.xp6(1),t.uIk("colspan",x.table[0].length),t.xp6(1),t.AsE("",x.appName," ",x.tripTitle,"")}}class b{static#e=this.RESULT_COLORS=Object.entries({oran:["-2","Erthys","Gnome","Saki","Saki Mitama","Random","\u30a2\u30fc\u30b7\u30fc\u30ba","\u30ce\u30fc\u30e0","\u30b5\u30ad\u30df\u30bf\u30de"],redd:["-1","Flaemis","Salamander","Ara ","Ara Mitama","Fiend","\u30d5\u30ec\u30a4\u30df\u30fc\u30ba","\u30b5\u30e9\u30de\u30f3\u30c0\u30fc","\u30a2\u30e9\u30df\u30bf\u30de"],gree:["1","Aeros","Sylph","Kusi","Kusi Mitama","UMA","\u30a8\u30a2\u30ed\u30b9","\u30b7\u30eb\u30ad\u30fc","\u30af\u30b7\u30df\u30bf\u30de"],blue:["2","Aquans","Undine","Nigi","Nigi Mitama","Enigma","\u30a2\u30af\u30a2\u30f3\u30ba","\u30a6\u30f3\u30c7\u30a3\u30fc\u30cd","\u30cb\u30ae\u30df\u30bf\u30de"]});constructor(T,x){this.title2=T,this.route=x,this.normTitle="Normal Fusions",this.tripTitle="",this.isPersona=!1,this.filterDarks=!0,this.langEn=!0,this.subscriptions=[],this.table=[],this.nameCut=4}ngOnInit(){this.subscriptions.push(this.route.parent.data.subscribe(T=>{this.appName=T.appName||"Shin Megami Tensei",this.nameCut=this.langEn?4:2,this.title2.setTitle(this.langEn?`Fusion Chart - ${this.appName} Fusion Calculator`:`\u5408\u4f53\u8868 ${this.appName} \u5408\u4f53\u30a2\u30d7\u30ea`)}))}ngOnChanges(){this.normChart&&this.fillFusionChart()}ngOnDestroy(){for(const T of this.subscriptions)T.unsubscribe()}fillFusionChart(){const T="noneNone",k=b.RESULT_COLORS.reduce((Z,[A,v])=>v.reduce((y,V)=>(y[V]=A,y),Z),{}),w=this.normChart.elementDemons;let c=[],I=this.normChart.races,u=[];this.filterDarks&&(c=this.normChart.races.filter(Z=>this.normChart.getLightDark(Z)>0),I=this.normChart.races.filter(Z=>0===this.normChart.getLightDark(Z)),u=this.normChart.races.filter(Z=>-1===this.normChart.getLightDark(Z)),0===u.length&&c.length>0&&(c=this.normChart.races.filter(Z=>this.normChart.getLightDark(Z)>-1),I=[],u=this.normChart.races.filter(Z=>this.normChart.getLightDark(Z)<-1)));const M=c.length-u.length,E=c.concat(I,w),ee=u.length?u.concat(Array(E.length-u.length).fill("")):E,ce=this.mitaTable?E:c.concat(I,Array(w.length).fill("")),te=this.mitaTable||u.length?Array(M).fill("").concat(u,I,w):E;this.table=[[""].concat(E,[""])];for(let Z=0;Z<te.length;Z++){const A=Array(E.length+2).fill("empt-"),v=te[Z],y=ce[Z],V=-1!==w.indexOf(v),he=-1!==w.indexOf(y);this.table.push(A),A[0]=v,A[A.length-1]=y;for(let R=Z;R<E.length;R++){const N=E[R],U=-1!==w.indexOf(N);if(U&&he){const s=w.indexOf(y),l=w.indexOf(N),n=this.mitaTable[s][l-s-1];A[R+1]=n?(k[n]||"norm")+n:T}else if(U&&y){const s=this.normChart.getElemFusions(N)[y];A[R+1]=s?(k[s]||"rank")+(s>0?"+":"")+s.toString():T}else if(N&&y){const s=this.isPersona&&N===y?N:this.normChart.getRaceFusion(N,y);A[R+1]=s?(k[s]||(N===y?"elem":"norm"))+s:T}}if(this.tripChart)for(let R=0;R<=Z-M;R++){const N=ee[R];if(N&&V){const U=this.tripChart.getElemFusions(v)[N];A[R+1]=U?(k[U]||"rank")+(U>0?"+":"")+U.toString():T}else if(N&&v){const U=this.tripChart.getRaceFusion(N,v);A[R+1]=U?(k[U]||(N===v?"elem":"trip"))+U:T}}if(-1!==v.indexOf(" x ")){const[R,N]=v.split(" x "),U=R.slice(0,3)+"x"+N.slice(0,3);A[0]=U,A[A.length-1]=U}else if(-1!==v.indexOf(" ")){const R=v.split(" ")[0];A[0]=R,A[A.length-1]=R}}for(let Z=0;Z<this.table[0].length;Z++){const A=this.table[0][Z];if(-1!==A.indexOf(" x ")){const[v,y]=A.split(" x ");this.table[0][Z]=v.slice(0,2)+y.slice(0,2)}}this.table.push([""].concat(ee,[""]))}static#t=this.\u0275fac=function(x){return new(x||b)(t.Y36($.Dx),t.Y36(L.gz))};static#n=this.\u0275cmp=t.Xpm({type:b,selectors:[["app-fusion-chart"]],inputs:{normChart:"normChart",tripChart:"tripChart",mitaTable:"mitaTable",normTitle:"normTitle",tripTitle:"tripTitle",isPersona:"isPersona",filterDarks:"filterDarks",langEn:"langEn",counter:"counter"},features:[t.TTD],decls:12,vars:7,consts:[[1,"title"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(x,k){1&x&&(t.TgZ(0,"table")(1,"tbody")(2,"tr")(3,"th",0),t._uU(4),t.qZA()(),t.TgZ(5,"tr"),t.YNc(6,K,2,1,"th",1),t.qZA(),t.YNc(7,G,6,3,"tr",1),t.TgZ(8,"tr"),t.YNc(9,H,2,1,"th",1),t.qZA(),t.YNc(10,e,3,3,"tr",2),t.qZA(),t._UZ(11,"tbody"),t.qZA()),2&x&&(t.xp6(3),t.uIk("colspan",k.table[0].length),t.xp6(1),t.AsE("",k.appName," ",k.normTitle,""),t.xp6(2),t.Q6J("ngForOf",k.table[0]),t.xp6(1),t.Q6J("ngForOf",k.table.slice(1,k.table.length-1)),t.xp6(2),t.Q6J("ngForOf",k.table[k.table.length-1]),t.xp6(1),t.Q6J("ngIf",k.tripTitle))},dependencies:[B.mk,B.sg,B.O5],styles:["table[_ngcontent-%COMP%]{width:auto;margin:0 auto;white-space:nowrap}td.elem[_ngcontent-%COMP%]{color:#0f0}td.trip[_ngcontent-%COMP%]{color:#d3d3d3}td.oran[_ngcontent-%COMP%]{color:orange}td.redd[_ngcontent-%COMP%]{color:red}td.gree[_ngcontent-%COMP%]{color:#0f0}td.blue[_ngcontent-%COMP%]{color:#0ff}td.none[_ngcontent-%COMP%]{color:transparent}td.empt[_ngcontent-%COMP%]{background-color:transparent;color:transparent}"],changeDetection:0})}},4436:(pe,j,S)=>{S.d(j,{X:()=>U});var t=S(6404);function L(s,l){return parseInt(l.map(n=>s.includes(n)?"1":"0").join(""),2)||0}function B(s,l){return s.map((n,i,o)=>L(o.slice(0,i+1),l))}function P(s,l,n,i,o,r){let a=n,h=[a];const _=i.getSpecialNameEntries(a),D=l[l.length-1];if(0!==_.length&&(a=_.find(d=>0===i.getSpecialNameEntries(d).length),h.unshift(_.filter(d=>d!==a).join(" x ")),h.unshift(a)),s.length>0){const d=function H(s,l,n,i,o){const{fusionCalculator:r}=o,a=s.slice(0,1);if(s.length<2)return a;let h=a[0],_=l[0];for(let D=1;D<s.length;D++){const d=s[D],f=l[D],g=r.getFusions(h,n,i).map(C=>(0,t.D0)(C,n)).sort((C,Q)=>C.price-Q.price);let O=!1;for(const C of g)if(C.name1===d&&(f&n.getDemon(C.name2).inherits)===f){a.push(d),a.push(C.name2),h=a[a.length-1],_=f,O=!0;break}if(O)continue;const J=r.getFusions(d,n,i).reduce((C,Q)=>(C[Q.name1]=Q.name2,C),{});for(const C of g)if(J[C.name2]&&(_&n.getDemon(C.name2).inherits)===_&&(f&n.getDemon(J[C.name2]).inherits)===f){a.push(C.name1),a.push(C.name2),a.push(d),a.push(J[C.name2]),h=a[a.length-1],_=f,O=!0;break}if(!O)return[]}return a}(s,l,i,o,r);if(0===d.length)return[];const f=d[d.length-1];let g=G(f,a,D,i,o,r);if(0===g.length){const O=i.getDemon(a),ne=i.getResultDemonLvls(O.race).map(J=>i.reverseLookupDemon(O.race,J)).filter(J=>J!==a);for(const J of o.elementDemons.concat(ne)){if((D&i.getDemon(J).inherits)!==D)continue;const C=G(f,J,D,i,o,r),Q=G(J,a,D,i,o,r);if(0!==C.length&&0!==Q.length){g=C.concat(Q.slice(1));break}}}if(0===g.length)return[];h=d.concat(g.slice(1),h.slice(1))}return h}function G(s,l,n,i,o,r){const{fissionCalculator:a,fusionCalculator:h}=r,_=[s];if(s===l)return _;const D=h.getFusions(s,i,o).map(g=>(0,t.D0)(g,i)).sort((g,O)=>g.price-O.price);for(const g of D)if(g.name2===l)return _.push(g.name1),_.push(l),_;const d=a.getFusions(l,i,o).map(g=>(0,t.S6)(g,i)).sort((g,O)=>g.price-O.price);D.sort((g,O)=>O.price-g.price);const f=D.reduce((g,O)=>(g[O.name2]=O.name1,g),{});for(const g of d){if(f[g.name1]&&(n&i.getDemon(g.name1).inherits)===n)return _.push(f[g.name1]),_.push(g.name1),_.push(g.name2),_.push(l),_;if(f[g.name2]&&(n&i.getDemon(g.name2).inherits)===n)return _.push(f[g.name2]),_.push(g.name2),_.push(g.name1),_.push(l),_}return[]}var e=S(4769),b=S(95),q=S(6814);function T(s,l){if(1&s&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function x(s,l){if(1&s&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("ngValue",n),e.xp6(1),e.Oqu(n.name)}}function k(s,l){if(1&s&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function w(s,l){if(1&s&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("ngValue",n),e.xp6(1),e.Oqu(n.name)}}function c(s,l){if(1&s&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function I(s,l){if(1&s&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("ngValue",n),e.xp6(1),e.Oqu(n.name)}}function u(s,l){if(1&s&&(e.TgZ(0,"select",25),e.YNc(1,I,2,2,"option",8),e.qZA()),2&s){const n=e.oxw(2).$implicit,i=e.oxw();e.xp6(1),e.Q6J("ngForOf",i.learnedBy[n.controls.skill.value.name])}}function M(s,l){if(1&s&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("ngValue",n),e.xp6(1),e.Oqu(n.name)}}function E(s,l){if(1&s&&(e.TgZ(0,"select",25),e.YNc(1,M,2,2,"option",8),e.qZA()),2&s){const n=e.oxw(2).$implicit,i=e.oxw();e.xp6(1),e.Q6J("ngForOf",i.demons[n.controls.race.value])}}function ee(s,l){if(1&s){const n=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"label"),e._uU(3),e.TgZ(4,"input",20),e.NdJ("change",function(){e.CHM(n);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.setIngredDemon(o))}),e.qZA()()(),e.TgZ(5,"td")(6,"select",21),e.NdJ("change",function(){e.CHM(n);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.setIngredElem(o))}),e.TgZ(7,"option",22),e._uU(8,"-"),e.qZA(),e.YNc(9,k,2,2,"option",6),e.qZA()(),e.TgZ(10,"td")(11,"select",23),e.NdJ("change",function(){e.CHM(n);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.setIngredDemon(o))}),e.YNc(12,w,2,2,"option",8),e.qZA()(),e.TgZ(13,"td")(14,"select",5),e.NdJ("change",function(){e.CHM(n);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.setIngredDemon(o))}),e.TgZ(15,"option",22),e._uU(16,"-"),e.qZA(),e.YNc(17,c,2,2,"option",6),e.qZA()(),e.TgZ(18,"td"),e.YNc(19,u,2,1,"select",24),e.YNc(20,E,2,1,"select",24),e.qZA()()}if(2&s){const n=e.oxw(),i=n.index,o=n.$implicit,r=e.oxw();e.xp6(3),e.hij("",r.langEn?"Learns skill #"+(i+1):"\u30b9\u30ad\u30eb\u691c\u7d22"," "),e.xp6(3),e.uIk("disabled",!o.controls.searchSkill.value||null),e.xp6(3),e.Q6J("ngForOf",r.elems),e.xp6(2),e.uIk("disabled",!o.controls.searchSkill.value||null),e.xp6(1),e.Q6J("ngForOf",r.skills[o.controls.elem.value]),e.xp6(2),e.uIk("disabled",o.controls.searchSkill.value||null),e.xp6(3),e.Q6J("ngForOf",r.races),e.xp6(2),e.Q6J("ngIf",o.controls.searchSkill.value),e.xp6(1),e.Q6J("ngIf",!o.controls.searchSkill.value)}}function ce(s,l){if(1&s&&(e.ynx(0,18),e.YNc(1,ee,21,9,"tr",19),e.BQk()),2&s){const n=l.index,i=e.oxw();e.Q6J("formGroupName",n),e.xp6(1),e.Q6J("ngIf",n<i.maxSkills)}}function te(s,l){if(1&s&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.xp6(1),e.Oqu(n)}}function Z(s,l){if(1&s&&(e.TgZ(0,"td",29)(1,"ul"),e.YNc(2,te,2,1,"li",30),e.qZA()()),2&s){const n=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",n.recipeLeft)}}function A(s,l){if(1&s&&(e.TgZ(0,"td",31),e._uU(1),e.qZA()),2&s){const n=e.oxw(2);e.xp6(1),e.Oqu(n.langEn?"No chains found":"\u5408\u4f53\u306a\u3057")}}function v(s,l){if(1&s&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.xp6(1),e.Oqu(n)}}function y(s,l){if(1&s&&(e.TgZ(0,"td",29)(1,"ul"),e.YNc(2,v,2,1,"li",30),e.qZA()()),2&s){const n=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",n.recipeRight)}}function V(s,l){if(1&s&&(e.TgZ(0,"td",31),e._uU(1),e.qZA()),2&s){const n=e.oxw(2);e.xp6(1),e.Oqu(n.langEn?"No chains found":"\u5408\u4f53\u306a\u3057")}}function he(s,l){if(1&s&&(e.ynx(0),e._uU(1),e._UZ(2,"br"),e._uU(3),e.BQk()),2&s){const n=e.oxw(2);e.xp6(1),e.AsE(" ",n.recipeResult.join(" x ")," = ",n.recipe.result,""),e.xp6(2),e.hij(" [",n.resultSkills.join(", "),"] ")}}function R(s,l){if(1&s&&(e.ynx(0),e._uU(1),e.BQk()),2&s){const n=e.oxw(2);e.xp6(1),e.Oqu(n.langEn?"No recipes found":"\u5408\u4f53\u306a\u3057")}}function N(s,l){if(1&s&&(e.TgZ(0,"table",1)(1,"tr")(2,"th",2),e._uU(3),e.qZA()(),e.TgZ(4,"tr")(5,"th"),e._uU(6),e.qZA(),e.TgZ(7,"th"),e._uU(8),e.qZA()(),e.TgZ(9,"tr"),e.YNc(10,Z,3,1,"td",26),e.YNc(11,A,2,1,"td",27),e.YNc(12,y,3,1,"td",26),e.YNc(13,V,2,1,"td",27),e.qZA(),e.TgZ(14,"tr")(15,"td",28),e.YNc(16,he,4,3,"ng-container",19),e.YNc(17,R,2,1,"ng-container",19),e.qZA()()()),2&s){const n=e.oxw();e.xp6(3),e.Oqu(n.langEn?"Fusion Recipe":"\u5408\u4f53\u30ec\u30b7\u30d4"),e.xp6(3),e.Oqu(n.langEn?"Left Chain":"\u5de6\u30ec\u30b7\u30d4"),e.xp6(2),e.Oqu(n.langEn?"Right Chain":"\u53f3\u30ec\u30b7\u30d4"),e.xp6(2),e.Q6J("ngIf",n.recipeLeft.length),e.xp6(1),e.Q6J("ngIf",!n.recipeLeft.length),e.xp6(1),e.Q6J("ngIf",n.recipeRight.length),e.xp6(1),e.Q6J("ngIf",!n.recipeRight.length),e.xp6(3),e.Q6J("ngIf",n.recipe.stepR.length),e.xp6(1),e.Q6J("ngIf",!n.recipe.stepR.length)}}let U=(()=>{class s{constructor(n){this.fb=n,this.maxSkills=8,this.langEn=!0,this.internalMaxSkills=9,this.range99=Array(99),this.demons={},this.skills={},this.learnedBy={},this.blankDemon={name:"-",race:"-",lvl:0,currLvl:0,price:0,inherits:0,skills:{},stats:[],resists:[],affinities:[],fusion:"normal",prereq:""},this.blankSkill={name:"-",element:"-",rank:99,cost:0,effect:"",target:"",level:0,learnedBy:[{demon:"-",level:0}]},this.createForm()}ngOnChanges(){this.initDropdowns()}createForm(){const n=[];for(let i=0;i<this.internalMaxSkills;i++)n.push(this.fb.group({searchSkill:!0,elem:"-",skill:this.blankSkill,race:"-",demon:this.blankDemon}));this.form=this.fb.group({race:"-",demon:this.blankDemon,ingreds:this.fb.array(n)}),this.form.valueChanges.subscribe(i=>{if(this.form.valid){const o=i.ingreds.filter(a=>"-"!==a.demon.name&&a.demon.name!==i.demon.name).map(a=>a.demon.name),r={};for(const a of i.ingreds)a.searchSkill&&"-"!==a.skill.name&&(r[a.skill.name]=a.demon.name);this.updateRecipe(function $(s,l,n,i,o,r){const{fissionCalculator:a,inheritElems:h,restrictInherits:_,triExclusiveRaces:D,triFissionCalculator:d}=r,{normalChart:f}=o,g=i.getDemon(s),O={};for(const[p,m]of Object.entries(n))"-"!==m&&m!==g.name&&(O[p]=m);const J=L(Object.keys(n).map(p=>i.getSkill(p)).map(p=>p.element),h);let C=i.getSpecialNameEntries(s);if(C.length<2&&D.includes(g.race)){const p=d.getFusions(s,i,o).map(m=>(0,t.Aw)(m,i)).sort((m,F)=>m.price-F.price).find(m=>!((J&(m.d1.inherits|m.d2.inherits))!==J||"special"!==m.d1.fusion&&D.includes(m.d1.race)||"special"!==m.d2.fusion&&D.includes(m.d2.race)||"special"!==m.d3.fusion&&D.includes(m.d3.race)));p&&(C=[p.d1.name,p.d2.name,p.d3.name])}if(C.length<2){const p=a.getFusions(s,i,f).map(m=>(0,t.S6)(m,i)).sort((m,F)=>m.price-F.price).find(m=>!((J&(i.getDemon(m.name1).inherits|i.getDemon(m.name2).inherits))!==J||"normal"!==i.getDemon(m.name1).fusion&&"special"!==i.getDemon(m.name1).fusion||"normal"!==i.getDemon(m.name2).fusion&&"special"!==i.getDemon(m.name2).fusion));p&&(C=[p.name1,p.name2])}const Q=C.map(p=>i.getDemon(p)).sort((p,m)=>m.price-p.price),ue=Object.keys(O).map(p=>i.getSkill(p)),ie=L(ue.map(p=>p.element),h),_e=ue.map(p=>L([p.element],h));let se,me,ge=0;for(let p=0;p<Q.length;p++){const m=Q[p];for(const F of Q.slice(p+1))if((ie&(m.inherits|F.inherits))===ie){const fe=(ie&m.inherits).toString(2).split("1").length*(ie&F.inherits).toString(2).split("1").length;ge<fe&&(se=m,me=F,ge=fe)}}const oe={chain1:[],chain2:[],stepR:C,skills:O,result:s};if(!se)return oe;const W=Object.values(O).filter((p,m,F)=>F.indexOf(p)===m),re=l.filter(p=>!W.includes(p));let Y=Math.ceil(W.length/2);W.sort((p,m)=>f.getLightDark(i.getDemon(p).race)-f.getLightDark(i.getDemon(m).race));let X=W.slice(0,Y),le=Array(X.length).fill(0),z=W.slice(Y),ae=Array(z.length).fill(0);if(_){const{left:p,right:m}=function K(s,l,n,i){let o=[],r=[];const a=[],h=[],_={},D=[];for(let d=0;d<n.length;d++){const f=n[d];0!==f?(_.hasOwnProperty(f)||(_[f]=[]),_[f].push(i[d])):D.push(i[d])}for(const d of Object.keys(_).sort()){const f=parseInt(d);a.length<=h.length?(f&s)===f?a.push(f):h.push(f):(f&l)===f?h.push(f):a.push(f)}for(const d of a)o=o.concat(_[d]);for(const d of h)r=r.concat(_[d]);for(const d of D)o.length<r.length?o.push(d):r.push(d);return{left:o.reverse(),right:r.reverse()}}(se.inherits,me.inherits,_e,ue.map(F=>F.name));X=p.map(F=>O[F]),le=B(p.map(F=>i.getSkill(F).element),h),z=m.map(F=>O[F]),ae=B(m.map(F=>i.getSkill(F).element),h)}return Y=Math.ceil(re.length/2),X=re.slice(0,Y).concat(X),le=Array(Y).fill(0).concat(le),z=re.slice(Y).concat(z),ae=Array(re.length-Y).fill(0).concat(ae),oe.chain1=P(X,le,se.name,i,f,r),oe.chain2=P(z,ae,me.name,i,f,r),oe}(i.demon.name,o,r,this.compendium,this.squareChart,this.recipeConfig))}})}setIngredElem(n){n.controls.skill.setValue(this.skills[n.controls.elem.value][0]),this.setIngredDemon(n)}setIngredDemon(n){n.controls.demon.setValue((n.controls.searchSkill.value?this.learnedBy[n.controls.skill.value.name]:this.demons[n.controls.race.value])[0])}updateRecipe(n){const i={};for(const[o,r]of Object.entries(n.skills)){i[r]||(i[r]=[]);const a=this.compendium.getDemon(r).skills[o];i[r].push(o+(a>=2?` (${a})`:""))}this.recipe=n,this.recipeLeft=this.decodeRecipechain(n.chain1,i),this.recipeRight=this.decodeRecipechain(n.chain2,i),this.resultSkills=[],this.recipeResult=[];for(const o of n.stepR)this.recipeResult.push(i[o]?`${o} [${i[o].join(", ")}]`:o);for(const[o,r]of Object.entries(this.compendium.getDemon(n.result).skills).filter(a=>a[1]<2e3).sort((a,h)=>a[1]-h[1]))this.resultSkills.push(o+(r>=2?` (${r})`:""))}decodeRecipechain(n,i){const o=[];for(let r=0;r<n.length-2;r+=2){const a=i[n[r]]?"["+i[n[r]].join(", ")+"] ":"",h=i[n[r+1]]?"["+i[n[r+1]].join(", ")+"] ":"";o.push(`${n[r]} ${a}x ${n[r+1]} ${h}= ${n[r+2]}`)}return o}initDropdowns(){if(this.recipeConfig&&this.compendium&&this.squareChart){this.demons={"-":[this.blankDemon]},this.skills={"-":[this.blankSkill]},this.learnedBy={"-":[this.blankDemon]};for(const n of this.compendium.allDemons)if(!n.isEnemy&&"party"!==n.fusion&&"enemy"!==n.fusion){this.demons[n.race]||(this.demons[n.race]=[]),this.demons[n.race].push(n);for(const i of Object.keys(n.skills))this.learnedBy[i]||(this.learnedBy[i]=[]),this.learnedBy[i].push(n)}for(const n of this.compendium.allSkills.filter(i=>i.rank<50&&i.learnedBy.length>0))this.skills[n.element]||(this.skills[n.element]=[]),this.skills[n.element].push(n);for(const n of Object.values(this.demons))n.sort((i,o)=>i.lvl-o.lvl);for(const n of Object.values(this.learnedBy))n.sort((i,o)=>i.lvl-o.lvl);for(const n of Object.values(this.skills))n.sort((i,o)=>i.rank-o.rank);this.races=this.recipeConfig.races.filter(n=>this.demons[n]),this.elems=this.recipeConfig.skillElems.filter(n=>this.skills[n]),this.setDemon(this.compendium.getDemon(this.recipeConfig.defaultDemon))}}setDemon(n){const i=[],{inheritElems:o}=this.recipeConfig,r=Object.entries(n.skills).slice(0,this.internalMaxSkills).filter(h=>h[1]<2).map(h=>this.compendium.getSkill(h[0])),a=Object.entries(n.skills).slice(0,this.internalMaxSkills).filter(h=>h[1]<100).map(h=>this.compendium.getSkill(h[0]));for(let h=0;h<o.length;h++)n.inherits&1<<h||i.push(o[o.length-h-1]);this.skills[this.blankSkill.element]=[this.blankSkill].concat(a),this.elems=this.recipeConfig.skillElems.filter(h=>this.skills[h]&&!i.includes(h)),this.form.patchValue({race:n.race,demon:n,ingreds:r.concat(Array(this.internalMaxSkills-r.length).fill(this.blankSkill)).map(h=>({searchSkill:!0,elem:"-",skill:h,race:"-",demon:"-"!==h.name?n:this.blankDemon}))})}static#e=this.\u0275fac=function(i){return new(i||s)(e.Y36(b.qu))};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["app-recipe-generator"]],inputs:{maxSkills:"maxSkills",compendium:"compendium",squareChart:"squareChart",recipeConfig:"recipeConfig",langEn:"langEn"},features:[e.TTD],decls:36,vars:15,consts:[[3,"formGroup"],[1,"entry-table"],["colspan","2",1,"title"],[2,"width","40%"],[2,"width","60%"],["formControlName","race",3,"change"],[3,"value",4,"ngFor","ngForOf"],["formControlName","demon",3,"change"],[3,"ngValue",4,"ngFor","ngForOf"],["formArrayName","ingreds",1,"entry-table"],["colspan","5",1,"title"],[2,"width","20%"],[2,"width","10%"],[2,"width","25%"],[3,"formGroupName",4,"ngFor","ngForOf"],["class","entry-table",4,"ngIf"],[3,"value"],[3,"ngValue"],[3,"formGroupName"],[4,"ngIf"],["formControlName","searchSkill","type","checkbox",3,"change"],["formControlName","elem",3,"change"],["value","-"],["formControlName","skill",3,"change"],["formControlName","demon",4,"ngIf"],["formControlName","demon"],["style","width: 50%",4,"ngIf"],["style","width: 50%","style","padding: 1em; text-align: center;",4,"ngIf"],["colspan","2",2,"padding","1em","text-align","center"],[2,"width","50%"],[4,"ngFor","ngForOf"],[2,"padding","1em","text-align","center"]],template:function(i,o){1&i&&(e.TgZ(0,"form",0)(1,"h2"),e._uU(2),e.qZA(),e.TgZ(3,"table",1)(4,"tr")(5,"th",2),e._uU(6),e.qZA()(),e.TgZ(7,"tr")(8,"th",3),e._uU(9),e.qZA(),e.TgZ(10,"th",4),e._uU(11),e.qZA()(),e.TgZ(12,"tr")(13,"td")(14,"select",5),e.NdJ("change",function(){return o.setDemon(o.demons[o.form.controls.race.value][0])}),e.YNc(15,T,2,2,"option",6),e.qZA()(),e.TgZ(16,"td")(17,"select",7),e.NdJ("change",function(){return o.setDemon(o.form.controls.demon.value)}),e.YNc(18,x,2,2,"option",8),e.qZA()()()(),e.TgZ(19,"table",9)(20,"tr")(21,"th",10),e._uU(22),e.qZA()(),e.TgZ(23,"tr")(24,"th",11),e._uU(25),e.qZA(),e.TgZ(26,"th",12),e._uU(27),e.qZA(),e.TgZ(28,"th",13),e._uU(29),e.qZA(),e.TgZ(30,"th",11),e._uU(31),e.qZA(),e.TgZ(32,"th",13),e._uU(33),e.qZA()(),e.YNc(34,ce,2,2,"ng-container",14),e.qZA(),e.YNc(35,N,18,9,"table",15),e.qZA()),2&i&&(e.Q6J("formGroup",o.form),e.xp6(2),e.Oqu(o.langEn?"Recipe Generator":"\u5408\u4f53\u30ec\u30b7\u30d4"),e.xp6(4),e.Oqu(o.langEn?"Target":"\u60aa\u9b54"),e.xp6(3),e.Oqu(o.langEn?"Race":"\u7a2e\u65cf"),e.xp6(2),e.Oqu(o.langEn?"Name":"\u60aa\u9b54\u540d"),e.xp6(4),e.Q6J("ngForOf",o.races),e.xp6(3),e.Q6J("ngForOf",o.demons[o.form.controls.race.value]),e.xp6(4),e.Oqu(o.langEn?"Include Ingredients":"\u7d20\u6750\u60aa\u9b54"),e.xp6(3),e.Oqu(o.langEn?"Filter By":"\u30b9\u30ad\u30eb\u691c\u7d22"),e.xp6(2),e.Oqu(o.langEn?"Elem":"\u5c5e\u6027"),e.xp6(2),e.Oqu(o.langEn?"Skill":"\u30b9\u30ad\u30eb\u540d"),e.xp6(2),e.Oqu(o.langEn?"Race":"\u7a2e\u65cf"),e.xp6(2),e.Oqu(o.langEn?"Ingredient":"\u60aa\u9b54\u540d"),e.xp6(1),e.Q6J("ngForOf",o.form.controls.ingreds.controls),e.xp6(1),e.Q6J("ngIf",o.recipe))},dependencies:[q.sg,q.O5,b._Y,b.YN,b.Kr,b.Wl,b.EJ,b.JJ,b.JL,b.sg,b.u,b.x0,b.CE],styles:["ul[_ngcontent-%COMP%]{padding:0 1em;list-style:none}td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-height:25px;width:100%}"],changeDetection:0})}return s})()}}]);