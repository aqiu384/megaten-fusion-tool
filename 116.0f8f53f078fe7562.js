"use strict";(self.webpackChunkmegaten_fusion_tool=self.webpackChunkmegaten_fusion_tool||[]).push([[116],{9012:(fe,V,F)=>{F.d(V,{N:()=>U});var t=F(4769),j=F(6814),G=F(2173);function M(u,k){if(1&u&&(t.TgZ(0,"th",4),t._uU(1,"Inheritable Skills"),t.qZA()),2&u){const p=t.oxw();t.uIk("colspan",p.inheritHeaders.length)}}function w(u,k){if(1&u&&(t.TgZ(0,"th",4),t._uU(1),t.qZA()),2&u){const p=t.oxw();t.uIk("colspan",p.inheritHeaders.length),t.xp6(1),t.hij(" ",p.langEn?"Skill Affinities":"\u30b9\u30ad\u30eb\u9069\u6b63"," ")}}function K(u,k){if(1&u&&(t.ynx(0),t._uU(1),t.BQk()),2&u){const p=t.oxw().$implicit;t.xp6(1),t.Oqu(p)}}function Y(u,k){if(1&u&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&u){const p=t.oxw().$implicit;t.Gre("element-icon ",p,""),t.xp6(1),t.Oqu(p)}}function W(u,k){if(1&u&&(t.TgZ(0,"th"),t.YNc(1,K,2,1,"ng-container",3),t.YNc(2,Y,2,4,"div",5),t.qZA()),2&u){const p=t.oxw();t.Udp("width",100/p.inheritHeaders.length,"%"),t.xp6(1),t.Q6J("ngIf",!p.hasIcons),t.xp6(1),t.Q6J("ngIf",p.hasIcons)}}function e(u,k){if(1&u&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&u){const p=k.$implicit;t.Udp("color",p?null:"transparent"),t.xp6(1),t.hij(" ",p?"yes":"no"," ")}}function v(u,k){if(1&u&&(t.TgZ(0,"tr"),t.YNc(1,e,2,3,"td",6),t.qZA()),2&u){const p=t.oxw();t.xp6(1),t.Q6J("ngForOf",p.inherits)}}function B(u,k){if(1&u&&(t.TgZ(0,"td"),t.ALo(1,"roundInheritPercent"),t._uU(2),t.qZA()),2&u){const p=k.$implicit;t.Gre("affinity",t.lcZ(1,4,100*p),""),t.xp6(2),t.hij(" ",100*p,"% ")}}function I(u,k){if(1&u&&(t.TgZ(0,"tr"),t.YNc(1,B,3,6,"td",7),t.qZA()),2&u){const p=t.oxw();t.xp6(1),t.Q6J("ngForOf",p.inherits)}}function C(u,k){if(1&u&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"affinityToString"),t.qZA()),2&u){const p=k.$implicit;t.Gre("affinity",p,""),t.xp6(1),t.hij(" ",t.lcZ(2,4,p)," ")}}function _(u,k){if(1&u&&(t.TgZ(0,"tr"),t.YNc(1,C,3,6,"td",7),t.qZA()),2&u){const p=t.oxw();t.xp6(1),t.Q6J("ngForOf",p.inherits)}}let U=(()=>{var u;class k{constructor(){this.inheritHeaders=[],this.inherits=[],this.hasChance=!1,this.hasIcons=!0,this.hasLvls=!1,this.langEn=!0}}return(u=k).\u0275fac=function(N){return new(N||u)},u.\u0275cmp=t.Xpm({type:u,selectors:[["app-demon-inherits"]],inputs:{inheritHeaders:"inheritHeaders",inherits:"inherits",hasChance:"hasChance",hasIcons:"hasIcons",hasLvls:"hasLvls",langEn:"langEn"},decls:11,vars:6,consts:[[1,"entry-table"],["class","title",4,"ngIf"],[3,"width",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"title"],[3,"class",4,"ngIf"],[3,"color",4,"ngFor","ngForOf"],[3,"class",4,"ngFor","ngForOf"]],template:function(N,J){1&N&&(t.TgZ(0,"table",0)(1,"thead")(2,"tr"),t.YNc(3,M,2,1,"th",1),t.YNc(4,w,2,2,"th",1),t.qZA(),t.TgZ(5,"tr"),t.YNc(6,W,3,4,"th",2),t.qZA()(),t.TgZ(7,"tbody"),t.YNc(8,v,2,1,"tr",3),t.YNc(9,I,2,1,"tr",3),t.YNc(10,_,2,1,"tr",3),t.qZA()()),2&N&&(t.xp6(3),t.Q6J("ngIf",!J.hasLvls),t.xp6(1),t.Q6J("ngIf",J.hasLvls&&J.inheritHeaders.length),t.xp6(2),t.Q6J("ngForOf",J.inheritHeaders),t.xp6(2),t.Q6J("ngIf",!J.hasLvls&&!J.hasChance),t.xp6(1),t.Q6J("ngIf",J.hasChance),t.xp6(1),t.Q6J("ngIf",J.hasLvls))},dependencies:[j.sg,j.O5,G.JZ,G.DY],encapsulation:2,changeDetection:0}),k})()},8615:(fe,V,F)=>{F.d(V,{R:()=>B});var w,t=F(4769),j=F(6593),G=F(4487),M=F(6814);function K(I,C){if(1&I&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&I){const _=C.$implicit,U=t.oxw();t.xp6(1),t.Oqu(_.slice(0,U.nameCut))}}function Y(I,C){if(1&I&&(t.TgZ(0,"td",4),t._uU(1),t.qZA()),2&I){const _=C.$implicit,U=t.oxw(2);t.Q6J("ngClass",_.slice(0,4)),t.xp6(1),t.Oqu(_.slice(4,U.nameCut+4))}}function W(I,C){if(1&I&&(t.TgZ(0,"tr")(1,"th"),t._uU(2),t.qZA(),t.YNc(3,Y,2,2,"td",3),t.TgZ(4,"th"),t._uU(5),t.qZA()()),2&I){const _=C.$implicit;t.xp6(2),t.Oqu(_[0]),t.xp6(1),t.Q6J("ngForOf",_.slice(1,_.length-1)),t.xp6(2),t.Oqu(_[_.length-1])}}function e(I,C){if(1&I&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&I){const _=C.$implicit,U=t.oxw();t.xp6(1),t.Oqu(_.slice(0,U.nameCut))}}function v(I,C){if(1&I&&(t.TgZ(0,"tr")(1,"th",0),t._uU(2),t.qZA()()),2&I){const _=t.oxw();t.xp6(1),t.uIk("colspan",_.table[0].length),t.xp6(1),t.AsE("",_.appName," ",_.tripTitle,"")}}class B{constructor(C,_){this.title2=C,this.route=_,this.normTitle="Normal Fusions",this.tripTitle="",this.isPersona=!1,this.filterDarks=!0,this.langEn=!0,this.subscriptions=[],this.table=[],this.nameCut=4}ngOnInit(){this.subscriptions.push(this.route.parent.data.subscribe(C=>{this.appName=C.appName||"Shin Megami Tensei",this.nameCut=this.langEn?4:2,this.title2.setTitle(this.langEn?`Fusion Chart - ${this.appName} Fusion Calculator`:`\u5408\u4f53\u8868 ${this.appName} \u5408\u4f53\u30a2\u30d7\u30ea`)}))}ngOnChanges(){this.normChart&&this.fillFusionChart()}ngOnDestroy(){for(const C of this.subscriptions)C.unsubscribe()}fillFusionChart(){const C="noneNone",U=B.RESULT_COLORS.reduce((T,[A,S])=>S.reduce((y,X)=>(y[X]=A,y),T),{}),u=this.normChart.elementDemons;let k=[],p=this.normChart.races,N=[];this.filterDarks&&(k=this.normChart.races.filter(T=>this.normChart.getLightDark(T)>0),p=this.normChart.races.filter(T=>0===this.normChart.getLightDark(T)),N=this.normChart.races.filter(T=>-1===this.normChart.getLightDark(T)),0===N.length&&k.length>0&&(k=this.normChart.races.filter(T=>this.normChart.getLightDark(T)>-1),p=[],N=this.normChart.races.filter(T=>this.normChart.getLightDark(T)<-1)));const J=k.length-N.length,Q=k.concat(p,u),ne=N.length?N.concat(Array(Q.length-N.length).fill("")):Q,he=this.mitaTable?Q:k.concat(p,Array(u.length).fill("")),ie=this.mitaTable||N.length?Array(J).fill("").concat(N,p,u):Q;this.table=[[""].concat(Q,[""])];for(let T=0;T<ie.length;T++){const A=Array(Q.length+2).fill("empt-"),S=ie[T],y=he[T],X=-1!==u.indexOf(S),ue=-1!==u.indexOf(y);this.table.push(A),A[0]=S,A[A.length-1]=y;for(let E=T;E<Q.length;E++){const q=Q[E],i=-1!==u.indexOf(q);if(i&&ue){const r=u.indexOf(y),s=u.indexOf(q),n=this.mitaTable[r][s-r-1];A[E+1]=n?(U[n]||"norm")+n:C}else if(i&&y){const r=this.normChart.getElemFusions(q)[y];A[E+1]=r?(U[r]||"rank")+(r>0?"+":"")+r.toString():C}else if(q&&y){const r=this.isPersona&&q===y?q:this.normChart.getRaceFusion(q,y);A[E+1]=r?(U[r]||(q===y?"elem":"norm"))+r:C}}if(this.tripChart)for(let E=0;E<=T-J;E++){const q=ne[E];if(q&&X){const i=this.tripChart.getElemFusions(S)[q];A[E+1]=i?(U[i]||"rank")+(i>0?"+":"")+i.toString():C}else if(q&&S){const i=this.tripChart.getRaceFusion(q,S);A[E+1]=i?(U[i]||(q===S?"elem":"trip"))+i:C}}if(-1!==S.indexOf(" x ")){const[E,q]=S.split(" x "),i=E.slice(0,3)+"x"+q.slice(0,3);A[0]=i,A[A.length-1]=i}else if(-1!==S.indexOf(" ")){const E=S.split(" ")[0];A[0]=E,A[A.length-1]=E}}for(let T=0;T<this.table[0].length;T++){const A=this.table[0][T];if(-1!==A.indexOf(" x ")){const[S,y]=A.split(" x ");this.table[0][T]=S.slice(0,2)+y.slice(0,2)}}this.table.push([""].concat(ne,[""]))}}(w=B).RESULT_COLORS=Object.entries({oran:["-2","Erthys","Gnome","Saki","Saki Mitama","Random","\u30a2\u30fc\u30b7\u30fc\u30ba","\u30ce\u30fc\u30e0","\u30b5\u30ad\u30df\u30bf\u30de"],redd:["-1","Flaemis","Salamander","Ara ","Ara Mitama","Fiend","\u30d5\u30ec\u30a4\u30df\u30fc\u30ba","\u30b5\u30e9\u30de\u30f3\u30c0\u30fc","\u30a2\u30e9\u30df\u30bf\u30de"],gree:["1","Aeros","Sylph","Kusi","Kusi Mitama","UMA","\u30a8\u30a2\u30ed\u30b9","\u30b7\u30eb\u30ad\u30fc","\u30af\u30b7\u30df\u30bf\u30de"],blue:["2","Aquans","Undine","Nigi","Nigi Mitama","Enigma","\u30a2\u30af\u30a2\u30f3\u30ba","\u30a6\u30f3\u30c7\u30a3\u30fc\u30cd","\u30cb\u30ae\u30df\u30bf\u30de"]}),w.\u0275fac=function(C){return new(C||w)(t.Y36(j.Dx),t.Y36(G.gz))},w.\u0275cmp=t.Xpm({type:w,selectors:[["app-fusion-chart"]],inputs:{normChart:"normChart",tripChart:"tripChart",mitaTable:"mitaTable",normTitle:"normTitle",tripTitle:"tripTitle",isPersona:"isPersona",filterDarks:"filterDarks",langEn:"langEn",counter:"counter"},features:[t.TTD],decls:12,vars:7,consts:[[1,"title"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(C,_){1&C&&(t.TgZ(0,"table")(1,"tbody")(2,"tr")(3,"th",0),t._uU(4),t.qZA()(),t.TgZ(5,"tr"),t.YNc(6,K,2,1,"th",1),t.qZA(),t.YNc(7,W,6,3,"tr",1),t.TgZ(8,"tr"),t.YNc(9,e,2,1,"th",1),t.qZA(),t.YNc(10,v,3,3,"tr",2),t.qZA(),t._UZ(11,"tbody"),t.qZA()),2&C&&(t.xp6(3),t.uIk("colspan",_.table[0].length),t.xp6(1),t.AsE("",_.appName," ",_.normTitle,""),t.xp6(2),t.Q6J("ngForOf",_.table[0]),t.xp6(1),t.Q6J("ngForOf",_.table.slice(1,_.table.length-1)),t.xp6(2),t.Q6J("ngForOf",_.table[_.table.length-1]),t.xp6(1),t.Q6J("ngIf",_.tripTitle))},dependencies:[M.mk,M.sg,M.O5],styles:["table[_ngcontent-%COMP%]{width:auto;margin:0 auto;white-space:nowrap}td.elem[_ngcontent-%COMP%]{color:#0f0}td.trip[_ngcontent-%COMP%]{color:#d3d3d3}td.oran[_ngcontent-%COMP%]{color:orange}td.redd[_ngcontent-%COMP%]{color:red}td.gree[_ngcontent-%COMP%]{color:#0f0}td.blue[_ngcontent-%COMP%]{color:#0ff}td.none[_ngcontent-%COMP%]{color:transparent}td.empt[_ngcontent-%COMP%]{background-color:transparent;color:transparent}"],changeDetection:0})},4436:(fe,V,F)=>{F.d(V,{X:()=>q});var t=F(6404);function G(i,r){return parseInt(r.map(s=>i.includes(s)?"1":"0").join(""),2)||0}function M(i,r){return i.map((s,n,o)=>G(o.slice(0,n+1),r))}function K(i,r,s,n,o,l){let a=s,c=[a];const f=n.getSpecialNameEntries(a),O=r[r.length-1];if(0!==f.length&&(a=f.find(x=>0===n.getSpecialNameEntries(x).length),c.unshift(f.filter(x=>x!==a).join(" x ")),c.unshift(a)),i.length>0){const x=function W(i,r,s,n,o){const{fusionCalculator:l}=o,a=i.slice(0,1);if(i.length<2)return a;let c=a[0],f=r[0];for(let O=1;O<i.length;O++){const x=i[O],d=r[O],g=l.getFusions(c,s,n).map(Z=>(0,t.D0)(Z,s)).sort((Z,L)=>Z.price-L.price);let b=!1;for(const Z of g)if(Z.name1===x&&(d&s.getDemon(Z.name2).inherits)===d){a.push(x),a.push(Z.name2),c=a[a.length-1],f=d,b=!0;break}if(b)continue;const R=l.getFusions(x,s,n).reduce((Z,L)=>(Z[L.name1]=L.name2,Z),{});for(const Z of g)if(R[Z.name2]&&(f&s.getDemon(Z.name2).inherits)===f&&(d&s.getDemon(R[Z.name2]).inherits)===d){a.push(Z.name1),a.push(Z.name2),a.push(x),a.push(R[Z.name2]),c=a[a.length-1],f=d,b=!0;break}if(!b)return[]}return a}(i,r,n,o,l);if(0===x.length)return[];const d=x[x.length-1];let g=Y(d,a,O,n,o,l);if(0===g.length){const b=n.getDemon(a),P=n.getResultDemonLvls(b.race).map(R=>n.reverseLookupDemon(b.race,R)).filter(R=>R!==a);for(const R of o.elementDemons.concat(P)){if((O&n.getDemon(R).inherits)!==O)continue;const Z=Y(d,R,O,n,o,l),L=Y(R,a,O,n,o,l);if(0!==Z.length&&0!==L.length){g=Z.concat(L.slice(1));break}}}if(0===g.length)return[];c=x.concat(g.slice(1),c.slice(1))}return c}function Y(i,r,s,n,o,l){const{fissionCalculator:a,fusionCalculator:c}=l,f=[i];if(i===r)return f;const O=c.getFusions(i,n,o).map(g=>(0,t.D0)(g,n)).sort((g,b)=>g.price-b.price);for(const g of O)if(g.name2===r)return f.push(g.name1),f.push(r),f;const x=a.getFusions(r,n,o).map(g=>(0,t.S6)(g,n)).sort((g,b)=>g.price-b.price);O.sort((g,b)=>b.price-g.price);const d=O.reduce((g,b)=>(g[b.name2]=b.name1,g),{});for(const g of x){if(d[g.name1]&&(s&n.getDemon(g.name1).inherits)===s)return f.push(d[g.name1]),f.push(g.name1),f.push(g.name2),f.push(r),f;if(d[g.name2]&&(s&n.getDemon(g.name2).inherits)===s)return f.push(d[g.name2]),f.push(g.name2),f.push(g.name1),f.push(r),f}return[]}var e=F(4769),v=F(95),B=F(6814);function I(i,r){if(1&i&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&i){const s=r.$implicit;e.Q6J("value",s),e.xp6(1),e.Oqu(s)}}function C(i,r){if(1&i&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&i){const s=r.$implicit;e.Q6J("ngValue",s),e.xp6(1),e.Oqu(s.name)}}function _(i,r){if(1&i&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&i){const s=r.$implicit;e.Q6J("value",s),e.xp6(1),e.Oqu(s)}}function U(i,r){if(1&i&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&i){const s=r.$implicit;e.Q6J("ngValue",s),e.xp6(1),e.Oqu(s.name)}}function u(i,r){if(1&i&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&i){const s=r.$implicit;e.Q6J("value",s),e.xp6(1),e.Oqu(s)}}function k(i,r){if(1&i&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&i){const s=r.$implicit;e.Q6J("ngValue",s),e.xp6(1),e.AsE("",s.name," ",s.lvl?"("+s.lvl+")":"","")}}function p(i,r){if(1&i&&(e.TgZ(0,"select",25),e.YNc(1,k,2,3,"option",8),e.qZA()),2&i){const s=e.oxw(2).$implicit,n=e.oxw();e.xp6(1),e.Q6J("ngForOf",n.learnedBy[s.controls.skill.value.name])}}function N(i,r){if(1&i&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&i){const s=r.$implicit;e.Q6J("ngValue",s),e.xp6(1),e.AsE("",s.name," ",s.lvl?"("+s.lvl+")":"","")}}function J(i,r){if(1&i&&(e.TgZ(0,"select",25),e.YNc(1,N,2,3,"option",8),e.qZA()),2&i){const s=e.oxw(2).$implicit,n=e.oxw();e.xp6(1),e.Q6J("ngForOf",n.demons[s.controls.race.value])}}function Q(i,r){if(1&i){const s=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"label"),e._uU(3),e.TgZ(4,"input",20),e.NdJ("change",function(){e.CHM(s);const o=e.oxw().$implicit,l=e.oxw();return e.KtG(l.setIngredDemon(o))}),e.qZA()()(),e.TgZ(5,"td")(6,"select",21),e.NdJ("change",function(){e.CHM(s);const o=e.oxw().$implicit,l=e.oxw();return e.KtG(l.setIngredElem(o))}),e.TgZ(7,"option",22),e._uU(8,"-"),e.qZA(),e.YNc(9,_,2,2,"option",6),e.qZA()(),e.TgZ(10,"td")(11,"select",23),e.NdJ("change",function(){e.CHM(s);const o=e.oxw().$implicit,l=e.oxw();return e.KtG(l.setIngredDemon(o))}),e.YNc(12,U,2,2,"option",8),e.qZA()(),e.TgZ(13,"td")(14,"select",5),e.NdJ("change",function(){e.CHM(s);const o=e.oxw().$implicit,l=e.oxw();return e.KtG(l.setIngredDemon(o))}),e.TgZ(15,"option",22),e._uU(16,"-"),e.qZA(),e.YNc(17,u,2,2,"option",6),e.qZA()(),e.TgZ(18,"td"),e.YNc(19,p,2,1,"select",24),e.YNc(20,J,2,1,"select",24),e.qZA()()}if(2&i){const s=e.oxw().$implicit,n=e.oxw();e.xp6(3),e.hij("",n.langEn?"Search Skill":"\u30b9\u30ad\u30eb\u691c\u7d22"," "),e.xp6(3),e.uIk("disabled",!s.controls.searchSkill.value||null),e.xp6(3),e.Q6J("ngForOf",n.elems),e.xp6(2),e.uIk("disabled",!s.controls.searchSkill.value||null),e.xp6(1),e.Q6J("ngForOf",n.skills[s.controls.elem.value]),e.xp6(2),e.uIk("disabled",s.controls.searchSkill.value||null),e.xp6(3),e.Q6J("ngForOf",n.races),e.xp6(2),e.Q6J("ngIf",s.controls.searchSkill.value),e.xp6(1),e.Q6J("ngIf",!s.controls.searchSkill.value)}}function ne(i,r){if(1&i&&(e.ynx(0,18),e.YNc(1,Q,21,9,"tr",19),e.BQk()),2&i){const s=r.index,n=e.oxw();e.Q6J("formGroupName",s),e.xp6(1),e.Q6J("ngIf",s<n.maxSkills)}}function he(i,r){if(1&i&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&i){const s=r.$implicit;e.xp6(1),e.Oqu(s)}}function ie(i,r){if(1&i&&(e.TgZ(0,"td",29)(1,"ul"),e.YNc(2,he,2,1,"li",30),e.qZA()()),2&i){const s=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",s.recipeLeft)}}function T(i,r){if(1&i&&(e.TgZ(0,"td",31),e._uU(1),e.qZA()),2&i){const s=e.oxw(2);e.xp6(1),e.Oqu(s.langEn?"No chains found":"\u5408\u4f53\u306a\u3057")}}function A(i,r){if(1&i&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&i){const s=r.$implicit;e.xp6(1),e.Oqu(s)}}function S(i,r){if(1&i&&(e.TgZ(0,"td",29)(1,"ul"),e.YNc(2,A,2,1,"li",30),e.qZA()()),2&i){const s=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",s.recipeRight)}}function y(i,r){if(1&i&&(e.TgZ(0,"td",31),e._uU(1),e.qZA()),2&i){const s=e.oxw(2);e.xp6(1),e.Oqu(s.langEn?"No chains found":"\u5408\u4f53\u306a\u3057")}}function X(i,r){if(1&i&&(e.ynx(0),e._uU(1),e._UZ(2,"br"),e._uU(3),e.BQk()),2&i){const s=e.oxw(2);e.xp6(1),e.AsE(" ",s.recipeResult.join(" x ")," = ",s.recipe.result,""),e.xp6(2),e.hij(" [",s.resultSkills.join(", "),"] ")}}function ue(i,r){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const s=e.oxw(2);e.xp6(1),e.Oqu(s.langEn?"No recipes found":"\u5408\u4f53\u306a\u3057")}}function E(i,r){if(1&i&&(e.TgZ(0,"table",1)(1,"tr")(2,"th",2),e._uU(3),e.qZA()(),e.TgZ(4,"tr")(5,"th"),e._uU(6),e.qZA(),e.TgZ(7,"th"),e._uU(8),e.qZA()(),e.TgZ(9,"tr"),e.YNc(10,ie,3,1,"td",26),e.YNc(11,T,2,1,"td",27),e.YNc(12,S,3,1,"td",26),e.YNc(13,y,2,1,"td",27),e.qZA(),e.TgZ(14,"tr")(15,"td",28),e.YNc(16,X,4,3,"ng-container",19),e.YNc(17,ue,2,1,"ng-container",19),e.qZA()()()),2&i){const s=e.oxw();e.xp6(3),e.Oqu(s.langEn?"Fusion Recipe":"\u5408\u4f53\u30ec\u30b7\u30d4"),e.xp6(3),e.Oqu(s.langEn?"Left Chain":"\u5de6\u30ec\u30b7\u30d4"),e.xp6(2),e.Oqu(s.langEn?"Right Chain":"\u53f3\u30ec\u30b7\u30d4"),e.xp6(2),e.Q6J("ngIf",s.recipeLeft.length),e.xp6(1),e.Q6J("ngIf",!s.recipeLeft.length),e.xp6(1),e.Q6J("ngIf",s.recipeRight.length),e.xp6(1),e.Q6J("ngIf",!s.recipeRight.length),e.xp6(3),e.Q6J("ngIf",s.recipe.stepR.length),e.xp6(1),e.Q6J("ngIf",!s.recipe.stepR.length)}}let q=(()=>{var i;class r{constructor(n){this.fb=n,this.maxSkills=8,this.langEn=!0,this.internalMaxSkills=9,this.range99=Array(99),this.demons={},this.skills={},this.learnedBy={},this.blankDemon={name:"-",race:"-",lvl:0,currLvl:0,price:0,inherits:0,skills:{},stats:[],resists:[],affinities:[],fusion:"normal",prereq:""},this.blankSkill={name:"-",element:"-",rank:99,cost:0,effect:"",target:"",level:0,learnedBy:[{demon:"-",level:0}]},this.createForm()}ngOnChanges(){this.initDropdowns()}createForm(){const n=[];for(let o=0;o<this.internalMaxSkills;o++)n.push(this.fb.group({searchSkill:!0,elem:"-",skill:this.blankSkill,race:"-",demon:this.blankDemon}));this.form=this.fb.group({race:"-",demon:this.blankDemon,ingreds:this.fb.array(n)}),this.form.valueChanges.subscribe(o=>{if(this.form.valid){const l=o.ingreds.filter(c=>"-"!==c.demon.name&&c.demon.name!==o.demon.name).map(c=>c.demon.name),a=o.ingreds.filter(c=>c.searchSkill&&"-"!==c.skill.name).map(c=>c.skill.name);this.updateRecipe(function j(i,r,s,n,o,l){const{fissionCalculator:a,inheritElems:c,restrictInherits:f,triExclusiveRaces:O,triFissionCalculator:x}=l,{normalChart:d}=o,g=n.getDemon(i),b=s.map(h=>n.getSkill(h)).filter((h,m,D)=>h.rank<50&&h.learnedBy.length>0&&!g.skills.hasOwnProperty(h.name)&&D.indexOf(h)===m),P=G(b.map(h=>h.element),c);let R=n.getSpecialNameEntries(i);if(R.length<2&&O.includes(g.race)){const h=x.getFusions(i,n,o).map(m=>(0,t.Aw)(m,n)).sort((m,D)=>m.price-D.price).find(m=>!((P&(m.d1.inherits|m.d2.inherits))!==P||"special"!==m.d1.fusion&&O.includes(m.d1.race)||"special"!==m.d2.fusion&&O.includes(m.d2.race)||"special"!==m.d3.fusion&&O.includes(m.d3.race)));h&&(R=[h.d1.name,h.d2.name,h.d3.name])}if(R.length<2){const h=a.getFusions(i,n,d).map(m=>(0,t.S6)(m,n)).sort((m,D)=>m.price-D.price).find(m=>!((P&(n.getDemon(m.name1).inherits|n.getDemon(m.name2).inherits))!==P||"normal"!==n.getDemon(m.name1).fusion&&"special"!==n.getDemon(m.name1).fusion||"normal"!==n.getDemon(m.name2).fusion&&"special"!==n.getDemon(m.name2).fusion));h&&(R=[h.name1,h.name2])}const Z=R.map(h=>n.getDemon(h)).sort((h,m)=>m.price-h.price),L=r.map(h=>n.getDemon(h)).sort((h,m)=>m.price-h.price),me={},H={};for(const h of b){for(const m of Z)m.skills.hasOwnProperty(h.name)&&(me[h.name]=m.name);if(!me[h.name])for(const m of L)m.skills.hasOwnProperty(h.name)&&(H[h.name]=m.name)}const pe=Object.keys(H).map(h=>n.getSkill(h)),se=G(pe.map(h=>h.element),c),xe=pe.map(h=>G([h.element],c));let oe,ge,_e=0;for(let h=0;h<Z.length;h++){const m=Z[h];for(const D of Z.slice(h+1))if((se&(m.inherits|D.inherits))===se){const de=(se&m.inherits).toString(2).split("1").length*(se&D.inherits).toString(2).split("1").length;_e<de&&(oe=m,ge=D,_e=de)}}const re={chain1:[],chain2:[],stepR:R,skills:Object.assign(H,me),result:i};if(!oe)return re;const z=Object.values(H).filter((h,m,D)=>D.indexOf(h)===m),le=r.filter(h=>!z.includes(h));let $=Math.ceil(z.length/2);z.sort((h,m)=>d.getLightDark(n.getDemon(h).race)-d.getLightDark(n.getDemon(m).race));let ee=z.slice(0,$),ae=Array(ee.length).fill(0),te=z.slice($),ce=Array(te.length).fill(0);if(f){const{left:h,right:m}=function w(i,r,s,n){let o=[],l=[];const a=[],c=[],f={},O=[];for(let x=0;x<s.length;x++){const d=s[x];0!==d?(f.hasOwnProperty(d)||(f[d]=[]),f[d].push(n[x])):O.push(n[x])}for(const x of Object.keys(f).sort()){const d=parseInt(x);a.length<=c.length?(d&i)===d?a.push(d):c.push(d):(d&r)===d?c.push(d):a.push(d)}for(const x of a)o=o.concat(f[x]);for(const x of c)l=l.concat(f[x]);for(const x of O)o.length<l.length?o.push(x):l.push(x);return{left:o.reverse(),right:l.reverse()}}(oe.inherits,ge.inherits,xe,pe.map(D=>D.name));ee=h.map(D=>H[D]),ae=M(h.map(D=>n.getSkill(D).element),c),te=m.map(D=>H[D]),ce=M(m.map(D=>n.getSkill(D).element),c)}return $=Math.ceil(le.length/2),ee=le.slice(0,$).concat(ee),ae=Array($).fill(0).concat(ae),te=le.slice($).concat(te),ce=Array(le.length-$).fill(0).concat(ce),re.chain1=K(ee,ae,oe.name,n,d,l),re.chain2=K(te,ce,ge.name,n,d,l),re}(o.demon.name,l,a,this.compendium,this.squareChart,this.recipeConfig))}})}setIngredElem(n){n.controls.skill.setValue(this.skills[n.controls.elem.value][0]),this.setIngredDemon(n)}setIngredDemon(n){n.controls.demon.setValue((n.controls.searchSkill.value?this.learnedBy[n.controls.skill.value.name]:this.demons[n.controls.race.value])[0])}updateRecipe(n){const o={};for(const[l,a]of Object.entries(n.skills)){o[a]||(o[a]=[]);const c=this.compendium.getDemon(a).skills[l];o[a].push(l+(c>=2?` (${c})`:""))}this.recipe=n,this.recipeLeft=this.decodeRecipechain(n.chain1,o),this.recipeRight=this.decodeRecipechain(n.chain2,o),this.resultSkills=[],this.recipeResult=[];for(const l of n.stepR)this.recipeResult.push(o[l]?`${l} [${o[l].join(", ")}]`:l);for(const[l,a]of Object.entries(this.compendium.getDemon(n.result).skills).filter(c=>c[1]<2e3).sort((c,f)=>c[1]-f[1]))this.resultSkills.push(l+(a>=2?` (${a})`:""))}decodeRecipechain(n,o){const l=[];for(let a=0;a<n.length-2;a+=2){const c=o[n[a]]?"["+o[n[a]].join(", ")+"] ":"",f=o[n[a+1]]?"["+o[n[a+1]].join(", ")+"] ":"";l.push(`${n[a]} ${c}x ${n[a+1]} ${f}= ${n[a+2]}`)}return l}initDropdowns(){if(this.recipeConfig&&this.compendium&&this.squareChart){this.demons={"-":[this.blankDemon]},this.skills={"-":[this.blankSkill]},this.learnedBy={"-":[this.blankDemon]};for(const n of this.compendium.allDemons)if(!n.isEnemy&&"party"!==n.fusion&&"enemy"!==n.fusion){this.demons[n.race]||(this.demons[n.race]=[]),this.demons[n.race].push(n);for(const o of Object.keys(n.skills))this.learnedBy[o]||(this.learnedBy[o]=[]),this.learnedBy[o].push(n)}for(const n of this.compendium.allSkills.filter(o=>o.rank<50&&o.learnedBy.length>0))this.skills[n.element]||(this.skills[n.element]=[]),this.skills[n.element].push(n);for(const n of Object.values(this.demons))n.sort((o,l)=>o.lvl-l.lvl);for(const n of Object.values(this.learnedBy))n.sort((o,l)=>o.lvl-l.lvl);for(const n of Object.values(this.skills))n.sort((o,l)=>o.rank-l.rank);this.races=this.recipeConfig.races.filter(n=>this.demons[n]),this.elems=this.recipeConfig.skillElems.filter(n=>this.skills[n]),this.setDemon(this.compendium.getDemon(this.recipeConfig.defaultDemon))}}setDemon(n){const o=[],{inheritElems:l}=this.recipeConfig,a=Object.entries(n.skills).slice(0,this.internalMaxSkills).filter(c=>c[1]<2).map(c=>this.compendium.getSkill(c[0]));for(let c=0;c<l.length;c++)n.inherits&1<<c||o.push(l[l.length-c-1]);this.skills[this.blankSkill.element]=[this.blankSkill].concat(a),this.elems=this.recipeConfig.skillElems.filter(c=>this.skills[c]&&!o.includes(c)),this.form.patchValue({race:n.race,demon:n,ingreds:a.concat(Array(this.internalMaxSkills-a.length).fill(this.blankSkill)).map(c=>({searchSkill:!0,elem:"-",skill:c,race:"-",demon:"-"!==c.name?n:this.blankDemon}))})}}return(i=r).\u0275fac=function(n){return new(n||i)(e.Y36(v.qu))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-recipe-generator"]],inputs:{maxSkills:"maxSkills",compendium:"compendium",squareChart:"squareChart",recipeConfig:"recipeConfig",langEn:"langEn"},features:[e.TTD],decls:36,vars:15,consts:[[3,"formGroup"],[1,"entry-table"],["colspan","2",1,"title"],[2,"width","40%"],[2,"width","60%"],["formControlName","race",3,"change"],[3,"value",4,"ngFor","ngForOf"],["formControlName","demon",3,"change"],[3,"ngValue",4,"ngFor","ngForOf"],["formArrayName","ingreds",1,"entry-table"],["colspan","5",1,"title"],[2,"width","20%"],[2,"width","10%"],[2,"width","25%"],[3,"formGroupName",4,"ngFor","ngForOf"],["class","entry-table",4,"ngIf"],[3,"value"],[3,"ngValue"],[3,"formGroupName"],[4,"ngIf"],["formControlName","searchSkill","type","checkbox",3,"change"],["formControlName","elem",3,"change"],["value","-"],["formControlName","skill",3,"change"],["formControlName","demon",4,"ngIf"],["formControlName","demon"],["style","width: 50%",4,"ngIf"],["style","width: 50%","style","padding: 1em; text-align: center;",4,"ngIf"],["colspan","2",2,"padding","1em","text-align","center"],[2,"width","50%"],[4,"ngFor","ngForOf"],[2,"padding","1em","text-align","center"]],template:function(n,o){1&n&&(e.TgZ(0,"form",0)(1,"h2"),e._uU(2),e.qZA(),e.TgZ(3,"table",1)(4,"tr")(5,"th",2),e._uU(6),e.qZA()(),e.TgZ(7,"tr")(8,"th",3),e._uU(9),e.qZA(),e.TgZ(10,"th",4),e._uU(11),e.qZA()(),e.TgZ(12,"tr")(13,"td")(14,"select",5),e.NdJ("change",function(){return o.setDemon(o.demons[o.form.controls.race.value][0])}),e.YNc(15,I,2,2,"option",6),e.qZA()(),e.TgZ(16,"td")(17,"select",7),e.NdJ("change",function(){return o.setDemon(o.form.controls.demon.value)}),e.YNc(18,C,2,2,"option",8),e.qZA()()()(),e.TgZ(19,"table",9)(20,"tr")(21,"th",10),e._uU(22),e.qZA()(),e.TgZ(23,"tr")(24,"th",11),e._uU(25),e.qZA(),e.TgZ(26,"th",12),e._uU(27),e.qZA(),e.TgZ(28,"th",13),e._uU(29),e.qZA(),e.TgZ(30,"th",11),e._uU(31),e.qZA(),e.TgZ(32,"th",13),e._uU(33),e.qZA()(),e.YNc(34,ne,2,2,"ng-container",14),e.qZA(),e.YNc(35,E,18,9,"table",15),e.qZA()),2&n&&(e.Q6J("formGroup",o.form),e.xp6(2),e.Oqu(o.langEn?"Recipe Generator":"\u5408\u4f53\u30ec\u30b7\u30d4"),e.xp6(4),e.Oqu(o.langEn?"Target":"\u60aa\u9b54"),e.xp6(3),e.Oqu(o.langEn?"Race":"\u7a2e\u65cf"),e.xp6(2),e.Oqu(o.langEn?"Name":"\u60aa\u9b54\u540d"),e.xp6(4),e.Q6J("ngForOf",o.races),e.xp6(3),e.Q6J("ngForOf",o.demons[o.form.controls.race.value]),e.xp6(4),e.Oqu(o.langEn?"Include Ingredients":"\u7d20\u6750\u60aa\u9b54"),e.xp6(3),e.Oqu(o.langEn?"Search":"\u30b9\u30ad\u30eb\u691c\u7d22"),e.xp6(2),e.Oqu(o.langEn?"Elem":"\u5c5e\u6027"),e.xp6(2),e.Oqu(o.langEn?"Skill":"\u30b9\u30ad\u30eb\u540d"),e.xp6(2),e.Oqu(o.langEn?"Race":"\u7a2e\u65cf"),e.xp6(2),e.Oqu(o.langEn?"Ingredient":"\u60aa\u9b54\u540d"),e.xp6(1),e.Q6J("ngForOf",o.form.controls.ingreds.controls),e.xp6(1),e.Q6J("ngIf",o.recipe))},dependencies:[B.sg,B.O5,v._Y,v.YN,v.Kr,v.Wl,v.EJ,v.JJ,v.JL,v.sg,v.u,v.x0,v.CE],styles:["ul[_ngcontent-%COMP%]{padding:0 1em;list-style:none}td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-height:25px;width:100%}"],changeDetection:0}),r})()}}]);