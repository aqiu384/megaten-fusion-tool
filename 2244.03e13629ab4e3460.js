"use strict";(self.webpackChunkmegaten_fusion_tool=self.webpackChunkmegaten_fusion_tool||[]).push([[2244],{9436:(ue,Q,O)=>{O.d(Q,{d:()=>D});var J=O(1090),n=O(2598),r=O(177),U=O(4207);function W(h,G){if(1&h&&(n.j41(0,"th",4),n.EFF(1,"Inheritable Skills"),n.k0s()),2&h){const p=n.XpG();n.BMQ("colspan",p.inheritHeaders.length)}}function V(h,G){if(1&h&&(n.j41(0,"th",4),n.EFF(1),n.nI1(2,"translateComp"),n.k0s()),2&h){const p=n.XpG();n.BMQ("colspan",p.inheritHeaders.length),n.R7$(1),n.SpI(" ",n.i5U(2,2,p.msgs.SkillAffinities,p.lang)," ")}}function H(h,G){if(1&h&&(n.qex(0),n.EFF(1),n.bVm()),2&h){const p=n.XpG().$implicit;n.R7$(1),n.JRh(p)}}function w(h,G){if(1&h&&(n.j41(0,"div"),n.EFF(1),n.k0s()),2&h){const p=n.XpG().$implicit;n.ZvI("element-icon ",p,""),n.R7$(1),n.JRh(p)}}function q(h,G){if(1&h&&(n.j41(0,"th"),n.DNE(1,H,2,1,"ng-container",3),n.DNE(2,w,2,4,"div",5),n.k0s()),2&h){const p=n.XpG();n.xc7("width",100/p.inheritHeaders.length,"%"),n.R7$(1),n.Y8G("ngIf",!p.hasIcons),n.R7$(1),n.Y8G("ngIf",p.hasIcons)}}function Z(h,G){if(1&h&&(n.j41(0,"td"),n.EFF(1),n.k0s()),2&h){const p=G.$implicit;n.xc7("color",p?null:"transparent"),n.R7$(1),n.SpI(" ",p?"yes":"no"," ")}}function e(h,G){if(1&h&&(n.j41(0,"tr"),n.DNE(1,Z,2,3,"td",6),n.k0s()),2&h){const p=n.XpG();n.R7$(1),n.Y8G("ngForOf",p.inherits)}}function j(h,G){if(1&h&&(n.j41(0,"td"),n.nI1(1,"roundInheritPercent"),n.EFF(2),n.k0s()),2&h){const p=G.$implicit;n.ZvI("affinity",n.bMT(1,4,p),""),n.R7$(2),n.SpI(" ",p,"% ")}}function T(h,G){if(1&h&&(n.j41(0,"tr"),n.DNE(1,j,3,6,"td",7),n.k0s()),2&h){const p=n.XpG();n.R7$(1),n.Y8G("ngForOf",p.inherits)}}function C(h,G){if(1&h&&(n.j41(0,"td"),n.EFF(1),n.nI1(2,"affinityToString"),n.k0s()),2&h){const p=G.$implicit;n.ZvI("affinity",p,""),n.R7$(1),n.SpI(" ",n.bMT(2,4,p)," ")}}function k(h,G){if(1&h&&(n.j41(0,"tr"),n.DNE(1,C,3,6,"td",7),n.k0s()),2&h){const p=n.XpG();n.R7$(1),n.Y8G("ngForOf",p.inherits)}}let D=(()=>{class h{constructor(){this.inheritHeaders=[],this.inherits=[],this.hasChance=!1,this.hasIcons=!0,this.hasLvls=!1,this.lang="en",this.msgs=J.dx}static{this.\u0275fac=function(y){return new(y||h)}}static{this.\u0275cmp=n.VBU({type:h,selectors:[["app-demon-inherits"]],inputs:{inheritHeaders:"inheritHeaders",inherits:"inherits",hasChance:"hasChance",hasIcons:"hasIcons",hasLvls:"hasLvls",lang:"lang"},decls:11,vars:6,consts:[[1,"entry-table"],["class","title",4,"ngIf"],[3,"width",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"title"],[3,"class",4,"ngIf"],[3,"color",4,"ngFor","ngForOf"],[3,"class",4,"ngFor","ngForOf"]],template:function(y,Y){1&y&&(n.j41(0,"table",0)(1,"thead")(2,"tr"),n.DNE(3,W,2,1,"th",1),n.DNE(4,V,3,5,"th",1),n.k0s(),n.j41(5,"tr"),n.DNE(6,q,3,4,"th",2),n.k0s()(),n.j41(7,"tbody"),n.DNE(8,e,2,1,"tr",3),n.DNE(9,T,2,1,"tr",3),n.DNE(10,k,2,1,"tr",3),n.k0s()()),2&y&&(n.R7$(3),n.Y8G("ngIf",!Y.hasLvls),n.R7$(1),n.Y8G("ngIf",Y.hasLvls&&Y.inheritHeaders.length),n.R7$(2),n.Y8G("ngForOf",Y.inheritHeaders),n.R7$(2),n.Y8G("ngIf",!Y.hasLvls&&!Y.hasChance),n.R7$(1),n.Y8G("ngIf",Y.hasChance),n.R7$(1),n.Y8G("ngIf",Y.hasLvls))},dependencies:[r.Sq,r.bT,U.uz,U.XM,U.D8],encapsulation:2,changeDetection:0})}}return h})()},9023:(ue,Q,O)=>{O.d(Q,{q:()=>j});var J=O(2755),n=O(1090),r=O(2598),U=O(345),W=O(8935),V=O(177);function H(T,C){if(1&T&&(r.j41(0,"th"),r.EFF(1),r.k0s()),2&T){const k=C.$implicit,D=r.XpG();r.R7$(1),r.JRh(k.slice(0,D.nameCut))}}function w(T,C){if(1&T&&(r.j41(0,"td",4),r.EFF(1),r.k0s()),2&T){const k=C.$implicit,D=r.XpG(2);r.Y8G("ngClass",k.slice(0,4)),r.R7$(1),r.JRh(k.slice(4,D.nameCut+4))}}function q(T,C){if(1&T&&(r.j41(0,"tr")(1,"th"),r.EFF(2),r.k0s(),r.DNE(3,w,2,2,"td",3),r.j41(4,"th"),r.EFF(5),r.k0s()()),2&T){const k=C.$implicit;r.R7$(2),r.JRh(k[0]),r.R7$(1),r.Y8G("ngForOf",k.slice(1,k.length-1)),r.R7$(2),r.JRh(k[k.length-1])}}function Z(T,C){if(1&T&&(r.j41(0,"th"),r.EFF(1),r.k0s()),2&T){const k=C.$implicit,D=r.XpG();r.R7$(1),r.JRh(k.slice(0,D.nameCut))}}function e(T,C){if(1&T&&(r.j41(0,"tr")(1,"th",0),r.EFF(2),r.k0s()()),2&T){const k=r.XpG();r.R7$(1),r.BMQ("colspan",k.table[0].length),r.R7$(1),r.Lme("",k.appName," ",k.tripTitle,"")}}class j{static{this.RESULT_COLORS=Object.entries({oran:["-2","Erthys","Gnome","Saki","Saki Mitama","Random","\u30a2\u30fc\u30b7\u30fc\u30ba","\u30ce\u30fc\u30e0","\u30b5\u30ad\u30df\u30bf\u30de"],redd:["-1","Flaemis","Salamander","Ara ","Ara Mitama","Fiend","\u30d5\u30ec\u30a4\u30df\u30fc\u30ba","\u30b5\u30e9\u30de\u30f3\u30c0\u30fc","\u30a2\u30e9\u30df\u30bf\u30de"],gree:["1","Aeros","Sylph","Kusi","Kusi Mitama","UMA","\u30a8\u30a2\u30ed\u30b9","\u30b7\u30eb\u30ad\u30fc","\u30af\u30b7\u30df\u30bf\u30de"],blue:["2","Aquans","Undine","Nigi","Nigi Mitama","Enigma","\u30a2\u30af\u30a2\u30f3\u30ba","\u30a6\u30f3\u30c7\u30a3\u30fc\u30cd","\u30cb\u30ae\u30df\u30bf\u30de"]})}constructor(C,k){this.title2=C,this.route=k,this.normTitle="Normal Fusions",this.tripTitle="",this.isPersona=!1,this.filterDarks=!0,this.lang="en",this.msgs=n.qh,this.subscriptions=[],this.table=[],this.nameCut=4}ngOnInit(){this.subscriptions.push(this.route.parent.data.subscribe(C=>{this.appName=C.appName||"Shin Megami Tensei",this.nameCut=parseInt((0,J.oO)(this.msgs.NameCut,C.lang)),this.title2.setTitle((0,J.oO)(this.msgs.AppTitle,C.lang).replace("$APP",this.appName))}))}ngOnChanges(){this.normChart&&this.fillFusionChart()}ngOnDestroy(){for(const C of this.subscriptions)C.unsubscribe()}fillFusionChart(){const C="noneNone",D=j.RESULT_COLORS.reduce((E,[b,M])=>M.reduce((L,z)=>(L[z]=b,L),E),{}),h=this.normChart.elementDemons;let G=[],p=this.normChart.races,y=[];this.filterDarks&&(G=this.normChart.races.filter(E=>this.normChart.getLightDark(E)>0),p=this.normChart.races.filter(E=>0===this.normChart.getLightDark(E)),y=this.normChart.races.filter(E=>-1===this.normChart.getLightDark(E)),0===y.length&&G.length>0&&(G=this.normChart.races.filter(E=>this.normChart.getLightDark(E)>-1),p=[],y=this.normChart.races.filter(E=>this.normChart.getLightDark(E)<-1)));const Y=G.length-y.length,B=G.concat(p,h),ie=y.length?y.concat(Array(B.length-y.length).fill("")):B,pe=this.mitaTable?B:G.concat(p,Array(h.length).fill("")),se=this.mitaTable||y.length?Array(Y).fill("").concat(y,p,h):B;this.table=[[""].concat(B,[""])];for(let E=0;E<se.length;E++){const b=Array(B.length+2).fill("empt-"),M=se[E],L=pe[E],z=-1!==h.indexOf(M),fe=-1!==h.indexOf(L);this.table.push(b),b[0]=M,b[b.length-1]=L;for(let v=E;v<B.length;v++){const N=B[v],P=-1!==h.indexOf(N);if(P&&fe){const X=h.indexOf(L),o=h.indexOf(N),a=this.mitaTable[o][X].replace("-","");b[v+1]=a?(D[a]||"norm")+a:C}else if(P&&L){const X=this.normChart.getElemFusions(N)[L];b[v+1]=X?(D[X]||"rank")+(X>0?"+":"")+X.toString():C}else if(N&&L){const X=this.isPersona&&N===L?N:this.normChart.getRaceFusion(N,L);b[v+1]=X?(D[X]||(N===L?"elem":"norm"))+X:C}}if(this.tripChart)for(let v=0;v<=E-Y;v++){const N=ie[v];if(N&&z){const P=this.tripChart.getElemFusions(M)[N];b[v+1]=P?(D[P]||"rank")+(P>0?"+":"")+P.toString():C}else if(N&&M){const P=this.tripChart.getRaceFusion(N,M);b[v+1]=P?(D[P]||(N===M?"elem":"trip"))+P:C}}if(-1!==M.indexOf(" x ")){const[v,N]=M.split(" x "),P=v.slice(0,3)+"x"+N.slice(0,3);b[0]=P,b[b.length-1]=P}else if(-1!==M.indexOf(" ")){const v=M.split(" ")[0];b[0]=v,b[b.length-1]=v}}for(let E=0;E<this.table[0].length;E++){const b=this.table[0][E];if(-1!==b.indexOf(" x ")){const[M,L]=b.split(" x ");this.table[0][E]=M.slice(0,2)+L.slice(0,2)}}this.table.push([""].concat(ie,[""]))}static{this.\u0275fac=function(k){return new(k||j)(r.rXU(U.hE),r.rXU(W.nX))}}static{this.\u0275cmp=r.VBU({type:j,selectors:[["app-fusion-chart"]],inputs:{normChart:"normChart",tripChart:"tripChart",mitaTable:"mitaTable",normTitle:"normTitle",tripTitle:"tripTitle",isPersona:"isPersona",filterDarks:"filterDarks",lang:"lang",counter:"counter"},features:[r.OA$],decls:12,vars:7,consts:[[1,"title"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(k,D){1&k&&(r.j41(0,"table")(1,"tbody")(2,"tr")(3,"th",0),r.EFF(4),r.k0s()(),r.j41(5,"tr"),r.DNE(6,H,2,1,"th",1),r.k0s(),r.DNE(7,q,6,3,"tr",1),r.j41(8,"tr"),r.DNE(9,Z,2,1,"th",1),r.k0s(),r.DNE(10,e,3,3,"tr",2),r.k0s(),r.nrm(11,"tbody"),r.k0s()),2&k&&(r.R7$(3),r.BMQ("colspan",D.table[0].length),r.R7$(1),r.Lme("",D.appName," ",D.normTitle,""),r.R7$(2),r.Y8G("ngForOf",D.table[0]),r.R7$(1),r.Y8G("ngForOf",D.table.slice(1,D.table.length-1)),r.R7$(2),r.Y8G("ngForOf",D.table[D.table.length-1]),r.R7$(1),r.Y8G("ngIf",D.tripTitle))},dependencies:[V.YU,V.Sq,V.bT],styles:["table[_ngcontent-%COMP%]{width:auto;margin:0 auto;white-space:nowrap}td.elem[_ngcontent-%COMP%]{color:#0f0}td.trip[_ngcontent-%COMP%]{color:#d3d3d3}td.oran[_ngcontent-%COMP%]{color:orange}td.redd[_ngcontent-%COMP%]{color:red}td.gree[_ngcontent-%COMP%]{color:#0f0}td.blue[_ngcontent-%COMP%]{color:#0ff}td.none[_ngcontent-%COMP%]{color:transparent}td.empt[_ngcontent-%COMP%]{background-color:transparent;color:transparent}"],changeDetection:0})}}},1289:(ue,Q,O)=>{O.d(Q,{h:()=>X});var J=O(4207),n=O(4660);function U(o,a){return parseInt(a.map(t=>o.includes(t)?"1":"0").join(""),2)||0}function W(o,a){return o.map((t,i,s)=>U(s.slice(0,i+1),a))}function H(o,a,t,i,s,l){let c=t,m=[c];const d=i.getSpecialNameEntries(c),I=a[a.length-1];if(0!==d.length&&(c=d.find(R=>0===i.getSpecialNameEntries(R).length),m.unshift(d.filter(R=>R!==c).join(" x ")),m.unshift(c)),o.length>0){const R=function q(o,a,t,i,s){const{fusionCalculator:l}=s,c=o.slice(0,1);if(o.length<2)return c;let m=c[0],d=a[0];for(let I=1;I<o.length;I++){const R=o[I],u=a[I],g=l.getFusions(m,t,i).map(F=>(0,n.lA)(F,t)).sort((F,A)=>F.price-A.price);let $=!1;for(const F of g)if(F.name1===R&&(u&t.getDemon(F.name2).inherits)===u){c.push(R),c.push(F.name2),m=c[c.length-1],d=u,$=!0;break}if($)continue;const x=l.getFusions(R,t,i).reduce((F,A)=>(F[A.name1]=A.name2,F),{});for(const F of g)if(x[F.name2]&&(d&t.getDemon(F.name2).inherits)===d&&(u&t.getDemon(x[F.name2]).inherits)===u){c.push(F.name1),c.push(F.name2),c.push(R),c.push(x[F.name2]),m=c[c.length-1],d=u,$=!0;break}if(!$)return[]}return c}(o,a,i,s,l);if(0===R.length)return[];const u=R[R.length-1];let g=w(u,c,I,i,s,l);if(0===g.length){const $=i.getDemon(c),oe=i.getResultDemonLvls($.race).map(x=>i.reverseLookupDemon($.race,x)).filter(x=>x!==c);for(const x of s.elementDemons.concat(oe)){if((I&i.getDemon(x).inherits)!==I)continue;const F=w(u,x,I,i,s,l),A=w(x,c,I,i,s,l);if(0!==F.length&&0!==A.length){g=F.concat(A.slice(1));break}}}if(0===g.length)return[];m=R.concat(g.slice(1),m.slice(1))}return m}function w(o,a,t,i,s,l){const{fissionCalculator:c,fusionCalculator:m}=l,d=[o];if(o===a)return d;const I=m.getFusions(o,i,s).map(g=>(0,n.lA)(g,i)).sort((g,$)=>g.price-$.price);for(const g of I)if(g.name2===a)return d.push(g.name1),d.push(a),d;const R=c.getFusions(a,i,s).map(g=>(0,n.on)(g,i)).sort((g,$)=>g.price-$.price);I.sort((g,$)=>$.price-g.price);const u=I.reduce((g,$)=>(g[$.name2]=$.name1,g),{});for(const g of R){if(u[g.name1]&&(t&i.getDemon(g.name1).inherits)===t)return d.push(u[g.name1]),d.push(g.name1),d.push(g.name2),d.push(a),d;if(u[g.name2]&&(t&i.getDemon(g.name2).inherits)===t)return d.push(u[g.name2]),d.push(g.name2),d.push(g.name1),d.push(a),d}return[]}var Z=O(1090),e=O(2598),j=O(4341),T=O(177);function C(o,a){if(1&o&&(e.j41(0,"option",16),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t),e.R7$(1),e.JRh(t)}}function k(o,a){if(1&o&&(e.j41(0,"option",17),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("ngValue",t),e.R7$(1),e.JRh(t.name)}}function D(o,a){if(1&o&&(e.j41(0,"option",16),e.EFF(1),e.k0s()),2&o){const t=a.$implicit,i=e.XpG(3);e.Y8G("value",t),e.R7$(1),e.JRh(i.recipeConfig.displayElems[t]||t)}}function h(o,a){if(1&o&&(e.j41(0,"option",17),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("ngValue",t),e.R7$(1),e.JRh(t.name)}}function G(o,a){if(1&o&&(e.j41(0,"option",16),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t),e.R7$(1),e.JRh(t)}}function p(o,a){if(1&o&&(e.j41(0,"option",17),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("ngValue",t),e.R7$(1),e.JRh(t.name)}}function y(o,a){if(1&o&&(e.j41(0,"select",25),e.DNE(1,p,2,2,"option",8),e.k0s()),2&o){const t=e.XpG(2).$implicit,i=e.XpG();e.R7$(1),e.Y8G("ngForOf",i.learnedBy[t.controls.skill.value.name])}}function Y(o,a){if(1&o&&(e.j41(0,"option",17),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("ngValue",t),e.R7$(1),e.JRh(t.name)}}function B(o,a){if(1&o&&(e.j41(0,"select",25),e.DNE(1,Y,2,2,"option",8),e.k0s()),2&o){const t=e.XpG(2).$implicit,i=e.XpG();e.R7$(1),e.Y8G("ngForOf",i.demons[t.controls.race.value])}}function ie(o,a){if(1&o){const t=e.RV6();e.j41(0,"tr")(1,"td")(2,"label"),e.EFF(3),e.nI1(4,"translateComp"),e.j41(5,"input",20),e.bIt("change",function(){e.eBV(t);const s=e.XpG().$implicit,l=e.XpG();return e.Njj(l.setIngredDemon(s))}),e.k0s()()(),e.j41(6,"td")(7,"select",21),e.bIt("change",function(){e.eBV(t);const s=e.XpG().$implicit,l=e.XpG();return e.Njj(l.setIngredElem(s))}),e.j41(8,"option",22),e.EFF(9,"-"),e.k0s(),e.DNE(10,D,2,2,"option",6),e.k0s()(),e.j41(11,"td")(12,"select",23),e.bIt("change",function(){e.eBV(t);const s=e.XpG().$implicit,l=e.XpG();return e.Njj(l.setIngredDemon(s))}),e.DNE(13,h,2,2,"option",8),e.k0s()(),e.j41(14,"td")(15,"select",5),e.bIt("change",function(){e.eBV(t);const s=e.XpG().$implicit,l=e.XpG();return e.Njj(l.setIngredDemon(s))}),e.j41(16,"option",22),e.EFF(17,"-"),e.k0s(),e.DNE(18,G,2,2,"option",6),e.k0s()(),e.j41(19,"td"),e.DNE(20,y,2,1,"select",24),e.DNE(21,B,2,1,"select",24),e.k0s()()}if(2&o){const t=e.XpG(),i=t.index,s=t.$implicit,l=e.XpG();e.R7$(3),e.Lme("",e.i5U(4,10,l.msgs.LearnsSkill,l.lang),"",i+1," "),e.R7$(4),e.BMQ("disabled",!s.controls.searchSkill.value||null),e.R7$(3),e.Y8G("ngForOf",l.elems),e.R7$(2),e.BMQ("disabled",!s.controls.searchSkill.value||null),e.R7$(1),e.Y8G("ngForOf",l.skills[s.controls.elem.value]),e.R7$(2),e.BMQ("disabled",s.controls.searchSkill.value||null),e.R7$(3),e.Y8G("ngForOf",l.races),e.R7$(2),e.Y8G("ngIf",s.controls.searchSkill.value),e.R7$(1),e.Y8G("ngIf",!s.controls.searchSkill.value)}}function pe(o,a){if(1&o&&(e.qex(0,18),e.DNE(1,ie,22,13,"tr",19),e.bVm()),2&o){const t=a.index,i=e.XpG();e.Y8G("formGroupName",t),e.R7$(1),e.Y8G("ngIf",t<i.maxSkills)}}function se(o,a){if(1&o&&(e.j41(0,"li"),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.R7$(1),e.JRh(t)}}function E(o,a){if(1&o&&(e.j41(0,"td",29)(1,"ul"),e.DNE(2,se,2,1,"li",30),e.k0s()()),2&o){const t=e.XpG(2);e.R7$(2),e.Y8G("ngForOf",t.recipeLeft)}}function b(o,a){if(1&o&&(e.j41(0,"td",31),e.EFF(1),e.nI1(2,"translateComp"),e.k0s()),2&o){const t=e.XpG(2);e.R7$(1),e.JRh(e.i5U(2,1,t.msgs.NoRecipesFound,t.lang))}}function M(o,a){if(1&o&&(e.j41(0,"li"),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.R7$(1),e.JRh(t)}}function L(o,a){if(1&o&&(e.j41(0,"td",29)(1,"ul"),e.DNE(2,M,2,1,"li",30),e.k0s()()),2&o){const t=e.XpG(2);e.R7$(2),e.Y8G("ngForOf",t.recipeRight)}}function z(o,a){if(1&o&&(e.j41(0,"td",31),e.EFF(1),e.nI1(2,"translateComp"),e.k0s()),2&o){const t=e.XpG(2);e.R7$(1),e.JRh(e.i5U(2,1,t.msgs.NoRecipesFound,t.lang))}}function fe(o,a){if(1&o&&(e.j41(0,"tr")(1,"td",28),e.EFF(2),e.nI1(3,"translateComp"),e.k0s()()),2&o){const t=e.XpG(2);e.R7$(2),e.Lme(" ",e.i5U(3,2,t.msgs.SpecialFusionCondition,t.lang),": ",t.fusionPrereq," ")}}function v(o,a){if(1&o&&(e.qex(0),e.EFF(1),e.nrm(2,"br"),e.EFF(3),e.bVm()),2&o){const t=e.XpG(2);e.R7$(1),e.Lme(" ",t.recipeResult.join(" x ")," = ",t.recipe.result,""),e.R7$(2),e.SpI(" [",t.resultSkills.join(", "),"] ")}}function N(o,a){if(1&o&&(e.qex(0),e.EFF(1),e.nI1(2,"translateComp"),e.bVm()),2&o){const t=e.XpG(2);e.R7$(1),e.JRh(e.i5U(2,1,t.msgs.NoRecipesFound,t.lang))}}function P(o,a){if(1&o&&(e.j41(0,"table",1)(1,"tr")(2,"th",2),e.EFF(3),e.nI1(4,"translateComp"),e.k0s()(),e.j41(5,"tr")(6,"th"),e.EFF(7),e.nI1(8,"translateComp"),e.k0s(),e.j41(9,"th"),e.EFF(10),e.nI1(11,"translateComp"),e.k0s()(),e.j41(12,"tr"),e.DNE(13,E,3,1,"td",26),e.DNE(14,b,3,4,"td",27),e.DNE(15,L,3,1,"td",26),e.DNE(16,z,3,4,"td",27),e.k0s(),e.DNE(17,fe,4,5,"tr",19),e.j41(18,"tr")(19,"td",28),e.DNE(20,v,4,3,"ng-container",19),e.DNE(21,N,3,4,"ng-container",19),e.k0s()()()),2&o){const t=e.XpG();e.R7$(3),e.JRh(e.i5U(4,10,t.msgs.FusionRecipe,t.lang)),e.R7$(4),e.JRh(e.i5U(8,13,t.msgs.LeftChain,t.lang)),e.R7$(3),e.JRh(e.i5U(11,16,t.msgs.RightChain,t.lang)),e.R7$(3),e.Y8G("ngIf",t.recipeLeft.length),e.R7$(1),e.Y8G("ngIf",!t.recipeLeft.length),e.R7$(1),e.Y8G("ngIf",t.recipeRight.length),e.R7$(1),e.Y8G("ngIf",!t.recipeRight.length),e.R7$(1),e.Y8G("ngIf",t.fusionPrereq),e.R7$(3),e.Y8G("ngIf",t.recipe.stepR.length),e.R7$(1),e.Y8G("ngIf",!t.recipe.stepR.length)}}let X=(()=>{class o{constructor(t){this.fb=t,this.maxSkills=8,this.lang="en",this.internalMaxSkills=9,this.range99=Array(99),this.demons={},this.skills={},this.learnedBy={},this.fusionPrereq="",this.msgs=Z.hV,this.skillLevelPipe=new J.wv,this.blankDemon={name:"-",race:"-",lvl:0,currLvl:0,price:0,inherits:0,skills:{},stats:[],resists:[],affinities:[],fusion:"normal",prereq:""},this.blankSkill={name:"-",element:"-",rank:99,cost:0,effect:"",target:"",level:0,learnedBy:[{demon:"-",level:0}]},this.createForm()}ngOnChanges(){this.initDropdowns()}createForm(){const t=[];for(let i=0;i<this.internalMaxSkills;i++)t.push(this.fb.group({searchSkill:!0,elem:"-",skill:this.blankSkill,race:{value:"-",disabled:!0},demon:this.blankDemon}));this.form=this.fb.group({race:"-",demon:this.blankDemon,ingreds:this.fb.array(t)}),this.form.valueChanges.subscribe(i=>{if(this.form.valid){const s=i.ingreds.filter(c=>"-"!==c.demon.name&&c.demon.name!==i.demon.name).map(c=>c.demon.name),l={};for(const c of i.ingreds)c.searchSkill&&"-"!==c.skill.name&&(l[c.skill.name]=c.demon.name);this.updateRecipe(function r(o,a,t,i,s,l){const{fissionCalculator:c,inheritElems:m,restrictInherits:d,triExclusiveRaces:I,triFissionCalculator:R}=l,{normalChart:u}=s,g=i.getDemon(o),$={};for(const[f,_]of Object.entries(t))"-"!==_&&_!==g.name&&($[f]=_);const x=U(Object.keys(t).map(f=>i.getSkill(f)).map(f=>f.element),m);let F=i.getSpecialNameEntries(o);if(F.length<2&&I.includes(g.race)){const f=R.getFusions(o,i,s).map(_=>(0,n.f7)(_,i)).sort((_,S)=>_.price-S.price).find(_=>(x&(_.d1.inherits|_.d2.inherits))===x&&!I.includes(_.d1.race)&&!I.includes(_.d2.race)&&!I.includes(_.d3.race));f&&(F=[f.d1.name,f.d2.name,f.d3.name])}if(F.length<2){const f=c.getFusions(o,i,u).map(_=>(0,n.on)(_,i)).sort((_,S)=>_.price-S.price).find(_=>(x&(i.getDemon(_.name1).inherits|i.getDemon(_.name2).inherits))===x&&"normal"===i.getDemon(_.name1).fusion&&"normal"===i.getDemon(_.name2).fusion&&!I.includes(i.getDemon(_.name1).race)&&!I.includes(i.getDemon(_.name2).race));f&&(F=[f.name1,f.name2])}const A=F.map(f=>i.getDemon(f)).sort((f,_)=>_.price-f.price),ge=Object.keys($).map(f=>i.getSkill(f)),re=U(ge.map(f=>f.element),m),ke=ge.map(f=>U([f.element],m));let le,_e,de=0;for(let f=0;f<A.length;f++){const _=A[f];for(const S of A.slice(f+1))if((re&(_.inherits|S.inherits))===re){const Re=(re&_.inherits).toString(2).split("1").length*(re&S.inherits).toString(2).split("1").length;de<Re&&(le=_,_e=S,de=Re)}}const ae={chain1:[],chain2:[],stepR:F,skills:$,result:o};if(!le)return ae;const ee=Object.values($).filter((f,_,S)=>S.indexOf(f)===_),ce=a.filter(f=>!ee.includes(f));let K=Math.ceil(ee.length/2);ee.sort((f,_)=>u.getLightDark(i.getDemon(f).race)-u.getLightDark(i.getDemon(_).race));let te=ee.slice(0,K),he=Array(te.length).fill(0),ne=ee.slice(K),me=Array(ne.length).fill(0);if(d){const{left:f,right:_}=function V(o,a,t,i){let s=[],l=[];const c=[],m=[],d={},I=[];for(let R=0;R<t.length;R++){const u=t[R];0!==u?(d.hasOwnProperty(u)||(d[u]=[]),d[u].push(i[R])):I.push(i[R])}for(const R of Object.keys(d).sort()){const u=parseInt(R);c.length<=m.length?(u&o)===u?c.push(u):m.push(u):(u&a)===u?m.push(u):c.push(u)}for(const R of c)s=s.concat(d[R]);for(const R of m)l=l.concat(d[R]);for(const R of I)s.length<l.length?s.push(R):l.push(R);return{left:s.reverse(),right:l.reverse()}}(le.inherits,_e.inherits,ke,ge.map(S=>S.name));te=f.map(S=>$[S]),he=W(f.map(S=>i.getSkill(S).element),m),ne=_.map(S=>$[S]),me=W(_.map(S=>i.getSkill(S).element),m)}return K=Math.ceil(ce.length/2),te=ce.slice(0,K).concat(te),he=Array(K).fill(0).concat(he),ne=ce.slice(K).concat(ne),me=Array(ce.length-K).fill(0).concat(me),ae.chain1=H(te,he,le.name,i,u,l),ae.chain2=H(ne,me,_e.name,i,u,l),ae}(i.demon.name,s,l,this.compendium,this.squareChart,this.recipeConfig))}})}setIngredElem(t){t.controls.skill.setValue(this.skills[t.controls.elem.value][0]),this.setIngredDemon(t)}setIngredDemon(t){t.controls.demon.setValue((t.controls.searchSkill.value?this.learnedBy[t.controls.skill.value.name]:this.demons[t.controls.race.value])[0])}updateRecipe(t){const i={};for(const[s,l]of Object.entries(t.skills)){i[l]||(i[l]=[]);const c=this.compendium.getDemon(l).skills[s];i[l].push(`${s} ${this.skillLevelPipe.transform(c)}`.trim())}this.recipe=t,this.recipeLeft=this.decodeRecipechain(t.chain1,i),this.recipeRight=this.decodeRecipechain(t.chain2,i),this.resultSkills=[],this.recipeResult=[],this.fusionPrereq=this.compendium.getDemon(t.result).prereq||"";for(const s of t.stepR)this.recipeResult.push(i[s]?`${s} [${i[s].join(", ")}]`:s);for(const[s,l]of Object.entries(this.compendium.getDemon(t.result).skills).filter(c=>c[1]<2e3).sort((c,m)=>c[1]-m[1]))this.resultSkills.push(`${s} ${this.skillLevelPipe.transform(l)}`.trim())}decodeRecipechain(t,i){const s=[];for(let l=0;l<t.length-2;l+=2){const c=i[t[l]]?"["+i[t[l]].join(", ")+"] ":"",m=i[t[l+1]]?"["+i[t[l+1]].join(", ")+"] ":"";s.push(`${t[l]} ${c}x ${t[l+1]} ${m}= ${t[l+2]}`)}return s}initDropdowns(){if(this.recipeConfig&&this.compendium&&this.squareChart){this.demons={"-":[this.blankDemon]},this.skills={"-":[this.blankSkill]},this.learnedBy={"-":[this.blankDemon]};for(const t of this.compendium.allDemons)if(!t.isEnemy&&"party"!==t.fusion&&"enemy"!==t.fusion){this.demons[t.race]||(this.demons[t.race]=[]),this.demons[t.race].push(t);for(const i of Object.keys(t.skills))this.learnedBy[i]||(this.learnedBy[i]=[]),this.learnedBy[i].push(t)}for(const t of this.compendium.allSkills.filter(i=>i.rank<50&&i.learnedBy.length>0))this.skills[t.element]||(this.skills[t.element]=[]),this.skills[t.element].push(t);for(const t of Object.values(this.demons))t.sort((i,s)=>i.lvl-s.lvl);for(const t of Object.values(this.learnedBy))t.sort((i,s)=>i.lvl-s.lvl);for(const t of Object.values(this.skills))t.sort((i,s)=>i.rank-s.rank);this.races=this.recipeConfig.races.filter(t=>this.demons[t]),this.elems=this.recipeConfig.skillElems.filter(t=>this.skills[t]),this.setDemon(this.compendium.getDemon(this.recipeConfig.defaultDemon))}}setDemon(t){const i=[],{inheritElems:s}=this.recipeConfig,l=Object.entries(t.skills).slice(0,this.internalMaxSkills).filter(m=>m[1]<2).map(m=>this.compendium.getSkill(m[0])),c=Object.entries(t.skills).slice(0,this.internalMaxSkills).filter(m=>m[1]<100).map(m=>this.compendium.getSkill(m[0]));for(let m=0;m<s.length;m++)t.inherits&1<<m||i.push(s[s.length-m-1]);this.skills[this.blankSkill.element]=[this.blankSkill].concat(c),this.elems=this.recipeConfig.skillElems.filter(m=>this.skills[m]&&!i.includes(m)),this.form.patchValue({race:t.race,demon:t,ingreds:l.concat(Array(this.internalMaxSkills-l.length).fill(this.blankSkill)).map(m=>({searchSkill:!0,elem:"-",skill:m,race:"-",demon:"-"!==m.name?t:this.blankDemon}))})}static{this.\u0275fac=function(i){return new(i||o)(e.rXU(j.ok))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-recipe-generator"]],inputs:{maxSkills:"maxSkills",compendium:"compendium",squareChart:"squareChart",recipeConfig:"recipeConfig",lang:"lang"},features:[e.OA$],decls:46,vars:45,consts:[[3,"formGroup"],[1,"entry-table"],["colspan","2",1,"title"],[2,"width","40%"],[2,"width","60%"],["formControlName","race",3,"change"],[3,"value",4,"ngFor","ngForOf"],["formControlName","demon",3,"change"],[3,"ngValue",4,"ngFor","ngForOf"],["formArrayName","ingreds",1,"entry-table"],["colspan","5",1,"title"],[2,"width","20%"],[2,"width","10%"],[2,"width","25%"],[3,"formGroupName",4,"ngFor","ngForOf"],["class","entry-table",4,"ngIf"],[3,"value"],[3,"ngValue"],[3,"formGroupName"],[4,"ngIf"],["formControlName","searchSkill","type","checkbox",3,"change"],["formControlName","elem",3,"change"],["value","-"],["formControlName","skill",3,"change"],["formControlName","demon",4,"ngIf"],["formControlName","demon"],["style","width: 50%",4,"ngIf"],["style","width: 50%","style","padding: 1em; text-align: center;",4,"ngIf"],["colspan","2",2,"padding","1em","text-align","center"],[2,"width","50%"],[4,"ngFor","ngForOf"],[2,"padding","1em","text-align","center"]],template:function(i,s){1&i&&(e.j41(0,"form",0)(1,"h2"),e.EFF(2),e.nI1(3,"translateComp"),e.k0s(),e.j41(4,"table",1)(5,"tr")(6,"th",2),e.EFF(7),e.nI1(8,"translateComp"),e.k0s()(),e.j41(9,"tr")(10,"th",3),e.EFF(11),e.nI1(12,"translateComp"),e.k0s(),e.j41(13,"th",4),e.EFF(14),e.nI1(15,"translateComp"),e.k0s()(),e.j41(16,"tr")(17,"td")(18,"select",5),e.bIt("change",function(){return s.setDemon(s.demons[s.form.controls.race.value][0])}),e.DNE(19,C,2,2,"option",6),e.k0s()(),e.j41(20,"td")(21,"select",7),e.bIt("change",function(){return s.setDemon(s.form.controls.demon.value)}),e.DNE(22,k,2,2,"option",8),e.k0s()()()(),e.j41(23,"table",9)(24,"tr")(25,"th",10),e.EFF(26),e.nI1(27,"translateComp"),e.k0s()(),e.j41(28,"tr")(29,"th",11),e.EFF(30),e.nI1(31,"translateComp"),e.k0s(),e.j41(32,"th",12),e.EFF(33),e.nI1(34,"translateComp"),e.k0s(),e.j41(35,"th",13),e.EFF(36),e.nI1(37,"translateComp"),e.k0s(),e.j41(38,"th",11),e.EFF(39),e.nI1(40,"translateComp"),e.k0s(),e.j41(41,"th",13),e.EFF(42),e.nI1(43,"translateComp"),e.k0s()(),e.DNE(44,pe,2,2,"ng-container",14),e.k0s(),e.DNE(45,P,22,19,"table",15),e.k0s()),2&i&&(e.Y8G("formGroup",s.form),e.R7$(2),e.JRh(e.i5U(3,15,s.msgs.RecipeGenerator,s.lang)),e.R7$(5),e.JRh(e.i5U(8,18,s.msgs.Target,s.lang)),e.R7$(4),e.JRh(e.i5U(12,21,s.msgs.Race,s.lang)),e.R7$(3),e.JRh(e.i5U(15,24,s.msgs.Name,s.lang)),e.R7$(5),e.Y8G("ngForOf",s.races),e.R7$(3),e.Y8G("ngForOf",s.demons[s.form.controls.race.value]),e.R7$(4),e.JRh(e.i5U(27,27,s.msgs.IncludeIngredients,s.lang)),e.R7$(4),e.JRh(e.i5U(31,30,s.msgs.FilterBy,s.lang)),e.R7$(3),e.JRh(e.i5U(34,33,s.msgs.Elem,s.lang)),e.R7$(3),e.JRh(e.i5U(37,36,s.msgs.Skill,s.lang)),e.R7$(3),e.JRh(e.i5U(40,39,s.msgs.Race,s.lang)),e.R7$(3),e.JRh(e.i5U(43,42,s.msgs.Ingredient,s.lang)),e.R7$(2),e.Y8G("ngForOf",s.form.controls.ingreds.controls),e.R7$(1),e.Y8G("ngIf",s.recipe))},dependencies:[T.Sq,T.bT,j.qT,j.xH,j.y7,j.Zm,j.wz,j.BC,j.cb,j.j4,j.JD,j.$R,j.v8,J.uz],styles:["ul[_ngcontent-%COMP%]{padding:0 1em;list-style:none}td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-height:25px;width:100%}"],changeDetection:0})}}return o})()}}]);