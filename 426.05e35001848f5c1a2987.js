(self.webpackChunkmegaten_fusion_tool=self.webpackChunkmegaten_fusion_tool||[]).push([[426],{628:(t,e,n)=>{"use strict";n.d(e,{N:()=>Z});var i=n(5614),s=n(1116),o=n(6101);function r(t,e){if(1&t&&(i.TgZ(0,"th",4),i._uU(1,"Inheritable Skills"),i.qZA()),2&t){const t=i.oxw();i.uIk("colspan",t.inheritHeaders.length)}}function l(t,e){if(1&t&&(i.TgZ(0,"th",4),i._uU(1),i.qZA()),2&t){const t=i.oxw();i.uIk("colspan",t.inheritHeaders.length),i.xp6(1),i.hij(" ",t.langEn?"Skill Affinities":"\u30b9\u30ad\u30eb\u9069\u6b63"," ")}}function c(t,e){if(1&t&&(i.ynx(0),i._uU(1),i.BQk()),2&t){const t=i.oxw().$implicit;i.xp6(1),i.Oqu(t)}}function a(t,e){if(1&t&&(i.TgZ(0,"div"),i._uU(1),i.qZA()),2&t){const t=i.oxw().$implicit;i.Gre("element-icon ",t,""),i.xp6(1),i.Oqu(t)}}function h(t,e){if(1&t&&(i.TgZ(0,"th"),i.YNc(1,c,2,1,"ng-container",3),i.YNc(2,a,2,4,"div",5),i.qZA()),2&t){const t=i.oxw();i.Udp("width",100/t.inheritHeaders.length,"%"),i.xp6(1),i.Q6J("ngIf",!t.hasIcons),i.xp6(1),i.Q6J("ngIf",t.hasIcons)}}function g(t,e){if(1&t&&(i.TgZ(0,"td"),i._uU(1),i.qZA()),2&t){const t=e.$implicit;i.Udp("color",t?null:"transparent"),i.xp6(1),i.hij(" ",t?"yes":"no"," ")}}function f(t,e){if(1&t&&(i.TgZ(0,"tr"),i.YNc(1,g,2,3,"td",6),i.qZA()),2&t){const t=i.oxw();i.xp6(1),i.Q6J("ngForOf",t.inherits)}}function u(t,e){if(1&t&&(i.TgZ(0,"td"),i.ALo(1,"roundInheritPercent"),i._uU(2),i.qZA()),2&t){const t=e.$implicit;i.Gre("affinity",i.lcZ(1,4,100*t),""),i.xp6(2),i.hij(" ",100*t,"% ")}}function p(t,e){if(1&t&&(i.TgZ(0,"tr"),i.YNc(1,u,3,6,"td",7),i.qZA()),2&t){const t=i.oxw();i.xp6(1),i.Q6J("ngForOf",t.inherits)}}function m(t,e){if(1&t&&(i.TgZ(0,"td"),i._uU(1),i.ALo(2,"affinityToString"),i.qZA()),2&t){const t=e.$implicit;i.Gre("affinity",t,""),i.xp6(1),i.hij(" ",i.lcZ(2,4,t)," ")}}function d(t,e){if(1&t&&(i.TgZ(0,"tr"),i.YNc(1,m,3,6,"td",7),i.qZA()),2&t){const t=i.oxw();i.xp6(1),i.Q6J("ngForOf",t.inherits)}}let Z=(()=>{class t{constructor(){this.inheritHeaders=[],this.inherits=[],this.hasChance=!1,this.hasIcons=!0,this.hasLvls=!1,this.langEn=!0}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-demon-inherits"]],inputs:{inheritHeaders:"inheritHeaders",inherits:"inherits",hasChance:"hasChance",hasIcons:"hasIcons",hasLvls:"hasLvls",langEn:"langEn"},decls:11,vars:6,consts:[[1,"entry-table"],["class","title",4,"ngIf"],[3,"width",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"title"],[3,"class",4,"ngIf"],[3,"color",4,"ngFor","ngForOf"],[3,"class",4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(i.TgZ(0,"table",0),i.TgZ(1,"thead"),i.TgZ(2,"tr"),i.YNc(3,r,2,1,"th",1),i.YNc(4,l,2,2,"th",1),i.qZA(),i.TgZ(5,"tr"),i.YNc(6,h,3,4,"th",2),i.qZA(),i.qZA(),i.TgZ(7,"tbody"),i.YNc(8,f,2,1,"tr",3),i.YNc(9,p,2,1,"tr",3),i.YNc(10,d,2,1,"tr",3),i.qZA(),i.qZA()),2&t&&(i.xp6(3),i.Q6J("ngIf",!e.hasLvls),i.xp6(1),i.Q6J("ngIf",e.hasLvls&&e.inheritHeaders.length),i.xp6(2),i.Q6J("ngForOf",e.inheritHeaders),i.xp6(2),i.Q6J("ngIf",!e.hasLvls&&!e.hasChance),i.xp6(1),i.Q6J("ngIf",e.hasChance),i.xp6(1),i.Q6J("ngIf",e.hasLvls))},directives:[s.O5,s.sg],pipes:[o.DY,o.JZ],encapsulation:2,changeDetection:0}),t})()},7967:(t,e,n)=>{"use strict";n.d(e,{R:()=>f});var i=n(5614),s=n(9624),o=n(3522),r=n(1116);function l(t,e){if(1&t&&(i.TgZ(0,"th"),i._uU(1),i.qZA()),2&t){const t=e.$implicit,n=i.oxw();i.xp6(1),i.Oqu(t.slice(0,n.nameCut))}}function c(t,e){if(1&t&&(i.TgZ(0,"td",4),i._uU(1),i.qZA()),2&t){const t=e.$implicit,n=i.oxw(2);i.Q6J("ngClass",t.slice(0,4)),i.xp6(1),i.Oqu(t.slice(4,n.nameCut+4))}}function a(t,e){if(1&t&&(i.TgZ(0,"tr"),i.TgZ(1,"th"),i._uU(2),i.qZA(),i.YNc(3,c,2,2,"td",3),i.TgZ(4,"th"),i._uU(5),i.qZA(),i.qZA()),2&t){const t=e.$implicit;i.xp6(2),i.Oqu(t[0]),i.xp6(1),i.Q6J("ngForOf",t.slice(1,t.length-1)),i.xp6(2),i.Oqu(t[t.length-1])}}function h(t,e){if(1&t&&(i.TgZ(0,"th"),i._uU(1),i.qZA()),2&t){const t=e.$implicit,n=i.oxw();i.xp6(1),i.Oqu(t.slice(0,n.nameCut))}}function g(t,e){if(1&t&&(i.TgZ(0,"tr"),i.TgZ(1,"th",0),i._uU(2),i.qZA(),i.qZA()),2&t){const t=i.oxw();i.xp6(1),i.uIk("colspan",t.table[0].length),i.xp6(1),i.AsE("",t.appName," ",t.tripTitle,"")}}let f=(()=>{class t{constructor(t,e){this.title2=t,this.route=e,this.normTitle="Normal Fusions",this.tripTitle="",this.isPersona=!1,this.filterDarks=!0,this.langEn=!0,this.subscriptions=[],this.table=[],this.nameCut=4}ngOnInit(){this.subscriptions.push(this.route.parent.data.subscribe(t=>{this.appName=t.appName||"Shin Megami Tensei",this.nameCut=this.langEn?4:2,this.title2.setTitle(this.langEn?`Fusion Chart - ${this.appName} Fusion Calculator`:`\u5408\u4f53\u8868 ${this.appName} \u5408\u4f53\u30a2\u30d7\u30ea`)}))}ngOnChanges(){this.normChart&&this.fillFusionChart()}ngOnDestroy(){for(const t of this.subscriptions)t.unsubscribe()}fillFusionChart(){const e="noneNone",n=t.RESULT_COLORS.reduce((t,[e,n])=>n.reduce((t,n)=>(t[n]=e,t),t),{}),i=this.normChart.elementDemons;let s=[],o=this.normChart.races,r=[];this.filterDarks&&(s=this.normChart.races.filter(t=>this.normChart.getLightDark(t)>0),o=this.normChart.races.filter(t=>0===this.normChart.getLightDark(t)),r=this.normChart.races.filter(t=>-1===this.normChart.getLightDark(t)),0===r.length&&s.length>0&&(s=this.normChart.races.filter(t=>this.normChart.getLightDark(t)>-1),o=[],r=this.normChart.races.filter(t=>this.normChart.getLightDark(t)<-1)));const l=s.length-r.length,c=s.concat(o,i),a=r.length?r.concat(Array(c.length-r.length).fill("")):c,h=this.mitaTable?c:s.concat(o,Array(i.length).fill("")),g=this.mitaTable||r.length?Array(l).fill("").concat(r,o,i):c;this.table=[[""].concat(c,[""])];for(let t=0;t<g.length;t++){const s=Array(c.length+2).fill("empt-"),o=g[t],r=h[t],f=-1!==i.indexOf(o),u=-1!==i.indexOf(r);this.table.push(s),s[0]=o,s[s.length-1]=r;for(let l=t;l<c.length;l++){const t=c[l],o=-1!==i.indexOf(t);if(o&&u){const o=i.indexOf(r),c=i.indexOf(t),a=this.mitaTable[o][c-o-1];s[l+1]=a?(n[a]||"norm")+a:e}else if(o&&r){const i=this.normChart.getElemFusions(t)[r];s[l+1]=i?(n[i]||"rank")+(i>0?"+":"")+i.toString():e}else if(t&&r){const i=this.isPersona&&t===r?t:this.normChart.getRaceFusion(t,r);s[l+1]=i?(n[i]||(t===r?"elem":"norm"))+i:e}}if(this.tripChart)for(let i=0;i<=t-l;i++){const t=a[i];if(t&&f){const r=this.tripChart.getElemFusions(o)[t];s[i+1]=r?(n[r]||"rank")+(r>0?"+":"")+r.toString():e}else if(t&&o){const r=this.tripChart.getRaceFusion(t,o);s[i+1]=r?(n[r]||(t===o?"elem":"trip"))+r:e}}if(-1!==o.indexOf(" x ")){const[t,e]=o.split(" x "),n=t.slice(0,3)+"x"+e.slice(0,3);s[0]=n,s[s.length-1]=n}else if(-1!==o.indexOf(" ")){const t=o.split(" ")[0];s[0]=t,s[s.length-1]=t}}for(let t=0;t<this.table[0].length;t++){const e=this.table[0][t];if(-1!==e.indexOf(" x ")){const[n,i]=e.split(" x ");this.table[0][t]=n.slice(0,2)+i.slice(0,2)}}this.table.push([""].concat(a,[""]))}}return t.RESULT_COLORS=Object.entries({oran:["-2","Erthys","Gnome","Saki","Saki Mitama","Random","\u30a2\u30fc\u30b7\u30fc\u30ba","\u30ce\u30fc\u30e0","\u30b5\u30ad\u30df\u30bf\u30de"],redd:["-1","Flaemis","Salamander","Ara ","Ara Mitama","Fiend","\u30d5\u30ec\u30a4\u30df\u30fc\u30ba","\u30b5\u30e9\u30de\u30f3\u30c0\u30fc","\u30a2\u30e9\u30df\u30bf\u30de"],gree:["1","Aeros","Sylph","Kusi","Kusi Mitama","UMA","\u30a8\u30a2\u30ed\u30b9","\u30b7\u30eb\u30ad\u30fc","\u30af\u30b7\u30df\u30bf\u30de"],blue:["2","Aquans","Undine","Nigi","Nigi Mitama","Enigma","\u30a2\u30af\u30a2\u30f3\u30ba","\u30a6\u30f3\u30c7\u30a3\u30fc\u30cd","\u30cb\u30ae\u30df\u30bf\u30de"]}),t.\u0275fac=function(e){return new(e||t)(i.Y36(s.Dx),i.Y36(o.gz))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-fusion-chart"]],inputs:{normChart:"normChart",tripChart:"tripChart",mitaTable:"mitaTable",normTitle:"normTitle",tripTitle:"tripTitle",isPersona:"isPersona",filterDarks:"filterDarks",langEn:"langEn",counter:"counter"},features:[i.TTD],decls:12,vars:7,consts:[[1,"title"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(t,e){1&t&&(i.TgZ(0,"table"),i.TgZ(1,"tbody"),i.TgZ(2,"tr"),i.TgZ(3,"th",0),i._uU(4),i.qZA(),i.qZA(),i.TgZ(5,"tr"),i.YNc(6,l,2,1,"th",1),i.qZA(),i.YNc(7,a,6,3,"tr",1),i.TgZ(8,"tr"),i.YNc(9,h,2,1,"th",1),i.qZA(),i.YNc(10,g,3,3,"tr",2),i.qZA(),i._UZ(11,"tbody"),i.qZA()),2&t&&(i.xp6(3),i.uIk("colspan",e.table[0].length),i.xp6(1),i.AsE("",e.appName," ",e.normTitle,""),i.xp6(2),i.Q6J("ngForOf",e.table[0]),i.xp6(1),i.Q6J("ngForOf",e.table.slice(1,e.table.length-1)),i.xp6(2),i.Q6J("ngForOf",e.table[e.table.length-1]),i.xp6(1),i.Q6J("ngIf",e.tripTitle))},directives:[r.sg,r.O5,r.mk],styles:["table[_ngcontent-%COMP%]{width:auto;margin:0 auto;white-space:nowrap}td.elem[_ngcontent-%COMP%]{color:#0f0}td.trip[_ngcontent-%COMP%]{color:#d3d3d3}td.oran[_ngcontent-%COMP%]{color:orange}td.redd[_ngcontent-%COMP%]{color:red}td.gree[_ngcontent-%COMP%]{color:#0f0}td.blue[_ngcontent-%COMP%]{color:#0ff}td.empt[_ngcontent-%COMP%], td.none[_ngcontent-%COMP%]{color:transparent}td.empt[_ngcontent-%COMP%]{background-color:initial}"],changeDetection:0}),t})()},3810:(t,e,n)=>{"use strict";n.d(e,{X:()=>F});var i=n(9859);function s(t,e){return parseInt(e.map(e=>t.includes(e)?"1":"0").join(""),2)||0}function o(t,e){return t.map((t,n,i)=>s(i.slice(0,n+1),e))}function r(t,e,n,s,o,r){let c=n,a=[c];const h=s.getSpecialNameEntries(c),g=e[e.length-1];if(0!==h.length&&(c=h.find(t=>0===s.getSpecialNameEntries(t).length),a.unshift(h.filter(t=>t!==c).join(" x ")),a.unshift(c)),t.length>0){const n=function(t,e,n,s,o){const{fusionCalculator:r}=o,l=t.slice(0,1);if(t.length<2)return l;let c=l[0],a=e[0];for(let h=1;h<t.length;h++){const o=t[h],g=e[h],f=r.getFusions(c,n,s).map(t=>(0,i.D0)(t,n)).sort((t,e)=>t.price-e.price);let u=!1;for(const t of f)if(t.name1===o&&(g&n.getDemon(t.name2).inherits)===g){l.push(o),l.push(t.name2),c=l[l.length-1],a=g,u=!0;break}if(u)continue;const p=r.getFusions(o,n,s).reduce((t,e)=>(t[e.name1]=e.name2,t),{});for(const t of f)if(p[t.name2]&&(a&n.getDemon(t.name2).inherits)===a&&(g&n.getDemon(t.name2).inherits)===g){l.push(t.name1),l.push(t.name2),l.push(o),l.push(p[t.name2]),c=l[l.length-1],a=g,u=!0;break}if(!u)return[]}return l}(t,e,s,o,r);if(0===n.length)return[];const h=n[n.length-1];let f=l(h,c,g,s,o,r);if(0===f.length){const t=s.getDemon(c),e=s.getResultDemonLvls(t.race).map(e=>s.reverseLookupDemon(t.race,e)).filter(t=>t!==c);for(const n of o.elementDemons.concat(e)){if((g&s.getDemon(n).inherits)!==g)continue;const t=l(h,n,g,s,o,r),e=l(n,c,g,s,o,r);if(0!==t.length&&0!==e.length){f=t.concat(e.slice(1));break}}}if(0===f.length)return[];a=n.concat(f.slice(1),a.slice(1))}return a}function l(t,e,n,s,o,r){const{fissionCalculator:l,fusionCalculator:c}=r,a=[t];if(t===e)return a;const h=c.getFusions(t,s,o).map(t=>(0,i.D0)(t,s)).sort((t,e)=>t.price-e.price);for(const i of h)if(i.name2===e)return a.push(i.name1),a.push(e),a;const g=l.getFusions(e,s,o).map(t=>(0,i.S6)(t,s)).sort((t,e)=>t.price-e.price);h.sort((t,e)=>e.price-t.price);const f=h.reduce((t,e)=>(t[e.name2]=e.name1,t),{});for(const i of g){if(f[i.name1]&&(n&s.getDemon(i.name1).inherits)===n)return a.push(f[i.name1]),a.push(i.name1),a.push(i.name2),a.push(e),a;if(f[i.name2]&&(n&s.getDemon(i.name2).inherits)===n)return a.push(f[i.name2]),a.push(i.name2),a.push(i.name1),a.push(e),a}return[]}var c=n(5614),a=n(1462),h=n(1116),g=n(6101);function f(t,e){if(1&t&&(c.TgZ(0,"option",15),c._uU(1),c.qZA()),2&t){const t=e.$implicit;c.Q6J("value",t),c.xp6(1),c.Oqu(t)}}function u(t,e){if(1&t&&(c.TgZ(0,"option",16),c._uU(1),c.qZA()),2&t){const t=e.$implicit;c.Q6J("ngValue",t),c.xp6(1),c.Oqu(t.name)}}function p(t,e){if(1&t&&(c.TgZ(0,"option",15),c._uU(1),c.qZA()),2&t){const t=e.index;c.Q6J("value",99-t),c.xp6(1),c.Oqu(99-t)}}function m(t,e){if(1&t&&(c.TgZ(0,"option",15),c._uU(1),c.qZA()),2&t){const t=e.$implicit;c.Q6J("value",t),c.xp6(1),c.Oqu(t)}}function d(t,e){if(1&t&&(c.TgZ(0,"option",16),c._uU(1),c.qZA()),2&t){const t=e.$implicit;c.Q6J("ngValue",t),c.xp6(1),c.Oqu(t.name)}}function Z(t,e){if(1&t&&(c.ynx(0),c.TgZ(1,"td"),c._uU(2),c.ALo(3,"skillCostToString"),c.qZA(),c.TgZ(4,"td"),c._uU(5),c.qZA(),c.TgZ(6,"td"),c._uU(7),c.qZA(),c.BQk()),2&t){const t=e.ngIf;c.xp6(1),c.Udp("color",t.cost?null:"transparent"),c.xp6(1),c.Oqu(c.lcZ(3,5,t.cost)),c.xp6(3),c.Oqu(t.effect),c.xp6(2),c.Oqu(t.target)}}function x(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"tr"),c.TgZ(1,"td"),c.TgZ(2,"select",19),c.NdJ("change",function(){c.CHM(t);const e=c.oxw().$implicit,n=c.oxw();return e.controls.custom.setValue(n.skills[e.controls.elem.value][0])}),c.TgZ(3,"option",20),c._uU(4,"-"),c.qZA(),c.YNc(5,m,2,2,"option",4),c.qZA(),c.qZA(),c.TgZ(6,"td"),c.TgZ(7,"select",21),c.YNc(8,d,2,2,"option",6),c.qZA(),c.qZA(),c.YNc(9,Z,8,7,"ng-container",18),c.qZA()}if(2&t){const t=c.oxw().$implicit,e=c.oxw();c.xp6(5),c.Q6J("ngForOf",e.elems),c.xp6(3),c.Q6J("ngForOf",e.skills[t.controls.elem.value]),c.xp6(1),c.Q6J("ngIf",t.controls.custom.value)}}function q(t,e){if(1&t&&(c.ynx(0,17),c.YNc(1,x,10,3,"tr",18),c.BQk()),2&t){const t=e.index,n=c.oxw();c.Q6J("formGroupName",t),c.xp6(1),c.Q6J("ngIf",t<n.maxSkills)}}function T(t,e){if(1&t&&(c.TgZ(0,"li"),c._uU(1),c.qZA()),2&t){const t=e.$implicit;c.xp6(1),c.Oqu(t)}}function A(t,e){if(1&t&&(c.TgZ(0,"td",26),c.TgZ(1,"ul"),c.YNc(2,T,2,1,"li",27),c.qZA(),c.qZA()),2&t){const t=c.oxw(2);c.xp6(2),c.Q6J("ngForOf",t.recipeLeft)}}function k(t,e){1&t&&(c.TgZ(0,"td",28),c._uU(1,"No chains found"),c.qZA())}function O(t,e){if(1&t&&(c.TgZ(0,"li"),c._uU(1),c.qZA()),2&t){const t=e.$implicit;c.xp6(1),c.Oqu(t)}}function C(t,e){if(1&t&&(c.TgZ(0,"td",26),c.TgZ(1,"ul"),c.YNc(2,O,2,1,"li",27),c.qZA(),c.qZA()),2&t){const t=c.oxw(2);c.xp6(2),c.Q6J("ngForOf",t.recipeRight)}}function b(t,e){1&t&&(c.TgZ(0,"td",28),c._uU(1,"No chains found"),c.qZA())}function _(t,e){if(1&t&&(c.ynx(0),c._uU(1),c._UZ(2,"br"),c._uU(3),c.BQk()),2&t){const t=c.oxw(2);c.xp6(1),c.AsE(" ",t.recipeResult.join(" x ")," = ",t.recipe.result,""),c.xp6(2),c.hij(" [",t.resultSkills.join(", "),"] ")}}function N(t,e){1&t&&(c.ynx(0),c._uU(1,"No recipes found"),c.BQk())}function D(t,e){if(1&t&&(c.TgZ(0,"table",1),c.TgZ(1,"tr"),c.TgZ(2,"th",22),c._uU(3,"Fusion Recipe"),c.qZA(),c.qZA(),c.TgZ(4,"tr"),c.TgZ(5,"th"),c._uU(6,"Left Chain"),c.qZA(),c.TgZ(7,"th"),c._uU(8,"Right Chain"),c.qZA(),c.qZA(),c.TgZ(9,"tr"),c.YNc(10,A,3,1,"td",23),c.YNc(11,k,2,0,"td",24),c.YNc(12,C,3,1,"td",23),c.YNc(13,b,2,0,"td",24),c.qZA(),c.TgZ(14,"tr"),c.TgZ(15,"td",25),c.YNc(16,_,4,3,"ng-container",18),c.YNc(17,N,2,0,"ng-container",18),c.qZA(),c.qZA(),c.qZA()),2&t){const t=c.oxw();c.xp6(10),c.Q6J("ngIf",t.recipeLeft.length),c.xp6(1),c.Q6J("ngIf",!t.recipeLeft.length),c.xp6(1),c.Q6J("ngIf",t.recipeRight.length),c.xp6(1),c.Q6J("ngIf",!t.recipeRight.length),c.xp6(3),c.Q6J("ngIf",t.recipe.stepR.length),c.xp6(1),c.Q6J("ngIf",!t.recipe.stepR.length)}}let F=(()=>{class t{constructor(t){this.fb=t,this.defaultDemon="Pixie",this.maxSkills=8,this.internalMaxSkills=9,this.range99=Array(99),this.demons={},this.skills={},this.blankDemon={name:"-",race:"-",lvl:0,currLvl:0,price:0,inherits:0,skills:{},stats:[],resists:[],affinities:[],fusion:"normal",prereq:""},this.blankSkill={name:"-",element:"-",rank:99,cost:0,effect:"",target:"",level:0,learnedBy:[]},this.createForm()}ngOnChanges(){this.initDropdowns()}createForm(){const t=[];for(let e=0;e<this.internalMaxSkills;e++)t.push(this.fb.group({elem:"-",custom:this.blankSkill}));this.form=this.fb.group({race:"-",demon:this.blankDemon,skills:this.fb.array(t)}),this.form.valueChanges.subscribe(t=>{if(this.form.valid){const e=t.skills.map(t=>t.custom.name).filter(t=>"-"!==t);this.updateRecipe(function(t,e,n,l,c){const{fissionCalculator:a,inheritElems:h,restrictInherits:g,triExclusiveRaces:f,triFissionCalculator:u}=c,{normalChart:p}=l,m=n.getDemon(t),d=e.map(t=>n.getSkill(t)).filter((t,e,n)=>t.rank<50&&t.learnedBy.length>0&&!m.skills.hasOwnProperty(t.name)&&n.indexOf(t)===e),Z=s(d.map(t=>t.element),h);let x=n.getSpecialNameEntries(t);if(x.length<2&&f.includes(m.race)){const e=u.getFusions(t,n,l).map(t=>(0,i.Aw)(t,n)).sort((t,e)=>t.price-e.price).find(t=>!((Z&(t.d1.inherits|t.d2.inherits|t.d3.inherits))!==Z||"special"!==t.d1.fusion&&f.includes(t.d1.race)||"special"!==t.d2.fusion&&f.includes(t.d2.race)||"special"!==t.d3.fusion&&f.includes(t.d3.race)));e&&(x=[e.d1.name,e.d2.name,e.d3.name])}if(x.length<2){const e=a.getFusions(t,n,p).map(t=>(0,i.S6)(t,n)).sort((t,e)=>t.price-e.price).find(t=>!((Z&(n.getDemon(t.name1).inherits|n.getDemon(t.name2).inherits))!==Z||"normal"!==n.getDemon(t.name1).fusion&&"special"!==n.getDemon(t.name1).fusion||"normal"!==n.getDemon(t.name2).fusion&&"special"!==n.getDemon(t.name2).fusion));e&&(x=[e.name1,e.name2])}console.log(x);const q=x.map(t=>n.getDemon(t)).sort((t,e)=>t.price-e.price),T={},A={},k=[];for(const i of d){let t=!1;for(const e of q)if(e.skills.hasOwnProperty(i.name)){t=!0,A[i.name]=e.name;break}t||k.push(i)}for(const i of k){const t=i.learnedBy.map(t=>n.getDemon(t.demon));T[i.name]=t.length>1?t.find(t=>Object.keys(p.getRaceFusions(t.race)).length>0&&"excluded"!==t.fusion).name:t[0].name}const O=s(k.map(t=>t.element),h),C=k.map(t=>s([t.element],h));let b,_,N=0;for(let i=0;i<q.length;i++){const t=q[i];for(const e of q.slice(i+1))if((O&(t.inherits|e.inherits))===O){const n=(O&t.inherits).toString(2).split("1").length*(O&e.inherits).toString(2).split("1").length;N<n&&(b=t,_=e,N=n)}}const D={chain1:[],chain2:[],stepR:x,skills:Object.assign(T,A),result:t};if(!b)return D;const F=Object.values(T).filter((t,e,n)=>n.indexOf(t)===e),U=Math.ceil(F.length/2);F.sort((t,e)=>p.getLightDark(n.getDemon(t).race)-p.getLightDark(n.getDemon(e).race));let y=F.slice(0,U),J=Array(y.length).fill(0),v=F.slice(U),Q=Array(v.length).fill(0);if(g){const{left:t,right:e}=function(t,e,n,i){let s=[],o=[];const r=[],l=[],c={},a=[];for(let h=0;h<n.length;h++){const t=n[h];0!==t?(c.hasOwnProperty(t)||(c[t]=[]),c[t].push(i[h])):a.push(i[h])}for(const h of Object.keys(c).sort()){const n=parseInt(h);r.length<=l.length?(n&t)===n?r.push(n):l.push(n):(n&e)===n?l.push(n):r.push(n)}for(const h of r)s=s.concat(c[h]);for(const h of l)o=o.concat(c[h]);for(const h of a)s.length<o.length?s.push(h):o.push(h);return{left:s.reverse(),right:o.reverse()}}(b.inherits,_.inherits,C,k.map(t=>t.name));y=t.map(t=>T[t]),J=o(t.map(t=>n.getSkill(t).element),h),v=e.map(t=>T[t]),Q=o(e.map(t=>n.getSkill(t).element),h)}return D.chain1=r(y,J,b.name,n,p,c),D.chain2=r(v,Q,_.name,n,p,c),D}(t.demon.name,e,this.compendium,this.squareChart,this.recipeConfig))}})}updateRecipe(t){const e={};for(const[n,i]of Object.entries(t.skills)){e[i]||(e[i]=[]);const t=this.compendium.getDemon(i).skills[n];e[i].push(n+(t?` (${t})`:""))}this.recipe=t,this.recipeLeft=this.decodeRecipechain(t.chain1,e),this.recipeRight=this.decodeRecipechain(t.chain2,e),this.resultSkills=[],this.recipeResult=[];for(const n of t.stepR)this.recipeResult.push(e[n]?`${n} [${e[n].join(", ")}]`:n);for(const[n,i]of Object.entries(this.compendium.getDemon(t.result).skills).filter(t=>t[1]<2e3).sort((t,e)=>t[1]-e[1]))this.resultSkills.push(n+(i?` (${i})`:""))}decodeRecipechain(t,e){const n=[];for(let i=0;i<t.length-2;i+=2){const s=e[t[i]]?"["+e[t[i]].join(", ")+"] ":"",o=e[t[i+1]]?"["+e[t[i+1]].join(", ")+"] ":"";n.push(`${t[i]} ${s}x ${t[i+1]} ${o}= ${t[i+2]}`)}return n}initDropdowns(){if(this.recipeConfig&&this.compendium&&this.squareChart){this.demons={},this.skills={"-":[this.blankSkill]};for(const t of this.compendium.allDemons)"normal"!==t.fusion&&"special"!==t.fusion||t.isEnemy||(this.demons[t.race]||(this.demons[t.race]=[]),this.demons[t.race].push(t));for(const t of this.compendium.allSkills.filter(t=>t.rank<50&&t.learnedBy.length>0))this.skills[t.element]||(this.skills[t.element]=[]),this.skills[t.element].push(t);for(const t of Object.values(this.demons))t.sort((t,e)=>e.lvl-t.lvl);for(const t of Object.values(this.skills))t.sort((t,e)=>t.rank-e.rank);this.races=this.recipeConfig.races.filter(t=>this.demons[t]),this.elems=this.recipeConfig.skillElems.filter(t=>this.skills[t]),this.setDemon(this.compendium.getDemon(this.defaultDemon))}}setDemon(t){const e=[],{inheritElems:n}=this.recipeConfig,i=Object.entries(t.skills).filter(t=>0===t[1]).map(t=>this.compendium.getSkill(t[0]));for(let s=0;s<n.length;s++)t.inherits&1<<s||e.push(n[n.length-s-1]);this.skills[this.blankSkill.element]=[this.blankSkill].concat(i),this.elems=this.recipeConfig.skillElems.filter(t=>this.skills[t]&&!e.includes(t)),this.form.patchValue({race:t.race,demon:t,skills:i.concat(Array(this.internalMaxSkills-i.length).fill(this.blankSkill)).map(t=>({elem:"-",custom:t}))})}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(a.qu))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-recipe-generator"]],inputs:{defaultDemon:"defaultDemon",maxSkills:"maxSkills",compendium:"compendium",squareChart:"squareChart",recipeConfig:"recipeConfig"},features:[c.TTD],decls:41,vars:6,consts:[[3,"formGroup"],[1,"entry-table"],["colspan","7",1,"title"],["formControlName","race",3,"change"],[3,"value",4,"ngFor","ngForOf"],["formControlName","demon",3,"change"],[3,"ngValue",4,"ngFor","ngForOf"],["formArrayName","skills",1,"entry-table"],["colspan","6",1,"title"],[2,"width","5%"],[2,"width","15%"],[2,"width","10%"],[2,"width","55%"],[3,"formGroupName",4,"ngFor","ngForOf"],["class","entry-table",4,"ngIf"],[3,"value"],[3,"ngValue"],[3,"formGroupName"],[4,"ngIf"],["formControlName","elem",3,"change"],["value","-"],["formControlName","custom"],["colspan","2",1,"title"],["style","width: 50%",4,"ngIf"],["style","width: 50%","style","padding: 1em; text-align: center;",4,"ngIf"],["colspan","2",2,"padding","1em","text-align","center"],[2,"width","50%"],[4,"ngFor","ngForOf"],[2,"padding","1em","text-align","center"]],template:function(t,e){1&t&&(c.TgZ(0,"form",0),c.TgZ(1,"h2"),c._uU(2,"Recipe Generator"),c.qZA(),c.TgZ(3,"table",1),c.TgZ(4,"tr"),c.TgZ(5,"th",2),c._uU(6,"Demon Entry"),c.qZA(),c.qZA(),c.TgZ(7,"tr"),c.TgZ(8,"th"),c._uU(9,"Race"),c.qZA(),c.TgZ(10,"th"),c._uU(11,"Demon"),c.qZA(),c.TgZ(12,"th"),c._uU(13,"Max Lvl"),c.qZA(),c.qZA(),c.TgZ(14,"tr"),c.TgZ(15,"td"),c.TgZ(16,"select",3),c.NdJ("change",function(){return e.setDemon(e.demons[e.form.controls.race.value][0])}),c.YNc(17,f,2,2,"option",4),c.qZA(),c.qZA(),c.TgZ(18,"td"),c.TgZ(19,"select",5),c.NdJ("change",function(){return e.setDemon(e.form.controls.demon.value)}),c.YNc(20,u,2,2,"option",6),c.qZA(),c.qZA(),c.TgZ(21,"td"),c.TgZ(22,"select"),c.YNc(23,p,2,2,"option",4),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(24,"table",7),c.TgZ(25,"tr"),c.TgZ(26,"th",8),c._uU(27,"Learned Skills"),c.qZA(),c.qZA(),c.TgZ(28,"tr"),c.TgZ(29,"th",9),c._uU(30,"Elem"),c.qZA(),c.TgZ(31,"th",10),c._uU(32,"Name"),c.qZA(),c.TgZ(33,"th",11),c._uU(34,"Cost"),c.qZA(),c.TgZ(35,"th",12),c._uU(36,"Effect"),c.qZA(),c.TgZ(37,"th",10),c._uU(38,"Target"),c.qZA(),c.qZA(),c.YNc(39,q,2,2,"ng-container",13),c.qZA(),c.YNc(40,D,18,6,"table",14),c.qZA()),2&t&&(c.Q6J("formGroup",e.form),c.xp6(17),c.Q6J("ngForOf",e.races),c.xp6(3),c.Q6J("ngForOf",e.demons[e.form.controls.race.value]),c.xp6(3),c.Q6J("ngForOf",e.range99),c.xp6(16),c.Q6J("ngForOf",e.form.controls.skills.controls),c.xp6(1),c.Q6J("ngIf",e.recipe))},directives:[a._Y,a.JL,a.sg,a.EJ,a.JJ,a.u,h.sg,a.CE,h.O5,a.YN,a.Kr,a.x0],pipes:[g.tq],styles:["ul[_ngcontent-%COMP%]{padding:0 1em;list-style:none}td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%}"],changeDetection:0}),t})()}}]);