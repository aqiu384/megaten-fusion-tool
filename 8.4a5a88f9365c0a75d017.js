(self.webpackChunkmegaten_fusion_tool=self.webpackChunkmegaten_fusion_tool||[]).push([[8],{8623:(t,e,n)=>{"use strict";n.d(e,{d:()=>c});var i=n(5614),s=n(9624),o=n(1116);function r(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"tr"),i.TgZ(1,"td"),i.TgZ(2,"label"),i._uU(3),i.TgZ(4,"input",3),i.NdJ("change",function(){const e=i.CHM(t).$implicit;return i.oxw().toggledName.emit(e.name)}),i.qZA(),i.qZA(),i.qZA(),i.qZA()}if(2&t){const t=e.$implicit;i.xp6(3),i.hij("",t.name.split(",").join(", ")," "),i.xp6(1),i.Q6J("checked",t.included)}}let c=(()=>{class t{constructor(t){this.title=t,this.dlcTitle="Included DLC Demons",this.langEn=!0,this.toggledName=new i.vpe}set appTitle(t){this.title.setTitle((this.langEn?"Fusion Settings - ":"\u5408\u4f53\u8a2d\u5b9a ")+t)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(s.Dx))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-demon-dlc-settings"]],inputs:{dlcDemons:"dlcDemons",dlcTitle:"dlcTitle",langEn:"langEn",appTitle:"appTitle"},outputs:{toggledName:"toggledName"},decls:10,vars:2,consts:[[1,"entry-table"],[1,"title"],[4,"ngFor","ngForOf"],["type","checkbox",3,"checked","change"]],template:function(t,e){1&t&&(i.ynx(0),i.TgZ(1,"h2"),i._uU(2),i.qZA(),i.TgZ(3,"table",0),i.TgZ(4,"thead"),i.TgZ(5,"tr"),i.TgZ(6,"th",1),i._uU(7,"DLC"),i.qZA(),i.qZA(),i.qZA(),i.TgZ(8,"tbody"),i.YNc(9,r,5,2,"tr",2),i.qZA(),i.qZA(),i.BQk()),2&t&&(i.xp6(2),i.Oqu(e.dlcTitle),i.xp6(7),i.Q6J("ngForOf",e.dlcDemons))},directives:[o.sg],encapsulation:2,changeDetection:0}),t})()},628:(t,e,n)=>{"use strict";n.d(e,{N:()=>Z});var i=n(5614),s=n(1116),o=n(6101);function r(t,e){if(1&t&&(i.TgZ(0,"th",4),i._uU(1,"Inheritable Skills"),i.qZA()),2&t){const t=i.oxw();i.uIk("colspan",t.inheritHeaders.length)}}function c(t,e){if(1&t&&(i.TgZ(0,"th",4),i._uU(1),i.qZA()),2&t){const t=i.oxw();i.uIk("colspan",t.inheritHeaders.length),i.xp6(1),i.hij(" ",t.langEn?"Skill Affinities":"\u30b9\u30ad\u30eb\u9069\u6b63"," ")}}function l(t,e){if(1&t&&(i.ynx(0),i._uU(1),i.BQk()),2&t){const t=i.oxw().$implicit;i.xp6(1),i.Oqu(t)}}function a(t,e){if(1&t&&(i.TgZ(0,"div"),i._uU(1),i.qZA()),2&t){const t=i.oxw().$implicit;i.Gre("element-icon ",t,""),i.xp6(1),i.Oqu(t)}}function h(t,e){if(1&t&&(i.TgZ(0,"th"),i.YNc(1,l,2,1,"ng-container",3),i.YNc(2,a,2,4,"div",5),i.qZA()),2&t){const t=i.oxw();i.Udp("width",100/t.inheritHeaders.length,"%"),i.xp6(1),i.Q6J("ngIf",!t.hasIcons),i.xp6(1),i.Q6J("ngIf",t.hasIcons)}}function u(t,e){if(1&t&&(i.TgZ(0,"td"),i._uU(1),i.qZA()),2&t){const t=e.$implicit;i.Udp("color",t?null:"transparent"),i.xp6(1),i.hij(" ",t?"yes":"no"," ")}}function g(t,e){if(1&t&&(i.TgZ(0,"tr"),i.YNc(1,u,2,3,"td",6),i.qZA()),2&t){const t=i.oxw();i.xp6(1),i.Q6J("ngForOf",t.inherits)}}function f(t,e){if(1&t&&(i.TgZ(0,"td"),i.ALo(1,"roundInheritPercent"),i._uU(2),i.qZA()),2&t){const t=e.$implicit;i.Gre("affinity",i.lcZ(1,4,100*t),""),i.xp6(2),i.hij(" ",100*t,"% ")}}function p(t,e){if(1&t&&(i.TgZ(0,"tr"),i.YNc(1,f,3,6,"td",7),i.qZA()),2&t){const t=i.oxw();i.xp6(1),i.Q6J("ngForOf",t.inherits)}}function m(t,e){if(1&t&&(i.TgZ(0,"td"),i._uU(1),i.ALo(2,"affinityToString"),i.qZA()),2&t){const t=e.$implicit;i.Gre("affinity",t,""),i.xp6(1),i.hij(" ",i.lcZ(2,4,t)," ")}}function d(t,e){if(1&t&&(i.TgZ(0,"tr"),i.YNc(1,m,3,6,"td",7),i.qZA()),2&t){const t=i.oxw();i.xp6(1),i.Q6J("ngForOf",t.inherits)}}let Z=(()=>{class t{constructor(){this.inheritHeaders=[],this.inherits=[],this.hasChance=!1,this.hasIcons=!0,this.hasLvls=!1,this.langEn=!0}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-demon-inherits"]],inputs:{inheritHeaders:"inheritHeaders",inherits:"inherits",hasChance:"hasChance",hasIcons:"hasIcons",hasLvls:"hasLvls",langEn:"langEn"},decls:11,vars:6,consts:[[1,"entry-table"],["class","title",4,"ngIf"],[3,"width",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"title"],[3,"class",4,"ngIf"],[3,"color",4,"ngFor","ngForOf"],[3,"class",4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(i.TgZ(0,"table",0),i.TgZ(1,"thead"),i.TgZ(2,"tr"),i.YNc(3,r,2,1,"th",1),i.YNc(4,c,2,2,"th",1),i.qZA(),i.TgZ(5,"tr"),i.YNc(6,h,3,4,"th",2),i.qZA(),i.qZA(),i.TgZ(7,"tbody"),i.YNc(8,g,2,1,"tr",3),i.YNc(9,p,2,1,"tr",3),i.YNc(10,d,2,1,"tr",3),i.qZA(),i.qZA()),2&t&&(i.xp6(3),i.Q6J("ngIf",!e.hasLvls),i.xp6(1),i.Q6J("ngIf",e.hasLvls&&e.inheritHeaders.length),i.xp6(2),i.Q6J("ngForOf",e.inheritHeaders),i.xp6(2),i.Q6J("ngIf",!e.hasLvls&&!e.hasChance),i.xp6(1),i.Q6J("ngIf",e.hasChance),i.xp6(1),i.Q6J("ngIf",e.hasLvls))},directives:[s.O5,s.sg],pipes:[o.DY,o.JZ],encapsulation:2,changeDetection:0}),t})()},2573:(t,e,n)=>{"use strict";n.d(e,{O:()=>p});var i=n(5614),s=n(1116);function o(t,e){if(1&t&&(i.TgZ(0,"h2"),i._uU(1),i.qZA()),2&t){const t=i.oxw();i.xp6(1),i.Oqu(t.title)}}function r(t,e){if(1&t&&(i.TgZ(0,"th"),i._uU(1),i.qZA()),2&t){const t=i.oxw();i.xp6(1),i.Oqu(t.langEn?"Price":"\u4fa1\u683c")}}function c(t,e){if(1&t&&(i.TgZ(0,"th"),i._uU(1),i.qZA()),2&t){const t=e.$implicit;i.xp6(1),i.Oqu(t)}}function l(t,e){1&t&&(i.TgZ(0,"th"),i._uU(1,"Inherits"),i.qZA())}function a(t,e){if(1&t&&(i.TgZ(0,"th"),i._uU(1),i.qZA()),2&t){const t=e.$implicit;i.xp6(1),i.Oqu(t)}}function h(t,e){if(1&t&&(i.TgZ(0,"td"),i._uU(1),i.qZA()),2&t){const t=i.oxw();i.xp6(1),i.Oqu(t.price)}}function u(t,e){if(1&t&&(i.TgZ(0,"td"),i._uU(1),i.qZA()),2&t){const t=e.$implicit;i.xp6(1),i.Oqu(t)}}function g(t,e){if(1&t&&(i.TgZ(0,"td"),i.TgZ(1,"div"),i._uU(2),i.qZA(),i.qZA()),2&t){const t=i.oxw();i.xp6(1),i.Gre("element-icon i",t.inherits,""),i.xp6(1),i.Oqu(t.inherits)}}const f=["*"];let p=(()=>{class t{constructor(){this.title="Demon Entry",this.statHeaders=[],this.stats=[],this.fusionHeaders=[],this.price=0,this.langEn=!0}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-demon-stats"]],inputs:{title:"title",statHeaders:"statHeaders",stats:"stats",fusionHeaders:"fusionHeaders",inherits:"inherits",price:"price",langEn:"langEn"},ngContentSelectors:f,decls:19,vars:10,consts:[[4,"ngIf"],[1,"entry-table"],[1,"title"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(i.F$t(),i.ynx(0),i.YNc(1,o,2,1,"h2",0),i.TgZ(2,"table",1),i.TgZ(3,"thead"),i.TgZ(4,"tr"),i.TgZ(5,"th",2),i._uU(6),i.qZA(),i.qZA(),i.TgZ(7,"tr"),i.YNc(8,r,2,1,"th",0),i.YNc(9,c,2,1,"th",3),i.YNc(10,l,2,0,"th",0),i.YNc(11,a,2,1,"th",3),i.qZA(),i.qZA(),i.TgZ(12,"tbody"),i.TgZ(13,"tr"),i.YNc(14,h,2,1,"td",0),i.YNc(15,u,2,1,"td",3),i.YNc(16,g,3,4,"td",0),i.Hsn(17),i.qZA(),i.qZA(),i.qZA(),i.GkF(18),i.BQk()),2&t&&(i.xp6(1),i.Q6J("ngIf",e.title.includes("Lvl")),i.xp6(4),i.uIk("colSpan",e.stats.length+e.fusionHeaders.length+(e.inherits?1:0)+(e.price?1:0)),i.xp6(1),i.hij(" ",e.title.includes("Lvl")?e.langEn?"Stats":"\u30b9\u30c6\u30fc\u30bf\u30b9":e.title," "),i.xp6(2),i.Q6J("ngIf",e.price),i.xp6(1),i.Q6J("ngForOf",e.statHeaders),i.xp6(1),i.Q6J("ngIf",e.inherits),i.xp6(1),i.Q6J("ngForOf",e.fusionHeaders),i.xp6(3),i.Q6J("ngIf",e.price),i.xp6(1),i.Q6J("ngForOf",e.stats),i.xp6(1),i.Q6J("ngIf",e.inherits))},directives:[s.O5,s.sg],encapsulation:2,changeDetection:0}),t})()},7967:(t,e,n)=>{"use strict";n.d(e,{R:()=>g});var i=n(5614),s=n(9624),o=n(3522),r=n(1116);function c(t,e){if(1&t&&(i.TgZ(0,"th"),i._uU(1),i.qZA()),2&t){const t=e.$implicit,n=i.oxw();i.xp6(1),i.Oqu(t.slice(0,n.nameCut))}}function l(t,e){if(1&t&&(i.TgZ(0,"td",4),i._uU(1),i.qZA()),2&t){const t=e.$implicit,n=i.oxw(2);i.Q6J("ngClass",t.slice(0,4)),i.xp6(1),i.Oqu(t.slice(4,n.nameCut+4))}}function a(t,e){if(1&t&&(i.TgZ(0,"tr"),i.TgZ(1,"th"),i._uU(2),i.qZA(),i.YNc(3,l,2,2,"td",3),i.TgZ(4,"th"),i._uU(5),i.qZA(),i.qZA()),2&t){const t=e.$implicit;i.xp6(2),i.Oqu(t[0]),i.xp6(1),i.Q6J("ngForOf",t.slice(1,t.length-1)),i.xp6(2),i.Oqu(t[t.length-1])}}function h(t,e){if(1&t&&(i.TgZ(0,"th"),i._uU(1),i.qZA()),2&t){const t=e.$implicit,n=i.oxw();i.xp6(1),i.Oqu(t.slice(0,n.nameCut))}}function u(t,e){if(1&t&&(i.TgZ(0,"tr"),i.TgZ(1,"th",0),i._uU(2),i.qZA(),i.qZA()),2&t){const t=i.oxw();i.xp6(1),i.uIk("colspan",t.table[0].length),i.xp6(1),i.AsE("",t.appName," ",t.tripTitle,"")}}let g=(()=>{class t{constructor(t,e){this.title2=t,this.route=e,this.normTitle="Normal Fusions",this.tripTitle="",this.isPersona=!1,this.filterDarks=!0,this.langEn=!0,this.subscriptions=[],this.table=[],this.nameCut=4}ngOnInit(){this.subscriptions.push(this.route.parent.data.subscribe(t=>{this.appName=t.appName||"Shin Megami Tensei",this.nameCut=this.langEn?4:2,this.title2.setTitle(this.langEn?`Fusion Chart - ${this.appName} Fusion Calculator`:`\u5408\u4f53\u8868 ${this.appName} \u5408\u4f53\u30a2\u30d7\u30ea`)}))}ngOnChanges(){this.normChart&&this.fillFusionChart()}ngOnDestroy(){for(const t of this.subscriptions)t.unsubscribe()}fillFusionChart(){const e="noneNone",n=t.RESULT_COLORS.reduce((t,[e,n])=>n.reduce((t,n)=>(t[n]=e,t),t),{}),i=this.normChart.elementDemons;let s=[],o=this.normChart.races,r=[];this.filterDarks&&(s=this.normChart.races.filter(t=>this.normChart.getLightDark(t)>0),o=this.normChart.races.filter(t=>0===this.normChart.getLightDark(t)),r=this.normChart.races.filter(t=>-1===this.normChart.getLightDark(t)),0===r.length&&s.length>0&&(s=this.normChart.races.filter(t=>this.normChart.getLightDark(t)>-1),o=[],r=this.normChart.races.filter(t=>this.normChart.getLightDark(t)<-1)));const c=s.length-r.length,l=s.concat(o,i),a=r.length?r.concat(Array(l.length-r.length).fill("")):l,h=this.mitaTable?l:s.concat(o,Array(i.length).fill("")),u=this.mitaTable||r.length?Array(c).fill("").concat(r,o,i):l;this.table=[[""].concat(l,[""])];for(let t=0;t<u.length;t++){const s=Array(l.length+2).fill("empt-"),o=u[t],r=h[t],g=-1!==i.indexOf(o),f=-1!==i.indexOf(r);this.table.push(s),s[0]=o,s[s.length-1]=r;for(let c=t;c<l.length;c++){const t=l[c],o=-1!==i.indexOf(t);if(o&&f){const o=i.indexOf(r),l=i.indexOf(t),a=this.mitaTable[o][l-o-1];s[c+1]=a?(n[a]||"norm")+a:e}else if(o&&r){const i=this.normChart.getElemFusions(t)[r];s[c+1]=i?(n[i]||"rank")+(i>0?"+":"")+i.toString():e}else if(t&&r){const i=this.isPersona&&t===r?t:this.normChart.getRaceFusion(t,r);s[c+1]=i?(n[i]||(t===r?"elem":"norm"))+i:e}}if(this.tripChart)for(let i=0;i<=t-c;i++){const t=a[i];if(t&&g){const r=this.tripChart.getElemFusions(o)[t];s[i+1]=r?(n[r]||"rank")+(r>0?"+":"")+r.toString():e}else if(t&&o){const r=this.tripChart.getRaceFusion(t,o);s[i+1]=r?(n[r]||(t===o?"elem":"trip"))+r:e}}if(-1!==o.indexOf(" x ")){const[t,e]=o.split(" x "),n=t.slice(0,3)+"x"+e.slice(0,3);s[0]=n,s[s.length-1]=n}else if(-1!==o.indexOf(" ")){const t=o.split(" ")[0];s[0]=t,s[s.length-1]=t}}for(let t=0;t<this.table[0].length;t++){const e=this.table[0][t];if(-1!==e.indexOf(" x ")){const[n,i]=e.split(" x ");this.table[0][t]=n.slice(0,2)+i.slice(0,2)}}this.table.push([""].concat(a,[""]))}}return t.RESULT_COLORS=Object.entries({oran:["-2","Erthys","Gnome","Saki","Saki Mitama","Random","\u30a2\u30fc\u30b7\u30fc\u30ba","\u30ce\u30fc\u30e0","\u30b5\u30ad\u30df\u30bf\u30de"],redd:["-1","Flaemis","Salamander","Ara ","Ara Mitama","Fiend","\u30d5\u30ec\u30a4\u30df\u30fc\u30ba","\u30b5\u30e9\u30de\u30f3\u30c0\u30fc","\u30a2\u30e9\u30df\u30bf\u30de"],gree:["1","Aeros","Sylph","Kusi","Kusi Mitama","UMA","\u30a8\u30a2\u30ed\u30b9","\u30b7\u30eb\u30ad\u30fc","\u30af\u30b7\u30df\u30bf\u30de"],blue:["2","Aquans","Undine","Nigi","Nigi Mitama","Enigma","\u30a2\u30af\u30a2\u30f3\u30ba","\u30a6\u30f3\u30c7\u30a3\u30fc\u30cd","\u30cb\u30ae\u30df\u30bf\u30de"]}),t.\u0275fac=function(e){return new(e||t)(i.Y36(s.Dx),i.Y36(o.gz))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-fusion-chart"]],inputs:{normChart:"normChart",tripChart:"tripChart",mitaTable:"mitaTable",normTitle:"normTitle",tripTitle:"tripTitle",isPersona:"isPersona",filterDarks:"filterDarks",langEn:"langEn",counter:"counter"},features:[i.TTD],decls:12,vars:7,consts:[[1,"title"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(t,e){1&t&&(i.TgZ(0,"table"),i.TgZ(1,"tbody"),i.TgZ(2,"tr"),i.TgZ(3,"th",0),i._uU(4),i.qZA(),i.qZA(),i.TgZ(5,"tr"),i.YNc(6,c,2,1,"th",1),i.qZA(),i.YNc(7,a,6,3,"tr",1),i.TgZ(8,"tr"),i.YNc(9,h,2,1,"th",1),i.qZA(),i.YNc(10,u,3,3,"tr",2),i.qZA(),i._UZ(11,"tbody"),i.qZA()),2&t&&(i.xp6(3),i.uIk("colspan",e.table[0].length),i.xp6(1),i.AsE("",e.appName," ",e.normTitle,""),i.xp6(2),i.Q6J("ngForOf",e.table[0]),i.xp6(1),i.Q6J("ngForOf",e.table.slice(1,e.table.length-1)),i.xp6(2),i.Q6J("ngForOf",e.table[e.table.length-1]),i.xp6(1),i.Q6J("ngIf",e.tripTitle))},directives:[r.sg,r.O5,r.mk],styles:["table[_ngcontent-%COMP%]{width:auto;margin:0 auto;white-space:nowrap}td.elem[_ngcontent-%COMP%]{color:#0f0}td.trip[_ngcontent-%COMP%]{color:#d3d3d3}td.oran[_ngcontent-%COMP%]{color:orange}td.redd[_ngcontent-%COMP%]{color:red}td.gree[_ngcontent-%COMP%]{color:#0f0}td.blue[_ngcontent-%COMP%]{color:#0ff}td.empt[_ngcontent-%COMP%], td.none[_ngcontent-%COMP%]{color:transparent}td.empt[_ngcontent-%COMP%]{background-color:initial}"],changeDetection:0}),t})()},3810:(t,e,n)=>{"use strict";n.d(e,{X:()=>D});var i=n(9859);function s(t,e){return parseInt(e.map(e=>t.includes(e)?"1":"0").join(""),2)}function o(t,e){return t.map((t,n,i)=>s(i.slice(0,n+1),e))}function r(t,e,n,s,o,r){let l=n,a=[l];const h=s.getSpecialNameEntries(l),u=e[e.length-1];if(0!==h.length&&(l=h.find(t=>0===s.getSpecialNameEntries(t).length),a.unshift(h.filter(t=>t!==l).join(" x ")),a.unshift(l)),t.length>0){const n=function(t,e,n,s,o){const{fusionCalculator:r}=o,c=t.slice(0,1);if(t.length<2)return c;let l=c[0],a=e[0];for(let h=1;h<t.length;h++){const o=t[h],u=e[h],g=r.getFusions(l,n,s).map(t=>(0,i.D0)(t,n)).sort((t,e)=>t.price-e.price);let f=!1;for(const t of g)if(t.name1===o&&(u&n.getDemon(t.name2).inherits)===u){c.push(o),c.push(t.name2),l=c[c.length-1],a=u,f=!0;break}if(f)continue;const p=r.getFusions(o,n,s).reduce((t,e)=>(t[e.name1]=e.name2,t),{});for(const t of g)if(p[t.name2]&&(a&n.getDemon(t.name2).inherits)===a&&(u&n.getDemon(t.name2).inherits)===u){c.push(t.name1),c.push(t.name2),c.push(o),c.push(p[t.name2]),l=c[c.length-1],a=u,f=!0;break}if(!f)return[]}return c}(t,e,s,o,r);if(0===n.length)return[];const h=n[n.length-1];let g=c(h,l,u,s,o,r);if(0===g.length)for(const t of o.elementDemons){if((u&s.getDemon(t).inherits)!==u)continue;const e=c(h,t,u,s,o,r),n=c(t,l,u,s,o,r);if(0!==e.length&&0!==n.length){g=e.concat(n.slice(1));break}}if(0===g.length)return[];a=n.concat(g.slice(1),a.slice(1))}return a}function c(t,e,n,s,o,r){const{fissionCalculator:c,fusionCalculator:l}=r,a=[t];if(t===e)return a;const h=l.getFusions(t,s,o).map(t=>(0,i.D0)(t,s)).sort((t,e)=>t.price-e.price);for(const i of h)if(i.name2===e)return a.push(i.name1),a.push(e),a;const u=c.getFusions(e,s,o).map(t=>(0,i.S6)(t,s)).sort((t,e)=>t.price-e.price);h.sort((t,e)=>e.price-t.price);const g=h.reduce((t,e)=>(t[e.name2]=e.name1,t),{});for(const i of u){if(g[i.name1]&&(n&s.getDemon(i.name1).inherits)===n)return a.push(g[i.name1]),a.push(i.name1),a.push(i.name2),a.push(e),a;if(g[i.name2]&&(n&s.getDemon(i.name2).inherits)===n)return a.push(g[i.name2]),a.push(i.name2),a.push(i.name1),a.push(e),a}return[]}var l=n(5614),a=n(1462),h=n(1116),u=n(6101);function g(t,e){if(1&t&&(l.TgZ(0,"option",15),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.Q6J("value",t),l.xp6(1),l.Oqu(t)}}function f(t,e){if(1&t&&(l.TgZ(0,"option",16),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.Q6J("ngValue",t),l.xp6(1),l.Oqu(t.name)}}function p(t,e){if(1&t&&(l.TgZ(0,"option",15),l._uU(1),l.qZA()),2&t){const t=e.index;l.Q6J("value",99-t),l.xp6(1),l.Oqu(99-t)}}function m(t,e){if(1&t&&(l.TgZ(0,"option",15),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.Q6J("value",t),l.xp6(1),l.Oqu(t)}}function d(t,e){if(1&t&&(l.TgZ(0,"option",16),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.Q6J("ngValue",t),l.xp6(1),l.Oqu(t.name)}}function Z(t,e){if(1&t&&(l.ynx(0),l.TgZ(1,"td"),l._uU(2),l.ALo(3,"skillCostToString"),l.qZA(),l.TgZ(4,"td"),l._uU(5),l.qZA(),l.TgZ(6,"td"),l._uU(7),l.qZA(),l.TgZ(8,"td"),l._uU(9),l.qZA(),l.BQk()),2&t){const t=e.ngIf;l.xp6(1),l.Udp("color",t.cost?null:"transparent"),l.xp6(1),l.Oqu(l.lcZ(3,8,t.cost)),l.xp6(3),l.Oqu(t.effect),l.xp6(2),l.Oqu(t.target),l.xp6(1),l.Udp("color",99!==t.rank?null:"transparent"),l.xp6(1),l.Oqu(t.rank)}}function x(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"tr"),l.TgZ(1,"td"),l.TgZ(2,"select",19),l.NdJ("change",function(){l.CHM(t);const e=l.oxw().$implicit,n=l.oxw();return e.controls.custom.setValue(n.skills[e.controls.elem.value][0])}),l.TgZ(3,"option",20),l._uU(4,"-"),l.qZA(),l.YNc(5,m,2,2,"option",4),l.qZA(),l.qZA(),l.TgZ(6,"td"),l.TgZ(7,"select",21),l.YNc(8,d,2,2,"option",6),l.qZA(),l.qZA(),l.YNc(9,Z,10,10,"ng-container",18),l.qZA()}if(2&t){const t=l.oxw().$implicit,e=l.oxw();l.xp6(5),l.Q6J("ngForOf",e.elems),l.xp6(3),l.Q6J("ngForOf",e.skills[t.controls.elem.value]),l.xp6(1),l.Q6J("ngIf",t.controls.custom.value)}}function T(t,e){if(1&t&&(l.ynx(0,17),l.YNc(1,x,10,3,"tr",18),l.BQk()),2&t){const t=e.index,n=l.oxw();l.Q6J("formGroupName",t),l.xp6(1),l.Q6J("ngIf",t<n.maxSkills)}}function A(t,e){if(1&t&&(l.TgZ(0,"li"),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.xp6(1),l.Oqu(t)}}function q(t,e){if(1&t&&(l.TgZ(0,"td",12),l.TgZ(1,"ul"),l.YNc(2,A,2,1,"li",26),l.qZA(),l.qZA()),2&t){const t=l.oxw(2);l.xp6(2),l.Q6J("ngForOf",t.recipeLeft)}}function O(t,e){1&t&&(l.TgZ(0,"td",27),l._uU(1,"No chains found"),l.qZA())}function k(t,e){if(1&t&&(l.TgZ(0,"li"),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.xp6(1),l.Oqu(t)}}function _(t,e){if(1&t&&(l.TgZ(0,"td",12),l.TgZ(1,"ul"),l.YNc(2,k,2,1,"li",26),l.qZA(),l.qZA()),2&t){const t=l.oxw(2);l.xp6(2),l.Q6J("ngForOf",t.recipeRight)}}function F(t,e){1&t&&(l.TgZ(0,"td",27),l._uU(1,"No chains found"),l.qZA())}function N(t,e){if(1&t&&(l.ynx(0),l._uU(1),l._UZ(2,"br"),l._uU(3),l.BQk()),2&t){const t=l.oxw(2);l.xp6(1),l.AsE(" ",t.recipeResult.join(" x ")," = ",t.recipe.result,""),l.xp6(2),l.hij(" [",t.resultSkills.join(", "),"] ")}}function C(t,e){1&t&&(l.ynx(0),l._uU(1,"No recipes found"),l.BQk())}function b(t,e){if(1&t&&(l.TgZ(0,"table",1),l.TgZ(1,"tr"),l.TgZ(2,"th",22),l._uU(3,"Fusion Recipe"),l.qZA(),l.qZA(),l.TgZ(4,"tr"),l.TgZ(5,"th"),l._uU(6,"Left Chain"),l.qZA(),l.TgZ(7,"th"),l._uU(8,"Right Chain"),l.qZA(),l.qZA(),l.TgZ(9,"tr"),l.YNc(10,q,3,1,"td",23),l.YNc(11,O,2,0,"td",24),l.YNc(12,_,3,1,"td",23),l.YNc(13,F,2,0,"td",24),l.qZA(),l.TgZ(14,"tr"),l.TgZ(15,"td",25),l.YNc(16,N,4,3,"ng-container",18),l.YNc(17,C,2,0,"ng-container",18),l.qZA(),l.qZA(),l.qZA()),2&t){const t=l.oxw();l.xp6(10),l.Q6J("ngIf",t.recipeLeft.length),l.xp6(1),l.Q6J("ngIf",!t.recipeLeft.length),l.xp6(1),l.Q6J("ngIf",t.recipeRight.length),l.xp6(1),l.Q6J("ngIf",!t.recipeRight.length),l.xp6(3),l.Q6J("ngIf",t.recipe.stepR.length),l.xp6(1),l.Q6J("ngIf",!t.recipe.stepR.length)}}let D=(()=>{class t{constructor(t){this.fb=t,this.defaultDemon="Pixie",this.maxSkills=8,this.range99=Array(99),this.demons={},this.skills={},this.blankDemon={name:"-",race:"-",lvl:0,currLvl:0,price:0,inherits:0,skills:{},stats:[],resists:[],affinities:[],fusion:"normal",prereq:""},this.blankSkill={name:"-",element:"-",rank:99,cost:0,effect:"",target:"",level:0,learnedBy:[]},this.createForm()}ngOnChanges(){this.initDropdowns()}createForm(){const t=[];for(let e=0;e<8;e++)t.push(this.fb.group({elem:"-",custom:this.blankSkill}));this.form=this.fb.group({race:"-",demon:this.blankDemon,skills:this.fb.array(t)}),this.form.valueChanges.subscribe(t=>{if(this.form.valid){const e=t.skills.map(t=>t.custom.name).filter(t=>"-"!==t);this.updateRecipe(function(t,e,n,c,l){const{fissionCalculator:a,inheritElems:h,restrictInherits:u}=l,g=n.getDemon(t),f=e.map(t=>n.getSkill(t)).filter((t,e,n)=>t.rank<50&&t.learnedBy.length>0&&!g.skills.hasOwnProperty(t.name)&&n.indexOf(t)===e),p=s(f.map(t=>t.element),h),m=a.getFusions(t,n,c).map(t=>(0,i.S6)(t,n)).sort((t,e)=>t.price-e.price).find(t=>(p&(n.getDemon(t.name1).inherits|n.getDemon(t.name2).inherits))===p&&a.getFusions(t.name1,n,c).length>0&&a.getFusions(t.name2,n,c).length>0),d=m?[m.name1,m.name2]:n.getSpecialNameEntries(t),Z=d.map(t=>n.getDemon(t)).sort((t,e)=>t.price-e.price),x={},T={},A=[];for(const i of f){let t=!1;for(const e of Z)if(e.skills.hasOwnProperty(i.name)){t=!0,T[i.name]=e.name;break}t||A.push(i)}for(const i of A){const t=i.learnedBy.map(t=>n.getDemon(t.demon));x[i.name]=t.length>1?t.find(t=>Object.keys(c.getRaceFusions(t.race)).length>0&&"excluded"!==t.fusion).name:t[0].name}const q=s(A.map(t=>t.element),h),O=A.map(t=>s([t.element],h));let k,_,F=0;for(let i=0;i<Z.length;i++){const t=Z[i];for(const e of Z.slice(i+1))if((q&(t.inherits|e.inherits))===q){const n=(q&t.inherits).toString(2).split("1").length*(q&e.inherits).toString(2).split("1").length;F<n&&(k=t,_=e,F=n)}}const N={chain1:[],chain2:[],stepR:d,skills:Object.assign(x,T),result:t};if(!k)return N;const C=Object.values(x).filter((t,e,n)=>n.indexOf(t)===e),b=Math.ceil(C.length/2);C.sort((t,e)=>c.getLightDark(n.getDemon(t).race)-c.getLightDark(n.getDemon(e).race));let D=C.slice(0,b),U=Array(D.length).fill(0),v=C.slice(b),y=Array(v.length).fill(0);if(u){const{left:t,right:e}=function(t,e,n,i){let s=[],o=[];const r=[],c=[],l={},a=[];for(let h=0;h<n.length;h++){const t=n[h];0!==t?(l.hasOwnProperty(t)||(l[t]=[]),l[t].push(i[h])):a.push(i[h])}for(const h of Object.keys(l).sort()){const n=parseInt(h);r.length<=c.length?(n&t)===n?r.push(n):c.push(n):(n&e)===n?c.push(n):r.push(n)}for(const h of r)s=s.concat(l[h]);for(const h of c)o=o.concat(l[h]);for(const h of a)s.length<o.length?s.push(h):o.push(h);return{left:s.reverse(),right:o.reverse()}}(k.inherits,_.inherits,O,A.map(t=>t.name));D=t.map(t=>x[t]),U=o(t.map(t=>n.getSkill(t).element),h),v=e.map(t=>x[t]),y=o(e.map(t=>n.getSkill(t).element),h)}return N.chain1=r(D,U,k.name,n,c,l),N.chain2=r(v,y,_.name,n,c,l),N}(t.demon.name,e,this.compendium,this.fusionChart,this.recipeConfig))}})}updateRecipe(t){const e={};for(const[n,i]of Object.entries(t.skills)){e[i]||(e[i]=[]);const t=this.compendium.getDemon(i).skills[n];e[i].push(n+(t?` (${t})`:""))}this.recipe=t,this.recipeLeft=this.decodeRecipechain(t.chain1,e),this.recipeRight=this.decodeRecipechain(t.chain2,e),this.resultSkills=[],this.recipeResult=[];for(const n of t.stepR)this.recipeResult.push(e[n]?`${n} [${e[n].join(", ")}]`:n);for(const[n,i]of Object.entries(this.compendium.getDemon(t.result).skills).filter(t=>t[1]<2e3).sort((t,e)=>t[1]-e[1]))this.resultSkills.push(n+(i?` (${i})`:""))}decodeRecipechain(t,e){const n=[];for(let i=0;i<t.length-2;i+=2){const s=e[t[i]]?"["+e[t[i]].join(", ")+"] ":"",o=e[t[i+1]]?"["+e[t[i+1]].join(", ")+"] ":"";n.push(`${t[i]} ${s}x ${t[i+1]} ${o}= ${t[i+2]}`)}return n}initDropdowns(){if(this.recipeConfig&&this.compendium&&this.fusionChart){this.demons={},this.skills={"-":[this.blankSkill]};for(const t of this.compendium.allDemons)this.demons[t.race]||(this.demons[t.race]=[]),this.demons[t.race].push(t);for(const t of this.compendium.allSkills.filter(t=>t.rank<50&&t.learnedBy.length>0))this.skills[t.element]||(this.skills[t.element]=[]),this.skills[t.element].push(t);for(const t of Object.values(this.demons))t.sort((t,e)=>e.lvl-t.lvl);for(const t of Object.values(this.skills))t.sort((t,e)=>t.rank-e.rank);this.races=this.recipeConfig.races.filter(t=>this.demons[t]),this.elems=this.recipeConfig.skillElems.filter(t=>this.skills[t]),this.setDemon(this.compendium.getDemon(this.defaultDemon))}}setDemon(t){const e=[],{inheritElems:n}=this.recipeConfig;for(let i=0;i<n.length;i++)t.inherits&1<<i||e.push(n[n.length-i-1]);this.elems=this.recipeConfig.skillElems.filter(t=>this.skills[t]&&!e.includes(t)),this.form.patchValue({race:t.race,demon:t,skills:Array(8).fill({elem:"-",custom:this.blankSkill})})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(a.qu))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-recipe-generator"]],inputs:{defaultDemon:"defaultDemon",maxSkills:"maxSkills",compendium:"compendium",fusionChart:"fusionChart",recipeConfig:"recipeConfig"},features:[l.TTD],decls:43,vars:6,consts:[[3,"formGroup"],[1,"entry-table"],["colspan","7",1,"title"],["formControlName","race",3,"change"],[3,"value",4,"ngFor","ngForOf"],["formControlName","demon",3,"change"],[3,"ngValue",4,"ngFor","ngForOf"],["formArrayName","skills",1,"entry-table"],["colspan","6",1,"title"],[2,"width","5%"],[2,"width","15%"],[2,"width","10%"],[2,"width","50%"],[3,"formGroupName",4,"ngFor","ngForOf"],["class","entry-table",4,"ngIf"],[3,"value"],[3,"ngValue"],[3,"formGroupName"],[4,"ngIf"],["formControlName","elem",3,"change"],["value","-"],["formControlName","custom"],["colspan","2",1,"title"],["style","width: 50%",4,"ngIf"],["style","width: 50%","style","padding: 1em; text-align: center;",4,"ngIf"],["colspan","2",2,"padding","1em","text-align","center"],[4,"ngFor","ngForOf"],[2,"padding","1em","text-align","center"]],template:function(t,e){1&t&&(l.TgZ(0,"form",0),l.TgZ(1,"h2"),l._uU(2,"Recipe Generator"),l.qZA(),l.TgZ(3,"table",1),l.TgZ(4,"tr"),l.TgZ(5,"th",2),l._uU(6,"Demon Entry"),l.qZA(),l.qZA(),l.TgZ(7,"tr"),l.TgZ(8,"th"),l._uU(9,"Race"),l.qZA(),l.TgZ(10,"th"),l._uU(11,"Demon"),l.qZA(),l.TgZ(12,"th"),l._uU(13,"Max Lvl"),l.qZA(),l.qZA(),l.TgZ(14,"tr"),l.TgZ(15,"td"),l.TgZ(16,"select",3),l.NdJ("change",function(){return e.setDemon(e.demons[e.form.controls.race.value][0])}),l.YNc(17,g,2,2,"option",4),l.qZA(),l.qZA(),l.TgZ(18,"td"),l.TgZ(19,"select",5),l.NdJ("change",function(){return e.setDemon(e.form.controls.demon.value)}),l.YNc(20,f,2,2,"option",6),l.qZA(),l.qZA(),l.TgZ(21,"td"),l.TgZ(22,"select"),l.YNc(23,p,2,2,"option",4),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(24,"table",7),l.TgZ(25,"tr"),l.TgZ(26,"th",8),l._uU(27,"Learned Skills"),l.qZA(),l.qZA(),l.TgZ(28,"tr"),l.TgZ(29,"th",9),l._uU(30,"Elem"),l.qZA(),l.TgZ(31,"th",10),l._uU(32,"Name"),l.qZA(),l.TgZ(33,"th",11),l._uU(34,"Cost"),l.qZA(),l.TgZ(35,"th",12),l._uU(36,"Effect"),l.qZA(),l.TgZ(37,"th",11),l._uU(38,"Target"),l.qZA(),l.TgZ(39,"th",11),l._uU(40,"Rank"),l.qZA(),l.qZA(),l.YNc(41,T,2,2,"ng-container",13),l.qZA(),l.YNc(42,b,18,6,"table",14),l.qZA()),2&t&&(l.Q6J("formGroup",e.form),l.xp6(17),l.Q6J("ngForOf",e.races),l.xp6(3),l.Q6J("ngForOf",e.demons[e.form.controls.race.value]),l.xp6(3),l.Q6J("ngForOf",e.range99),l.xp6(18),l.Q6J("ngForOf",e.form.controls.skills.controls),l.xp6(1),l.Q6J("ngIf",e.recipe))},directives:[a._Y,a.JL,a.sg,a.EJ,a.JJ,a.u,h.sg,a.CE,h.O5,a.YN,a.Kr,a.x0],pipes:[u.tq],styles:["ul[_ngcontent-%COMP%]{padding:0 1em;list-style:none}td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%}"],changeDetection:0}),t})()},4354:(t,e,n)=>{"use strict";n.d(e,{O:()=>f});var i=n(1501),s=n(649),o=n(5614),r=n(1116),c=n(3522);const l=function(){return{exact:!0}};function a(t,e){if(1&t&&(o.TgZ(0,"th",4),o.TgZ(1,"a",5),o._uU(2),o.qZA(),o.qZA()),2&t){const t=e.$implicit,n=o.oxw();o.Udp("width",100/n.fusionOptions.length,"%"),o.Q6J("routerLink",t.link)("routerLinkActiveOptions",o.DdM(6,l)),o.xp6(1),o.Q6J("routerLink",t.link),o.xp6(1),o.Oqu(t.title)}}function h(t,e){if(1&t&&(o.TgZ(0,"tr"),o.TgZ(1,"th",6),o._uU(2),o.qZA(),o.qZA()),2&t){const t=o.oxw();o.xp6(1),o.uIk("colspan",t.fusionOptions.length),o.xp6(1),o.hij(" ",t.langEn?"DLC marked as excluded in fusion settings, results may be inaccurate!":"DLC\u306a\u3057"," ")}}function u(t,e){if(1&t&&(o.TgZ(0,"tr"),o.TgZ(1,"th",6),o.Hsn(2),o.qZA(),o.qZA()),2&t){const t=o.oxw();o.xp6(1),o.uIk("colspan",t.fusionOptions.length)}}const g=["*"];let f=(()=>{class t{constructor(){this.hasTripleFusion=!1,this.showFusionAlert=!1,this.excludedDlc=!1,this.langEn=!0,this.fusionOptions=t.NORMAL_FUSIONS_EN}ngOnInit(){this.fusionOptions=this.hasTripleFusion?t.TRIPLE_FUSIONS:this.langEn?t.NORMAL_FUSIONS_EN:t.NORMAL_FUSIONS_JA}ngOnChanges(){setTimeout(()=>this.stickyTable.nextEdges())}}return t.NORMAL_FUSIONS_EN=[{title:"Reverse Fusions",link:"fissions"},{title:"Forward Fusions",link:"fusions"}],t.NORMAL_FUSIONS_JA=[{title:"\u9006\u5f15\u304d\u5408\u4f53",link:"fissions"},{title:"2\u4f53\u5408\u4f53",link:"fusions"}],t.TRIPLE_FUSIONS=[{title:"Normal Reverse Fusions",link:"fissions"},{title:"Triple Reverse Fusions",link:"fissions/triple"},{title:"Triple Forward Fusions",link:"fusions/triple"},{title:"Normal Forward Fusions",link:"fusions"}],t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-smt-fusions"]],viewQuery:function(t,e){if(1&t&&o.Gf(s.v,5),2&t){let t;o.iGM(t=o.CRH())&&(e.stickyTable=t.first)}},inputs:{hasTripleFusion:"hasTripleFusion",showFusionAlert:"showFusionAlert",excludedDlc:"excludedDlc",langEn:"langEn"},features:[o._Bn([i.L]),o.TTD],ngContentSelectors:g,decls:11,vars:3,consts:[["appPositionSticky","",1,"list-table"],["stickyTable",""],["class","nav","routerLinkActive","active",3,"routerLink","width","routerLinkActiveOptions",4,"ngFor","ngForOf"],[4,"ngIf"],["routerLinkActive","active",1,"nav",3,"routerLink","routerLinkActiveOptions"],[3,"routerLink"],[1,"title"]],template:function(t,e){1&t&&(o.F$t(),o.TgZ(0,"div"),o.TgZ(1,"table",0,1),o.TgZ(3,"thead"),o.TgZ(4,"tr"),o.YNc(5,a,3,7,"th",2),o.qZA(),o.YNc(6,h,3,2,"tr",3),o._UZ(7,"tr"),o.YNc(8,u,3,1,"tr",3),o._UZ(9,"tr"),o.qZA(),o.qZA(),o._UZ(10,"router-outlet"),o.qZA()),2&t&&(o.xp6(5),o.Q6J("ngForOf",e.fusionOptions),o.xp6(1),o.Q6J("ngIf",e.excludedDlc),o.xp6(2),o.Q6J("ngIf",e.showFusionAlert))},directives:[s.v,r.sg,r.O5,c.lC,c.Od,c.rH,c.yS],encapsulation:2,changeDetection:0}),t})()},9805:(t,e,n)=>{"use strict";n.d(e,{f:()=>s});var i=n(5614);let s=(()=>{class t{constructor(t,e){this.changeDetector2=t,this.fusionDataService2=e,this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.fusionDataService2.compendium.subscribe(t=>{this.changeDetector2.markForCheck(),this.compendium=t,this._dlcDemons=Object.assign({},this.compendium.dlcDemons),this.dlcDemons=Object.entries(this._dlcDemons).map(([t,e])=>({name:t,included:e}))}))}ngOnDestroy(){for(const t of this.subscriptions)t.unsubscribe()}toggleName(t){this._dlcDemons[t]=!this._dlcDemons[t],this.fusionDataService2.nextDlcDemons(this._dlcDemons)}}return t.\u0275fac=function(t){i.$Z()},t.\u0275dir=i.lG2({type:t}),t})()}}]);