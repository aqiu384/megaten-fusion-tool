"use strict";(self.webpackChunkmegaten_fusion_tool=self.webpackChunkmegaten_fusion_tool||[]).push([[116],{9012:(fe,K,R)=>{R.d(K,{N:()=>Z});var w=R(627),n=R(4769),r=R(6814),Y=R(2173);function H(h,D){if(1&h&&(n.TgZ(0,"th",4),n._uU(1,"Inheritable Skills"),n.qZA()),2&h){const g=n.oxw();n.uIk("colspan",g.inheritHeaders.length)}}function $(h,D){if(1&h&&(n.TgZ(0,"th",4),n._uU(1),n.ALo(2,"translateComp"),n.qZA()),2&h){const g=n.oxw();n.uIk("colspan",g.inheritHeaders.length),n.xp6(1),n.hij(" ",n.xi3(2,2,g.msgs.SkillAffinities,g.lang)," ")}}function j(h,D){if(1&h&&(n.ynx(0),n._uU(1),n.BQk()),2&h){const g=n.oxw().$implicit;n.xp6(1),n.Oqu(g)}}function W(h,D){if(1&h&&(n.TgZ(0,"div"),n._uU(1),n.qZA()),2&h){const g=n.oxw().$implicit;n.Gre("element-icon ",g,""),n.xp6(1),n.Oqu(g)}}function V(h,D){if(1&h&&(n.TgZ(0,"th"),n.YNc(1,j,2,1,"ng-container",3),n.YNc(2,W,2,4,"div",5),n.qZA()),2&h){const g=n.oxw();n.Udp("width",100/g.inheritHeaders.length,"%"),n.xp6(1),n.Q6J("ngIf",!g.hasIcons),n.xp6(1),n.Q6J("ngIf",g.hasIcons)}}function e(h,D){if(1&h&&(n.TgZ(0,"td"),n._uU(1),n.qZA()),2&h){const g=D.$implicit;n.Udp("color",g?null:"transparent"),n.xp6(1),n.hij(" ",g?"yes":"no"," ")}}function S(h,D){if(1&h&&(n.TgZ(0,"tr"),n.YNc(1,e,2,3,"td",6),n.qZA()),2&h){const g=n.oxw();n.xp6(1),n.Q6J("ngForOf",g.inherits)}}function P(h,D){if(1&h&&(n.TgZ(0,"td"),n.ALo(1,"roundInheritPercent"),n._uU(2),n.qZA()),2&h){const g=D.$implicit;n.Gre("affinity",n.lcZ(1,4,g),""),n.xp6(2),n.hij(" ",g,"% ")}}function N(h,D){if(1&h&&(n.TgZ(0,"tr"),n.YNc(1,P,3,6,"td",7),n.qZA()),2&h){const g=n.oxw();n.xp6(1),n.Q6J("ngForOf",g.inherits)}}function T(h,D){if(1&h&&(n.TgZ(0,"td"),n._uU(1),n.ALo(2,"affinityToString"),n.qZA()),2&h){const g=D.$implicit;n.Gre("affinity",g,""),n.xp6(1),n.hij(" ",n.lcZ(2,4,g)," ")}}function C(h,D){if(1&h&&(n.TgZ(0,"tr"),n.YNc(1,T,3,6,"td",7),n.qZA()),2&h){const g=n.oxw();n.xp6(1),n.Q6J("ngForOf",g.inherits)}}let Z=(()=>{class h{constructor(){this.inheritHeaders=[],this.inherits=[],this.hasChance=!1,this.hasIcons=!0,this.hasLvls=!1,this.lang="en",this.msgs=w.Nb}static#e=this.\u0275fac=function(y){return new(y||h)};static#t=this.\u0275cmp=n.Xpm({type:h,selectors:[["app-demon-inherits"]],inputs:{inheritHeaders:"inheritHeaders",inherits:"inherits",hasChance:"hasChance",hasIcons:"hasIcons",hasLvls:"hasLvls",lang:"lang"},decls:11,vars:6,consts:[[1,"entry-table"],["class","title",4,"ngIf"],[3,"width",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"title"],[3,"class",4,"ngIf"],[3,"color",4,"ngFor","ngForOf"],[3,"class",4,"ngFor","ngForOf"]],template:function(y,Q){1&y&&(n.TgZ(0,"table",0)(1,"thead")(2,"tr"),n.YNc(3,H,2,1,"th",1),n.YNc(4,$,3,5,"th",1),n.qZA(),n.TgZ(5,"tr"),n.YNc(6,V,3,4,"th",2),n.qZA()(),n.TgZ(7,"tbody"),n.YNc(8,S,2,1,"tr",3),n.YNc(9,N,2,1,"tr",3),n.YNc(10,C,2,1,"tr",3),n.qZA()()),2&y&&(n.xp6(3),n.Q6J("ngIf",!Q.hasLvls),n.xp6(1),n.Q6J("ngIf",Q.hasLvls&&Q.inheritHeaders.length),n.xp6(2),n.Q6J("ngForOf",Q.inheritHeaders),n.xp6(2),n.Q6J("ngIf",!Q.hasLvls&&!Q.hasChance),n.xp6(1),n.Q6J("ngIf",Q.hasChance),n.xp6(1),n.Q6J("ngIf",Q.hasLvls))},dependencies:[r.sg,r.O5,Y.zi,Y.JZ,Y.DY],encapsulation:2,changeDetection:0})}return h})()},8615:(fe,K,R)=>{R.d(K,{R:()=>P});var w=R(3184),n=R(627),r=R(4769),Y=R(6593),H=R(4487),$=R(6814);function j(N,T){if(1&N&&(r.TgZ(0,"th"),r._uU(1),r.qZA()),2&N){const C=T.$implicit,Z=r.oxw();r.xp6(1),r.Oqu(C.slice(0,Z.nameCut))}}function W(N,T){if(1&N&&(r.TgZ(0,"td",4),r._uU(1),r.qZA()),2&N){const C=T.$implicit,Z=r.oxw(2);r.Q6J("ngClass",C.slice(0,4)),r.xp6(1),r.Oqu(C.slice(4,Z.nameCut+4))}}function V(N,T){if(1&N&&(r.TgZ(0,"tr")(1,"th"),r._uU(2),r.qZA(),r.YNc(3,W,2,2,"td",3),r.TgZ(4,"th"),r._uU(5),r.qZA()()),2&N){const C=T.$implicit;r.xp6(2),r.Oqu(C[0]),r.xp6(1),r.Q6J("ngForOf",C.slice(1,C.length-1)),r.xp6(2),r.Oqu(C[C.length-1])}}function e(N,T){if(1&N&&(r.TgZ(0,"th"),r._uU(1),r.qZA()),2&N){const C=T.$implicit,Z=r.oxw();r.xp6(1),r.Oqu(C.slice(0,Z.nameCut))}}function S(N,T){if(1&N&&(r.TgZ(0,"tr")(1,"th",0),r._uU(2),r.qZA()()),2&N){const C=r.oxw();r.xp6(1),r.uIk("colspan",C.table[0].length),r.xp6(1),r.AsE("",C.appName," ",C.tripTitle,"")}}class P{static#e=this.RESULT_COLORS=Object.entries({oran:["-2","Erthys","Gnome","Saki","Saki Mitama","Random","\u30a2\u30fc\u30b7\u30fc\u30ba","\u30ce\u30fc\u30e0","\u30b5\u30ad\u30df\u30bf\u30de"],redd:["-1","Flaemis","Salamander","Ara ","Ara Mitama","Fiend","\u30d5\u30ec\u30a4\u30df\u30fc\u30ba","\u30b5\u30e9\u30de\u30f3\u30c0\u30fc","\u30a2\u30e9\u30df\u30bf\u30de"],gree:["1","Aeros","Sylph","Kusi","Kusi Mitama","UMA","\u30a8\u30a2\u30ed\u30b9","\u30b7\u30eb\u30ad\u30fc","\u30af\u30b7\u30df\u30bf\u30de"],blue:["2","Aquans","Undine","Nigi","Nigi Mitama","Enigma","\u30a2\u30af\u30a2\u30f3\u30ba","\u30a6\u30f3\u30c7\u30a3\u30fc\u30cd","\u30cb\u30ae\u30df\u30bf\u30de"]});constructor(T,C){this.title2=T,this.route=C,this.normTitle="Normal Fusions",this.tripTitle="",this.isPersona=!1,this.filterDarks=!0,this.lang="en",this.msgs=n.R9,this.subscriptions=[],this.table=[],this.nameCut=4}ngOnInit(){this.subscriptions.push(this.route.parent.data.subscribe(T=>{this.appName=T.appName||"Shin Megami Tensei",this.nameCut=parseInt((0,w.y0)(this.msgs.NameCut,T.lang)),this.title2.setTitle((0,w.y0)(this.msgs.AppTitle,T.lang).replace("$APP",this.appName))}))}ngOnChanges(){this.normChart&&this.fillFusionChart()}ngOnDestroy(){for(const T of this.subscriptions)T.unsubscribe()}fillFusionChart(){const T="noneNone",Z=P.RESULT_COLORS.reduce((A,[I,L])=>L.reduce((U,X)=>(U[X]=I,U),A),{}),h=this.normChart.elementDemons;let D=[],g=this.normChart.races,y=[];this.filterDarks&&(D=this.normChart.races.filter(A=>this.normChart.getLightDark(A)>0),g=this.normChart.races.filter(A=>0===this.normChart.getLightDark(A)),y=this.normChart.races.filter(A=>-1===this.normChart.getLightDark(A)),0===y.length&&D.length>0&&(D=this.normChart.races.filter(A=>this.normChart.getLightDark(A)>-1),g=[],y=this.normChart.races.filter(A=>this.normChart.getLightDark(A)<-1)));const Q=D.length-y.length,G=D.concat(g,h),ne=y.length?y.concat(Array(G.length-y.length).fill("")):G,me=this.mitaTable?G:D.concat(g,Array(h.length).fill("")),ie=this.mitaTable||y.length?Array(Q).fill("").concat(y,g,h):G;this.table=[[""].concat(G,[""])];for(let A=0;A<ie.length;A++){const I=Array(G.length+2).fill("empt-"),L=ie[A],U=me[A],X=-1!==h.indexOf(L),pe=-1!==h.indexOf(U);this.table.push(I),I[0]=L,I[I.length-1]=U;for(let q=A;q<G.length;q++){const F=G[q],E=-1!==h.indexOf(F);if(E&&pe){const s=h.indexOf(U),a=h.indexOf(F),t=this.mitaTable[s][a-s-1];I[q+1]=t?(Z[t]||"norm")+t:T}else if(E&&U){const s=this.normChart.getElemFusions(F)[U];I[q+1]=s?(Z[s]||"rank")+(s>0?"+":"")+s.toString():T}else if(F&&U){const s=this.isPersona&&F===U?F:this.normChart.getRaceFusion(F,U);I[q+1]=s?(Z[s]||(F===U?"elem":"norm"))+s:T}}if(this.tripChart)for(let q=0;q<=A-Q;q++){const F=ne[q];if(F&&X){const E=this.tripChart.getElemFusions(L)[F];I[q+1]=E?(Z[E]||"rank")+(E>0?"+":"")+E.toString():T}else if(F&&L){const E=this.tripChart.getRaceFusion(F,L);I[q+1]=E?(Z[E]||(F===L?"elem":"trip"))+E:T}}if(-1!==L.indexOf(" x ")){const[q,F]=L.split(" x "),E=q.slice(0,3)+"x"+F.slice(0,3);I[0]=E,I[I.length-1]=E}else if(-1!==L.indexOf(" ")){const q=L.split(" ")[0];I[0]=q,I[I.length-1]=q}}for(let A=0;A<this.table[0].length;A++){const I=this.table[0][A];if(-1!==I.indexOf(" x ")){const[L,U]=I.split(" x ");this.table[0][A]=L.slice(0,2)+U.slice(0,2)}}this.table.push([""].concat(ne,[""]))}static#t=this.\u0275fac=function(C){return new(C||P)(r.Y36(Y.Dx),r.Y36(H.gz))};static#n=this.\u0275cmp=r.Xpm({type:P,selectors:[["app-fusion-chart"]],inputs:{normChart:"normChart",tripChart:"tripChart",mitaTable:"mitaTable",normTitle:"normTitle",tripTitle:"tripTitle",isPersona:"isPersona",filterDarks:"filterDarks",lang:"lang",counter:"counter"},features:[r.TTD],decls:12,vars:7,consts:[[1,"title"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(C,Z){1&C&&(r.TgZ(0,"table")(1,"tbody")(2,"tr")(3,"th",0),r._uU(4),r.qZA()(),r.TgZ(5,"tr"),r.YNc(6,j,2,1,"th",1),r.qZA(),r.YNc(7,V,6,3,"tr",1),r.TgZ(8,"tr"),r.YNc(9,e,2,1,"th",1),r.qZA(),r.YNc(10,S,3,3,"tr",2),r.qZA(),r._UZ(11,"tbody"),r.qZA()),2&C&&(r.xp6(3),r.uIk("colspan",Z.table[0].length),r.xp6(1),r.AsE("",Z.appName," ",Z.normTitle,""),r.xp6(2),r.Q6J("ngForOf",Z.table[0]),r.xp6(1),r.Q6J("ngForOf",Z.table.slice(1,Z.table.length-1)),r.xp6(2),r.Q6J("ngForOf",Z.table[Z.table.length-1]),r.xp6(1),r.Q6J("ngIf",Z.tripTitle))},dependencies:[$.mk,$.sg,$.O5],styles:["table[_ngcontent-%COMP%]{width:auto;margin:0 auto;white-space:nowrap}td.elem[_ngcontent-%COMP%]{color:#0f0}td.trip[_ngcontent-%COMP%]{color:#d3d3d3}td.oran[_ngcontent-%COMP%]{color:orange}td.redd[_ngcontent-%COMP%]{color:red}td.gree[_ngcontent-%COMP%]{color:#0f0}td.blue[_ngcontent-%COMP%]{color:#0ff}td.none[_ngcontent-%COMP%]{color:transparent}td.empt[_ngcontent-%COMP%]{background-color:transparent;color:transparent}"],changeDetection:0})}},4436:(fe,K,R)=>{R.d(K,{X:()=>E});var w=R(6404);function r(s,a){return parseInt(a.map(t=>s.includes(t)?"1":"0").join(""),2)||0}function Y(s,a){return s.map((t,i,o)=>r(o.slice(0,i+1),a))}function $(s,a,t,i,o,l){let c=t,m=[c];const d=i.getSpecialNameEntries(c),b=a[a.length-1];if(0!==d.length&&(c=d.find(x=>0===i.getSpecialNameEntries(x).length),m.unshift(d.filter(x=>x!==c).join(" x ")),m.unshift(c)),s.length>0){const x=function W(s,a,t,i,o){const{fusionCalculator:l}=o,c=s.slice(0,1);if(s.length<2)return c;let m=c[0],d=a[0];for(let b=1;b<s.length;b++){const x=s[b],_=a[b],f=l.getFusions(m,t,i).map(k=>(0,w.D0)(k,t)).sort((k,M)=>k.price-M.price);let O=!1;for(const k of f)if(k.name1===x&&(_&t.getDemon(k.name2).inherits)===_){c.push(x),c.push(k.name2),m=c[c.length-1],d=_,O=!0;break}if(O)continue;const J=l.getFusions(x,t,i).reduce((k,M)=>(k[M.name1]=M.name2,k),{});for(const k of f)if(J[k.name2]&&(d&t.getDemon(k.name2).inherits)===d&&(_&t.getDemon(J[k.name2]).inherits)===_){c.push(k.name1),c.push(k.name2),c.push(x),c.push(J[k.name2]),m=c[c.length-1],d=_,O=!0;break}if(!O)return[]}return c}(s,a,i,o,l);if(0===x.length)return[];const _=x[x.length-1];let f=j(_,c,b,i,o,l);if(0===f.length){const O=i.getDemon(c),se=i.getResultDemonLvls(O.race).map(J=>i.reverseLookupDemon(O.race,J)).filter(J=>J!==c);for(const J of o.elementDemons.concat(se)){if((b&i.getDemon(J).inherits)!==b)continue;const k=j(_,J,b,i,o,l),M=j(J,c,b,i,o,l);if(0!==k.length&&0!==M.length){f=k.concat(M.slice(1));break}}}if(0===f.length)return[];m=x.concat(f.slice(1),m.slice(1))}return m}function j(s,a,t,i,o,l){const{fissionCalculator:c,fusionCalculator:m}=l,d=[s];if(s===a)return d;const b=m.getFusions(s,i,o).map(f=>(0,w.D0)(f,i)).sort((f,O)=>f.price-O.price);for(const f of b)if(f.name2===a)return d.push(f.name1),d.push(a),d;const x=c.getFusions(a,i,o).map(f=>(0,w.S6)(f,i)).sort((f,O)=>f.price-O.price);b.sort((f,O)=>O.price-f.price);const _=b.reduce((f,O)=>(f[O.name2]=O.name1,f),{});for(const f of x){if(_[f.name1]&&(t&i.getDemon(f.name1).inherits)===t)return d.push(_[f.name1]),d.push(f.name1),d.push(f.name2),d.push(a),d;if(_[f.name2]&&(t&i.getDemon(f.name2).inherits)===t)return d.push(_[f.name2]),d.push(f.name2),d.push(f.name1),d.push(a),d}return[]}var V=R(627),e=R(4769),S=R(95),P=R(6814),N=R(2173);function T(s,a){if(1&s&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&s){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function C(s,a){if(1&s&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&s){const t=a.$implicit;e.Q6J("ngValue",t),e.xp6(1),e.Oqu(t.name)}}function Z(s,a){if(1&s&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&s){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function h(s,a){if(1&s&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&s){const t=a.$implicit;e.Q6J("ngValue",t),e.xp6(1),e.Oqu(t.name)}}function D(s,a){if(1&s&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&s){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function g(s,a){if(1&s&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&s){const t=a.$implicit;e.Q6J("ngValue",t),e.xp6(1),e.Oqu(t.name)}}function y(s,a){if(1&s&&(e.TgZ(0,"select",25),e.YNc(1,g,2,2,"option",8),e.qZA()),2&s){const t=e.oxw(2).$implicit,i=e.oxw();e.xp6(1),e.Q6J("ngForOf",i.learnedBy[t.controls.skill.value.name])}}function Q(s,a){if(1&s&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&s){const t=a.$implicit;e.Q6J("ngValue",t),e.xp6(1),e.Oqu(t.name)}}function G(s,a){if(1&s&&(e.TgZ(0,"select",25),e.YNc(1,Q,2,2,"option",8),e.qZA()),2&s){const t=e.oxw(2).$implicit,i=e.oxw();e.xp6(1),e.Q6J("ngForOf",i.demons[t.controls.race.value])}}function ne(s,a){if(1&s){const t=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"label"),e._uU(3),e.ALo(4,"translateComp"),e.TgZ(5,"input",20),e.NdJ("change",function(){e.CHM(t);const o=e.oxw().$implicit,l=e.oxw();return e.KtG(l.setIngredDemon(o))}),e.qZA()()(),e.TgZ(6,"td")(7,"select",21),e.NdJ("change",function(){e.CHM(t);const o=e.oxw().$implicit,l=e.oxw();return e.KtG(l.setIngredElem(o))}),e.TgZ(8,"option",22),e._uU(9,"-"),e.qZA(),e.YNc(10,Z,2,2,"option",6),e.qZA()(),e.TgZ(11,"td")(12,"select",23),e.NdJ("change",function(){e.CHM(t);const o=e.oxw().$implicit,l=e.oxw();return e.KtG(l.setIngredDemon(o))}),e.YNc(13,h,2,2,"option",8),e.qZA()(),e.TgZ(14,"td")(15,"select",5),e.NdJ("change",function(){e.CHM(t);const o=e.oxw().$implicit,l=e.oxw();return e.KtG(l.setIngredDemon(o))}),e.TgZ(16,"option",22),e._uU(17,"-"),e.qZA(),e.YNc(18,D,2,2,"option",6),e.qZA()(),e.TgZ(19,"td"),e.YNc(20,y,2,1,"select",24),e.YNc(21,G,2,1,"select",24),e.qZA()()}if(2&s){const t=e.oxw(),i=t.index,o=t.$implicit,l=e.oxw();e.xp6(3),e.AsE("",e.xi3(4,10,l.msgs.LearnsSkill,l.lang),"",i+1," "),e.xp6(4),e.uIk("disabled",!o.controls.searchSkill.value||null),e.xp6(3),e.Q6J("ngForOf",l.elems),e.xp6(2),e.uIk("disabled",!o.controls.searchSkill.value||null),e.xp6(1),e.Q6J("ngForOf",l.skills[o.controls.elem.value]),e.xp6(2),e.uIk("disabled",o.controls.searchSkill.value||null),e.xp6(3),e.Q6J("ngForOf",l.races),e.xp6(2),e.Q6J("ngIf",o.controls.searchSkill.value),e.xp6(1),e.Q6J("ngIf",!o.controls.searchSkill.value)}}function me(s,a){if(1&s&&(e.ynx(0,18),e.YNc(1,ne,22,13,"tr",19),e.BQk()),2&s){const t=a.index,i=e.oxw();e.Q6J("formGroupName",t),e.xp6(1),e.Q6J("ngIf",t<i.maxSkills)}}function ie(s,a){if(1&s&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&s){const t=a.$implicit;e.xp6(1),e.Oqu(t)}}function A(s,a){if(1&s&&(e.TgZ(0,"td",29)(1,"ul"),e.YNc(2,ie,2,1,"li",30),e.qZA()()),2&s){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",t.recipeLeft)}}function I(s,a){if(1&s&&(e.TgZ(0,"td",31),e._uU(1),e.ALo(2,"translateComp"),e.qZA()),2&s){const t=e.oxw(2);e.xp6(1),e.Oqu(e.xi3(2,1,t.msgs.NoRecipesFound,t.lang))}}function L(s,a){if(1&s&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&s){const t=a.$implicit;e.xp6(1),e.Oqu(t)}}function U(s,a){if(1&s&&(e.TgZ(0,"td",29)(1,"ul"),e.YNc(2,L,2,1,"li",30),e.qZA()()),2&s){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",t.recipeRight)}}function X(s,a){if(1&s&&(e.TgZ(0,"td",31),e._uU(1),e.ALo(2,"translateComp"),e.qZA()),2&s){const t=e.oxw(2);e.xp6(1),e.Oqu(e.xi3(2,1,t.msgs.NoRecipesFound,t.lang))}}function pe(s,a){if(1&s&&(e.ynx(0),e._uU(1),e._UZ(2,"br"),e._uU(3),e.BQk()),2&s){const t=e.oxw(2);e.xp6(1),e.AsE(" ",t.recipeResult.join(" x ")," = ",t.recipe.result,""),e.xp6(2),e.hij(" [",t.resultSkills.join(", "),"] ")}}function q(s,a){if(1&s&&(e.ynx(0),e._uU(1),e.ALo(2,"translateComp"),e.BQk()),2&s){const t=e.oxw(2);e.xp6(1),e.Oqu(e.xi3(2,1,t.msgs.NoRecipesFound,t.lang))}}function F(s,a){if(1&s&&(e.TgZ(0,"table",1)(1,"tr")(2,"th",2),e._uU(3),e.ALo(4,"translateComp"),e.qZA()(),e.TgZ(5,"tr")(6,"th"),e._uU(7),e.ALo(8,"translateComp"),e.qZA(),e.TgZ(9,"th"),e._uU(10),e.ALo(11,"translateComp"),e.qZA()(),e.TgZ(12,"tr"),e.YNc(13,A,3,1,"td",26),e.YNc(14,I,3,4,"td",27),e.YNc(15,U,3,1,"td",26),e.YNc(16,X,3,4,"td",27),e.qZA(),e.TgZ(17,"tr")(18,"td",28),e.YNc(19,pe,4,3,"ng-container",19),e.YNc(20,q,3,4,"ng-container",19),e.qZA()()()),2&s){const t=e.oxw();e.xp6(3),e.Oqu(e.xi3(4,9,t.msgs.FusionRecipe,t.lang)),e.xp6(4),e.Oqu(e.xi3(8,12,t.msgs.LeftChain,t.lang)),e.xp6(3),e.Oqu(e.xi3(11,15,t.msgs.RightChain,t.lang)),e.xp6(3),e.Q6J("ngIf",t.recipeLeft.length),e.xp6(1),e.Q6J("ngIf",!t.recipeLeft.length),e.xp6(1),e.Q6J("ngIf",t.recipeRight.length),e.xp6(1),e.Q6J("ngIf",!t.recipeRight.length),e.xp6(3),e.Q6J("ngIf",t.recipe.stepR.length),e.xp6(1),e.Q6J("ngIf",!t.recipe.stepR.length)}}let E=(()=>{class s{constructor(t){this.fb=t,this.maxSkills=8,this.lang="en",this.internalMaxSkills=9,this.range99=Array(99),this.demons={},this.skills={},this.learnedBy={},this.msgs=V.XE,this.blankDemon={name:"-",race:"-",lvl:0,currLvl:0,price:0,inherits:0,skills:{},stats:[],resists:[],affinities:[],fusion:"normal",prereq:""},this.blankSkill={name:"-",element:"-",rank:99,cost:0,effect:"",target:"",level:0,learnedBy:[{demon:"-",level:0}]},this.createForm()}ngOnChanges(){this.initDropdowns()}createForm(){const t=[];for(let i=0;i<this.internalMaxSkills;i++)t.push(this.fb.group({searchSkill:!0,elem:"-",skill:this.blankSkill,race:{value:"-",disabled:!0},demon:this.blankDemon}));this.form=this.fb.group({race:"-",demon:this.blankDemon,ingreds:this.fb.array(t)}),this.form.valueChanges.subscribe(i=>{if(this.form.valid){const o=i.ingreds.filter(c=>"-"!==c.demon.name&&c.demon.name!==i.demon.name).map(c=>c.demon.name),l={};for(const c of i.ingreds)c.searchSkill&&"-"!==c.skill.name&&(l[c.skill.name]=c.demon.name);this.updateRecipe(function n(s,a,t,i,o,l){const{fissionCalculator:c,inheritElems:m,restrictInherits:d,triExclusiveRaces:b,triFissionCalculator:x}=l,{normalChart:_}=o,f=i.getDemon(s),O={};for(const[u,p]of Object.entries(t))"-"!==p&&p!==f.name&&(O[u]=p);const J=r(Object.keys(t).map(u=>i.getSkill(u)).map(u=>u.element),m);let k=i.getSpecialNameEntries(s);if(k.length<2&&b.includes(f.race)){const u=x.getFusions(s,i,o).map(p=>(0,w.Aw)(p,i)).sort((p,v)=>p.price-v.price).find(p=>!((J&(p.d1.inherits|p.d2.inherits))!==J||"special"!==p.d1.fusion&&b.includes(p.d1.race)||"special"!==p.d2.fusion&&b.includes(p.d2.race)||"special"!==p.d3.fusion&&b.includes(p.d3.race)));u&&(k=[u.d1.name,u.d2.name,u.d3.name])}if(k.length<2){const u=c.getFusions(s,i,_).map(p=>(0,w.S6)(p,i)).sort((p,v)=>p.price-v.price).find(p=>!((J&(i.getDemon(p.name1).inherits|i.getDemon(p.name2).inherits))!==J||"normal"!==i.getDemon(p.name1).fusion&&"special"!==i.getDemon(p.name1).fusion||"normal"!==i.getDemon(p.name2).fusion&&"special"!==i.getDemon(p.name2).fusion));u&&(k=[u.name1,u.name2])}const M=k.map(u=>i.getDemon(u)).sort((u,p)=>p.price-u.price),ge=Object.keys(O).map(u=>i.getSkill(u)),oe=r(ge.map(u=>u.element),m),xe=ge.map(u=>r([u.element],m));let re,ue,_e=0;for(let u=0;u<M.length;u++){const p=M[u];for(const v of M.slice(u+1))if((oe&(p.inherits|v.inherits))===oe){const de=(oe&p.inherits).toString(2).split("1").length*(oe&v.inherits).toString(2).split("1").length;_e<de&&(re=p,ue=v,_e=de)}}const le={chain1:[],chain2:[],stepR:k,skills:O,result:s};if(!re)return le;const z=Object.values(O).filter((u,p,v)=>v.indexOf(u)===p),ae=a.filter(u=>!z.includes(u));let B=Math.ceil(z.length/2);z.sort((u,p)=>_.getLightDark(i.getDemon(u).race)-_.getLightDark(i.getDemon(p).race));let ee=z.slice(0,B),ce=Array(ee.length).fill(0),te=z.slice(B),he=Array(te.length).fill(0);if(d){const{left:u,right:p}=function H(s,a,t,i){let o=[],l=[];const c=[],m=[],d={},b=[];for(let x=0;x<t.length;x++){const _=t[x];0!==_?(d.hasOwnProperty(_)||(d[_]=[]),d[_].push(i[x])):b.push(i[x])}for(const x of Object.keys(d).sort()){const _=parseInt(x);c.length<=m.length?(_&s)===_?c.push(_):m.push(_):(_&a)===_?m.push(_):c.push(_)}for(const x of c)o=o.concat(d[x]);for(const x of m)l=l.concat(d[x]);for(const x of b)o.length<l.length?o.push(x):l.push(x);return{left:o.reverse(),right:l.reverse()}}(re.inherits,ue.inherits,xe,ge.map(v=>v.name));ee=u.map(v=>O[v]),ce=Y(u.map(v=>i.getSkill(v).element),m),te=p.map(v=>O[v]),he=Y(p.map(v=>i.getSkill(v).element),m)}return B=Math.ceil(ae.length/2),ee=ae.slice(0,B).concat(ee),ce=Array(B).fill(0).concat(ce),te=ae.slice(B).concat(te),he=Array(ae.length-B).fill(0).concat(he),le.chain1=$(ee,ce,re.name,i,_,l),le.chain2=$(te,he,ue.name,i,_,l),le}(i.demon.name,o,l,this.compendium,this.squareChart,this.recipeConfig))}})}setIngredElem(t){t.controls.skill.setValue(this.skills[t.controls.elem.value][0]),this.setIngredDemon(t)}setIngredDemon(t){t.controls.demon.setValue((t.controls.searchSkill.value?this.learnedBy[t.controls.skill.value.name]:this.demons[t.controls.race.value])[0])}updateRecipe(t){const i={};for(const[o,l]of Object.entries(t.skills)){i[l]||(i[l]=[]);const c=this.compendium.getDemon(l).skills[o];i[l].push(o+(c>=2?` (${c})`:""))}this.recipe=t,this.recipeLeft=this.decodeRecipechain(t.chain1,i),this.recipeRight=this.decodeRecipechain(t.chain2,i),this.resultSkills=[],this.recipeResult=[];for(const o of t.stepR)this.recipeResult.push(i[o]?`${o} [${i[o].join(", ")}]`:o);for(const[o,l]of Object.entries(this.compendium.getDemon(t.result).skills).filter(c=>c[1]<2e3).sort((c,m)=>c[1]-m[1]))this.resultSkills.push(o+(l>=2?` (${l})`:""))}decodeRecipechain(t,i){const o=[];for(let l=0;l<t.length-2;l+=2){const c=i[t[l]]?"["+i[t[l]].join(", ")+"] ":"",m=i[t[l+1]]?"["+i[t[l+1]].join(", ")+"] ":"";o.push(`${t[l]} ${c}x ${t[l+1]} ${m}= ${t[l+2]}`)}return o}initDropdowns(){if(this.recipeConfig&&this.compendium&&this.squareChart){this.demons={"-":[this.blankDemon]},this.skills={"-":[this.blankSkill]},this.learnedBy={"-":[this.blankDemon]};for(const t of this.compendium.allDemons)if(!t.isEnemy&&"party"!==t.fusion&&"enemy"!==t.fusion){this.demons[t.race]||(this.demons[t.race]=[]),this.demons[t.race].push(t);for(const i of Object.keys(t.skills))this.learnedBy[i]||(this.learnedBy[i]=[]),this.learnedBy[i].push(t)}for(const t of this.compendium.allSkills.filter(i=>i.rank<50&&i.learnedBy.length>0))this.skills[t.element]||(this.skills[t.element]=[]),this.skills[t.element].push(t);for(const t of Object.values(this.demons))t.sort((i,o)=>i.lvl-o.lvl);for(const t of Object.values(this.learnedBy))t.sort((i,o)=>i.lvl-o.lvl);for(const t of Object.values(this.skills))t.sort((i,o)=>i.rank-o.rank);this.races=this.recipeConfig.races.filter(t=>this.demons[t]),this.elems=this.recipeConfig.skillElems.filter(t=>this.skills[t]),this.setDemon(this.compendium.getDemon(this.recipeConfig.defaultDemon))}}setDemon(t){const i=[],{inheritElems:o}=this.recipeConfig,l=Object.entries(t.skills).slice(0,this.internalMaxSkills).filter(m=>m[1]<2).map(m=>this.compendium.getSkill(m[0])),c=Object.entries(t.skills).slice(0,this.internalMaxSkills).filter(m=>m[1]<100).map(m=>this.compendium.getSkill(m[0]));for(let m=0;m<o.length;m++)t.inherits&1<<m||i.push(o[o.length-m-1]);this.skills[this.blankSkill.element]=[this.blankSkill].concat(c),this.elems=this.recipeConfig.skillElems.filter(m=>this.skills[m]&&!i.includes(m)),this.form.patchValue({race:t.race,demon:t,ingreds:l.concat(Array(this.internalMaxSkills-l.length).fill(this.blankSkill)).map(m=>({searchSkill:!0,elem:"-",skill:m,race:"-",demon:"-"!==m.name?t:this.blankDemon}))})}static#e=this.\u0275fac=function(i){return new(i||s)(e.Y36(S.qu))};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["app-recipe-generator"]],inputs:{maxSkills:"maxSkills",compendium:"compendium",squareChart:"squareChart",recipeConfig:"recipeConfig",lang:"lang"},features:[e.TTD],decls:46,vars:45,consts:[[3,"formGroup"],[1,"entry-table"],["colspan","2",1,"title"],[2,"width","40%"],[2,"width","60%"],["formControlName","race",3,"change"],[3,"value",4,"ngFor","ngForOf"],["formControlName","demon",3,"change"],[3,"ngValue",4,"ngFor","ngForOf"],["formArrayName","ingreds",1,"entry-table"],["colspan","5",1,"title"],[2,"width","20%"],[2,"width","10%"],[2,"width","25%"],[3,"formGroupName",4,"ngFor","ngForOf"],["class","entry-table",4,"ngIf"],[3,"value"],[3,"ngValue"],[3,"formGroupName"],[4,"ngIf"],["formControlName","searchSkill","type","checkbox",3,"change"],["formControlName","elem",3,"change"],["value","-"],["formControlName","skill",3,"change"],["formControlName","demon",4,"ngIf"],["formControlName","demon"],["style","width: 50%",4,"ngIf"],["style","width: 50%","style","padding: 1em; text-align: center;",4,"ngIf"],["colspan","2",2,"padding","1em","text-align","center"],[2,"width","50%"],[4,"ngFor","ngForOf"],[2,"padding","1em","text-align","center"]],template:function(i,o){1&i&&(e.TgZ(0,"form",0)(1,"h2"),e._uU(2),e.ALo(3,"translateComp"),e.qZA(),e.TgZ(4,"table",1)(5,"tr")(6,"th",2),e._uU(7),e.ALo(8,"translateComp"),e.qZA()(),e.TgZ(9,"tr")(10,"th",3),e._uU(11),e.ALo(12,"translateComp"),e.qZA(),e.TgZ(13,"th",4),e._uU(14),e.ALo(15,"translateComp"),e.qZA()(),e.TgZ(16,"tr")(17,"td")(18,"select",5),e.NdJ("change",function(){return o.setDemon(o.demons[o.form.controls.race.value][0])}),e.YNc(19,T,2,2,"option",6),e.qZA()(),e.TgZ(20,"td")(21,"select",7),e.NdJ("change",function(){return o.setDemon(o.form.controls.demon.value)}),e.YNc(22,C,2,2,"option",8),e.qZA()()()(),e.TgZ(23,"table",9)(24,"tr")(25,"th",10),e._uU(26),e.ALo(27,"translateComp"),e.qZA()(),e.TgZ(28,"tr")(29,"th",11),e._uU(30),e.ALo(31,"translateComp"),e.qZA(),e.TgZ(32,"th",12),e._uU(33),e.ALo(34,"translateComp"),e.qZA(),e.TgZ(35,"th",13),e._uU(36),e.ALo(37,"translateComp"),e.qZA(),e.TgZ(38,"th",11),e._uU(39),e.ALo(40,"translateComp"),e.qZA(),e.TgZ(41,"th",13),e._uU(42),e.ALo(43,"translateComp"),e.qZA()(),e.YNc(44,me,2,2,"ng-container",14),e.qZA(),e.YNc(45,F,21,18,"table",15),e.qZA()),2&i&&(e.Q6J("formGroup",o.form),e.xp6(2),e.Oqu(e.xi3(3,15,o.msgs.RecipeGenerator,o.lang)),e.xp6(5),e.Oqu(e.xi3(8,18,o.msgs.Target,o.lang)),e.xp6(4),e.Oqu(e.xi3(12,21,o.msgs.Race,o.lang)),e.xp6(3),e.Oqu(e.xi3(15,24,o.msgs.Name,o.lang)),e.xp6(5),e.Q6J("ngForOf",o.races),e.xp6(3),e.Q6J("ngForOf",o.demons[o.form.controls.race.value]),e.xp6(4),e.Oqu(e.xi3(27,27,o.msgs.IncludeIngredients,o.lang)),e.xp6(4),e.Oqu(e.xi3(31,30,o.msgs.FilterBy,o.lang)),e.xp6(3),e.Oqu(e.xi3(34,33,o.msgs.Elem,o.lang)),e.xp6(3),e.Oqu(e.xi3(37,36,o.msgs.Skill,o.lang)),e.xp6(3),e.Oqu(e.xi3(40,39,o.msgs.Race,o.lang)),e.xp6(3),e.Oqu(e.xi3(43,42,o.msgs.Ingredient,o.lang)),e.xp6(2),e.Q6J("ngForOf",o.form.controls.ingreds.controls),e.xp6(1),e.Q6J("ngIf",o.recipe))},dependencies:[P.sg,P.O5,S._Y,S.YN,S.Kr,S.Wl,S.EJ,S.JJ,S.JL,S.sg,S.u,S.x0,S.CE,N.zi],styles:["ul[_ngcontent-%COMP%]{padding:0 1em;list-style:none}td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-height:25px;width:100%}"],changeDetection:0})}return s})()}}]);