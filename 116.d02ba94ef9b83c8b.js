"use strict";(self.webpackChunkmegaten_fusion_tool=self.webpackChunkmegaten_fusion_tool||[]).push([[116],{9012:(ue,V,F)=>{F.d(V,{N:()=>U});var t=F(4769),j=F(6814),G=F(2173);function M(m,T){if(1&m&&(t.TgZ(0,"th",4),t._uU(1,"Inheritable Skills"),t.qZA()),2&m){const f=t.oxw();t.uIk("colspan",f.inheritHeaders.length)}}function w(m,T){if(1&m&&(t.TgZ(0,"th",4),t._uU(1),t.qZA()),2&m){const f=t.oxw();t.uIk("colspan",f.inheritHeaders.length),t.xp6(1),t.hij(" ",f.langEn?"Skill Affinities":"\u30b9\u30ad\u30eb\u9069\u6b63"," ")}}function K(m,T){if(1&m&&(t.ynx(0),t._uU(1),t.BQk()),2&m){const f=t.oxw().$implicit;t.xp6(1),t.Oqu(f)}}function P(m,T){if(1&m&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&m){const f=t.oxw().$implicit;t.Gre("element-icon ",f,""),t.xp6(1),t.Oqu(f)}}function W(m,T){if(1&m&&(t.TgZ(0,"th"),t.YNc(1,K,2,1,"ng-container",3),t.YNc(2,P,2,4,"div",5),t.qZA()),2&m){const f=t.oxw();t.Udp("width",100/f.inheritHeaders.length,"%"),t.xp6(1),t.Q6J("ngIf",!f.hasIcons),t.xp6(1),t.Q6J("ngIf",f.hasIcons)}}function e(m,T){if(1&m&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&m){const f=T.$implicit;t.Udp("color",f?null:"transparent"),t.xp6(1),t.hij(" ",f?"yes":"no"," ")}}function N(m,T){if(1&m&&(t.TgZ(0,"tr"),t.YNc(1,e,2,3,"td",6),t.qZA()),2&m){const f=t.oxw();t.xp6(1),t.Q6J("ngForOf",f.inherits)}}function L(m,T){if(1&m&&(t.TgZ(0,"td"),t.ALo(1,"roundInheritPercent"),t._uU(2),t.qZA()),2&m){const f=T.$implicit;t.Gre("affinity",t.lcZ(1,4,100*f),""),t.xp6(2),t.hij(" ",100*f,"% ")}}function I(m,T){if(1&m&&(t.TgZ(0,"tr"),t.YNc(1,L,3,6,"td",7),t.qZA()),2&m){const f=t.oxw();t.xp6(1),t.Q6J("ngForOf",f.inherits)}}function C(m,T){if(1&m&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"affinityToString"),t.qZA()),2&m){const f=T.$implicit;t.Gre("affinity",f,""),t.xp6(1),t.hij(" ",t.lcZ(2,4,f)," ")}}function _(m,T){if(1&m&&(t.TgZ(0,"tr"),t.YNc(1,C,3,6,"td",7),t.qZA()),2&m){const f=t.oxw();t.xp6(1),t.Q6J("ngForOf",f.inherits)}}let U=(()=>{var m;class T{constructor(){this.inheritHeaders=[],this.inherits=[],this.hasChance=!1,this.hasIcons=!0,this.hasLvls=!1,this.langEn=!0}}return(m=T).\u0275fac=function(S){return new(S||m)},m.\u0275cmp=t.Xpm({type:m,selectors:[["app-demon-inherits"]],inputs:{inheritHeaders:"inheritHeaders",inherits:"inherits",hasChance:"hasChance",hasIcons:"hasIcons",hasLvls:"hasLvls",langEn:"langEn"},decls:11,vars:6,consts:[[1,"entry-table"],["class","title",4,"ngIf"],[3,"width",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"title"],[3,"class",4,"ngIf"],[3,"color",4,"ngFor","ngForOf"],[3,"class",4,"ngFor","ngForOf"]],template:function(S,J){1&S&&(t.TgZ(0,"table",0)(1,"thead")(2,"tr"),t.YNc(3,M,2,1,"th",1),t.YNc(4,w,2,2,"th",1),t.qZA(),t.TgZ(5,"tr"),t.YNc(6,W,3,4,"th",2),t.qZA()(),t.TgZ(7,"tbody"),t.YNc(8,N,2,1,"tr",3),t.YNc(9,I,2,1,"tr",3),t.YNc(10,_,2,1,"tr",3),t.qZA()()),2&S&&(t.xp6(3),t.Q6J("ngIf",!J.hasLvls),t.xp6(1),t.Q6J("ngIf",J.hasLvls&&J.inheritHeaders.length),t.xp6(2),t.Q6J("ngForOf",J.inheritHeaders),t.xp6(2),t.Q6J("ngIf",!J.hasLvls&&!J.hasChance),t.xp6(1),t.Q6J("ngIf",J.hasChance),t.xp6(1),t.Q6J("ngIf",J.hasLvls))},dependencies:[j.sg,j.O5,G.JZ,G.DY],encapsulation:2,changeDetection:0}),T})()},8615:(ue,V,F)=>{F.d(V,{R:()=>L});var w,t=F(4769),j=F(6593),G=F(4487),M=F(6814);function K(I,C){if(1&I&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&I){const _=C.$implicit,U=t.oxw();t.xp6(1),t.Oqu(_.slice(0,U.nameCut))}}function P(I,C){if(1&I&&(t.TgZ(0,"td",4),t._uU(1),t.qZA()),2&I){const _=C.$implicit,U=t.oxw(2);t.Q6J("ngClass",_.slice(0,4)),t.xp6(1),t.Oqu(_.slice(4,U.nameCut+4))}}function W(I,C){if(1&I&&(t.TgZ(0,"tr")(1,"th"),t._uU(2),t.qZA(),t.YNc(3,P,2,2,"td",3),t.TgZ(4,"th"),t._uU(5),t.qZA()()),2&I){const _=C.$implicit;t.xp6(2),t.Oqu(_[0]),t.xp6(1),t.Q6J("ngForOf",_.slice(1,_.length-1)),t.xp6(2),t.Oqu(_[_.length-1])}}function e(I,C){if(1&I&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&I){const _=C.$implicit,U=t.oxw();t.xp6(1),t.Oqu(_.slice(0,U.nameCut))}}function N(I,C){if(1&I&&(t.TgZ(0,"tr")(1,"th",0),t._uU(2),t.qZA()()),2&I){const _=t.oxw();t.xp6(1),t.uIk("colspan",_.table[0].length),t.xp6(1),t.AsE("",_.appName," ",_.tripTitle,"")}}class L{constructor(C,_){this.title2=C,this.route=_,this.normTitle="Normal Fusions",this.tripTitle="",this.isPersona=!1,this.filterDarks=!0,this.langEn=!0,this.subscriptions=[],this.table=[],this.nameCut=4}ngOnInit(){this.subscriptions.push(this.route.parent.data.subscribe(C=>{this.appName=C.appName||"Shin Megami Tensei",this.nameCut=this.langEn?4:2,this.title2.setTitle(this.langEn?`Fusion Chart - ${this.appName} Fusion Calculator`:`\u5408\u4f53\u8868 ${this.appName} \u5408\u4f53\u30a2\u30d7\u30ea`)}))}ngOnChanges(){this.normChart&&this.fillFusionChart()}ngOnDestroy(){for(const C of this.subscriptions)C.unsubscribe()}fillFusionChart(){const C="noneNone",U=L.RESULT_COLORS.reduce((k,[A,y])=>y.reduce((E,X)=>(E[X]=A,E),k),{}),m=this.normChart.elementDemons;let T=[],f=this.normChart.races,S=[];this.filterDarks&&(T=this.normChart.races.filter(k=>this.normChart.getLightDark(k)>0),f=this.normChart.races.filter(k=>0===this.normChart.getLightDark(k)),S=this.normChart.races.filter(k=>-1===this.normChart.getLightDark(k)),0===S.length&&T.length>0&&(T=this.normChart.races.filter(k=>this.normChart.getLightDark(k)>-1),f=[],S=this.normChart.races.filter(k=>this.normChart.getLightDark(k)<-1)));const J=T.length-S.length,Q=T.concat(f,m),ne=S.length?S.concat(Array(Q.length-S.length).fill("")):Q,he=this.mitaTable?Q:T.concat(f,Array(m.length).fill("")),ie=this.mitaTable||S.length?Array(J).fill("").concat(S,f,m):Q;this.table=[[""].concat(Q,[""])];for(let k=0;k<ie.length;k++){const A=Array(Q.length+2).fill("empt-"),y=ie[k],E=he[k],X=-1!==m.indexOf(y),me=-1!==m.indexOf(E);this.table.push(A),A[0]=y,A[A.length-1]=E;for(let b=k;b<Q.length;b++){const v=Q[b],i=-1!==m.indexOf(v);if(i&&me){const r=m.indexOf(E),o=m.indexOf(v),n=this.mitaTable[r][o-r-1];A[b+1]=n?(U[n]||"norm")+n:C}else if(i&&E){const r=this.normChart.getElemFusions(v)[E];A[b+1]=r?(U[r]||"rank")+(r>0?"+":"")+r.toString():C}else if(v&&E){const r=this.isPersona&&v===E?v:this.normChart.getRaceFusion(v,E);A[b+1]=r?(U[r]||(v===E?"elem":"norm"))+r:C}}if(this.tripChart)for(let b=0;b<=k-J;b++){const v=ne[b];if(v&&X){const i=this.tripChart.getElemFusions(y)[v];A[b+1]=i?(U[i]||"rank")+(i>0?"+":"")+i.toString():C}else if(v&&y){const i=this.tripChart.getRaceFusion(v,y);A[b+1]=i?(U[i]||(v===y?"elem":"trip"))+i:C}}if(-1!==y.indexOf(" x ")){const[b,v]=y.split(" x "),i=b.slice(0,3)+"x"+v.slice(0,3);A[0]=i,A[A.length-1]=i}else if(-1!==y.indexOf(" ")){const b=y.split(" ")[0];A[0]=b,A[A.length-1]=b}}for(let k=0;k<this.table[0].length;k++){const A=this.table[0][k];if(-1!==A.indexOf(" x ")){const[y,E]=A.split(" x ");this.table[0][k]=y.slice(0,2)+E.slice(0,2)}}this.table.push([""].concat(ne,[""]))}}(w=L).RESULT_COLORS=Object.entries({oran:["-2","Erthys","Gnome","Saki","Saki Mitama","Random","\u30a2\u30fc\u30b7\u30fc\u30ba","\u30ce\u30fc\u30e0","\u30b5\u30ad\u30df\u30bf\u30de"],redd:["-1","Flaemis","Salamander","Ara ","Ara Mitama","Fiend","\u30d5\u30ec\u30a4\u30df\u30fc\u30ba","\u30b5\u30e9\u30de\u30f3\u30c0\u30fc","\u30a2\u30e9\u30df\u30bf\u30de"],gree:["1","Aeros","Sylph","Kusi","Kusi Mitama","UMA","\u30a8\u30a2\u30ed\u30b9","\u30b7\u30eb\u30ad\u30fc","\u30af\u30b7\u30df\u30bf\u30de"],blue:["2","Aquans","Undine","Nigi","Nigi Mitama","Enigma","\u30a2\u30af\u30a2\u30f3\u30ba","\u30a6\u30f3\u30c7\u30a3\u30fc\u30cd","\u30cb\u30ae\u30df\u30bf\u30de"]}),w.\u0275fac=function(C){return new(C||w)(t.Y36(j.Dx),t.Y36(G.gz))},w.\u0275cmp=t.Xpm({type:w,selectors:[["app-fusion-chart"]],inputs:{normChart:"normChart",tripChart:"tripChart",mitaTable:"mitaTable",normTitle:"normTitle",tripTitle:"tripTitle",isPersona:"isPersona",filterDarks:"filterDarks",langEn:"langEn",counter:"counter"},features:[t.TTD],decls:12,vars:7,consts:[[1,"title"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(C,_){1&C&&(t.TgZ(0,"table")(1,"tbody")(2,"tr")(3,"th",0),t._uU(4),t.qZA()(),t.TgZ(5,"tr"),t.YNc(6,K,2,1,"th",1),t.qZA(),t.YNc(7,W,6,3,"tr",1),t.TgZ(8,"tr"),t.YNc(9,e,2,1,"th",1),t.qZA(),t.YNc(10,N,3,3,"tr",2),t.qZA(),t._UZ(11,"tbody"),t.qZA()),2&C&&(t.xp6(3),t.uIk("colspan",_.table[0].length),t.xp6(1),t.AsE("",_.appName," ",_.normTitle,""),t.xp6(2),t.Q6J("ngForOf",_.table[0]),t.xp6(1),t.Q6J("ngForOf",_.table.slice(1,_.table.length-1)),t.xp6(2),t.Q6J("ngForOf",_.table[_.table.length-1]),t.xp6(1),t.Q6J("ngIf",_.tripTitle))},dependencies:[M.mk,M.sg,M.O5],styles:["table[_ngcontent-%COMP%]{width:auto;margin:0 auto;white-space:nowrap}td.elem[_ngcontent-%COMP%]{color:#0f0}td.trip[_ngcontent-%COMP%]{color:#d3d3d3}td.oran[_ngcontent-%COMP%]{color:orange}td.redd[_ngcontent-%COMP%]{color:red}td.gree[_ngcontent-%COMP%]{color:#0f0}td.blue[_ngcontent-%COMP%]{color:#0ff}td.none[_ngcontent-%COMP%]{color:transparent}td.empt[_ngcontent-%COMP%]{background-color:transparent;color:transparent}"],changeDetection:0})},4436:(ue,V,F)=>{F.d(V,{X:()=>v});var t=F(6404);function G(i,r){return parseInt(r.map(o=>i.includes(o)?"1":"0").join(""),2)||0}function M(i,r){return i.map((o,n,s)=>G(s.slice(0,n+1),r))}function K(i,r,o,n,s,l){let a=o,c=[a];const u=n.getSpecialNameEntries(a),O=r[r.length-1];if(0!==u.length&&(a=u.find(x=>0===n.getSpecialNameEntries(x).length),c.unshift(u.filter(x=>x!==a).join(" x ")),c.unshift(a)),i.length>0){const x=function W(i,r,o,n,s){const{fusionCalculator:l}=s,a=i.slice(0,1);if(i.length<2)return a;let c=a[0],u=r[0];for(let O=1;O<i.length;O++){const x=i[O],d=r[O],g=l.getFusions(c,o,n).map(Z=>(0,t.D0)(Z,o)).sort((Z,Y)=>Z.price-Y.price);let R=!1;for(const Z of g)if(Z.name1===x&&(d&o.getDemon(Z.name2).inherits)===d){a.push(x),a.push(Z.name2),c=a[a.length-1],u=d,R=!0;break}if(R)continue;const q=l.getFusions(x,o,n).reduce((Z,Y)=>(Z[Y.name1]=Y.name2,Z),{});for(const Z of g)if(q[Z.name2]&&(u&o.getDemon(Z.name2).inherits)===u&&(d&o.getDemon(q[Z.name2]).inherits)===d){a.push(Z.name1),a.push(Z.name2),a.push(x),a.push(q[Z.name2]),c=a[a.length-1],u=d,R=!0;break}if(!R)return[]}return a}(i,r,n,s,l);if(0===x.length)return[];const d=x[x.length-1];let g=P(d,a,O,n,s,l);if(0===g.length){const R=n.getDemon(a),$=n.getResultDemonLvls(R.race).map(q=>n.reverseLookupDemon(R.race,q)).filter(q=>q!==a);for(const q of s.elementDemons.concat($)){if((O&n.getDemon(q).inherits)!==O)continue;const Z=P(d,q,O,n,s,l),Y=P(q,a,O,n,s,l);if(0!==Z.length&&0!==Y.length){g=Z.concat(Y.slice(1));break}}}if(0===g.length)return[];c=x.concat(g.slice(1),c.slice(1))}return c}function P(i,r,o,n,s,l){const{fissionCalculator:a,fusionCalculator:c}=l,u=[i];if(i===r)return u;const O=c.getFusions(i,n,s).map(g=>(0,t.D0)(g,n)).sort((g,R)=>g.price-R.price);for(const g of O)if(g.name2===r)return u.push(g.name1),u.push(r),u;const x=a.getFusions(r,n,s).map(g=>(0,t.S6)(g,n)).sort((g,R)=>g.price-R.price);O.sort((g,R)=>R.price-g.price);const d=O.reduce((g,R)=>(g[R.name2]=R.name1,g),{});for(const g of x){if(d[g.name1]&&(o&n.getDemon(g.name1).inherits)===o)return u.push(d[g.name1]),u.push(g.name1),u.push(g.name2),u.push(r),u;if(d[g.name2]&&(o&n.getDemon(g.name2).inherits)===o)return u.push(d[g.name2]),u.push(g.name2),u.push(g.name1),u.push(r),u}return[]}var e=F(4769),N=F(95),L=F(6814);function I(i,r){if(1&i&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&i){const o=r.$implicit;e.Q6J("value",o),e.xp6(1),e.Oqu(o)}}function C(i,r){if(1&i&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&i){const o=r.$implicit;e.Q6J("ngValue",o),e.xp6(1),e.Oqu(o.name)}}function _(i,r){if(1&i&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&i){const o=r.$implicit;e.Q6J("value",o),e.xp6(1),e.Oqu(o)}}function U(i,r){if(1&i&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&i){const o=r.$implicit;e.Q6J("ngValue",o),e.xp6(1),e.Oqu(o.name)}}function m(i,r){if(1&i&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&i){const o=r.$implicit;e.Q6J("value",o),e.xp6(1),e.Oqu(o)}}function T(i,r){if(1&i&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&i){const o=r.$implicit;e.Q6J("ngValue",o),e.xp6(1),e.AsE("",o.name," ",o.lvl?"("+o.lvl+")":"","")}}function f(i,r){if(1&i&&(e.TgZ(0,"select",25),e.YNc(1,T,2,3,"option",8),e.qZA()),2&i){const o=e.oxw(2).$implicit,n=e.oxw();e.xp6(1),e.Q6J("ngForOf",n.learnedBy[o.controls.skill.value.name])}}function S(i,r){if(1&i&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&i){const o=r.$implicit;e.Q6J("ngValue",o),e.xp6(1),e.AsE("",o.name," ",o.lvl?"("+o.lvl+")":"","")}}function J(i,r){if(1&i&&(e.TgZ(0,"select",25),e.YNc(1,S,2,3,"option",8),e.qZA()),2&i){const o=e.oxw(2).$implicit,n=e.oxw();e.xp6(1),e.Q6J("ngForOf",n.demons[o.controls.race.value])}}function Q(i,r){if(1&i){const o=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"label"),e._uU(3,"Search Skill "),e.TgZ(4,"input",20),e.NdJ("change",function(){e.CHM(o);const s=e.oxw().$implicit,l=e.oxw();return e.KtG(l.setIngredDemon(s))}),e.qZA()()(),e.TgZ(5,"td")(6,"select",21),e.NdJ("change",function(){e.CHM(o);const s=e.oxw().$implicit,l=e.oxw();return e.KtG(l.setIngredElem(s))}),e.TgZ(7,"option",22),e._uU(8,"-"),e.qZA(),e.YNc(9,_,2,2,"option",6),e.qZA()(),e.TgZ(10,"td")(11,"select",23),e.NdJ("change",function(){e.CHM(o);const s=e.oxw().$implicit,l=e.oxw();return e.KtG(l.setIngredDemon(s))}),e.YNc(12,U,2,2,"option",8),e.qZA()(),e.TgZ(13,"td")(14,"select",5),e.NdJ("change",function(){e.CHM(o);const s=e.oxw().$implicit,l=e.oxw();return e.KtG(l.setIngredDemon(s))}),e.TgZ(15,"option",22),e._uU(16,"-"),e.qZA(),e.YNc(17,m,2,2,"option",6),e.qZA()(),e.TgZ(18,"td"),e.YNc(19,f,2,1,"select",24),e.YNc(20,J,2,1,"select",24),e.qZA()()}if(2&i){const o=e.oxw().$implicit,n=e.oxw();e.xp6(6),e.uIk("disabled",!o.controls.searchSkill.value||null),e.xp6(3),e.Q6J("ngForOf",n.elems),e.xp6(2),e.uIk("disabled",!o.controls.searchSkill.value||null),e.xp6(1),e.Q6J("ngForOf",n.skills[o.controls.elem.value]),e.xp6(2),e.uIk("disabled",o.controls.searchSkill.value||null),e.xp6(3),e.Q6J("ngForOf",n.races),e.xp6(2),e.Q6J("ngIf",o.controls.searchSkill.value),e.xp6(1),e.Q6J("ngIf",!o.controls.searchSkill.value)}}function ne(i,r){if(1&i&&(e.ynx(0,18),e.YNc(1,Q,21,8,"tr",19),e.BQk()),2&i){const o=r.index,n=e.oxw();e.Q6J("formGroupName",o),e.xp6(1),e.Q6J("ngIf",o<n.maxSkills)}}function he(i,r){if(1&i&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&i){const o=r.$implicit;e.xp6(1),e.Oqu(o)}}function ie(i,r){if(1&i&&(e.TgZ(0,"td",29)(1,"ul"),e.YNc(2,he,2,1,"li",30),e.qZA()()),2&i){const o=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",o.recipeLeft)}}function k(i,r){1&i&&(e.TgZ(0,"td",31),e._uU(1,"No chains found"),e.qZA())}function A(i,r){if(1&i&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&i){const o=r.$implicit;e.xp6(1),e.Oqu(o)}}function y(i,r){if(1&i&&(e.TgZ(0,"td",29)(1,"ul"),e.YNc(2,A,2,1,"li",30),e.qZA()()),2&i){const o=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",o.recipeRight)}}function E(i,r){1&i&&(e.TgZ(0,"td",31),e._uU(1,"No chains found"),e.qZA())}function X(i,r){if(1&i&&(e.ynx(0),e._uU(1),e._UZ(2,"br"),e._uU(3),e.BQk()),2&i){const o=e.oxw(2);e.xp6(1),e.AsE(" ",o.recipeResult.join(" x ")," = ",o.recipe.result,""),e.xp6(2),e.hij(" [",o.resultSkills.join(", "),"] ")}}function me(i,r){1&i&&(e.ynx(0),e._uU(1,"No recipes found"),e.BQk())}function b(i,r){if(1&i&&(e.TgZ(0,"table",1)(1,"tr")(2,"th",2),e._uU(3,"Fusion Recipe"),e.qZA()(),e.TgZ(4,"tr")(5,"th"),e._uU(6,"Left Chain"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Right Chain"),e.qZA()(),e.TgZ(9,"tr"),e.YNc(10,ie,3,1,"td",26),e.YNc(11,k,2,0,"td",27),e.YNc(12,y,3,1,"td",26),e.YNc(13,E,2,0,"td",27),e.qZA(),e.TgZ(14,"tr")(15,"td",28),e.YNc(16,X,4,3,"ng-container",19),e.YNc(17,me,2,0,"ng-container",19),e.qZA()()()),2&i){const o=e.oxw();e.xp6(10),e.Q6J("ngIf",o.recipeLeft.length),e.xp6(1),e.Q6J("ngIf",!o.recipeLeft.length),e.xp6(1),e.Q6J("ngIf",o.recipeRight.length),e.xp6(1),e.Q6J("ngIf",!o.recipeRight.length),e.xp6(3),e.Q6J("ngIf",o.recipe.stepR.length),e.xp6(1),e.Q6J("ngIf",!o.recipe.stepR.length)}}let v=(()=>{var i;class r{constructor(n){this.fb=n,this.defaultDemon="Pixie",this.maxSkills=8,this.internalMaxSkills=9,this.range99=Array(99),this.demons={},this.skills={},this.learnedBy={},this.blankDemon={name:"-",race:"-",lvl:0,currLvl:0,price:0,inherits:0,skills:{},stats:[],resists:[],affinities:[],fusion:"normal",prereq:""},this.blankSkill={name:"-",element:"-",rank:99,cost:0,effect:"",target:"",level:0,learnedBy:[{demon:"-",level:0}]},this.createForm()}ngOnChanges(){this.initDropdowns()}createForm(){const n=[];for(let s=0;s<this.internalMaxSkills;s++)n.push(this.fb.group({searchSkill:!0,elem:"-",skill:this.blankSkill,race:"-",demon:this.blankDemon}));this.form=this.fb.group({race:"-",demon:this.blankDemon,ingreds:this.fb.array(n)}),this.form.valueChanges.subscribe(s=>{if(this.form.valid){const l=s.ingreds.filter(c=>"-"!==c.demon.name&&c.demon.name!==s.demon.name).map(c=>c.demon.name),a=s.ingreds.filter(c=>c.searchSkill&&"-"!==c.skill.name).map(c=>c.skill.name);this.updateRecipe(function j(i,r,o,n,s,l){const{fissionCalculator:a,inheritElems:c,restrictInherits:u,triExclusiveRaces:O,triFissionCalculator:x}=l,{normalChart:d}=s,g=n.getDemon(i),R=o.map(h=>n.getSkill(h)).filter((h,p,D)=>h.rank<50&&h.learnedBy.length>0&&!g.skills.hasOwnProperty(h.name)&&D.indexOf(h)===p),$=G(R.map(h=>h.element),c);let q=n.getSpecialNameEntries(i);if(q.length<2&&O.includes(g.race)){const h=x.getFusions(i,n,s).map(p=>(0,t.Aw)(p,n)).sort((p,D)=>p.price-D.price).find(p=>!(($&(p.d1.inherits|p.d2.inherits|p.d3.inherits))!==$||"special"!==p.d1.fusion&&O.includes(p.d1.race)||"special"!==p.d2.fusion&&O.includes(p.d2.race)||"special"!==p.d3.fusion&&O.includes(p.d3.race)));h&&(q=[h.d1.name,h.d2.name,h.d3.name])}if(q.length<2){const h=a.getFusions(i,n,d).map(p=>(0,t.S6)(p,n)).sort((p,D)=>p.price-D.price).find(p=>!(($&(n.getDemon(p.name1).inherits|n.getDemon(p.name2).inherits))!==$||"normal"!==n.getDemon(p.name1).fusion&&"special"!==n.getDemon(p.name1).fusion||"normal"!==n.getDemon(p.name2).fusion&&"special"!==n.getDemon(p.name2).fusion));h&&(q=[h.name1,h.name2])}const Z=q.map(h=>n.getDemon(h)).sort((h,p)=>p.price-h.price),Y=r.map(h=>n.getDemon(h)).sort((h,p)=>p.price-h.price),pe={},H={};for(const h of R){for(const p of Z)p.skills.hasOwnProperty(h.name)&&(pe[h.name]=p.name);if(!pe[h.name])for(const p of Y)p.skills.hasOwnProperty(h.name)&&(H[h.name]=p.name)}const fe=Object.keys(H).map(h=>n.getSkill(h)),oe=G(fe.map(h=>h.element),c),xe=fe.map(h=>G([h.element],c));let se,ge,_e=0;for(let h=0;h<Z.length;h++){const p=Z[h];for(const D of Z.slice(h+1))if((oe&(p.inherits|D.inherits))===oe){const de=(oe&p.inherits).toString(2).split("1").length*(oe&D.inherits).toString(2).split("1").length;_e<de&&(se=p,ge=D,_e=de)}}const re={chain1:[],chain2:[],stepR:q,skills:Object.assign(H,pe),result:i};if(!se)return re;const z=Object.values(H).filter((h,p,D)=>D.indexOf(h)===p),le=r.filter(h=>!z.includes(h));let B=Math.ceil(z.length/2);z.sort((h,p)=>d.getLightDark(n.getDemon(h).race)-d.getLightDark(n.getDemon(p).race));let ee=z.slice(0,B),ae=Array(ee.length).fill(0),te=z.slice(B),ce=Array(te.length).fill(0);if(u){const{left:h,right:p}=function w(i,r,o,n){let s=[],l=[];const a=[],c=[],u={},O=[];for(let x=0;x<o.length;x++){const d=o[x];0!==d?(u.hasOwnProperty(d)||(u[d]=[]),u[d].push(n[x])):O.push(n[x])}for(const x of Object.keys(u).sort()){const d=parseInt(x);a.length<=c.length?(d&i)===d?a.push(d):c.push(d):(d&r)===d?c.push(d):a.push(d)}for(const x of a)s=s.concat(u[x]);for(const x of c)l=l.concat(u[x]);for(const x of O)s.length<l.length?s.push(x):l.push(x);return{left:s.reverse(),right:l.reverse()}}(se.inherits,ge.inherits,xe,fe.map(D=>D.name));ee=h.map(D=>H[D]),ae=M(h.map(D=>n.getSkill(D).element),c),te=p.map(D=>H[D]),ce=M(p.map(D=>n.getSkill(D).element),c)}return B=Math.ceil(le.length/2),ee=le.slice(0,B).concat(ee),ae=Array(B).fill(0).concat(ae),te=le.slice(B).concat(te),ce=Array(le.length-B).fill(0).concat(ce),re.chain1=K(ee,ae,se.name,n,d,l),re.chain2=K(te,ce,ge.name,n,d,l),re}(s.demon.name,l,a,this.compendium,this.squareChart,this.recipeConfig))}})}setIngredElem(n){n.controls.skill.setValue(this.skills[n.controls.elem.value][0]),this.setIngredDemon(n)}setIngredDemon(n){n.controls.demon.setValue((n.controls.searchSkill.value?this.learnedBy[n.controls.skill.value.name]:this.demons[n.controls.race.value])[0])}updateRecipe(n){const s={};for(const[l,a]of Object.entries(n.skills)){s[a]||(s[a]=[]);const c=this.compendium.getDemon(a).skills[l];s[a].push(l+(c?` (${c})`:""))}this.recipe=n,this.recipeLeft=this.decodeRecipechain(n.chain1,s),this.recipeRight=this.decodeRecipechain(n.chain2,s),this.resultSkills=[],this.recipeResult=[];for(const l of n.stepR)this.recipeResult.push(s[l]?`${l} [${s[l].join(", ")}]`:l);for(const[l,a]of Object.entries(this.compendium.getDemon(n.result).skills).filter(c=>c[1]<2e3).sort((c,u)=>c[1]-u[1]))this.resultSkills.push(l+(a?` (${a})`:""))}decodeRecipechain(n,s){const l=[];for(let a=0;a<n.length-2;a+=2){const c=s[n[a]]?"["+s[n[a]].join(", ")+"] ":"",u=s[n[a+1]]?"["+s[n[a+1]].join(", ")+"] ":"";l.push(`${n[a]} ${c}x ${n[a+1]} ${u}= ${n[a+2]}`)}return l}initDropdowns(){if(this.recipeConfig&&this.compendium&&this.squareChart){this.demons={"-":[this.blankDemon]},this.skills={"-":[this.blankSkill]},this.learnedBy={"-":[this.blankDemon]};for(const n of this.compendium.allDemons)if(!n.isEnemy){this.demons[n.race]||(this.demons[n.race]=[]),this.demons[n.race].push(n);for(const s of Object.keys(n.skills))this.learnedBy[s]||(this.learnedBy[s]=[]),this.learnedBy[s].push(n)}for(const n of this.compendium.allSkills.filter(s=>s.rank<50&&s.learnedBy.length>0))this.skills[n.element]||(this.skills[n.element]=[]),this.skills[n.element].push(n);for(const n of Object.values(this.demons))n.sort((s,l)=>s.lvl-l.lvl);for(const n of Object.values(this.learnedBy))n.sort((s,l)=>s.lvl-l.lvl);for(const n of Object.values(this.skills))n.sort((s,l)=>s.rank-l.rank);this.races=this.recipeConfig.races.filter(n=>this.demons[n]),this.elems=this.recipeConfig.skillElems.filter(n=>this.skills[n]),this.setDemon(this.compendium.getDemon(this.defaultDemon))}}setDemon(n){const s=[],{inheritElems:l}=this.recipeConfig,a=Object.entries(n.skills).filter(c=>0===c[1]).map(c=>this.compendium.getSkill(c[0]));for(let c=0;c<l.length;c++)n.inherits&1<<c||s.push(l[l.length-c-1]);this.skills[this.blankSkill.element]=[this.blankSkill].concat(a),this.elems=this.recipeConfig.skillElems.filter(c=>this.skills[c]&&!s.includes(c)),this.form.patchValue({race:n.race,demon:n,ingreds:a.concat(Array(this.internalMaxSkills-a.length).fill(this.blankSkill)).map(c=>({searchSkill:!0,elem:"-",skill:c,race:"-",demon:"-"!==c.name?n:this.blankDemon}))})}}return(i=r).\u0275fac=function(n){return new(n||i)(e.Y36(N.qu))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-recipe-generator"]],inputs:{defaultDemon:"defaultDemon",maxSkills:"maxSkills",compendium:"compendium",squareChart:"squareChart",recipeConfig:"recipeConfig"},features:[e.TTD],decls:36,vars:5,consts:[[3,"formGroup"],[1,"entry-table"],["colspan","2",1,"title"],[2,"width","40%"],[2,"width","60%"],["formControlName","race",3,"change"],[3,"value",4,"ngFor","ngForOf"],["formControlName","demon",3,"change"],[3,"ngValue",4,"ngFor","ngForOf"],["formArrayName","ingreds",1,"entry-table"],["colspan","5",1,"title"],[2,"width","20%"],[2,"width","10%"],[2,"width","25%"],[3,"formGroupName",4,"ngFor","ngForOf"],["class","entry-table",4,"ngIf"],[3,"value"],[3,"ngValue"],[3,"formGroupName"],[4,"ngIf"],["formControlName","searchSkill","type","checkbox",3,"change"],["formControlName","elem",3,"change"],["value","-"],["formControlName","skill",3,"change"],["formControlName","demon",4,"ngIf"],["formControlName","demon"],["style","width: 50%",4,"ngIf"],["style","width: 50%","style","padding: 1em; text-align: center;",4,"ngIf"],["colspan","2",2,"padding","1em","text-align","center"],[2,"width","50%"],[4,"ngFor","ngForOf"],[2,"padding","1em","text-align","center"]],template:function(n,s){1&n&&(e.TgZ(0,"form",0)(1,"h2"),e._uU(2,"Recipe Generator"),e.qZA(),e.TgZ(3,"table",1)(4,"tr")(5,"th",2),e._uU(6,"Target"),e.qZA()(),e.TgZ(7,"tr")(8,"th",3),e._uU(9,"Race"),e.qZA(),e.TgZ(10,"th",4),e._uU(11,"Name"),e.qZA()(),e.TgZ(12,"tr")(13,"td")(14,"select",5),e.NdJ("change",function(){return s.setDemon(s.demons[s.form.controls.race.value][0])}),e.YNc(15,I,2,2,"option",6),e.qZA()(),e.TgZ(16,"td")(17,"select",7),e.NdJ("change",function(){return s.setDemon(s.form.controls.demon.value)}),e.YNc(18,C,2,2,"option",8),e.qZA()()()(),e.TgZ(19,"table",9)(20,"tr")(21,"th",10),e._uU(22,"Include Ingredients"),e.qZA()(),e.TgZ(23,"tr")(24,"th",11),e._uU(25,"Search"),e.qZA(),e.TgZ(26,"th",12),e._uU(27,"Elem"),e.qZA(),e.TgZ(28,"th",13),e._uU(29,"Skill"),e.qZA(),e.TgZ(30,"th",11),e._uU(31,"Race"),e.qZA(),e.TgZ(32,"th",13),e._uU(33,"Ingredient"),e.qZA()(),e.YNc(34,ne,2,2,"ng-container",14),e.qZA(),e.YNc(35,b,18,6,"table",15),e.qZA()),2&n&&(e.Q6J("formGroup",s.form),e.xp6(15),e.Q6J("ngForOf",s.races),e.xp6(3),e.Q6J("ngForOf",s.demons[s.form.controls.race.value]),e.xp6(16),e.Q6J("ngForOf",s.form.controls.ingreds.controls),e.xp6(1),e.Q6J("ngIf",s.recipe))},dependencies:[L.sg,L.O5,N._Y,N.YN,N.Kr,N.Wl,N.EJ,N.JJ,N.JL,N.sg,N.u,N.x0,N.CE],styles:["ul[_ngcontent-%COMP%]{padding:0 1em;list-style:none}td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%}"],changeDetection:0}),r})()}}]);