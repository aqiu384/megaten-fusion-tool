"use strict";(self.webpackChunkmegaten_fusion_tool=self.webpackChunkmegaten_fusion_tool||[]).push([[116],{9012:(fe,H,S)=>{S.d(H,{N:()=>w});var t=S(4769),$=S(6814),Q=S(2173);function L(h,D){if(1&h&&(t.TgZ(0,"th",4),t._uU(1,"Inheritable Skills"),t.qZA()),2&h){const m=t.oxw();t.uIk("colspan",m.inheritHeaders.length)}}function V(h,D){if(1&h&&(t.TgZ(0,"th",4),t._uU(1),t.qZA()),2&h){const m=t.oxw();t.uIk("colspan",m.inheritHeaders.length),t.xp6(1),t.hij(" ",m.langEn?"Skill Affinities":"\u30b9\u30ad\u30eb\u9069\u6b63"," ")}}function j(h,D){if(1&h&&(t.ynx(0),t._uU(1),t.BQk()),2&h){const m=t.oxw().$implicit;t.xp6(1),t.Oqu(m)}}function M(h,D){if(1&h&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&h){const m=t.oxw().$implicit;t.Gre("element-icon ",m,""),t.xp6(1),t.Oqu(m)}}function W(h,D){if(1&h&&(t.TgZ(0,"th"),t.YNc(1,j,2,1,"ng-container",3),t.YNc(2,M,2,4,"div",5),t.qZA()),2&h){const m=t.oxw();t.Udp("width",100/m.inheritHeaders.length,"%"),t.xp6(1),t.Q6J("ngIf",!m.hasIcons),t.xp6(1),t.Q6J("ngIf",m.hasIcons)}}function e(h,D){if(1&h&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&h){const m=D.$implicit;t.Udp("color",m?null:"transparent"),t.xp6(1),t.hij(" ",m?"yes":"no"," ")}}function E(h,D){if(1&h&&(t.TgZ(0,"tr"),t.YNc(1,e,2,3,"td",6),t.qZA()),2&h){const m=t.oxw();t.xp6(1),t.Q6J("ngForOf",m.inherits)}}function b(h,D){if(1&h&&(t.TgZ(0,"td"),t.ALo(1,"roundInheritPercent"),t._uU(2),t.qZA()),2&h){const m=D.$implicit;t.Gre("affinity",t.lcZ(1,4,m),""),t.xp6(2),t.hij(" ",m,"% ")}}function x(h,D){if(1&h&&(t.TgZ(0,"tr"),t.YNc(1,b,3,6,"td",7),t.qZA()),2&h){const m=t.oxw();t.xp6(1),t.Q6J("ngForOf",m.inherits)}}function d(h,D){if(1&h&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"affinityToString"),t.qZA()),2&h){const m=D.$implicit;t.Gre("affinity",m,""),t.xp6(1),t.hij(" ",t.lcZ(2,4,m)," ")}}function k(h,D){if(1&h&&(t.TgZ(0,"tr"),t.YNc(1,d,3,6,"td",7),t.qZA()),2&h){const m=t.oxw();t.xp6(1),t.Q6J("ngForOf",m.inherits)}}let w=(()=>{class h{constructor(){this.inheritHeaders=[],this.inherits=[],this.hasChance=!1,this.hasIcons=!0,this.hasLvls=!1,this.langEn=!0}static#e=this.\u0275fac=function(B){return new(B||h)};static#t=this.\u0275cmp=t.Xpm({type:h,selectors:[["app-demon-inherits"]],inputs:{inheritHeaders:"inheritHeaders",inherits:"inherits",hasChance:"hasChance",hasIcons:"hasIcons",hasLvls:"hasLvls",langEn:"langEn"},decls:11,vars:6,consts:[[1,"entry-table"],["class","title",4,"ngIf"],[3,"width",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"title"],[3,"class",4,"ngIf"],[3,"color",4,"ngFor","ngForOf"],[3,"class",4,"ngFor","ngForOf"]],template:function(B,q){1&B&&(t.TgZ(0,"table",0)(1,"thead")(2,"tr"),t.YNc(3,L,2,1,"th",1),t.YNc(4,V,2,2,"th",1),t.qZA(),t.TgZ(5,"tr"),t.YNc(6,W,3,4,"th",2),t.qZA()(),t.TgZ(7,"tbody"),t.YNc(8,E,2,1,"tr",3),t.YNc(9,x,2,1,"tr",3),t.YNc(10,k,2,1,"tr",3),t.qZA()()),2&B&&(t.xp6(3),t.Q6J("ngIf",!q.hasLvls),t.xp6(1),t.Q6J("ngIf",q.hasLvls&&q.inheritHeaders.length),t.xp6(2),t.Q6J("ngForOf",q.inheritHeaders),t.xp6(2),t.Q6J("ngIf",!q.hasLvls&&!q.hasChance),t.xp6(1),t.Q6J("ngIf",q.hasChance),t.xp6(1),t.Q6J("ngIf",q.hasLvls))},dependencies:[$.sg,$.O5,Q.JZ,Q.DY],encapsulation:2,changeDetection:0})}return h})()},8615:(fe,H,S)=>{S.d(H,{R:()=>E});var t=S(4769),$=S(6593),Q=S(4487),L=S(6814);function V(b,x){if(1&b&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&b){const d=x.$implicit,k=t.oxw();t.xp6(1),t.Oqu(d.slice(0,k.nameCut))}}function j(b,x){if(1&b&&(t.TgZ(0,"td",4),t._uU(1),t.qZA()),2&b){const d=x.$implicit,k=t.oxw(2);t.Q6J("ngClass",d.slice(0,4)),t.xp6(1),t.Oqu(d.slice(4,k.nameCut+4))}}function M(b,x){if(1&b&&(t.TgZ(0,"tr")(1,"th"),t._uU(2),t.qZA(),t.YNc(3,j,2,2,"td",3),t.TgZ(4,"th"),t._uU(5),t.qZA()()),2&b){const d=x.$implicit;t.xp6(2),t.Oqu(d[0]),t.xp6(1),t.Q6J("ngForOf",d.slice(1,d.length-1)),t.xp6(2),t.Oqu(d[d.length-1])}}function W(b,x){if(1&b&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&b){const d=x.$implicit,k=t.oxw();t.xp6(1),t.Oqu(d.slice(0,k.nameCut))}}function e(b,x){if(1&b&&(t.TgZ(0,"tr")(1,"th",0),t._uU(2),t.qZA()()),2&b){const d=t.oxw();t.xp6(1),t.uIk("colspan",d.table[0].length),t.xp6(1),t.AsE("",d.appName," ",d.tripTitle,"")}}class E{static#e=this.RESULT_COLORS=Object.entries({oran:["-2","Erthys","Gnome","Saki","Saki Mitama","Random","\u30a2\u30fc\u30b7\u30fc\u30ba","\u30ce\u30fc\u30e0","\u30b5\u30ad\u30df\u30bf\u30de"],redd:["-1","Flaemis","Salamander","Ara ","Ara Mitama","Fiend","\u30d5\u30ec\u30a4\u30df\u30fc\u30ba","\u30b5\u30e9\u30de\u30f3\u30c0\u30fc","\u30a2\u30e9\u30df\u30bf\u30de"],gree:["1","Aeros","Sylph","Kusi","Kusi Mitama","UMA","\u30a8\u30a2\u30ed\u30b9","\u30b7\u30eb\u30ad\u30fc","\u30af\u30b7\u30df\u30bf\u30de"],blue:["2","Aquans","Undine","Nigi","Nigi Mitama","Enigma","\u30a2\u30af\u30a2\u30f3\u30ba","\u30a6\u30f3\u30c7\u30a3\u30fc\u30cd","\u30cb\u30ae\u30df\u30bf\u30de"]});constructor(x,d){this.title2=x,this.route=d,this.normTitle="Normal Fusions",this.tripTitle="",this.isPersona=!1,this.filterDarks=!0,this.langEn=!0,this.subscriptions=[],this.table=[],this.nameCut=4}ngOnInit(){this.subscriptions.push(this.route.parent.data.subscribe(x=>{this.appName=x.appName||"Shin Megami Tensei",this.nameCut=this.langEn?4:2,this.title2.setTitle(this.langEn?`Fusion Chart - ${this.appName} Fusion Calculator`:`\u5408\u4f53\u8868 ${this.appName} \u5408\u4f53\u30a2\u30d7\u30ea`)}))}ngOnChanges(){this.normChart&&this.fillFusionChart()}ngOnDestroy(){for(const x of this.subscriptions)x.unsubscribe()}fillFusionChart(){const x="noneNone",k=E.RESULT_COLORS.reduce((T,[A,y])=>y.reduce((U,X)=>(U[X]=A,U),T),{}),w=this.normChart.elementDemons;let h=[],D=this.normChart.races,m=[];this.filterDarks&&(h=this.normChart.races.filter(T=>this.normChart.getLightDark(T)>0),D=this.normChart.races.filter(T=>0===this.normChart.getLightDark(T)),m=this.normChart.races.filter(T=>-1===this.normChart.getLightDark(T)),0===m.length&&h.length>0&&(h=this.normChart.races.filter(T=>this.normChart.getLightDark(T)>-1),D=[],m=this.normChart.races.filter(T=>this.normChart.getLightDark(T)<-1)));const B=h.length-m.length,q=h.concat(D,w),ne=m.length?m.concat(Array(q.length-m.length).fill("")):q,he=this.mitaTable?q:h.concat(D,Array(w.length).fill("")),ie=this.mitaTable||m.length?Array(B).fill("").concat(m,D,w):q;this.table=[[""].concat(q,[""])];for(let T=0;T<ie.length;T++){const A=Array(q.length+2).fill("empt-"),y=ie[T],U=he[T],X=-1!==w.indexOf(y),ue=-1!==w.indexOf(U);this.table.push(A),A[0]=y,A[A.length-1]=U;for(let R=T;R<q.length;R++){const v=q[R],J=-1!==w.indexOf(v);if(J&&ue){const s=w.indexOf(U),l=w.indexOf(v),n=this.mitaTable[s][l-s-1];A[R+1]=n?(k[n]||"norm")+n:x}else if(J&&U){const s=this.normChart.getElemFusions(v)[U];A[R+1]=s?(k[s]||"rank")+(s>0?"+":"")+s.toString():x}else if(v&&U){const s=this.isPersona&&v===U?v:this.normChart.getRaceFusion(v,U);A[R+1]=s?(k[s]||(v===U?"elem":"norm"))+s:x}}if(this.tripChart)for(let R=0;R<=T-B;R++){const v=ne[R];if(v&&X){const J=this.tripChart.getElemFusions(y)[v];A[R+1]=J?(k[J]||"rank")+(J>0?"+":"")+J.toString():x}else if(v&&y){const J=this.tripChart.getRaceFusion(v,y);A[R+1]=J?(k[J]||(v===y?"elem":"trip"))+J:x}}if(-1!==y.indexOf(" x ")){const[R,v]=y.split(" x "),J=R.slice(0,3)+"x"+v.slice(0,3);A[0]=J,A[A.length-1]=J}else if(-1!==y.indexOf(" ")){const R=y.split(" ")[0];A[0]=R,A[A.length-1]=R}}for(let T=0;T<this.table[0].length;T++){const A=this.table[0][T];if(-1!==A.indexOf(" x ")){const[y,U]=A.split(" x ");this.table[0][T]=y.slice(0,2)+U.slice(0,2)}}this.table.push([""].concat(ne,[""]))}static#t=this.\u0275fac=function(d){return new(d||E)(t.Y36($.Dx),t.Y36(Q.gz))};static#n=this.\u0275cmp=t.Xpm({type:E,selectors:[["app-fusion-chart"]],inputs:{normChart:"normChart",tripChart:"tripChart",mitaTable:"mitaTable",normTitle:"normTitle",tripTitle:"tripTitle",isPersona:"isPersona",filterDarks:"filterDarks",langEn:"langEn",counter:"counter"},features:[t.TTD],decls:12,vars:7,consts:[[1,"title"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(d,k){1&d&&(t.TgZ(0,"table")(1,"tbody")(2,"tr")(3,"th",0),t._uU(4),t.qZA()(),t.TgZ(5,"tr"),t.YNc(6,V,2,1,"th",1),t.qZA(),t.YNc(7,M,6,3,"tr",1),t.TgZ(8,"tr"),t.YNc(9,W,2,1,"th",1),t.qZA(),t.YNc(10,e,3,3,"tr",2),t.qZA(),t._UZ(11,"tbody"),t.qZA()),2&d&&(t.xp6(3),t.uIk("colspan",k.table[0].length),t.xp6(1),t.AsE("",k.appName," ",k.normTitle,""),t.xp6(2),t.Q6J("ngForOf",k.table[0]),t.xp6(1),t.Q6J("ngForOf",k.table.slice(1,k.table.length-1)),t.xp6(2),t.Q6J("ngForOf",k.table[k.table.length-1]),t.xp6(1),t.Q6J("ngIf",k.tripTitle))},dependencies:[L.mk,L.sg,L.O5],styles:["table[_ngcontent-%COMP%]{width:auto;margin:0 auto;white-space:nowrap}td.elem[_ngcontent-%COMP%]{color:#0f0}td.trip[_ngcontent-%COMP%]{color:#d3d3d3}td.oran[_ngcontent-%COMP%]{color:orange}td.redd[_ngcontent-%COMP%]{color:red}td.gree[_ngcontent-%COMP%]{color:#0f0}td.blue[_ngcontent-%COMP%]{color:#0ff}td.none[_ngcontent-%COMP%]{color:transparent}td.empt[_ngcontent-%COMP%]{background-color:transparent;color:transparent}"],changeDetection:0})}},4436:(fe,H,S)=>{S.d(H,{X:()=>J});var t=S(6404);function Q(s,l){return parseInt(l.map(n=>s.includes(n)?"1":"0").join(""),2)||0}function L(s,l){return s.map((n,i,o)=>Q(o.slice(0,i+1),l))}function j(s,l,n,i,o,a){let r=n,C=[r];const f=i.getSpecialNameEntries(r),O=l[l.length-1];if(0!==f.length&&(r=f.find(_=>0===i.getSpecialNameEntries(_).length),C.unshift(f.filter(_=>_!==r).join(" x ")),C.unshift(r)),s.length>0){const _=function W(s,l,n,i,o){const{fusionCalculator:a}=o,r=s.slice(0,1);if(s.length<2)return r;let C=r[0],f=l[0];for(let O=1;O<s.length;O++){const _=s[O],g=l[O],p=a.getFusions(C,n,i).map(Z=>(0,t.D0)(Z,n)).sort((Z,G)=>Z.price-G.price);let F=!1;for(const Z of p)if(Z.name1===_&&(g&n.getDemon(Z.name2).inherits)===g){r.push(_),r.push(Z.name2),C=r[r.length-1],f=g,F=!0;break}if(F)continue;const N=a.getFusions(_,n,i).reduce((Z,G)=>(Z[G.name1]=G.name2,Z),{});for(const Z of p)if(N[Z.name2]&&(f&n.getDemon(Z.name2).inherits)===f&&(g&n.getDemon(N[Z.name2]).inherits)===g){r.push(Z.name1),r.push(Z.name2),r.push(_),r.push(N[Z.name2]),C=r[r.length-1],f=g,F=!0;break}if(!F)return[]}return r}(s,l,i,o,a);if(0===_.length)return[];const g=_[_.length-1];let p=M(g,r,O,i,o,a);if(0===p.length){const F=i.getDemon(r),Y=i.getResultDemonLvls(F.race).map(N=>i.reverseLookupDemon(F.race,N)).filter(N=>N!==r);for(const N of o.elementDemons.concat(Y)){if((O&i.getDemon(N).inherits)!==O)continue;const Z=M(g,N,O,i,o,a),G=M(N,r,O,i,o,a);if(0!==Z.length&&0!==G.length){p=Z.concat(G.slice(1));break}}}if(0===p.length)return[];C=_.concat(p.slice(1),C.slice(1))}return C}function M(s,l,n,i,o,a){const{fissionCalculator:r,fusionCalculator:C}=a,f=[s];if(s===l)return f;const O=C.getFusions(s,i,o).map(p=>(0,t.D0)(p,i)).sort((p,F)=>p.price-F.price);for(const p of O)if(p.name2===l)return f.push(p.name1),f.push(l),f;const _=r.getFusions(l,i,o).map(p=>(0,t.S6)(p,i)).sort((p,F)=>p.price-F.price);O.sort((p,F)=>F.price-p.price);const g=O.reduce((p,F)=>(p[F.name2]=F.name1,p),{});for(const p of _){if(g[p.name1]&&(n&i.getDemon(p.name1).inherits)===n)return f.push(g[p.name1]),f.push(p.name1),f.push(p.name2),f.push(l),f;if(g[p.name2]&&(n&i.getDemon(p.name2).inherits)===n)return f.push(g[p.name2]),f.push(p.name2),f.push(p.name1),f.push(l),f}return[]}var e=S(4769),E=S(95),b=S(6814);function x(s,l){if(1&s&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function d(s,l){if(1&s&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("ngValue",n),e.xp6(1),e.Oqu(n.name)}}function k(s,l){if(1&s&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function w(s,l){if(1&s&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("ngValue",n),e.xp6(1),e.Oqu(n.name)}}function h(s,l){if(1&s&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function D(s,l){if(1&s&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("ngValue",n),e.xp6(1),e.AsE("",n.name," ",n.lvl?"("+n.lvl+")":"","")}}function m(s,l){if(1&s&&(e.TgZ(0,"select",25),e.YNc(1,D,2,3,"option",8),e.qZA()),2&s){const n=e.oxw(2).$implicit,i=e.oxw();e.xp6(1),e.Q6J("ngForOf",i.learnedBy[n.controls.skill.value.name])}}function B(s,l){if(1&s&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("ngValue",n),e.xp6(1),e.AsE("",n.name," ",n.lvl?"("+n.lvl+")":"","")}}function q(s,l){if(1&s&&(e.TgZ(0,"select",25),e.YNc(1,B,2,3,"option",8),e.qZA()),2&s){const n=e.oxw(2).$implicit,i=e.oxw();e.xp6(1),e.Q6J("ngForOf",i.demons[n.controls.race.value])}}function ne(s,l){if(1&s){const n=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"label"),e._uU(3),e.TgZ(4,"input",20),e.NdJ("change",function(){e.CHM(n);const o=e.oxw().$implicit,a=e.oxw();return e.KtG(a.setIngredDemon(o))}),e.qZA()()(),e.TgZ(5,"td")(6,"select",21),e.NdJ("change",function(){e.CHM(n);const o=e.oxw().$implicit,a=e.oxw();return e.KtG(a.setIngredElem(o))}),e.TgZ(7,"option",22),e._uU(8,"-"),e.qZA(),e.YNc(9,k,2,2,"option",6),e.qZA()(),e.TgZ(10,"td")(11,"select",23),e.NdJ("change",function(){e.CHM(n);const o=e.oxw().$implicit,a=e.oxw();return e.KtG(a.setIngredDemon(o))}),e.YNc(12,w,2,2,"option",8),e.qZA()(),e.TgZ(13,"td")(14,"select",5),e.NdJ("change",function(){e.CHM(n);const o=e.oxw().$implicit,a=e.oxw();return e.KtG(a.setIngredDemon(o))}),e.TgZ(15,"option",22),e._uU(16,"-"),e.qZA(),e.YNc(17,h,2,2,"option",6),e.qZA()(),e.TgZ(18,"td"),e.YNc(19,m,2,1,"select",24),e.YNc(20,q,2,1,"select",24),e.qZA()()}if(2&s){const n=e.oxw().$implicit,i=e.oxw();e.xp6(3),e.hij("",i.langEn?"Search Skill":"\u30b9\u30ad\u30eb\u691c\u7d22"," "),e.xp6(3),e.uIk("disabled",!n.controls.searchSkill.value||null),e.xp6(3),e.Q6J("ngForOf",i.elems),e.xp6(2),e.uIk("disabled",!n.controls.searchSkill.value||null),e.xp6(1),e.Q6J("ngForOf",i.skills[n.controls.elem.value]),e.xp6(2),e.uIk("disabled",n.controls.searchSkill.value||null),e.xp6(3),e.Q6J("ngForOf",i.races),e.xp6(2),e.Q6J("ngIf",n.controls.searchSkill.value),e.xp6(1),e.Q6J("ngIf",!n.controls.searchSkill.value)}}function he(s,l){if(1&s&&(e.ynx(0,18),e.YNc(1,ne,21,9,"tr",19),e.BQk()),2&s){const n=l.index,i=e.oxw();e.Q6J("formGroupName",n),e.xp6(1),e.Q6J("ngIf",n<i.maxSkills)}}function ie(s,l){if(1&s&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.xp6(1),e.Oqu(n)}}function T(s,l){if(1&s&&(e.TgZ(0,"td",29)(1,"ul"),e.YNc(2,ie,2,1,"li",30),e.qZA()()),2&s){const n=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",n.recipeLeft)}}function A(s,l){if(1&s&&(e.TgZ(0,"td",31),e._uU(1),e.qZA()),2&s){const n=e.oxw(2);e.xp6(1),e.Oqu(n.langEn?"No chains found":"\u5408\u4f53\u306a\u3057")}}function y(s,l){if(1&s&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.xp6(1),e.Oqu(n)}}function U(s,l){if(1&s&&(e.TgZ(0,"td",29)(1,"ul"),e.YNc(2,y,2,1,"li",30),e.qZA()()),2&s){const n=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",n.recipeRight)}}function X(s,l){if(1&s&&(e.TgZ(0,"td",31),e._uU(1),e.qZA()),2&s){const n=e.oxw(2);e.xp6(1),e.Oqu(n.langEn?"No chains found":"\u5408\u4f53\u306a\u3057")}}function ue(s,l){if(1&s&&(e.ynx(0),e._uU(1),e._UZ(2,"br"),e._uU(3),e.BQk()),2&s){const n=e.oxw(2);e.xp6(1),e.AsE(" ",n.recipeResult.join(" x ")," = ",n.recipe.result,""),e.xp6(2),e.hij(" [",n.resultSkills.join(", "),"] ")}}function R(s,l){if(1&s&&(e.ynx(0),e._uU(1),e.BQk()),2&s){const n=e.oxw(2);e.xp6(1),e.Oqu(n.langEn?"No recipes found":"\u5408\u4f53\u306a\u3057")}}function v(s,l){if(1&s&&(e.TgZ(0,"table",1)(1,"tr")(2,"th",2),e._uU(3),e.qZA()(),e.TgZ(4,"tr")(5,"th"),e._uU(6),e.qZA(),e.TgZ(7,"th"),e._uU(8),e.qZA()(),e.TgZ(9,"tr"),e.YNc(10,T,3,1,"td",26),e.YNc(11,A,2,1,"td",27),e.YNc(12,U,3,1,"td",26),e.YNc(13,X,2,1,"td",27),e.qZA(),e.TgZ(14,"tr")(15,"td",28),e.YNc(16,ue,4,3,"ng-container",19),e.YNc(17,R,2,1,"ng-container",19),e.qZA()()()),2&s){const n=e.oxw();e.xp6(3),e.Oqu(n.langEn?"Fusion Recipe":"\u5408\u4f53\u30ec\u30b7\u30d4"),e.xp6(3),e.Oqu(n.langEn?"Left Chain":"\u5de6\u30ec\u30b7\u30d4"),e.xp6(2),e.Oqu(n.langEn?"Right Chain":"\u53f3\u30ec\u30b7\u30d4"),e.xp6(2),e.Q6J("ngIf",n.recipeLeft.length),e.xp6(1),e.Q6J("ngIf",!n.recipeLeft.length),e.xp6(1),e.Q6J("ngIf",n.recipeRight.length),e.xp6(1),e.Q6J("ngIf",!n.recipeRight.length),e.xp6(3),e.Q6J("ngIf",n.recipe.stepR.length),e.xp6(1),e.Q6J("ngIf",!n.recipe.stepR.length)}}let J=(()=>{class s{constructor(n){this.fb=n,this.maxSkills=8,this.langEn=!0,this.internalMaxSkills=9,this.range99=Array(99),this.demons={},this.skills={},this.learnedBy={},this.blankDemon={name:"-",race:"-",lvl:0,currLvl:0,price:0,inherits:0,skills:{},stats:[],resists:[],affinities:[],fusion:"normal",prereq:""},this.blankSkill={name:"-",element:"-",rank:99,cost:0,effect:"",target:"",level:0,learnedBy:[{demon:"-",level:0}]},this.createForm()}ngOnChanges(){this.initDropdowns()}createForm(){const n=[];for(let i=0;i<this.internalMaxSkills;i++)n.push(this.fb.group({searchSkill:!0,elem:"-",skill:this.blankSkill,race:"-",demon:this.blankDemon}));this.form=this.fb.group({race:"-",demon:this.blankDemon,ingreds:this.fb.array(n)}),this.form.valueChanges.subscribe(i=>{if(this.form.valid){const o=i.ingreds.filter(r=>"-"!==r.demon.name&&r.demon.name!==i.demon.name).map(r=>r.demon.name),a=i.ingreds.filter(r=>r.searchSkill&&"-"!==r.skill.name).map(r=>r.skill.name);this.updateRecipe(function $(s,l,n,i,o,a){const{fissionCalculator:r,inheritElems:C,restrictInherits:f,triExclusiveRaces:O,triFissionCalculator:_}=a,{normalChart:g}=o,p=i.getDemon(s),F=n.map(c=>i.getSkill(c)).filter((c,u,I)=>c.rank<50&&c.learnedBy.length>0&&!p.skills.hasOwnProperty(c.name)&&I.indexOf(c)===u),Y=Q(F.map(c=>c.element),C);let N=i.getSpecialNameEntries(s);if(N.length<2&&O.includes(p.race)){const c=_.getFusions(s,i,o).map(u=>(0,t.Aw)(u,i)).sort((u,I)=>u.price-I.price).find(u=>!((Y&(u.d1.inherits|u.d2.inherits))!==Y||"special"!==u.d1.fusion&&O.includes(u.d1.race)||"special"!==u.d2.fusion&&O.includes(u.d2.race)||"special"!==u.d3.fusion&&O.includes(u.d3.race)));c&&(N=[c.d1.name,c.d2.name,c.d3.name])}if(N.length<2){const c=r.getFusions(s,i,g).map(u=>(0,t.S6)(u,i)).sort((u,I)=>u.price-I.price).find(u=>!((Y&(i.getDemon(u.name1).inherits|i.getDemon(u.name2).inherits))!==Y||"normal"!==i.getDemon(u.name1).fusion&&"special"!==i.getDemon(u.name1).fusion||"normal"!==i.getDemon(u.name2).fusion&&"special"!==i.getDemon(u.name2).fusion));c&&(N=[c.name1,c.name2])}const Z=N.map(c=>i.getDemon(c)).sort((c,u)=>u.price-c.price),G=l.map(c=>i.getDemon(c)).sort((c,u)=>u.price-c.price),me={},K={};for(const c of F){for(const u of Z)u.skills.hasOwnProperty(c.name)&&(me[c.name]=u.name);if(!me[c.name])for(const u of G)u.skills.hasOwnProperty(c.name)&&(K[c.name]=u.name)}const pe=Object.keys(K).map(c=>i.getSkill(c)),se=Q(pe.map(c=>c.element),C),xe=pe.map(c=>Q([c.element],C));let oe,ge,_e=0;for(let c=0;c<Z.length;c++){const u=Z[c];for(const I of Z.slice(c+1))if((se&(u.inherits|I.inherits))===se){const de=(se&u.inherits).toString(2).split("1").length*(se&I.inherits).toString(2).split("1").length;_e<de&&(oe=u,ge=I,_e=de)}}const re={chain1:[],chain2:[],stepR:N,skills:Object.assign(K,me),result:s};if(!oe)return re;const z=Object.values(K).filter((c,u,I)=>I.indexOf(c)===u),le=l.filter(c=>!z.includes(c));let P=Math.ceil(z.length/2);z.sort((c,u)=>g.getLightDark(i.getDemon(c).race)-g.getLightDark(i.getDemon(u).race));let ee=z.slice(0,P),ae=Array(ee.length).fill(0),te=z.slice(P),ce=Array(te.length).fill(0);if(f){const{left:c,right:u}=function V(s,l,n,i){let o=[],a=[];const r=[],C=[],f={},O=[];for(let _=0;_<n.length;_++){const g=n[_];0!==g?(f.hasOwnProperty(g)||(f[g]=[]),f[g].push(i[_])):O.push(i[_])}for(const _ of Object.keys(f).sort()){const g=parseInt(_);r.length<=C.length?(g&s)===g?r.push(g):C.push(g):(g&l)===g?C.push(g):r.push(g)}for(const _ of r)o=o.concat(f[_]);for(const _ of C)a=a.concat(f[_]);for(const _ of O)o.length<a.length?o.push(_):a.push(_);return{left:o.reverse(),right:a.reverse()}}(oe.inherits,ge.inherits,xe,pe.map(I=>I.name));ee=c.map(I=>K[I]),ae=L(c.map(I=>i.getSkill(I).element),C),te=u.map(I=>K[I]),ce=L(u.map(I=>i.getSkill(I).element),C)}return P=Math.ceil(le.length/2),ee=le.slice(0,P).concat(ee),ae=Array(P).fill(0).concat(ae),te=le.slice(P).concat(te),ce=Array(le.length-P).fill(0).concat(ce),re.chain1=j(ee,ae,oe.name,i,g,a),re.chain2=j(te,ce,ge.name,i,g,a),re}(i.demon.name,o,a,this.compendium,this.squareChart,this.recipeConfig))}})}setIngredElem(n){n.controls.skill.setValue(this.skills[n.controls.elem.value][0]),this.setIngredDemon(n)}setIngredDemon(n){n.controls.demon.setValue((n.controls.searchSkill.value?this.learnedBy[n.controls.skill.value.name]:this.demons[n.controls.race.value])[0])}updateRecipe(n){const i={};for(const[o,a]of Object.entries(n.skills)){i[a]||(i[a]=[]);const r=this.compendium.getDemon(a).skills[o];i[a].push(o+(r>=2?` (${r})`:""))}this.recipe=n,this.recipeLeft=this.decodeRecipechain(n.chain1,i),this.recipeRight=this.decodeRecipechain(n.chain2,i),this.resultSkills=[],this.recipeResult=[];for(const o of n.stepR)this.recipeResult.push(i[o]?`${o} [${i[o].join(", ")}]`:o);for(const[o,a]of Object.entries(this.compendium.getDemon(n.result).skills).filter(r=>r[1]<2e3).sort((r,C)=>r[1]-C[1]))this.resultSkills.push(o+(a>=2?` (${a})`:""))}decodeRecipechain(n,i){const o=[];for(let a=0;a<n.length-2;a+=2){const r=i[n[a]]?"["+i[n[a]].join(", ")+"] ":"",C=i[n[a+1]]?"["+i[n[a+1]].join(", ")+"] ":"";o.push(`${n[a]} ${r}x ${n[a+1]} ${C}= ${n[a+2]}`)}return o}initDropdowns(){if(this.recipeConfig&&this.compendium&&this.squareChart){this.demons={"-":[this.blankDemon]},this.skills={"-":[this.blankSkill]},this.learnedBy={"-":[this.blankDemon]};for(const n of this.compendium.allDemons)if(!n.isEnemy&&"party"!==n.fusion&&"enemy"!==n.fusion){this.demons[n.race]||(this.demons[n.race]=[]),this.demons[n.race].push(n);for(const i of Object.keys(n.skills))this.learnedBy[i]||(this.learnedBy[i]=[]),this.learnedBy[i].push(n)}for(const n of this.compendium.allSkills.filter(i=>i.rank<50&&i.learnedBy.length>0))this.skills[n.element]||(this.skills[n.element]=[]),this.skills[n.element].push(n);for(const n of Object.values(this.demons))n.sort((i,o)=>i.lvl-o.lvl);for(const n of Object.values(this.learnedBy))n.sort((i,o)=>i.lvl-o.lvl);for(const n of Object.values(this.skills))n.sort((i,o)=>i.rank-o.rank);this.races=this.recipeConfig.races.filter(n=>this.demons[n]),this.elems=this.recipeConfig.skillElems.filter(n=>this.skills[n]),this.setDemon(this.compendium.getDemon(this.recipeConfig.defaultDemon))}}setDemon(n){const i=[],{inheritElems:o}=this.recipeConfig,a=Object.entries(n.skills).slice(0,this.internalMaxSkills).filter(r=>r[1]<2).map(r=>this.compendium.getSkill(r[0]));for(let r=0;r<o.length;r++)n.inherits&1<<r||i.push(o[o.length-r-1]);this.skills[this.blankSkill.element]=[this.blankSkill].concat(a),this.elems=this.recipeConfig.skillElems.filter(r=>this.skills[r]&&!i.includes(r)),this.form.patchValue({race:n.race,demon:n,ingreds:a.concat(Array(this.internalMaxSkills-a.length).fill(this.blankSkill)).map(r=>({searchSkill:!0,elem:"-",skill:r,race:"-",demon:"-"!==r.name?n:this.blankDemon}))})}static#e=this.\u0275fac=function(i){return new(i||s)(e.Y36(E.qu))};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["app-recipe-generator"]],inputs:{maxSkills:"maxSkills",compendium:"compendium",squareChart:"squareChart",recipeConfig:"recipeConfig",langEn:"langEn"},features:[e.TTD],decls:36,vars:15,consts:[[3,"formGroup"],[1,"entry-table"],["colspan","2",1,"title"],[2,"width","40%"],[2,"width","60%"],["formControlName","race",3,"change"],[3,"value",4,"ngFor","ngForOf"],["formControlName","demon",3,"change"],[3,"ngValue",4,"ngFor","ngForOf"],["formArrayName","ingreds",1,"entry-table"],["colspan","5",1,"title"],[2,"width","20%"],[2,"width","10%"],[2,"width","25%"],[3,"formGroupName",4,"ngFor","ngForOf"],["class","entry-table",4,"ngIf"],[3,"value"],[3,"ngValue"],[3,"formGroupName"],[4,"ngIf"],["formControlName","searchSkill","type","checkbox",3,"change"],["formControlName","elem",3,"change"],["value","-"],["formControlName","skill",3,"change"],["formControlName","demon",4,"ngIf"],["formControlName","demon"],["style","width: 50%",4,"ngIf"],["style","width: 50%","style","padding: 1em; text-align: center;",4,"ngIf"],["colspan","2",2,"padding","1em","text-align","center"],[2,"width","50%"],[4,"ngFor","ngForOf"],[2,"padding","1em","text-align","center"]],template:function(i,o){1&i&&(e.TgZ(0,"form",0)(1,"h2"),e._uU(2),e.qZA(),e.TgZ(3,"table",1)(4,"tr")(5,"th",2),e._uU(6),e.qZA()(),e.TgZ(7,"tr")(8,"th",3),e._uU(9),e.qZA(),e.TgZ(10,"th",4),e._uU(11),e.qZA()(),e.TgZ(12,"tr")(13,"td")(14,"select",5),e.NdJ("change",function(){return o.setDemon(o.demons[o.form.controls.race.value][0])}),e.YNc(15,x,2,2,"option",6),e.qZA()(),e.TgZ(16,"td")(17,"select",7),e.NdJ("change",function(){return o.setDemon(o.form.controls.demon.value)}),e.YNc(18,d,2,2,"option",8),e.qZA()()()(),e.TgZ(19,"table",9)(20,"tr")(21,"th",10),e._uU(22),e.qZA()(),e.TgZ(23,"tr")(24,"th",11),e._uU(25),e.qZA(),e.TgZ(26,"th",12),e._uU(27),e.qZA(),e.TgZ(28,"th",13),e._uU(29),e.qZA(),e.TgZ(30,"th",11),e._uU(31),e.qZA(),e.TgZ(32,"th",13),e._uU(33),e.qZA()(),e.YNc(34,he,2,2,"ng-container",14),e.qZA(),e.YNc(35,v,18,9,"table",15),e.qZA()),2&i&&(e.Q6J("formGroup",o.form),e.xp6(2),e.Oqu(o.langEn?"Recipe Generator":"\u5408\u4f53\u30ec\u30b7\u30d4"),e.xp6(4),e.Oqu(o.langEn?"Target":"\u60aa\u9b54"),e.xp6(3),e.Oqu(o.langEn?"Race":"\u7a2e\u65cf"),e.xp6(2),e.Oqu(o.langEn?"Name":"\u60aa\u9b54\u540d"),e.xp6(4),e.Q6J("ngForOf",o.races),e.xp6(3),e.Q6J("ngForOf",o.demons[o.form.controls.race.value]),e.xp6(4),e.Oqu(o.langEn?"Include Ingredients":"\u7d20\u6750\u60aa\u9b54"),e.xp6(3),e.Oqu(o.langEn?"Search":"\u30b9\u30ad\u30eb\u691c\u7d22"),e.xp6(2),e.Oqu(o.langEn?"Elem":"\u5c5e\u6027"),e.xp6(2),e.Oqu(o.langEn?"Skill":"\u30b9\u30ad\u30eb\u540d"),e.xp6(2),e.Oqu(o.langEn?"Race":"\u7a2e\u65cf"),e.xp6(2),e.Oqu(o.langEn?"Ingredient":"\u60aa\u9b54\u540d"),e.xp6(1),e.Q6J("ngForOf",o.form.controls.ingreds.controls),e.xp6(1),e.Q6J("ngIf",o.recipe))},dependencies:[b.sg,b.O5,E._Y,E.YN,E.Kr,E.Wl,E.EJ,E.JJ,E.JL,E.sg,E.u,E.x0,E.CE],styles:["ul[_ngcontent-%COMP%]{padding:0 1em;list-style:none}td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-height:25px;width:100%}"],changeDetection:0})}return s})()}}]);