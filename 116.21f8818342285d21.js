"use strict";(self.webpackChunkmegaten_fusion_tool=self.webpackChunkmegaten_fusion_tool||[]).push([[116],{9012:(fe,H,S)=>{S.d(H,{N:()=>w});var t=S(4769),$=S(6814),Q=S(2173);function M(h,D){if(1&h&&(t.TgZ(0,"th",4),t._uU(1,"Inheritable Skills"),t.qZA()),2&h){const p=t.oxw();t.uIk("colspan",p.inheritHeaders.length)}}function V(h,D){if(1&h&&(t.TgZ(0,"th",4),t._uU(1),t.qZA()),2&h){const p=t.oxw();t.uIk("colspan",p.inheritHeaders.length),t.xp6(1),t.hij(" ",p.langEn?"Skill Affinities":"\u30b9\u30ad\u30eb\u9069\u6b63"," ")}}function j(h,D){if(1&h&&(t.ynx(0),t._uU(1),t.BQk()),2&h){const p=t.oxw().$implicit;t.xp6(1),t.Oqu(p)}}function G(h,D){if(1&h&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&h){const p=t.oxw().$implicit;t.Gre("element-icon ",p,""),t.xp6(1),t.Oqu(p)}}function W(h,D){if(1&h&&(t.TgZ(0,"th"),t.YNc(1,j,2,1,"ng-container",3),t.YNc(2,G,2,4,"div",5),t.qZA()),2&h){const p=t.oxw();t.Udp("width",100/p.inheritHeaders.length,"%"),t.xp6(1),t.Q6J("ngIf",!p.hasIcons),t.xp6(1),t.Q6J("ngIf",p.hasIcons)}}function e(h,D){if(1&h&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&h){const p=D.$implicit;t.Udp("color",p?null:"transparent"),t.xp6(1),t.hij(" ",p?"yes":"no"," ")}}function b(h,D){if(1&h&&(t.TgZ(0,"tr"),t.YNc(1,e,2,3,"td",6),t.qZA()),2&h){const p=t.oxw();t.xp6(1),t.Q6J("ngForOf",p.inherits)}}function E(h,D){if(1&h&&(t.TgZ(0,"td"),t.ALo(1,"roundInheritPercent"),t._uU(2),t.qZA()),2&h){const p=D.$implicit;t.Gre("affinity",t.lcZ(1,4,p),""),t.xp6(2),t.hij(" ",p,"% ")}}function C(h,D){if(1&h&&(t.TgZ(0,"tr"),t.YNc(1,E,3,6,"td",7),t.qZA()),2&h){const p=t.oxw();t.xp6(1),t.Q6J("ngForOf",p.inherits)}}function x(h,D){if(1&h&&(t.TgZ(0,"td"),t._uU(1),t.ALo(2,"affinityToString"),t.qZA()),2&h){const p=D.$implicit;t.Gre("affinity",p,""),t.xp6(1),t.hij(" ",t.lcZ(2,4,p)," ")}}function k(h,D){if(1&h&&(t.TgZ(0,"tr"),t.YNc(1,x,3,6,"td",7),t.qZA()),2&h){const p=t.oxw();t.xp6(1),t.Q6J("ngForOf",p.inherits)}}let w=(()=>{class h{constructor(){this.inheritHeaders=[],this.inherits=[],this.hasChance=!1,this.hasIcons=!0,this.hasLvls=!1,this.langEn=!0}static#e=this.\u0275fac=function(B){return new(B||h)};static#t=this.\u0275cmp=t.Xpm({type:h,selectors:[["app-demon-inherits"]],inputs:{inheritHeaders:"inheritHeaders",inherits:"inherits",hasChance:"hasChance",hasIcons:"hasIcons",hasLvls:"hasLvls",langEn:"langEn"},decls:11,vars:6,consts:[[1,"entry-table"],["class","title",4,"ngIf"],[3,"width",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"title"],[3,"class",4,"ngIf"],[3,"color",4,"ngFor","ngForOf"],[3,"class",4,"ngFor","ngForOf"]],template:function(B,q){1&B&&(t.TgZ(0,"table",0)(1,"thead")(2,"tr"),t.YNc(3,M,2,1,"th",1),t.YNc(4,V,2,2,"th",1),t.qZA(),t.TgZ(5,"tr"),t.YNc(6,W,3,4,"th",2),t.qZA()(),t.TgZ(7,"tbody"),t.YNc(8,b,2,1,"tr",3),t.YNc(9,C,2,1,"tr",3),t.YNc(10,k,2,1,"tr",3),t.qZA()()),2&B&&(t.xp6(3),t.Q6J("ngIf",!q.hasLvls),t.xp6(1),t.Q6J("ngIf",q.hasLvls&&q.inheritHeaders.length),t.xp6(2),t.Q6J("ngForOf",q.inheritHeaders),t.xp6(2),t.Q6J("ngIf",!q.hasLvls&&!q.hasChance),t.xp6(1),t.Q6J("ngIf",q.hasChance),t.xp6(1),t.Q6J("ngIf",q.hasLvls))},dependencies:[$.sg,$.O5,Q.JZ,Q.DY],encapsulation:2,changeDetection:0})}return h})()},8615:(fe,H,S)=>{S.d(H,{R:()=>b});var t=S(4769),$=S(6593),Q=S(4487),M=S(6814);function V(E,C){if(1&E&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&E){const x=C.$implicit,k=t.oxw();t.xp6(1),t.Oqu(x.slice(0,k.nameCut))}}function j(E,C){if(1&E&&(t.TgZ(0,"td",4),t._uU(1),t.qZA()),2&E){const x=C.$implicit,k=t.oxw(2);t.Q6J("ngClass",x.slice(0,4)),t.xp6(1),t.Oqu(x.slice(4,k.nameCut+4))}}function G(E,C){if(1&E&&(t.TgZ(0,"tr")(1,"th"),t._uU(2),t.qZA(),t.YNc(3,j,2,2,"td",3),t.TgZ(4,"th"),t._uU(5),t.qZA()()),2&E){const x=C.$implicit;t.xp6(2),t.Oqu(x[0]),t.xp6(1),t.Q6J("ngForOf",x.slice(1,x.length-1)),t.xp6(2),t.Oqu(x[x.length-1])}}function W(E,C){if(1&E&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&E){const x=C.$implicit,k=t.oxw();t.xp6(1),t.Oqu(x.slice(0,k.nameCut))}}function e(E,C){if(1&E&&(t.TgZ(0,"tr")(1,"th",0),t._uU(2),t.qZA()()),2&E){const x=t.oxw();t.xp6(1),t.uIk("colspan",x.table[0].length),t.xp6(1),t.AsE("",x.appName," ",x.tripTitle,"")}}class b{static#e=this.RESULT_COLORS=Object.entries({oran:["-2","Erthys","Gnome","Saki","Saki Mitama","Random","\u30a2\u30fc\u30b7\u30fc\u30ba","\u30ce\u30fc\u30e0","\u30b5\u30ad\u30df\u30bf\u30de"],redd:["-1","Flaemis","Salamander","Ara ","Ara Mitama","Fiend","\u30d5\u30ec\u30a4\u30df\u30fc\u30ba","\u30b5\u30e9\u30de\u30f3\u30c0\u30fc","\u30a2\u30e9\u30df\u30bf\u30de"],gree:["1","Aeros","Sylph","Kusi","Kusi Mitama","UMA","\u30a8\u30a2\u30ed\u30b9","\u30b7\u30eb\u30ad\u30fc","\u30af\u30b7\u30df\u30bf\u30de"],blue:["2","Aquans","Undine","Nigi","Nigi Mitama","Enigma","\u30a2\u30af\u30a2\u30f3\u30ba","\u30a6\u30f3\u30c7\u30a3\u30fc\u30cd","\u30cb\u30ae\u30df\u30bf\u30de"]});constructor(C,x){this.title2=C,this.route=x,this.normTitle="Normal Fusions",this.tripTitle="",this.isPersona=!1,this.filterDarks=!0,this.langEn=!0,this.subscriptions=[],this.table=[],this.nameCut=4}ngOnInit(){this.subscriptions.push(this.route.parent.data.subscribe(C=>{this.appName=C.appName||"Shin Megami Tensei",this.nameCut=this.langEn?4:2,this.title2.setTitle(this.langEn?`Fusion Chart - ${this.appName} Fusion Calculator`:`\u5408\u4f53\u8868 ${this.appName} \u5408\u4f53\u30a2\u30d7\u30ea`)}))}ngOnChanges(){this.normChart&&this.fillFusionChart()}ngOnDestroy(){for(const C of this.subscriptions)C.unsubscribe()}fillFusionChart(){const C="noneNone",k=b.RESULT_COLORS.reduce((T,[A,y])=>y.reduce((U,X)=>(U[X]=A,U),T),{}),w=this.normChart.elementDemons;let h=[],D=this.normChart.races,p=[];this.filterDarks&&(h=this.normChart.races.filter(T=>this.normChart.getLightDark(T)>0),D=this.normChart.races.filter(T=>0===this.normChart.getLightDark(T)),p=this.normChart.races.filter(T=>-1===this.normChart.getLightDark(T)),0===p.length&&h.length>0&&(h=this.normChart.races.filter(T=>this.normChart.getLightDark(T)>-1),D=[],p=this.normChart.races.filter(T=>this.normChart.getLightDark(T)<-1)));const B=h.length-p.length,q=h.concat(D,w),ne=p.length?p.concat(Array(q.length-p.length).fill("")):q,he=this.mitaTable?q:h.concat(D,Array(w.length).fill("")),ie=this.mitaTable||p.length?Array(B).fill("").concat(p,D,w):q;this.table=[[""].concat(q,[""])];for(let T=0;T<ie.length;T++){const A=Array(q.length+2).fill("empt-"),y=ie[T],U=he[T],X=-1!==w.indexOf(y),ue=-1!==w.indexOf(U);this.table.push(A),A[0]=y,A[A.length-1]=U;for(let R=T;R<q.length;R++){const v=q[R],J=-1!==w.indexOf(v);if(J&&ue){const s=w.indexOf(U),l=w.indexOf(v),n=this.mitaTable[s][l-s-1];A[R+1]=n?(k[n]||"norm")+n:C}else if(J&&U){const s=this.normChart.getElemFusions(v)[U];A[R+1]=s?(k[s]||"rank")+(s>0?"+":"")+s.toString():C}else if(v&&U){const s=this.isPersona&&v===U?v:this.normChart.getRaceFusion(v,U);A[R+1]=s?(k[s]||(v===U?"elem":"norm"))+s:C}}if(this.tripChart)for(let R=0;R<=T-B;R++){const v=ne[R];if(v&&X){const J=this.tripChart.getElemFusions(y)[v];A[R+1]=J?(k[J]||"rank")+(J>0?"+":"")+J.toString():C}else if(v&&y){const J=this.tripChart.getRaceFusion(v,y);A[R+1]=J?(k[J]||(v===y?"elem":"trip"))+J:C}}if(-1!==y.indexOf(" x ")){const[R,v]=y.split(" x "),J=R.slice(0,3)+"x"+v.slice(0,3);A[0]=J,A[A.length-1]=J}else if(-1!==y.indexOf(" ")){const R=y.split(" ")[0];A[0]=R,A[A.length-1]=R}}for(let T=0;T<this.table[0].length;T++){const A=this.table[0][T];if(-1!==A.indexOf(" x ")){const[y,U]=A.split(" x ");this.table[0][T]=y.slice(0,2)+U.slice(0,2)}}this.table.push([""].concat(ne,[""]))}static#t=this.\u0275fac=function(x){return new(x||b)(t.Y36($.Dx),t.Y36(Q.gz))};static#n=this.\u0275cmp=t.Xpm({type:b,selectors:[["app-fusion-chart"]],inputs:{normChart:"normChart",tripChart:"tripChart",mitaTable:"mitaTable",normTitle:"normTitle",tripTitle:"tripTitle",isPersona:"isPersona",filterDarks:"filterDarks",langEn:"langEn",counter:"counter"},features:[t.TTD],decls:12,vars:7,consts:[[1,"title"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(x,k){1&x&&(t.TgZ(0,"table")(1,"tbody")(2,"tr")(3,"th",0),t._uU(4),t.qZA()(),t.TgZ(5,"tr"),t.YNc(6,V,2,1,"th",1),t.qZA(),t.YNc(7,G,6,3,"tr",1),t.TgZ(8,"tr"),t.YNc(9,W,2,1,"th",1),t.qZA(),t.YNc(10,e,3,3,"tr",2),t.qZA(),t._UZ(11,"tbody"),t.qZA()),2&x&&(t.xp6(3),t.uIk("colspan",k.table[0].length),t.xp6(1),t.AsE("",k.appName," ",k.normTitle,""),t.xp6(2),t.Q6J("ngForOf",k.table[0]),t.xp6(1),t.Q6J("ngForOf",k.table.slice(1,k.table.length-1)),t.xp6(2),t.Q6J("ngForOf",k.table[k.table.length-1]),t.xp6(1),t.Q6J("ngIf",k.tripTitle))},dependencies:[M.mk,M.sg,M.O5],styles:["table[_ngcontent-%COMP%]{width:auto;margin:0 auto;white-space:nowrap}td.elem[_ngcontent-%COMP%]{color:#0f0}td.trip[_ngcontent-%COMP%]{color:#d3d3d3}td.oran[_ngcontent-%COMP%]{color:orange}td.redd[_ngcontent-%COMP%]{color:red}td.gree[_ngcontent-%COMP%]{color:#0f0}td.blue[_ngcontent-%COMP%]{color:#0ff}td.none[_ngcontent-%COMP%]{color:transparent}td.empt[_ngcontent-%COMP%]{background-color:transparent;color:transparent}"],changeDetection:0})}},4436:(fe,H,S)=>{S.d(H,{X:()=>J});var t=S(6404);function Q(s,l){return parseInt(l.map(n=>s.includes(n)?"1":"0").join(""),2)||0}function M(s,l){return s.map((n,i,o)=>Q(o.slice(0,i+1),l))}function j(s,l,n,i,o,r){let a=n,m=[a];const _=i.getSpecialNameEntries(a),O=l[l.length-1];if(0!==_.length&&(a=_.find(d=>0===i.getSpecialNameEntries(d).length),m.unshift(_.filter(d=>d!==a).join(" x ")),m.unshift(a)),s.length>0){const d=function W(s,l,n,i,o){const{fusionCalculator:r}=o,a=s.slice(0,1);if(s.length<2)return a;let m=a[0],_=l[0];for(let O=1;O<s.length;O++){const d=s[O],f=l[O],g=r.getFusions(m,n,i).map(Z=>(0,t.D0)(Z,n)).sort((Z,L)=>Z.price-L.price);let F=!1;for(const Z of g)if(Z.name1===d&&(f&n.getDemon(Z.name2).inherits)===f){a.push(d),a.push(Z.name2),m=a[a.length-1],_=f,F=!0;break}if(F)continue;const N=r.getFusions(d,n,i).reduce((Z,L)=>(Z[L.name1]=L.name2,Z),{});for(const Z of g)if(N[Z.name2]&&(_&n.getDemon(Z.name2).inherits)===_&&(f&n.getDemon(N[Z.name2]).inherits)===f){a.push(Z.name1),a.push(Z.name2),a.push(d),a.push(N[Z.name2]),m=a[a.length-1],_=f,F=!0;break}if(!F)return[]}return a}(s,l,i,o,r);if(0===d.length)return[];const f=d[d.length-1];let g=G(f,a,O,i,o,r);if(0===g.length){const F=i.getDemon(a),Y=i.getResultDemonLvls(F.race).map(N=>i.reverseLookupDemon(F.race,N)).filter(N=>N!==a);for(const N of o.elementDemons.concat(Y)){if((O&i.getDemon(N).inherits)!==O)continue;const Z=G(f,N,O,i,o,r),L=G(N,a,O,i,o,r);if(0!==Z.length&&0!==L.length){g=Z.concat(L.slice(1));break}}}if(0===g.length)return[];m=d.concat(g.slice(1),m.slice(1))}return m}function G(s,l,n,i,o,r){const{fissionCalculator:a,fusionCalculator:m}=r,_=[s];if(s===l)return _;const O=m.getFusions(s,i,o).map(g=>(0,t.D0)(g,i)).sort((g,F)=>g.price-F.price);for(const g of O)if(g.name2===l)return _.push(g.name1),_.push(l),_;const d=a.getFusions(l,i,o).map(g=>(0,t.S6)(g,i)).sort((g,F)=>g.price-F.price);O.sort((g,F)=>F.price-g.price);const f=O.reduce((g,F)=>(g[F.name2]=F.name1,g),{});for(const g of d){if(f[g.name1]&&(n&i.getDemon(g.name1).inherits)===n)return _.push(f[g.name1]),_.push(g.name1),_.push(g.name2),_.push(l),_;if(f[g.name2]&&(n&i.getDemon(g.name2).inherits)===n)return _.push(f[g.name2]),_.push(g.name2),_.push(g.name1),_.push(l),_}return[]}var e=S(4769),b=S(95),E=S(6814);function C(s,l){if(1&s&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function x(s,l){if(1&s&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("ngValue",n),e.xp6(1),e.Oqu(n.name)}}function k(s,l){if(1&s&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function w(s,l){if(1&s&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("ngValue",n),e.xp6(1),e.Oqu(n.name)}}function h(s,l){if(1&s&&(e.TgZ(0,"option",16),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function D(s,l){if(1&s&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("ngValue",n),e.xp6(1),e.AsE("",n.name," ",n.lvl?"("+n.lvl+")":"","")}}function p(s,l){if(1&s&&(e.TgZ(0,"select",25),e.YNc(1,D,2,3,"option",8),e.qZA()),2&s){const n=e.oxw(2).$implicit,i=e.oxw();e.xp6(1),e.Q6J("ngForOf",i.learnedBy[n.controls.skill.value.name])}}function B(s,l){if(1&s&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("ngValue",n),e.xp6(1),e.AsE("",n.name," ",n.lvl?"("+n.lvl+")":"","")}}function q(s,l){if(1&s&&(e.TgZ(0,"select",25),e.YNc(1,B,2,3,"option",8),e.qZA()),2&s){const n=e.oxw(2).$implicit,i=e.oxw();e.xp6(1),e.Q6J("ngForOf",i.demons[n.controls.race.value])}}function ne(s,l){if(1&s){const n=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"label"),e._uU(3),e.TgZ(4,"input",20),e.NdJ("change",function(){e.CHM(n);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.setIngredDemon(o))}),e.qZA()()(),e.TgZ(5,"td")(6,"select",21),e.NdJ("change",function(){e.CHM(n);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.setIngredElem(o))}),e.TgZ(7,"option",22),e._uU(8,"-"),e.qZA(),e.YNc(9,k,2,2,"option",6),e.qZA()(),e.TgZ(10,"td")(11,"select",23),e.NdJ("change",function(){e.CHM(n);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.setIngredDemon(o))}),e.YNc(12,w,2,2,"option",8),e.qZA()(),e.TgZ(13,"td")(14,"select",5),e.NdJ("change",function(){e.CHM(n);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.setIngredDemon(o))}),e.TgZ(15,"option",22),e._uU(16,"-"),e.qZA(),e.YNc(17,h,2,2,"option",6),e.qZA()(),e.TgZ(18,"td"),e.YNc(19,p,2,1,"select",24),e.YNc(20,q,2,1,"select",24),e.qZA()()}if(2&s){const n=e.oxw(),i=n.index,o=n.$implicit,r=e.oxw();e.xp6(3),e.hij("",r.langEn?"Learns skill #"+(i+1):"\u30b9\u30ad\u30eb\u691c\u7d22"," "),e.xp6(3),e.uIk("disabled",!o.controls.searchSkill.value||null),e.xp6(3),e.Q6J("ngForOf",r.elems),e.xp6(2),e.uIk("disabled",!o.controls.searchSkill.value||null),e.xp6(1),e.Q6J("ngForOf",r.skills[o.controls.elem.value]),e.xp6(2),e.uIk("disabled",o.controls.searchSkill.value||null),e.xp6(3),e.Q6J("ngForOf",r.races),e.xp6(2),e.Q6J("ngIf",o.controls.searchSkill.value),e.xp6(1),e.Q6J("ngIf",!o.controls.searchSkill.value)}}function he(s,l){if(1&s&&(e.ynx(0,18),e.YNc(1,ne,21,9,"tr",19),e.BQk()),2&s){const n=l.index,i=e.oxw();e.Q6J("formGroupName",n),e.xp6(1),e.Q6J("ngIf",n<i.maxSkills)}}function ie(s,l){if(1&s&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.xp6(1),e.Oqu(n)}}function T(s,l){if(1&s&&(e.TgZ(0,"td",29)(1,"ul"),e.YNc(2,ie,2,1,"li",30),e.qZA()()),2&s){const n=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",n.recipeLeft)}}function A(s,l){if(1&s&&(e.TgZ(0,"td",31),e._uU(1),e.qZA()),2&s){const n=e.oxw(2);e.xp6(1),e.Oqu(n.langEn?"No chains found":"\u5408\u4f53\u306a\u3057")}}function y(s,l){if(1&s&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.xp6(1),e.Oqu(n)}}function U(s,l){if(1&s&&(e.TgZ(0,"td",29)(1,"ul"),e.YNc(2,y,2,1,"li",30),e.qZA()()),2&s){const n=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",n.recipeRight)}}function X(s,l){if(1&s&&(e.TgZ(0,"td",31),e._uU(1),e.qZA()),2&s){const n=e.oxw(2);e.xp6(1),e.Oqu(n.langEn?"No chains found":"\u5408\u4f53\u306a\u3057")}}function ue(s,l){if(1&s&&(e.ynx(0),e._uU(1),e._UZ(2,"br"),e._uU(3),e.BQk()),2&s){const n=e.oxw(2);e.xp6(1),e.AsE(" ",n.recipeResult.join(" x ")," = ",n.recipe.result,""),e.xp6(2),e.hij(" [",n.resultSkills.join(", "),"] ")}}function R(s,l){if(1&s&&(e.ynx(0),e._uU(1),e.BQk()),2&s){const n=e.oxw(2);e.xp6(1),e.Oqu(n.langEn?"No recipes found":"\u5408\u4f53\u306a\u3057")}}function v(s,l){if(1&s&&(e.TgZ(0,"table",1)(1,"tr")(2,"th",2),e._uU(3),e.qZA()(),e.TgZ(4,"tr")(5,"th"),e._uU(6),e.qZA(),e.TgZ(7,"th"),e._uU(8),e.qZA()(),e.TgZ(9,"tr"),e.YNc(10,T,3,1,"td",26),e.YNc(11,A,2,1,"td",27),e.YNc(12,U,3,1,"td",26),e.YNc(13,X,2,1,"td",27),e.qZA(),e.TgZ(14,"tr")(15,"td",28),e.YNc(16,ue,4,3,"ng-container",19),e.YNc(17,R,2,1,"ng-container",19),e.qZA()()()),2&s){const n=e.oxw();e.xp6(3),e.Oqu(n.langEn?"Fusion Recipe":"\u5408\u4f53\u30ec\u30b7\u30d4"),e.xp6(3),e.Oqu(n.langEn?"Left Chain":"\u5de6\u30ec\u30b7\u30d4"),e.xp6(2),e.Oqu(n.langEn?"Right Chain":"\u53f3\u30ec\u30b7\u30d4"),e.xp6(2),e.Q6J("ngIf",n.recipeLeft.length),e.xp6(1),e.Q6J("ngIf",!n.recipeLeft.length),e.xp6(1),e.Q6J("ngIf",n.recipeRight.length),e.xp6(1),e.Q6J("ngIf",!n.recipeRight.length),e.xp6(3),e.Q6J("ngIf",n.recipe.stepR.length),e.xp6(1),e.Q6J("ngIf",!n.recipe.stepR.length)}}let J=(()=>{class s{constructor(n){this.fb=n,this.maxSkills=8,this.langEn=!0,this.internalMaxSkills=9,this.range99=Array(99),this.demons={},this.skills={},this.learnedBy={},this.blankDemon={name:"-",race:"-",lvl:0,currLvl:0,price:0,inherits:0,skills:{},stats:[],resists:[],affinities:[],fusion:"normal",prereq:""},this.blankSkill={name:"-",element:"-",rank:99,cost:0,effect:"",target:"",level:0,learnedBy:[{demon:"-",level:0}]},this.createForm()}ngOnChanges(){this.initDropdowns()}createForm(){const n=[];for(let i=0;i<this.internalMaxSkills;i++)n.push(this.fb.group({searchSkill:!0,elem:"-",skill:this.blankSkill,race:"-",demon:this.blankDemon}));this.form=this.fb.group({race:"-",demon:this.blankDemon,ingreds:this.fb.array(n)}),this.form.valueChanges.subscribe(i=>{if(this.form.valid){const o=i.ingreds.filter(a=>"-"!==a.demon.name&&a.demon.name!==i.demon.name).map(a=>a.demon.name),r=i.ingreds.filter(a=>a.searchSkill&&"-"!==a.skill.name).map(a=>a.skill.name);this.updateRecipe(function $(s,l,n,i,o,r){const{fissionCalculator:a,inheritElems:m,restrictInherits:_,triExclusiveRaces:O,triFissionCalculator:d}=r,{normalChart:f}=o,g=i.getDemon(s),F=n.map(c=>i.getSkill(c)).filter((c,u,I)=>c.rank<50&&c.learnedBy.length>0&&!g.skills.hasOwnProperty(c.name)&&I.indexOf(c)===u),Y=Q(F.map(c=>c.element),m);let N=i.getSpecialNameEntries(s);if(N.length<2&&O.includes(g.race)){const c=d.getFusions(s,i,o).map(u=>(0,t.Aw)(u,i)).sort((u,I)=>u.price-I.price).find(u=>!((Y&(u.d1.inherits|u.d2.inherits))!==Y||"special"!==u.d1.fusion&&O.includes(u.d1.race)||"special"!==u.d2.fusion&&O.includes(u.d2.race)||"special"!==u.d3.fusion&&O.includes(u.d3.race)));c&&(N=[c.d1.name,c.d2.name,c.d3.name])}if(N.length<2){const c=a.getFusions(s,i,f).map(u=>(0,t.S6)(u,i)).sort((u,I)=>u.price-I.price).find(u=>!((Y&(i.getDemon(u.name1).inherits|i.getDemon(u.name2).inherits))!==Y||"normal"!==i.getDemon(u.name1).fusion&&"special"!==i.getDemon(u.name1).fusion||"normal"!==i.getDemon(u.name2).fusion&&"special"!==i.getDemon(u.name2).fusion));c&&(N=[c.name1,c.name2])}const Z=N.map(c=>i.getDemon(c)).sort((c,u)=>u.price-c.price),L=l.map(c=>i.getDemon(c)).sort((c,u)=>u.price-c.price),me={},K={};for(const c of F){for(const u of Z)u.skills.hasOwnProperty(c.name)&&(me[c.name]=u.name);if(!me[c.name])for(const u of L)u.skills.hasOwnProperty(c.name)&&(K[c.name]=u.name)}const pe=Object.keys(K).map(c=>i.getSkill(c)),se=Q(pe.map(c=>c.element),m),xe=pe.map(c=>Q([c.element],m));let oe,ge,_e=0;for(let c=0;c<Z.length;c++){const u=Z[c];for(const I of Z.slice(c+1))if((se&(u.inherits|I.inherits))===se){const de=(se&u.inherits).toString(2).split("1").length*(se&I.inherits).toString(2).split("1").length;_e<de&&(oe=u,ge=I,_e=de)}}const re={chain1:[],chain2:[],stepR:N,skills:Object.assign(K,me),result:s};if(!oe)return re;const z=Object.values(K).filter((c,u,I)=>I.indexOf(c)===u),le=l.filter(c=>!z.includes(c));let P=Math.ceil(z.length/2);z.sort((c,u)=>f.getLightDark(i.getDemon(c).race)-f.getLightDark(i.getDemon(u).race));let ee=z.slice(0,P),ae=Array(ee.length).fill(0),te=z.slice(P),ce=Array(te.length).fill(0);if(_){const{left:c,right:u}=function V(s,l,n,i){let o=[],r=[];const a=[],m=[],_={},O=[];for(let d=0;d<n.length;d++){const f=n[d];0!==f?(_.hasOwnProperty(f)||(_[f]=[]),_[f].push(i[d])):O.push(i[d])}for(const d of Object.keys(_).sort()){const f=parseInt(d);a.length<=m.length?(f&s)===f?a.push(f):m.push(f):(f&l)===f?m.push(f):a.push(f)}for(const d of a)o=o.concat(_[d]);for(const d of m)r=r.concat(_[d]);for(const d of O)o.length<r.length?o.push(d):r.push(d);return{left:o.reverse(),right:r.reverse()}}(oe.inherits,ge.inherits,xe,pe.map(I=>I.name));ee=c.map(I=>K[I]),ae=M(c.map(I=>i.getSkill(I).element),m),te=u.map(I=>K[I]),ce=M(u.map(I=>i.getSkill(I).element),m)}return P=Math.ceil(le.length/2),ee=le.slice(0,P).concat(ee),ae=Array(P).fill(0).concat(ae),te=le.slice(P).concat(te),ce=Array(le.length-P).fill(0).concat(ce),re.chain1=j(ee,ae,oe.name,i,f,r),re.chain2=j(te,ce,ge.name,i,f,r),re}(i.demon.name,o,r,this.compendium,this.squareChart,this.recipeConfig))}})}setIngredElem(n){n.controls.skill.setValue(this.skills[n.controls.elem.value][0]),this.setIngredDemon(n)}setIngredDemon(n){n.controls.demon.setValue((n.controls.searchSkill.value?this.learnedBy[n.controls.skill.value.name]:this.demons[n.controls.race.value])[0])}updateRecipe(n){const i={};for(const[o,r]of Object.entries(n.skills)){i[r]||(i[r]=[]);const a=this.compendium.getDemon(r).skills[o];i[r].push(o+(a>=2?` (${a})`:""))}this.recipe=n,this.recipeLeft=this.decodeRecipechain(n.chain1,i),this.recipeRight=this.decodeRecipechain(n.chain2,i),this.resultSkills=[],this.recipeResult=[];for(const o of n.stepR)this.recipeResult.push(i[o]?`${o} [${i[o].join(", ")}]`:o);for(const[o,r]of Object.entries(this.compendium.getDemon(n.result).skills).filter(a=>a[1]<2e3).sort((a,m)=>a[1]-m[1]))this.resultSkills.push(o+(r>=2?` (${r})`:""))}decodeRecipechain(n,i){const o=[];for(let r=0;r<n.length-2;r+=2){const a=i[n[r]]?"["+i[n[r]].join(", ")+"] ":"",m=i[n[r+1]]?"["+i[n[r+1]].join(", ")+"] ":"";o.push(`${n[r]} ${a}x ${n[r+1]} ${m}= ${n[r+2]}`)}return o}initDropdowns(){if(this.recipeConfig&&this.compendium&&this.squareChart){this.demons={"-":[this.blankDemon]},this.skills={"-":[this.blankSkill]},this.learnedBy={"-":[this.blankDemon]};for(const n of this.compendium.allDemons)if(!n.isEnemy&&"party"!==n.fusion&&"enemy"!==n.fusion){this.demons[n.race]||(this.demons[n.race]=[]),this.demons[n.race].push(n);for(const i of Object.keys(n.skills))this.learnedBy[i]||(this.learnedBy[i]=[]),this.learnedBy[i].push(n)}for(const n of this.compendium.allSkills.filter(i=>i.rank<50&&i.learnedBy.length>0))this.skills[n.element]||(this.skills[n.element]=[]),this.skills[n.element].push(n);for(const n of Object.values(this.demons))n.sort((i,o)=>i.lvl-o.lvl);for(const n of Object.values(this.learnedBy))n.sort((i,o)=>i.lvl-o.lvl);for(const n of Object.values(this.skills))n.sort((i,o)=>i.rank-o.rank);this.races=this.recipeConfig.races.filter(n=>this.demons[n]),this.elems=this.recipeConfig.skillElems.filter(n=>this.skills[n]),this.setDemon(this.compendium.getDemon(this.recipeConfig.defaultDemon))}}setDemon(n){const i=[],{inheritElems:o}=this.recipeConfig,r=Object.entries(n.skills).slice(0,this.internalMaxSkills).filter(m=>m[1]<2).map(m=>this.compendium.getSkill(m[0])),a=Object.entries(n.skills).slice(0,this.internalMaxSkills).filter(m=>m[1]<100).map(m=>this.compendium.getSkill(m[0]));for(let m=0;m<o.length;m++)n.inherits&1<<m||i.push(o[o.length-m-1]);this.skills[this.blankSkill.element]=[this.blankSkill].concat(a),this.elems=this.recipeConfig.skillElems.filter(m=>this.skills[m]&&!i.includes(m)),this.form.patchValue({race:n.race,demon:n,ingreds:r.concat(Array(this.internalMaxSkills-r.length).fill(this.blankSkill)).map(m=>({searchSkill:!0,elem:"-",skill:m,race:"-",demon:"-"!==m.name?n:this.blankDemon}))})}static#e=this.\u0275fac=function(i){return new(i||s)(e.Y36(b.qu))};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["app-recipe-generator"]],inputs:{maxSkills:"maxSkills",compendium:"compendium",squareChart:"squareChart",recipeConfig:"recipeConfig",langEn:"langEn"},features:[e.TTD],decls:36,vars:15,consts:[[3,"formGroup"],[1,"entry-table"],["colspan","2",1,"title"],[2,"width","40%"],[2,"width","60%"],["formControlName","race",3,"change"],[3,"value",4,"ngFor","ngForOf"],["formControlName","demon",3,"change"],[3,"ngValue",4,"ngFor","ngForOf"],["formArrayName","ingreds",1,"entry-table"],["colspan","5",1,"title"],[2,"width","20%"],[2,"width","10%"],[2,"width","25%"],[3,"formGroupName",4,"ngFor","ngForOf"],["class","entry-table",4,"ngIf"],[3,"value"],[3,"ngValue"],[3,"formGroupName"],[4,"ngIf"],["formControlName","searchSkill","type","checkbox",3,"change"],["formControlName","elem",3,"change"],["value","-"],["formControlName","skill",3,"change"],["formControlName","demon",4,"ngIf"],["formControlName","demon"],["style","width: 50%",4,"ngIf"],["style","width: 50%","style","padding: 1em; text-align: center;",4,"ngIf"],["colspan","2",2,"padding","1em","text-align","center"],[2,"width","50%"],[4,"ngFor","ngForOf"],[2,"padding","1em","text-align","center"]],template:function(i,o){1&i&&(e.TgZ(0,"form",0)(1,"h2"),e._uU(2),e.qZA(),e.TgZ(3,"table",1)(4,"tr")(5,"th",2),e._uU(6),e.qZA()(),e.TgZ(7,"tr")(8,"th",3),e._uU(9),e.qZA(),e.TgZ(10,"th",4),e._uU(11),e.qZA()(),e.TgZ(12,"tr")(13,"td")(14,"select",5),e.NdJ("change",function(){return o.setDemon(o.demons[o.form.controls.race.value][0])}),e.YNc(15,C,2,2,"option",6),e.qZA()(),e.TgZ(16,"td")(17,"select",7),e.NdJ("change",function(){return o.setDemon(o.form.controls.demon.value)}),e.YNc(18,x,2,2,"option",8),e.qZA()()()(),e.TgZ(19,"table",9)(20,"tr")(21,"th",10),e._uU(22),e.qZA()(),e.TgZ(23,"tr")(24,"th",11),e._uU(25),e.qZA(),e.TgZ(26,"th",12),e._uU(27),e.qZA(),e.TgZ(28,"th",13),e._uU(29),e.qZA(),e.TgZ(30,"th",11),e._uU(31),e.qZA(),e.TgZ(32,"th",13),e._uU(33),e.qZA()(),e.YNc(34,he,2,2,"ng-container",14),e.qZA(),e.YNc(35,v,18,9,"table",15),e.qZA()),2&i&&(e.Q6J("formGroup",o.form),e.xp6(2),e.Oqu(o.langEn?"Recipe Generator":"\u5408\u4f53\u30ec\u30b7\u30d4"),e.xp6(4),e.Oqu(o.langEn?"Target":"\u60aa\u9b54"),e.xp6(3),e.Oqu(o.langEn?"Race":"\u7a2e\u65cf"),e.xp6(2),e.Oqu(o.langEn?"Name":"\u60aa\u9b54\u540d"),e.xp6(4),e.Q6J("ngForOf",o.races),e.xp6(3),e.Q6J("ngForOf",o.demons[o.form.controls.race.value]),e.xp6(4),e.Oqu(o.langEn?"Include Ingredients":"\u7d20\u6750\u60aa\u9b54"),e.xp6(3),e.Oqu(o.langEn?"Filter By":"\u30b9\u30ad\u30eb\u691c\u7d22"),e.xp6(2),e.Oqu(o.langEn?"Elem":"\u5c5e\u6027"),e.xp6(2),e.Oqu(o.langEn?"Skill":"\u30b9\u30ad\u30eb\u540d"),e.xp6(2),e.Oqu(o.langEn?"Race":"\u7a2e\u65cf"),e.xp6(2),e.Oqu(o.langEn?"Ingredient":"\u60aa\u9b54\u540d"),e.xp6(1),e.Q6J("ngForOf",o.form.controls.ingreds.controls),e.xp6(1),e.Q6J("ngIf",o.recipe))},dependencies:[E.sg,E.O5,b._Y,b.YN,b.Kr,b.Wl,b.EJ,b.JJ,b.JL,b.sg,b.u,b.x0,b.CE],styles:["ul[_ngcontent-%COMP%]{padding:0 1em;list-style:none}td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-height:25px;width:100%}"],changeDetection:0})}return s})()}}]);